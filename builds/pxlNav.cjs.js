"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var i=t(e),s=Object.create,r=Object.defineProperty,a=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,o=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,h=(e,t)=>()=>(e&&(t=e(e=0)),t),c=(e,t)=>{for(var i in t)r(e,i,{get:t[i],enumerable:!0})},d=(e,t,i,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of n(t))!l.call(e,o)&&o!==i&&r(e,o,{get:()=>t[o],enumerable:!(s=a(t,o))||s.enumerable});return e},u={};c(u,{ExtensionBase:()=>A});var A,p=h((()=>{A=class{constructor(e=null){this.extType=e||"ExtensionBase",this.active=!1,this.verbose=!1,this.callbacks={}}init(){}start(){this.active=!0}pause(){this.stop()}stop(){this.active=!1}subscribe(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter((e=>e!==t)))}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach((e=>e(t)))}destroy(){this.disable()}}})),m={};c(m,{default:()=>f});var g,f,v=h((()=>{p(),g=class{constructor(e,t){this.url=e,this.options=t}on(e,t){}emit(e,t){}},f=class extends A{constructor(e){super("Networking"),this.status=!1,this.accessToken="",this.jwtToken="",this.socket=g("https://www.www.com",{transports:["websocket"]})}init(){this.socket.on("event",(e=>{console.log(e)})),this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("authenticated",this.onAuthenticated),this.socket.on("unauthorized",console.error)}onConnect(){console.log("Successfully connected to the websocket"),this.socket.emit("authenticate",{method:"jwt",token:this.jwtToken})}onDisconnect(){console.log("Disconnected from websocket"),this.status=!1,this.onConnect()}onAuthenticated(e){let{channelId:t}=e;console.log(`Successfully connected to channel ${t}`),this.status=!0}}})),b={};c(b,{MediaPipePoseEngine:()=>x});var x,C=h((()=>{x=class e{constructor(){this.workerScriptUrl="./PoseEngine_worker.js",this.worker=null,this.booted=!1}static async loadScriptWithProgress(e,t){return new Promise(((i,s)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="text",r.onprogress=e=>{if(e.lengthComputable&&"function"==typeof t){let i=Math.round(e.loaded/e.total*100);t(i)}},r.onload=()=>{if(200===r.status){let e=document.createElement("script");e.textContent=r.responseText,document.head.appendChild(e),i()}else s(new Error(`Failed to load script: ${e}`))},r.onerror=()=>s(new Error(`Network error while loading: ${e}`)),r.send()}))}async init(t){try{console.log("Loading MediaPipe..."),await e.loadScriptWithProgress("https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js",t),this.worker=new Worker(this.workerScriptUrl),this.booted=!0,console.log("MediaPipe Pose Engine Initialized")}catch(e){console.error("Error initializing MediaPipePoseEngine:",e)}}sendMessage(e){this.booted?this.worker.postMessage(e):console.warn("MediaPipePoseEngine is not initialized.")}onMessage(e){this.worker?this.worker.onmessage=t=>e(t.data):console.warn("WebWorker not initialized.")}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,console.log("WebWorker terminated."))}}})),y={};c(y,{default:()=>I,pxlPoseEngineList:()=>E});var E,I,B,w,S=h((()=>{p(),C(),E=["MediaPipe"],I=class extends A{constructor(e){if("MediaPipe"!==(super(),this.active=!1,this.verbose=!1,e))throw new Error("Unknown pose estimation '"+e+"' model");this.model=new x}async estimatePose(e){return await this.model.estimate(e)}}})),D=(B=()=>{self.onmessage=async e=>{let{type:t,data:i}=e.data;switch(t){case"init":await(async()=>{try{console.log("Pose model initialization placeholder")}catch(e){console.error("Failed to initialize pose model:",e)}})(),self.postMessage({type:"initialized"});break;case"processFrame":return void self.postMessage({type:"error",error:"Pose model not initialized"});default:console.warn("Unknown message type:",t)}}},()=>(w||B((w={exports:{}}).exports,w),w.exports)),P={};c(P,{WebCamera:()=>T});var T,R,M=h((()=>{p(),T=class extends A{constructor(){super("WebCamera"),this.video=document.createElement("video"),this.stream=null,this.isInitialized=!1,this.active=!1}init(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((t=>{this.stream=t,this.video.srcObject=this.stream,this.video.play(),this.isInitialized=!0,console.log("WebCamera Initialized"),e&&e(null)})).catch((t=>{console.error("Error initializing WebCamera:",t),e&&e(t)}))}start(e){this.isInitialized?(this.active=!0,console.log("WebCamera Started"),e&&e(null)):(console.error("WebCamera is not initialized"),e&&e(new Error("WebCamera is not initialized")))}pause(e){this.stop(e)}stop(e){this.stream?(this.stream.getTracks().forEach((e=>e.stop())),this.video.srcObject=null,this.isInitialized=!1,console.log("WebCamera Stopped"),this.active=!1,e&&e(null)):e&&e(new Error("WebCamera is not initialized"))}}})),L=h((()=>{R=(e=>t=>{var i=e[t];if(i)return i();throw new Error("Module not found in bundle: "+t)})({"./ExtensionBase.js":()=>Promise.resolve().then((()=>(p(),u))),"./Extensions.js":()=>Promise.resolve().then((()=>(F(),k))),"./Networking.js":()=>Promise.resolve().then((()=>(v(),m))),"./PoseEngine.js":()=>Promise.resolve().then((()=>(S(),y))),"./PoseEngine/MediaPipe.js":()=>Promise.resolve().then((()=>(C(),b))),"./PoseEngine/PoseEngine_worker.js":()=>Promise.resolve().then((()=>((e,t,i)=>(i=null!=e?s(o(e)):{},d(e&&e.__esModule?i:r(i,"default",{value:e,enumerable:!0}),e)))(D()))),"./WebCam.js":()=>Promise.resolve().then((()=>(M(),P)))})})),k={};c(k,{Extensions:()=>O});var Q,O,F=h((()=>{L(),Q=["PoseEngine"],O=class{constructor(){this.plugins={},this.verbose=!1}init(e,t,i,s=!1){!this.plugins[e]||s?this.load(e,((e,s)=>{e?i?i(e):this.verbose&&console.error(e):t&&t(s)})):(this.verbose&&console.log(`Extension ${e} already booted, skipping...`),t&&t(this.plugins[e]))}async load(e,t){if(Q.includes(e))try{let i=new((await R(`./${e}.js`)).default);try{this.boot(e,i)}catch(t){console.error(`Error (2) Booting extension '${e}':`,t)}t&&t(null,i)}catch(i){console.error(`Error (1) Importing / Parsing extension '${e}':`,i),t&&t(i,null)}else{let i=new Error(`Extension ${e} not found`);console.error(i),t&&t(i,null)}}start(e){let t=this.get(e);t&&t.start()}pause(e){let t=this.get(e);t&&t.pause()}stop(e){let t=this.get(e);t&&t.stop()}status(e){let t=this.get(e);return!!t&&t.active}boot(e,t){this.plugins[e]=t,t.init()}get(e){return this.plugins[e]?this.plugins[e]:(console.warn(`Extension ${e} not found`),null)}unload(e){let t=this.get(e);t&&(t.destroy(),delete this.plugins[e])}}})),G={};c(G,{BufferGeometryUtils:()=>Xe,CopyShader:()=>U,DRACOLoader:()=>ci,EffectComposer:()=>K,FBXLoader:()=>Le,FullScreenQuad:()=>H,GLTFLoader:()=>dt,KTX2Loader:()=>wi,LuminosityHighPassShader:()=>Y,MeshoptDecoder:()=>Ri,Pass:()=>_,RenderPass:()=>q,ShaderPass:()=>V,UnrealBloomPass:()=>J}),((e,t)=>{d(e,t,"default")})(G,i);var U={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform float opacity;\n\nuniform sampler2D tDiffuse;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texel = texture2D( tDiffuse, vUv );\n\tgl_FragColor = opacity * texel;\n\n}"},_=class{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}},N=new e.OrthographicCamera(-1,1,1,-1,0,1),j=new class extends e.BufferGeometry{constructor(){super(),this.setAttribute("position",new e.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new e.Float32BufferAttribute([0,2,0,0,2,0],2))}},H=class{constructor(t){this._mesh=new e.Mesh(j,t)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,N)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},V=class extends _{constructor(t,i){super(),this.textureID=void 0!==i?i:"tDiffuse",t instanceof e.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new H(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}},W=class extends _{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){let s,r,a=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(s=0,r=1):(s=1,r=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),n.buffers.stencil.setFunc(a.ALWAYS,s,4294967295),n.buffers.stencil.setClear(r),n.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(a.EQUAL,1,4294967295),n.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),n.buffers.stencil.setLocked(!0)}},z=class extends _{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}},K=class{constructor(t,i){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===i){let s=t.getSize(new e.Vector2);this._width=s.width,this._height=s.height,(i=new e.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:e.HalfFloatType})).texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new V(U),this.copyPass.material.blending=e.NoBlending,this.clock=new e.Clock}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),i=!1;for(let t=0,s=this.passes.length;t<s;t++){let s=this.passes[t];if(!1!==s.enabled){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),s.needsSwap){if(i){let t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==W&&(s instanceof W?i=!0:s instanceof z&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(t){if(void 0===t){let i=this.renderer.getSize(new e.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}},q=class extends _{constructor(t,i,s=null,r=null,a=null){super(),this.scene=t,this.camera=i,this.overrideMaterial=s,this.clearColor=r,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new e.Color}render(e,t,i){let s,r,a=e.autoClear;e.autoClear=!1,null!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(s),null!==this.overrideMaterial&&(this.scene.overrideMaterial=r),e.autoClear=a}},Y={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new e.Color(0)},defaultOpacity:{value:0}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvUv = uv;\n\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nuniform vec3 defaultColor;\nuniform float defaultOpacity;\nuniform float luminosityThreshold;\nuniform float smoothWidth;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\tfloat v = luminance( texel.xyz );\n\n\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\tgl_FragColor = mix( outputColor, texel, alpha );\n\n}"},J=class t extends _{constructor(t,i,s,r){super(),this.strength=void 0!==i?i:1,this.radius=s,this.threshold=r,this.resolution=void 0!==t?new e.Vector2(t.x,t.y):new e.Vector2(256,256),this.clearColor=new e.Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new e.WebGLRenderTarget(a,n,{type:e.HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){let i=new e.WebGLRenderTarget(a,n,{type:e.HalfFloatType});i.texture.name="UnrealBloomPass.h"+t,i.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(i);let s=new e.WebGLRenderTarget(a,n,{type:e.HalfFloatType});s.texture.name="UnrealBloomPass.v"+t,s.texture.generateMipmaps=!1,this.renderTargetsVertical.push(s),a=Math.round(a/2),n=Math.round(n/2)}let o=Y;this.highPassUniforms=e.UniformsUtils.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new e.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];let l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[t])),this.separableBlurMaterials[t].uniforms.invSize.value=new e.Vector2(1/a,1/n),a=Math.round(a/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;let h=U;this.copyUniforms=e.UniformsUtils.clone(h.uniforms),this.blendMaterial=new e.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:e.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new e.Color,this.oldClearAlpha=1,this.basic=new e.MeshBasicMaterial,this.fsQuad=new H(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,i){let s=Math.round(t/2),r=Math.round(i/2);this.renderTargetBright.setSize(s,r);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(s,r),this.renderTargetsVertical[t].setSize(s,r),this.separableBlurMaterials[t].uniforms.invSize.value=new e.Vector2(1/s,1/r),s=Math.round(s/2),r=Math.round(r/2)}render(e,i,s,r,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=s.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let i=0;i<this.nMips;i++)this.fsQuad.material=this.separableBlurMaterials[i],this.separableBlurMaterials[i].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[i].uniforms.direction.value=t.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[i]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[i].uniforms.colorTexture.value=this.renderTargetsHorizontal[i].texture,this.separableBlurMaterials[i].uniforms.direction.value=t.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[i]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[i];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(t){let i=[];for(let e=0;e<t;e++)i.push(.39894*Math.exp(-.5*e*e/(t*t))/t);return new e.ShaderMaterial({defines:{KERNEL_RADIUS:t},uniforms:{colorTexture:{value:null},invSize:{value:new e.Vector2(.5,.5)},direction:{value:new e.Vector2(.5,.5)},gaussianCoefficients:{value:i}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new e.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}};J.BlurDirectionX=new e.Vector2(1,0),J.BlurDirectionY=new e.Vector2(0,1);var X=Uint8Array,Z=Uint16Array,$=Int32Array,ee=new X([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),te=new X([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ie=new X([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),se=function(e,t){for(var i=new Z(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var r=new $(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)r[a]=a-i[s]<<5|s;return{b:i,r:r}},re=se(ee,2),ae=re.b,ne=re.r;ae[28]=258,ne[258]=28;var oe=se(te,0).b,le=new Z(32768);for(ue=0;ue<32768;++ue)he=(61680&(he=(52428&(he=(43690&ue)>>1|(21845&ue)<<1))>>2|(13107&he)<<2))>>4|(3855&he)<<4,le[ue]=((65280&he)>>8|(255&he)<<8)>>1;var he,ce=function(e,t,i){for(var s=e.length,r=0,a=new Z(t);r<s;++r)e[r]&&++a[e[r]-1];var n,o=new Z(t);for(r=1;r<t;++r)o[r]=o[r-1]+a[r-1]<<1;n=new Z(1<<t);var l=15-t;for(r=0;r<s;++r)if(e[r])for(var h=r<<4|e[r],c=t-e[r],d=o[e[r]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)n[le[d]>>l]=h;return n},de=new X(288);for(ue=0;ue<144;++ue)de[ue]=8;for(ue=144;ue<256;++ue)de[ue]=9;for(ue=256;ue<280;++ue)de[ue]=7;for(ue=280;ue<288;++ue)de[ue]=8;var ue,Ae=new X(32);for(ue=0;ue<32;++ue)Ae[ue]=5;var pe=ce(de,9),me=ce(Ae,5),ge=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},fe=function(e,t,i){var s=t/8|0;return(e[s]|e[s+1]<<8)>>(7&t)&i},ve=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},be=function(e){return(e+7)/8|0},xe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ce=function(e,t,i){var s=new Error(t||xe[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,Ce),!i)throw s;return s},ye=function(e,t,i,s){var r=e.length;if(!r||t.f&&!t.l)return i||new X(0);var a=!i,n=a||2!=t.i,o=t.i;a&&(i=new X(3*r));var l=function(e){var t=i.length;if(e>t){var s=new X(Math.max(2*t,e));s.set(i),i=s}},h=t.f||0,c=t.p||0,d=t.b||0,u=t.l,A=t.d,p=t.m,m=t.n,g=8*r;do{if(!u){h=fe(e,c,1);var f=fe(e,c+1,3);if(c+=3,!f){var v=e[(P=be(c)+4)-4]|e[P-3]<<8,b=P+v;if(b>r){o&&Ce(0);break}n&&l(d+v),i.set(e.subarray(P,b),d),t.b=d+=v,t.p=c=8*b,t.f=h;continue}if(1==f)u=pe,A=me,p=9,m=5;else if(2==f){var x=fe(e,c,31)+257,C=fe(e,c+10,15)+4,y=x+fe(e,c+5,31)+1;c+=14;for(var E=new X(y),I=new X(19),B=0;B<C;++B)I[ie[B]]=fe(e,c+3*B,7);c+=3*C;var w=ge(I),S=(1<<w)-1,D=ce(I,w);for(B=0;B<y;){var P,T=D[fe(e,c,S)];if(c+=15&T,(P=T>>4)<16)E[B++]=P;else{var R=0,M=0;for(16==P?(M=3+fe(e,c,3),c+=2,R=E[B-1]):17==P?(M=3+fe(e,c,7),c+=3):18==P&&(M=11+fe(e,c,127),c+=7);M--;)E[B++]=R}}var L=E.subarray(0,x),k=E.subarray(x);p=ge(L),m=ge(k),u=ce(L,p),A=ce(k,m)}else Ce(1);if(c>g){o&&Ce(0);break}}n&&l(d+131072);for(var Q=(1<<p)-1,O=(1<<m)-1,F=c;;F=c){var G=(R=u[ve(e,c)&Q])>>4;if((c+=15&R)>g){o&&Ce(0);break}if(R||Ce(2),G<256)i[d++]=G;else{if(256==G){F=c,u=null;break}var U=G-254;if(G>264){var _=ee[B=G-257];U=fe(e,c,(1<<_)-1)+ae[B],c+=_}var N=A[ve(e,c)&O],j=N>>4;N||Ce(3),c+=15&N;k=oe[j];if(j>3){_=te[j];k+=ve(e,c)&(1<<_)-1,c+=_}if(c>g){o&&Ce(0);break}n&&l(d+131072);var H=d+U;if(d<k){var V=0-k,W=Math.min(k,H);for(V+d<0&&Ce(3);d<W;++d)i[d]=s[V+d]}for(;d<H;++d)i[d]=i[d-k]}}t.l=u,t.p=F,t.b=d,t.f=h,u&&(h=1,t.m=p,t.d=A,t.n=m)}while(!h);return d!=i.length&&a?function(e,t,i){return(null==i||i>e.length)&&(i=e.length),new X(e.subarray(t,i))}(i,0,d):i.subarray(0,d)},Ee=new X(0);function Ie(e,t){return ye(e.subarray(function(e){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&Ce(6,"invalid zlib data"),1==(e[1]>>5&1)&&Ce(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)}(e),-4),{i:2},t,t)}var Be="undefined"!=typeof TextDecoder&&new TextDecoder;try{Be.decode(Ee,{stream:!0})}catch(B){}function we(e,t,i){let s=i.length-e-1;if(t>=i[s])return s-1;if(t<=i[e])return e;let r=e,a=s,n=Math.floor((r+a)/2);for(;t<i[n]||t>=i[n+1];)t<i[n]?a=n:r=n,n=Math.floor((r+a)/2);return n}function Se(e,t){let i=1;for(let t=2;t<=e;++t)i*=t;let s=1;for(let e=2;e<=t;++e)s*=e;for(let i=2;i<=e-t;++i)s*=i;return i/s}function De(t,i,s,r,a){let n=function(t,i,s,r,a){let n=a<t?a:t,o=[],l=we(t,r,i),h=function(e,t,i,s,r){let a=[];for(let e=0;e<=i;++e)a[e]=0;let n=[];for(let e=0;e<=s;++e)n[e]=a.slice(0);let o=[];for(let e=0;e<=i;++e)o[e]=a.slice(0);o[0][0]=1;let l=a.slice(0),h=a.slice(0);for(let s=1;s<=i;++s){l[s]=t-r[e+1-s],h[s]=r[e+s]-t;let i=0;for(let e=0;e<s;++e){let t=h[e+1],r=l[s-e];o[s][e]=t+r;let a=o[e][s-1]/o[s][e];o[e][s]=i+t*a,i=r*a}o[s][s]=i}for(let e=0;e<=i;++e)n[0][e]=o[e][i];for(let e=0;e<=i;++e){let t=0,r=1,l=[];for(let e=0;e<=i;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=s;++a){let s=0,h=e-a,c=i-a;e>=a&&(l[r][0]=l[t][0]/o[c+1][h],s=l[r][0]*o[h][c]);let d=e-1<=c?a-1:i-e;for(let e=h>=-1?1:-h;e<=d;++e)l[r][e]=(l[t][e]-l[t][e-1])/o[c+1][h+e],s+=l[r][e]*o[h+e][c];e<=c&&(l[r][a]=-l[t][a-1]/o[c+1][e],s+=l[r][a]*o[e][c]),n[a][e]=s;let u=t;t=r,r=u}}let c=i;for(let e=1;e<=s;++e){for(let t=0;t<=i;++t)n[e][t]*=c;c*=i-e}return n}(l,r,t,n,i),c=[];for(let e=0;e<s.length;++e){let t=s[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let e=0;e<=n;++e){let i=c[l-t].clone().multiplyScalar(h[e][0]);for(let s=1;s<=t;++s)i.add(c[l-t+s].clone().multiplyScalar(h[e][s]));o[e]=i}for(let t=n+1;t<=a+1;++t)o[t]=new e.Vector4(0,0,0);return o}(t,i,s,r,a);return function(t){let i=t.length,s=[],r=[];for(let a=0;a<i;++a){let i=t[a];s[a]=new e.Vector3(i.x,i.y,i.z),r[a]=i.w}let a=[];for(let e=0;e<i;++e){let t=s[e].clone();for(let i=1;i<=e;++i)t.sub(a[e-i].clone().multiplyScalar(Se(e,i)*r[i]));a[e]=t.divideScalar(r[0])}return a}(n)}var Pe,Te,Re,Me=class extends e.Curve{constructor(t,i,s,r,a){super();let n=i?i.length-1:0,o=s?s.length:0;this.degree=t,this.knots=i,this.controlPoints=[],this.startKnot=r||0,this.endKnot=a||n;for(let t=0;t<o;++t){let i=s[t];this.controlPoints[t]=new e.Vector4(i.x,i.y,i.z,i.w)}}getPoint(t,i=new e.Vector3){let s=i,r=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(t,i,s,r){let a=we(t,r,i),n=function(e,t,i,s){let r=[],a=[],n=[];r[0]=1;for(let o=1;o<=i;++o){a[o]=t-s[e+1-o],n[o]=s[e+o]-t;let i=0;for(let e=0;e<o;++e){let t=n[e+1],s=a[o-e],l=r[e]/(t+s);r[e]=i+t*l,i=s*l}r[o]=i}return r}(a,r,t,i),o=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){let i=s[a-t+e],r=n[e],l=i.w*r;o.x+=i.x*l,o.y+=i.y*l,o.z+=i.z*l,o.w+=i.w*r}return o}(this.degree,this.knots,this.controlPoints,r);return 1!==a.w&&a.divideScalar(a.w),s.set(a.x,a.y,a.z)}getTangent(t,i=new e.Vector3){let s=i,r=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),a=De(this.degree,this.knots,this.controlPoints,r,1);return s.copy(a[1]).normalize(),s}toJSON(){let e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map((e=>e.toArray())),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(t){return super.fromJSON(t),this.degree=t.degree,this.knots=[...t.knots],this.controlPoints=t.controlPoints.map((t=>new e.Vector4(t[0],t[1],t[2],t[3]))),this.startKnot=t.startKnot,this.endKnot=t.endKnot,this}},Le=class extends e.Loader{constructor(e){super(e)}load(t,i,s,r){let a=this,n=""===a.path?e.LoaderUtils.extractUrlBase(t):a.path,o=new e.FileLoader(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(e){try{i(a.parse(e,n))}catch(e){r?r(e):console.error(e),a.manager.itemError(t)}}),s,r)}parse(t,i){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Je(e,0,t.length)}(t))Pe=(new Ge).parse(t);else{let e=Je(t);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function s(t){let s=e[t-1];return e=e.slice(i+t),i++,s}for(let e=0;e<t.length;++e)if(s(1)===t[e])return!1;return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(Ne(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ne(e));Pe=(new Fe).parse(e)}let s=new e.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new ke(s,this.manager).parse(Pe)}},ke=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Te=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=(new Qe).parse(s);return this.parseScene(s,r,i),Re}parseConnections(){let e=new Map;return"Connections"in Pe&&Pe.Connections.connections.forEach((function(t){let i=t[0],s=t[1],r=t[2];e.has(i)||e.set(i,{parents:[],children:[]});let a={ID:s,relationship:r};e.get(i).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});let n={ID:i,relationship:r};e.get(s).children.push(n)})),e}parseImages(){let e={},t={};if("Video"in Pe.Objects){let i=Pe.Objects.Video;for(let s in i){let r=i[s];if(e[parseInt(s)]=r.RelativeFilename||r.Filename,"Content"in r){let e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,a="string"==typeof r.Content&&""!==r.Content;if(e||a){let e=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=e}}}}for(let i in e){let s=e[i];void 0!==t[s]?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){let t,i=e.Content,s=e.RelativeFilename||e.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",s),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;{let e=new Uint8Array(i);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in Pe.Objects){let i=Pe.Objects.Texture;for(let s in i){let r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(t,i){let s=this.loadTexture(t,i);s.ID=t.id,s.name=t.attrName;let r=t.WrapModeU,a=t.WrapModeV,n=void 0!==r?r.value:0,o=void 0!==a?a.value:0;if(s.wrapS=0===n?e.RepeatWrapping:e.ClampToEdgeWrapping,s.wrapT=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){let e=t.Scaling.value;s.repeat.x=e[0],s.repeat.y=e[1]}if("Translation"in t){let e=t.Translation.value;s.offset.x=e[0],s.offset.y=e[1]}return s}loadTexture(t,i){let s=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),r=t.FileName.split(".").pop().toLowerCase(),a=s.has(r)?this.manager.getHandler(`.${r}`):this.textureLoader;if(!a)return console.warn(`FBXLoader: ${r.toUpperCase()} loader not found, creating placeholder texture for`,t.RelativeFilename),new e.Texture;let n=a.path;n||a.setPath(this.textureLoader.path);let o,l=Te.get(t.id).children;void 0!==l&&l.length>0&&void 0!==i[l[0].ID]&&(o=i[l[0].ID],(0===o.indexOf("blob:")||0===o.indexOf("data:"))&&a.setPath(void 0));let h=a.load(o);return a.setPath(n),h}parseMaterials(e){let t=new Map;if("Material"in Pe.Objects){let i=Pe.Objects.Material;for(let s in i){let r=this.parseMaterial(i[s],e);null!==r&&t.set(parseInt(s),r)}}return t}parseMaterial(t,i){let s=t.id,r=t.attrName,a=t.ShadingModel;if("object"==typeof a&&(a=a.value),!Te.has(s))return null;let n,o=this.parseParameters(t,i,s);switch(a.toLowerCase()){case"phong":n=new e.MeshPhongMaterial;break;case"lambert":n=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),n=new e.MeshPhongMaterial}return n.setValues(o),n.name=r,n}parseParameters(t,i,s){let r={};t.BumpFactor&&(r.bumpScale=t.BumpFactor.value),t.Diffuse?r.color=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.Diffuse.value),e.SRGBColorSpace):t.DiffuseColor&&("Color"===t.DiffuseColor.type||"ColorRGB"===t.DiffuseColor.type)&&(r.color=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.DiffuseColor.value),e.SRGBColorSpace)),t.DisplacementFactor&&(r.displacementScale=t.DisplacementFactor.value),t.Emissive?r.emissive=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.Emissive.value),e.SRGBColorSpace):t.EmissiveColor&&("Color"===t.EmissiveColor.type||"ColorRGB"===t.EmissiveColor.type)&&(r.emissive=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.EmissiveColor.value),e.SRGBColorSpace)),t.EmissiveFactor&&(r.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),r.opacity=1-(t.TransparencyFactor?parseFloat(t.TransparencyFactor.value):0),(1===r.opacity||0===r.opacity)&&(r.opacity=t.Opacity?parseFloat(t.Opacity.value):null,null===r.opacity&&(r.opacity=1-(t.TransparentColor?parseFloat(t.TransparentColor.value[0]):0))),r.opacity<1&&(r.transparent=!0),t.ReflectionFactor&&(r.reflectivity=t.ReflectionFactor.value),t.Shininess&&(r.shininess=t.Shininess.value),t.Specular?r.specular=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.Specular.value),e.SRGBColorSpace):t.SpecularColor&&"Color"===t.SpecularColor.type&&(r.specular=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(t.SpecularColor.value),e.SRGBColorSpace));let a=this;return Te.get(s).children.forEach((function(t){let s=t.relationship;switch(s){case"Bump":r.bumpMap=a.getTexture(i,t.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(i,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(i,t.ID),void 0!==r.map&&(r.map.colorSpace=e.SRGBColorSpace);break;case"DisplacementColor":r.displacementMap=a.getTexture(i,t.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(i,t.ID),void 0!==r.emissiveMap&&(r.emissiveMap.colorSpace=e.SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(i,t.ID);break;case"ReflectionColor":r.envMap=a.getTexture(i,t.ID),void 0!==r.envMap&&(r.envMap.mapping=e.EquirectangularReflectionMapping,r.envMap.colorSpace=e.SRGBColorSpace);break;case"SpecularColor":r.specularMap=a.getTexture(i,t.ID),void 0!==r.specularMap&&(r.specularMap.colorSpace=e.SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(i,t.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",s)}})),r}getTexture(e,t){return"LayeredTexture"in Pe.Objects&&t in Pe.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Te.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in Pe.Objects){let i=Pe.Objects.Deformer;for(let s in i){let r=i[s],a=Te.get(parseInt(s));if("Skin"===r.attrType){let t=this.parseSkeleton(a,i);t.ID=s,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[s]=t}else if("BlendShape"===r.attrType){let e={id:s};e.rawTargets=this.parseMorphTargets(a,i),e.id=s,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(t,i){let s=[];return t.children.forEach((function(t){let r=i[t.ID];if("Cluster"!==r.attrType)return;let a={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),s.push(a)})),{rawBones:s,bones:[]}}parseMorphTargets(e,t){let i=[];for(let s=0;s<e.children.length;s++){let r=e.children[s],a=t[r.ID],n={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;n.geoID=Te.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,i.push(n)}return i}parseScene(t,i,s){Re=new e.Group;let r=this.parseModels(t.skeletons,i,s),a=Pe.Objects.Model,n=this;r.forEach((function(e){let t=a[e.ID];n.setLookAtProperties(e,t),Te.get(e.ID).parents.forEach((function(t){let i=r.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&Re.add(e)})),this.bindSkeleton(t.skeletons,i,r),this.addGlobalSceneSettings(),Re.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=Ke(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));let o=(new Oe).parse();1===Re.children.length&&Re.children[0].isGroup&&(Re.children[0].animations=o,Re=Re.children[0]),Re.animations=o}parseModels(t,i,s){let r=new Map,a=Pe.Objects.Model;for(let n in a){let o=parseInt(n),l=a[n],h=Te.get(o),c=this.buildSkeleton(h,t,o,l.attrName);if(!c){switch(l.attrType){case"Camera":c=this.createCamera(h);break;case"Light":c=this.createLight(h);break;case"Mesh":c=this.createMesh(h,i,s);break;case"NurbsCurve":c=this.createCurve(h,i);break;case"LimbNode":case"Root":c=new e.Bone;break;default:c=new e.Group}c.name=l.attrName?e.PropertyBinding.sanitizeNodeName(l.attrName):"",c.userData.originalName=l.attrName,c.ID=o}this.getTransformData(c,l),r.set(o,c)}return r}buildSkeleton(t,i,s,r){let a=null;return t.parents.forEach((function(t){for(let n in i){let o=i[n];o.rawBones.forEach((function(i,n){if(i.ID===t.ID){let t=a;a=new e.Bone,a.matrixWorld.copy(i.transformLink),a.name=r?e.PropertyBinding.sanitizeNodeName(r):"",a.userData.originalName=r,a.ID=s,o.bones[n]=a,null!==t&&a.add(t)}}))}})),a}createCamera(t){let i,s;if(t.children.forEach((function(e){let t=Pe.Objects.NodeAttribute[e.ID];void 0!==t&&(s=t)})),void 0===s)i=new e.Object3D;else{let t=0;void 0!==s.CameraProjectionType&&1===s.CameraProjectionType.value&&(t=1);let r=1;void 0!==s.NearPlane&&(r=s.NearPlane.value/1e3);let a=1e3;void 0!==s.FarPlane&&(a=s.FarPlane.value/1e3);let n=window.innerWidth,o=window.innerHeight;void 0!==s.AspectWidth&&void 0!==s.AspectHeight&&(n=s.AspectWidth.value,o=s.AspectHeight.value);let l=n/o,h=45;void 0!==s.FieldOfView&&(h=s.FieldOfView.value);let c=s.FocalLength?s.FocalLength.value:null;switch(t){case 0:i=new e.PerspectiveCamera(h,l,r,a),null!==c&&i.setFocalLength(c);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),i=new e.Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),i=new e.Object3D}}return i}createLight(t){let i,s;if(t.children.forEach((function(e){let t=Pe.Objects.NodeAttribute[e.ID];void 0!==t&&(s=t)})),void 0===s)i=new e.Object3D;else{let t;t=void 0===s.LightType?0:s.LightType.value;let r=16777215;void 0!==s.Color&&(r=e.ColorManagement.toWorkingColorSpace((new e.Color).fromArray(s.Color.value),e.SRGBColorSpace));let a=void 0===s.Intensity?1:s.Intensity.value/100;void 0!==s.CastLightOnObject&&0===s.CastLightOnObject.value&&(a=0);let n=0;void 0!==s.FarAttenuationEnd&&(n=void 0!==s.EnableFarAttenuation&&0===s.EnableFarAttenuation.value?0:s.FarAttenuationEnd.value);let o=1;switch(t){case 0:i=new e.PointLight(r,a,n,o);break;case 1:i=new e.DirectionalLight(r,a);break;case 2:let t=Math.PI/3;void 0!==s.InnerAngle&&(t=e.MathUtils.degToRad(s.InnerAngle.value));let l=0;void 0!==s.OuterAngle&&(l=e.MathUtils.degToRad(s.OuterAngle.value),l=Math.max(l,1)),i=new e.SpotLight(r,a,n,t,l,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new e.PointLight(r,a)}void 0!==s.CastShadows&&1===s.CastShadows.value&&(i.castShadow=!0)}return i}createMesh(t,i,s){let r,a=null,n=null,o=[];return t.children.forEach((function(e){i.has(e.ID)&&(a=i.get(e.ID)),s.has(e.ID)&&o.push(s.get(e.ID))})),o.length>1?n=o:o.length>0?n=o[0]:(n=new e.MeshPhongMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(n)),"color"in a.attributes&&o.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(r=new e.SkinnedMesh(a,n),r.normalizeSkinWeights()):r=new e.Mesh(a,n),r}createCurve(t,i){let s=t.children.reduce((function(e,t){return i.has(t.ID)&&(e=i.get(t.ID)),e}),null),r=new e.LineBasicMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new e.Line(s,r)}getTransformData(e,t){let i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder=qe("RotationOrder"in t?t.RotationOrder.value:0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(t,i){"LookAtProperty"in i&&Te.get(t.ID).children.forEach((function(i){if("LookAtProperty"===i.relationship){let s=Pe.Objects.Model[i.ID];if("Lcl_Translation"in s){let i=s.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(i),Re.add(t.target)):t.lookAt((new e.Vector3).fromArray(i))}}}))}bindSkeleton(t,i,s){let r=this.parsePoseNodes();for(let a in t){let n=t[a];Te.get(parseInt(n.ID)).parents.forEach((function(t){if(i.has(t.ID)){let i=t.ID;Te.get(i).parents.forEach((function(t){s.has(t.ID)&&s.get(t.ID).bind(new e.Skeleton(n.bones),r[t.ID])}))}}))}}parsePoseNodes(){let t={};if("Pose"in Pe.Objects){let i=Pe.Objects.Pose;for(let s in i)if("BindPose"===i[s].attrType&&i[s].NbPoseNodes>0){let r=i[s].PoseNode;Array.isArray(r)?r.forEach((function(i){t[i.Node]=(new e.Matrix4).fromArray(i.Matrix.a)})):t[r.Node]=(new e.Matrix4).fromArray(r.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in Pe){if("AmbientColor"in Pe.GlobalSettings){let t=Pe.GlobalSettings.AmbientColor.value,i=t[0],s=t[1],r=t[2];if(0!==i||0!==s||0!==r){let t=(new e.Color).setRGB(i,s,r,e.SRGBColorSpace);Re.add(new e.AmbientLight(t,1))}}"UnitScaleFactor"in Pe.GlobalSettings&&(Re.userData.unitScaleFactor=Pe.GlobalSettings.UnitScaleFactor.value)}}},Qe=class{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in Pe.Objects){let i=Pe.Objects.Geometry;for(let s in i){let r=Te.get(parseInt(s)),a=this.parseGeometry(r,i[s],e);t.set(parseInt(s),a)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){let s=i.skeletons,r=[],a=e.parents.map((function(e){return Pe.Objects.Model[e.ID]}));if(0===a.length)return;let n=e.children.reduce((function(e,t){return void 0!==s[t.ID]&&(e=s[t.ID]),e}),null);e.children.forEach((function(e){void 0!==i.morphTargets[e.ID]&&r.push(i.morphTargets[e.ID])}));let o=a[0],l={};"RotationOrder"in o&&(l.eulerOrder=qe(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);let h=Ke(l);return this.genGeometry(t,n,r,h)}genGeometry(t,i,s,r){let a=new e.BufferGeometry;t.attrName&&(a.name=t.attrName);let n=this.parseGeoNode(t,i),o=this.genBuffers(n),l=new e.Float32BufferAttribute(o.vertex,3);if(l.applyMatrix4(r),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new e.Float32BufferAttribute(o.colors,3)),i&&(a.setAttribute("skinIndex",new e.Uint16BufferAttribute(o.weightsIndices,4)),a.setAttribute("skinWeight",new e.Float32BufferAttribute(o.vertexWeights,4)),a.FBX_Deformer=i),o.normal.length>0){let t=(new e.Matrix3).getNormalMatrix(r),i=new e.Float32BufferAttribute(o.normal,3);i.applyNormalMatrix(t),a.setAttribute("normal",i)}if(o.uvs.forEach((function(t,i){let s=0===i?"uv":`uv${i}`;a.setAttribute(s,new e.Float32BufferAttribute(o.uvs[i],2))})),n.material&&"AllSame"!==n.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach((function(i,s){i!==e&&(a.addGroup(t,s-t,e),e=i,t=s)})),a.groups.length>0){let t=a.groups[a.groups.length-1],i=t.start+t.count;i!==o.materialIndex.length&&a.addGroup(i,o.materialIndex.length-i,e)}0===a.groups.length&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,t,s,r),a}parseGeoNode(e,t){let i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(s,r){void 0===i.weightTable[s]&&(i.weightTable[s]=[]),i.weightTable[s].push({id:t,weight:e.weights[r]})}))}))),i}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,s=0,r=!1,a=[],n=[],o=[],l=[],h=[],c=[],d=this;return e.vertexIndices.forEach((function(u,A){let p,m=!1;u<0&&(u=~u,m=!0);let g=[],f=[];if(a.push(3*u,3*u+1,3*u+2),e.color){let t=Ve(A,i,u,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[u]&&e.weightTable[u].forEach((function(e){f.push(e.weight),g.push(e.id)})),f.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let e=[0,0,0,0],t=[0,0,0,0];f.forEach((function(i,s){let r=i,a=g[s];t.forEach((function(t,i,s){if(r>t){s[i]=r,r=t;let n=e[i];e[i]=a,a=n}}))})),g=e,f=t}for(;f.length<4;)f.push(0),g.push(0);for(let e=0;e<4;++e)h.push(f[e]),c.push(g[e])}if(e.normal){let t=Ve(A,i,u,e.normal);n.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=Ve(A,i,u,e.material)[0],p<0&&(d.negativeMaterialIndices=!0,p=0)),e.uv&&e.uv.forEach((function(e,t){let s=Ve(A,i,u,e);void 0===l[t]&&(l[t]=[]),l[t].push(s[0]),l[t].push(s[1])})),s++,m&&(d.genFace(t,e,a,p,n,o,l,h,c,s),i++,s=0,a=[],n=[],o=[],l=[],h=[],c=[])})),t}getNormalNewell(t){let i=new e.Vector3(0,0,0);for(let e=0;e<t.length;e++){let s=t[e],r=t[(e+1)%t.length];i.x+=(s.y-r.y)*(s.z+r.z),i.y+=(s.z-r.z)*(s.x+r.x),i.z+=(s.x-r.x)*(s.y+r.y)}return i.normalize(),i}getNormalTangentAndBitangent(t){let i=this.getNormalNewell(t),s=(Math.abs(i.z)>.5?new e.Vector3(0,1,0):new e.Vector3(0,0,1)).cross(i).normalize(),r=i.clone().cross(s).normalize();return{normal:i,tangent:s,bitangent:r}}flattenVertex(t,i,s){return new e.Vector2(t.dot(i),t.dot(s))}genFace(t,i,s,r,a,n,o,l,h,c){let d;if(c>3){let t=[],r=i.baseVertexPositions||i.vertexPositions;for(let i=0;i<s.length;i+=3)t.push(new e.Vector3(r[s[i]],r[s[i+1]],r[s[i+2]]));let{tangent:a,bitangent:n}=this.getNormalTangentAndBitangent(t),o=[];for(let e of t)o.push(this.flattenVertex(e,a,n));d=e.ShapeUtils.triangulateShape(o,[])}else d=[[0,1,2]];for(let[e,c,u]of d)t.vertex.push(i.vertexPositions[s[3*e]]),t.vertex.push(i.vertexPositions[s[3*e+1]]),t.vertex.push(i.vertexPositions[s[3*e+2]]),t.vertex.push(i.vertexPositions[s[3*c]]),t.vertex.push(i.vertexPositions[s[3*c+1]]),t.vertex.push(i.vertexPositions[s[3*c+2]]),t.vertex.push(i.vertexPositions[s[3*u]]),t.vertex.push(i.vertexPositions[s[3*u+1]]),t.vertex.push(i.vertexPositions[s[3*u+2]]),i.skeleton&&(t.vertexWeights.push(l[4*e]),t.vertexWeights.push(l[4*e+1]),t.vertexWeights.push(l[4*e+2]),t.vertexWeights.push(l[4*e+3]),t.vertexWeights.push(l[4*c]),t.vertexWeights.push(l[4*c+1]),t.vertexWeights.push(l[4*c+2]),t.vertexWeights.push(l[4*c+3]),t.vertexWeights.push(l[4*u]),t.vertexWeights.push(l[4*u+1]),t.vertexWeights.push(l[4*u+2]),t.vertexWeights.push(l[4*u+3]),t.weightsIndices.push(h[4*e]),t.weightsIndices.push(h[4*e+1]),t.weightsIndices.push(h[4*e+2]),t.weightsIndices.push(h[4*e+3]),t.weightsIndices.push(h[4*c]),t.weightsIndices.push(h[4*c+1]),t.weightsIndices.push(h[4*c+2]),t.weightsIndices.push(h[4*c+3]),t.weightsIndices.push(h[4*u]),t.weightsIndices.push(h[4*u+1]),t.weightsIndices.push(h[4*u+2]),t.weightsIndices.push(h[4*u+3])),i.color&&(t.colors.push(n[3*e]),t.colors.push(n[3*e+1]),t.colors.push(n[3*e+2]),t.colors.push(n[3*c]),t.colors.push(n[3*c+1]),t.colors.push(n[3*c+2]),t.colors.push(n[3*u]),t.colors.push(n[3*u+1]),t.colors.push(n[3*u+2])),i.material&&"AllSame"!==i.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),i.normal&&(t.normal.push(a[3*e]),t.normal.push(a[3*e+1]),t.normal.push(a[3*e+2]),t.normal.push(a[3*c]),t.normal.push(a[3*c+1]),t.normal.push(a[3*c+2]),t.normal.push(a[3*u]),t.normal.push(a[3*u+1]),t.normal.push(a[3*u+2])),i.uv&&i.uv.forEach((function(i,s){void 0===t.uvs[s]&&(t.uvs[s]=[]),t.uvs[s].push(o[s][2*e]),t.uvs[s].push(o[s][2*e+1]),t.uvs[s].push(o[s][2*c]),t.uvs[s].push(o[s][2*c+1]),t.uvs[s].push(o[s][2*u]),t.uvs[s].push(o[s][2*u+1])}))}addMorphTargets(e,t,i,s){if(0===i.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;i.forEach((function(i){i.rawTargets.forEach((function(i){let a=Pe.Objects.Geometry[i.geoID];void 0!==a&&r.genMorphGeometry(e,t,a,s,i.name)}))}))}genMorphGeometry(t,i,s,r,a){let n=void 0!==i.Vertices?i.Vertices.a:[],o=void 0!==i.PolygonVertexIndex?i.PolygonVertexIndex.a:[],l=void 0!==s.Vertices?s.Vertices.a:[],h=void 0!==s.Indexes?s.Indexes.a:[],c=3*t.attributes.position.count,d=new Float32Array(c);for(let e=0;e<h.length;e++){let t=3*h[e];d[t]=l[3*e],d[t+1]=l[3*e+1],d[t+2]=l[3*e+2]}let u={vertexIndices:o,vertexPositions:d,baseVertexPositions:n},A=this.genBuffers(u),p=new e.Float32BufferAttribute(A.vertex,3);p.name=a||s.attrName,p.applyMatrix4(r),t.morphAttributes.position.push(p)}parseNormals(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a,r=[];return"IndexToDirect"===i&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a,r=[];return"IndexToDirect"===i&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(t){let i=t.MappingInformationType,s=t.ReferenceInformationType,r=t.Colors.a,a=[];"IndexToDirect"===s&&(a=t.ColorIndex.a);for(let t=0,i=new e.Color;t<r.length;t+=4)i.fromArray(r,t),e.ColorManagement.toWorkingColorSpace(i,e.SRGBColorSpace),i.toArray(r,t);return{dataSize:4,buffer:r,indices:a,mappingType:i,referenceType:s}}parseMaterialIndices(e){let t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};let s=e.Materials.a,r=[];for(let e=0;e<s.length;++e)r.push(e);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(t){let i=parseInt(t.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;let s,r,a=i-1,n=t.KnotVector.a,o=[],l=t.Points.a;for(let t=0,i=l.length;t<i;t+=4)o.push((new e.Vector4).fromArray(l,t));if("Closed"===t.Form)o.push(o[0]);else if("Periodic"===t.Form){s=a,r=n.length-1-s;for(let e=0;e<a;++e)o.push(o[e])}let h=new Me(a,n,o,s,r).getPoints(12*o.length);return(new e.BufferGeometry).setFromPoints(h)}},Oe=class{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let i in t){let s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(void 0===Pe.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=Pe.Objects.AnimationCurveNode,t=new Map;for(let i in e){let s=e[i];if(null!==s.attrName.match(/S|R|T|DeformPercent/)){let e={id:s.id,attr:s.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=Pe.Objects.AnimationCurve;for(let i in t){let s={id:t[i].id,times:t[i].KeyTime.a.map(je),values:t[i].KeyValueFloat.a},r=Te.get(s.id);if(void 0!==r){let t=r.parents[0].ID,i=r.parents[0].relationship;i.match(/X/)?e.get(t).curves.x=s:i.match(/Y/)?e.get(t).curves.y=s:i.match(/Z/)?e.get(t).curves.z=s:i.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=s)}}}parseAnimationLayers(t){let i=Pe.Objects.AnimationLayer,s=new Map;for(let r in i){let i=[],a=Te.get(parseInt(r));void 0!==a&&(a.children.forEach((function(s,r){if(t.has(s.ID)){let a=t.get(s.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===i[r]){let t=Te.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==t){let a=Pe.Objects.Model[t.toString()];if(void 0===a)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);let n={modelName:a.attrName?e.PropertyBinding.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Re.traverse((function(e){e.ID===a.id&&(n.transform=e.matrix,e.userData.transformData&&(n.eulerOrder=e.userData.transformData.eulerOrder))})),n.transform||(n.transform=new e.Matrix4),"PreRotation"in a&&(n.preRotation=a.PreRotation.value),"PostRotation"in a&&(n.postRotation=a.PostRotation.value),i[r]=n}}i[r]&&(i[r][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===i[r]){let t=Te.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,a=Te.get(t).parents[0].ID,n=Te.get(a).parents[0].ID,o=Te.get(n).parents[0].ID,l=Pe.Objects.Model[o],h={modelName:l.attrName?e.PropertyBinding.sanitizeNodeName(l.attrName):"",morphName:Pe.Objects.Deformer[t].attrName};i[r]=h}i[r][a.attr]=a}}})),s.set(parseInt(r),i))}return s}parseAnimStacks(e){let t=Pe.Objects.AnimationStack,i={};for(let s in t){let r=Te.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:a}}return i}addClip(t){let i=[],s=this;return t.layer.forEach((function(e){i=i.concat(s.generateTracks(e))})),new e.AnimationClip(t.name,-1,i)}generateTracks(t){let i=[],s=new e.Vector3,r=new e.Vector3;if(t.transform&&t.transform.decompose(s,new e.Quaternion,r),s=s.toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){let e=this.generateVectorTrack(t.modelName,t.T.curves,s,"position");void 0!==e&&i.push(e)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){let e=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);void 0!==e&&i.push(e)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){let e=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==e&&i.push(e)}if(void 0!==t.DeformPercent){let e=this.generateMorphTrack(t);void 0!==e&&i.push(e)}return i}generateVectorTrack(t,i,s,r){let a=this.getTimesForAllAxes(i),n=this.getKeyframeTrackValues(a,i,s);return new e.VectorKeyframeTrack(t+"."+r,a,n)}generateRotationTrack(t,i,s,r,a){let n,o;if(void 0!==i.x&&void 0!==i.y&&void 0!==i.z){let e=this.interpolateRotations(i.x,i.y,i.z,a);n=e[0],o=e[1]}let l=qe(0);void 0!==s&&((s=s.map(e.MathUtils.degToRad)).push(l),s=(new e.Euler).fromArray(s),s=(new e.Quaternion).setFromEuler(s)),void 0!==r&&((r=r.map(e.MathUtils.degToRad)).push(l),r=(new e.Euler).fromArray(r),r=(new e.Quaternion).setFromEuler(r).invert());let h=new e.Quaternion,c=new e.Euler,d=[];if(!o||!n)return new e.QuaternionKeyframeTrack(t+".quaternion",[0],[0]);for(let t=0;t<o.length;t+=3)c.set(o[t],o[t+1],o[t+2],a),h.setFromEuler(c),void 0!==s&&h.premultiply(s),void 0!==r&&h.multiply(r),t>2&&(new e.Quaternion).fromArray(d,(t-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(d,t/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",n,d)}generateMorphTrack(t){let i=t.DeformPercent.curves.morph,s=i.values.map((function(e){return e/100})),r=Re.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+r+"]",i.times,s)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,i=t[0];for(let s=1;s<t.length;s++){let r=t[s];r!==i&&(t[e]=r,i=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,i){let s=i,r=[],a=-1,n=-1,o=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(n=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];r.push(e),s[0]=e}else r.push(s[0]);if(-1!==n){let e=t.y.values[n];r.push(e),s[1]=e}else r.push(s[1]);if(-1!==o){let e=t.z.values[o];r.push(e),s[2]=e}else r.push(s[2])})),r}interpolateRotations(t,i,s,r){let a=[],n=[];a.push(t.times[0]),n.push(e.MathUtils.degToRad(t.values[0])),n.push(e.MathUtils.degToRad(i.values[0])),n.push(e.MathUtils.degToRad(s.values[0]));for(let o=1;o<t.values.length;o++){let l=[t.values[o-1],i.values[o-1],s.values[o-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;let h=l.map(e.MathUtils.degToRad),c=[t.values[o],i.values[o],s.values[o]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;let d=c.map(e.MathUtils.degToRad),u=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],A=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(A[0]>=180||A[1]>=180||A[2]>=180){let i=Math.max(...A)/180,s=new e.Euler(...h,r),l=new e.Euler(...d,r),c=(new e.Quaternion).setFromEuler(s),u=(new e.Quaternion).setFromEuler(l);c.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);let p=t.times[o-1],m=t.times[o]-p,g=new e.Quaternion,f=new e.Euler;for(let e=0;e<1;e+=1/i)g.copy(c.clone().slerp(u.clone(),e)),a.push(p+e*m),f.setFromQuaternion(g,r),n.push(f.x),n.push(f.y),n.push(f.z)}else a.push(t.times[o]),n.push(e.MathUtils.degToRad(t.values[o])),n.push(e.MathUtils.degToRad(i.values[o])),n.push(e.MathUtils.degToRad(s.values[o]))}return[a,n]}},Fe=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new _e,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,s){let r=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(r||a)return;let n=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(e,n):o?t.parseNodeProperty(e,o,i[++s]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){let i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:i},a=this.parseNodeAttr(s),n=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,r):i in n?("PoseNode"===i?n.PoseNode.push(r):void 0!==n[i].id&&(n[i]={},n[i][n[i].id]=n[i]),""!==a.id&&(n[i][a.id]=r)):"number"==typeof a.id?(n[i]={},n[i][a.id]=r):"Properties70"!==i&&(n[i]="PoseNode"===i?[r]:r),"number"==typeof a.id&&(r.id=a.id),""!==a.name&&(r.attrName=a.name),""!==a.type&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===s&&","===r&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===s){let e=r.split(",").slice(1),t=parseInt(e[0]),i=parseInt(e[1]),n=r.split(",").slice(3);n=n.map((function(e){return e.trim().replace(/^"/,"")})),s="connections",r=[t,i],function(e,t){for(let i=0,s=e.length,r=t.length;i<r;i++,s++)e[s]=t[i]}(r,n),void 0===a[s]&&(a[s]=[])}"Node"===s&&(a.id=r),s in a&&Array.isArray(a[s])?a[s].push(r):"a"!==s?a[s]=r:a.a=r,this.setCurrentProp(a,s),"a"===s&&","!==r.slice(-1)&&(a.a=Ye(r))}else this.parseNodeSpecialProperty(e,s,r)}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Ye(t.a))}parseNodeSpecialProperty(e,t,i){let s=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=s[0],a=s[1],n=s[2],o=s[3],l=s[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Ye(l)}this.getPrevNode()[r]={type:a,type2:n,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),r)}},Ge=class{parse(e){let t=new Ue(e);t.skip(23);let i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);let s=new _e;for(;!this.endOfContent(t);){let e=this.parseNode(t,i);null!==e&&s.add(e.name,e)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),n=e.getString(a);if(0===s)return null;let o=[];for(let t=0;t<r;t++)o.push(this.parseProperty(e));let l=o.length>0?o[0]:"",h=o.length>1?o[1]:"",c=o.length>2?o[2]:"";for(i.singleProperty=1===r&&e.getOffset()===s;s>e.getOffset();){let s=this.parseNode(e,t);null!==s&&this.parseSubNode(n,i,s)}return i.propertyList=o,"number"==typeof l&&(i.id=l),""!==h&&(i.attrName=h),""!==c&&(i.attrType=c),""!==n&&(i.name=n),i}parseSubNode(e,t,i){if(!0===i.singleProperty){let e=i.propertyList[0];Array.isArray(e)?(t[i.name]=i,i.a=e):t[i.name]=e}else if("Connections"===e&&"C"===i.name){let e=[];i.propertyList.forEach((function(t,i){0!==i&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===i.name)Object.keys(i).forEach((function(e){t[e]=i[e]}));else if("Properties70"===e&&"P"===i.name){let e,s=i.propertyList[0],r=i.propertyList[1],a=i.propertyList[2],n=i.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),e="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[s]={type:r,type2:a,flag:n,value:e}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)}parseProperty(e){let t,i=e.getString(1);switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let s=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(0===r)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}let n=Ie(new Uint8Array(e.getArrayBuffer(a))),o=new Ue(n.buffer);switch(i){case"b":case"c":return o.getBooleanArray(s);case"d":return o.getFloat64Array(s);case"f":return o.getFloat32Array(s);case"i":return o.getInt32Array(s);case"l":return o.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}},Ue=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){let t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}},_e=class{add(e,t){this[e]=t}};function Ne(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function je(e){return e/46186158e3}var He=[];function Ve(e,t,i,s){let r;switch(s.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=i;break;case"AllSame":r=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}"IndexToDirect"===s.referenceType&&(r=s.indices[r]);let a=r*s.dataSize,n=a+s.dataSize;return function(e,t,i,s){for(let r=i,a=0;r<s;r++,a++)e[a]=t[r];return e}(He,s.buffer,a,n)}var We=new e.Euler,ze=new e.Vector3;function Ke(t){let i=new e.Matrix4,s=new e.Matrix4,r=new e.Matrix4,a=new e.Matrix4,n=new e.Matrix4,o=new e.Matrix4,l=new e.Matrix4,h=new e.Matrix4,c=new e.Matrix4,d=new e.Matrix4,u=new e.Matrix4,A=new e.Matrix4,p=t.inheritType?t.inheritType:0;t.translation&&i.setPosition(ze.fromArray(t.translation));let m=qe(0);if(t.preRotation){let i=t.preRotation.map(e.MathUtils.degToRad);i.push(m),s.makeRotationFromEuler(We.fromArray(i))}if(t.rotation){let i=t.rotation.map(e.MathUtils.degToRad);i.push(t.eulerOrder||m),r.makeRotationFromEuler(We.fromArray(i))}if(t.postRotation){let i=t.postRotation.map(e.MathUtils.degToRad);i.push(m),a.makeRotationFromEuler(We.fromArray(i)),a.invert()}t.scale&&n.scale(ze.fromArray(t.scale)),t.scalingOffset&&l.setPosition(ze.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(ze.fromArray(t.scalingPivot)),t.rotationOffset&&h.setPosition(ze.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(ze.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(u.copy(t.parentMatrix),d.copy(t.parentMatrixWorld));let g=s.clone().multiply(r).multiply(a),f=new e.Matrix4;f.extractRotation(d);let v=new e.Matrix4;v.copyPosition(d);let b=v.clone().invert().multiply(d),x=f.clone().invert().multiply(b),C=n,y=new e.Matrix4;if(0===p)y.copy(f).multiply(g).multiply(x).multiply(C);else if(1===p)y.copy(f).multiply(x).multiply(g).multiply(C);else{let t=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(u)).clone().invert(),i=x.clone().multiply(t);y.copy(f).multiply(g).multiply(i).multiply(C)}let E=c.clone().invert(),I=o.clone().invert(),B=i.clone().multiply(h).multiply(c).multiply(s).multiply(r).multiply(a).multiply(E).multiply(l).multiply(o).multiply(n).multiply(I),w=(new e.Matrix4).copyPosition(B),S=d.clone().multiply(w);return A.copyPosition(S),B=A.clone().multiply(y),B.premultiply(d.invert()),B}function qe(e){let t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Ye(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Je(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,i))}var Xe={};function Ze(t,i,s=!0){if(!i||!i.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!t.hasAttribute("position")||!t.hasAttribute("normal")||!t.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(e){if(e.normalized||e.isInterleavedBufferAttribute){let t=new Float32Array(e.count*e.itemSize);for(let i=0,s=0;i<e.count;i++)t[s++]=e.getX(i),t[s++]=e.getY(i),e.itemSize>2&&(t[s++]=e.getZ(i));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}let a=t.index?t.toNonIndexed():t,n=i.generateTangents(r(a.attributes.position),r(a.attributes.normal),r(a.attributes.uv));if(s)for(let e=3;e<n.length;e+=4)n[e]*=-1;return a.setAttribute("tangent",new e.BufferAttribute(n,4)),t!==a&&t.copy(a),t}function $e(t,i=!1){let s=null!==t[0].index,r=new Set(Object.keys(t[0].attributes)),a=new Set(Object.keys(t[0].morphAttributes)),n={},o={},l=t[0].morphTargetsRelative,h=new e.BufferGeometry,c=0;for(let e=0;e<t.length;++e){let d=t[e],u=0;if(s!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let t in d.attributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===n[t]&&(n[t]=[]),n[t].push(d.attributes[t]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". Make sure all geometries have the same number of attributes."),null;if(l!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let t in d.morphAttributes){if(!a.has(t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[t]&&(o[t]=[]),o[t].push(d.morphAttributes[t])}if(i){let t;if(s)t=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+e+". The geometry must have either an index or a position attribute"),null;t=d.attributes.position.count}h.addGroup(c,t,e),c+=t}}if(s){let e=0,i=[];for(let s=0;s<t.length;++s){let r=t[s].index;for(let t=0;t<r.count;++t)i.push(r.getX(t)+e);e+=t[s].attributes.position.count}h.setIndex(i)}for(let e in n){let t=et(n[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;h.setAttribute(e,t)}for(let e in o){let t=o[e][0].length;if(0===t)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[e]=[];for(let i=0;i<t;++i){let t=[];for(let s=0;s<o[e].length;++s)t.push(o[e][s][i]);let s=et(t);if(!s)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;h.morphAttributes[e].push(s)}}return h}function et(t){let i,s,r,a=-1,n=0;for(let e=0;e<t.length;++e){let o=t[e];if(void 0===i&&(i=o.array.constructor),i!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===s&&(s=o.itemSize),s!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===a&&(a=o.gpuType),a!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;n+=o.count*s}let o=new i(n),l=new e.BufferAttribute(o,s,r),h=0;for(let e=0;e<t.length;++e){let i=t[e];if(i.isInterleavedBufferAttribute){let e=h/s;for(let t=0,r=i.count;t<r;t++)for(let r=0;r<s;r++){let s=i.getComponent(t,r);l.setComponent(t+e,r,s)}}else o.set(i.array,h);h+=i.count*s}return void 0!==a&&(l.gpuType=a),l}function tt(t){return t.isInstancedInterleavedBufferAttribute||t.isInterleavedBufferAttribute?st(t):t.isInstancedBufferAttribute?(new e.InstancedBufferAttribute).copy(t):(new e.BufferAttribute).copy(t)}function it(t){let i,s=0,r=0;for(let e=0,a=t.length;e<a;++e){let a=t[e];if(void 0===i&&(i=a.array.constructor),i!==a.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;s+=a.array.length,r+=a.itemSize}let a=new e.InterleavedBuffer(new i(s),r),n=0,o=[],l=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"];for(let i=0,s=t.length;i<s;i++){let s=t[i],r=s.itemSize,c=s.count,d=new e.InterleavedBufferAttribute(a,r,n,s.normalized);o.push(d),n+=r;for(let e=0;e<c;e++)for(let t=0;t<r;t++)d[h[t]](e,s[l[t]](e))}return o}function st(t){let i,s=t.data.array.constructor,r=t.count,a=t.itemSize,n=t.normalized,o=new s(r*a);i=t.isInstancedInterleavedBufferAttribute?new e.InstancedBufferAttribute(o,a,n,t.meshPerAttribute):new e.BufferAttribute(o,a,n);for(let e=0;e<r;e++)i.setX(e,t.getX(e)),a>=2&&i.setY(e,t.getY(e)),a>=3&&i.setZ(e,t.getZ(e)),a>=4&&i.setW(e,t.getW(e));return i}function rt(e){let t=e.attributes,i=e.morphTargets,s=new Map;for(let e in t){let i=t[e];i.isInterleavedBufferAttribute&&(s.has(i)||s.set(i,st(i)),t[e]=s.get(i))}for(let e in i){let t=i[e];t.isInterleavedBufferAttribute&&(s.has(t)||s.set(t,st(t)),i[e]=s.get(t))}}function at(e){let t=0;for(let i in e.attributes){let s=e.getAttribute(i);t+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}let i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,t}function nt(e,t=1e-4){t=Math.max(t,Number.EPSILON);let i={},s=e.getIndex(),r=e.getAttribute("position"),a=s?s.count:r.count,n=0,o=Object.keys(e.attributes),l={},h={},c=[],d=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let t=0,i=o.length;t<i;t++){let i=o[t],s=e.attributes[i];l[i]=new s.constructor(new s.array.constructor(s.count*s.itemSize),s.itemSize,s.normalized);let r=e.morphAttributes[i];r&&(h[i]||(h[i]=[]),r.forEach(((e,t)=>{let s=new e.array.constructor(e.count*e.itemSize);h[i][t]=new e.constructor(s,e.itemSize,e.normalized)})))}let A=.5*t,p=Math.log10(1/t),m=Math.pow(10,p),g=A*m;for(let t=0;t<a;t++){let r=s?s.getX(t):t,a="";for(let t=0,i=o.length;t<i;t++){let i=o[t],s=e.getAttribute(i),n=s.itemSize;for(let e=0;e<n;e++)a+=~~(s[d[e]](r)*m+g)+","}if(a in i)c.push(i[a]);else{for(let t=0,i=o.length;t<i;t++){let i=o[t],s=e.getAttribute(i),a=e.morphAttributes[i],c=s.itemSize,A=l[i],p=h[i];for(let e=0;e<c;e++){let t=d[e],i=u[e];if(A[i](n,s[t](r)),a)for(let e=0,s=a.length;e<s;e++)p[e][i](n,a[e][t](r))}}i[a]=n,c.push(n),n++}}let f=e.clone();for(let t in e.attributes){let e=l[t];if(f.setAttribute(t,new e.constructor(e.array.slice(0,n*e.itemSize),e.itemSize,e.normalized)),t in h)for(let e=0;e<h[t].length;e++){let i=h[t][e];f.morphAttributes[t][e]=new i.constructor(i.array.slice(0,n*i.itemSize),i.itemSize,i.normalized)}}return f.setIndex(c),f}function ot(t,i){if(i===e.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(i===e.TriangleFanDrawMode||i===e.TriangleStripDrawMode){let s=t.getIndex();if(null===s){let e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),s=t.getIndex()}let r=s.count-2,a=[];if(i===e.TriangleFanDrawMode)for(let e=1;e<=r;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let n=t.clone();return n.setIndex(a),n.clearGroups(),n}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),t}function lt(t){let i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,a=new e.Vector3,n=new e.Vector3,o=new e.Vector3,l=new e.Vector3,h=new e.Vector3,c=new e.Vector3;function d(e,t,d,u,A,p,m,g){i.fromBufferAttribute(t,A),s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m);let f=e.morphTargetInfluences;if(d&&f){l.set(0,0,0),h.set(0,0,0),c.set(0,0,0);for(let e=0,t=d.length;e<t;e++){let t=f[e],g=d[e];0!==t&&(a.fromBufferAttribute(g,A),n.fromBufferAttribute(g,p),o.fromBufferAttribute(g,m),u?(l.addScaledVector(a,t),h.addScaledVector(n,t),c.addScaledVector(o,t)):(l.addScaledVector(a.sub(i),t),h.addScaledVector(n.sub(s),t),c.addScaledVector(o.sub(r),t)))}i.add(l),s.add(h),r.add(c)}e.isSkinnedMesh&&(e.applyBoneTransform(A,i),e.applyBoneTransform(p,s),e.applyBoneTransform(m,r)),g[3*A+0]=i.x,g[3*A+1]=i.y,g[3*A+2]=i.z,g[3*p+0]=s.x,g[3*p+1]=s.y,g[3*p+2]=s.z,g[3*m+0]=r.x,g[3*m+1]=r.y,g[3*m+2]=r.z}let u,A,p,m,g,f,v,b,x,C,y=t.geometry,E=t.material,I=y.index,B=y.attributes.position,w=y.morphAttributes.position,S=y.morphTargetsRelative,D=y.attributes.normal,P=y.morphAttributes.position,T=y.groups,R=y.drawRange,M=new Float32Array(B.count*B.itemSize),L=new Float32Array(D.count*D.itemSize);if(null!==I)if(Array.isArray(E))for(m=0,f=T.length;m<f;m++)for(b=T[m],x=Math.max(b.start,R.start),C=Math.min(b.start+b.count,R.start+R.count),g=x,v=C;g<v;g+=3)u=I.getX(g),A=I.getX(g+1),p=I.getX(g+2),d(t,B,w,S,u,A,p,M),d(t,D,P,S,u,A,p,L);else for(x=Math.max(0,R.start),C=Math.min(I.count,R.start+R.count),m=x,f=C;m<f;m+=3)u=I.getX(m),A=I.getX(m+1),p=I.getX(m+2),d(t,B,w,S,u,A,p,M),d(t,D,P,S,u,A,p,L);else if(Array.isArray(E))for(m=0,f=T.length;m<f;m++)for(b=T[m],x=Math.max(b.start,R.start),C=Math.min(b.start+b.count,R.start+R.count),g=x,v=C;g<v;g+=3)u=g,A=g+1,p=g+2,d(t,B,w,S,u,A,p,M),d(t,D,P,S,u,A,p,L);else for(x=Math.max(0,R.start),C=Math.min(B.count,R.start+R.count),m=x,f=C;m<f;m+=3)u=m,A=m+1,p=m+2,d(t,B,w,S,u,A,p,M),d(t,D,P,S,u,A,p,L);return{positionAttribute:B,normalAttribute:D,morphedPositionAttribute:new e.Float32BufferAttribute(M,3),morphedNormalAttribute:new e.Float32BufferAttribute(L,3)}}function ht(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort(((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start)),null===e.getIndex()){let t=e.getAttribute("position"),i=[];for(let e=0;e<t.count;e+=3)i.push(e,e+1,e+2);e.setIndex(i)}let i=e.getIndex(),s=[];for(let e=0;e<t.length;e++){let r=t[e],a=r.start,n=a+r.count;for(let e=a;e<n;e++)s.push(i.getX(e))}e.dispose(),e.setIndex(s);let r=0;for(let e=0;e<t.length;e++){let i=t[e];i.start=r,r+=i.count}let a=t[0];e.groups=[a];for(let i=1;i<t.length;i++){let s=t[i];a.materialIndex===s.materialIndex?a.count+=s.count:(a=s,e.groups.push(a))}return e}function ct(t,i=Math.PI/3){let s=Math.cos(i),r=100*(1+1e-10),a=[new e.Vector3,new e.Vector3,new e.Vector3],n=new e.Vector3,o=new e.Vector3,l=new e.Vector3,h=new e.Vector3;function c(e){return`${~~(e.x*r)},${~~(e.y*r)},${~~(e.z*r)}`}let d=t.index?t.toNonIndexed():t,u=d.attributes.position,A={};for(let t=0,i=u.count/3;t<i;t++){let i=3*t,s=a[0].fromBufferAttribute(u,i+0),r=a[1].fromBufferAttribute(u,i+1),l=a[2].fromBufferAttribute(u,i+2);n.subVectors(l,r),o.subVectors(s,r);let h=(new e.Vector3).crossVectors(n,o).normalize();for(let e=0;e<3;e++){let t=c(a[e]);t in A||(A[t]=[]),A[t].push(h)}}let p=new Float32Array(3*u.count),m=new e.BufferAttribute(p,3,!1);for(let e=0,t=u.count/3;e<t;e++){let t=3*e,i=a[0].fromBufferAttribute(u,t+0),r=a[1].fromBufferAttribute(u,t+1),d=a[2].fromBufferAttribute(u,t+2);n.subVectors(d,r),o.subVectors(i,r),l.crossVectors(n,o).normalize();for(let e=0;e<3;e++){let i=A[c(a[e])];h.set(0,0,0);for(let e=0,t=i.length;e<t;e++){let t=i[e];l.dot(t)>s&&h.add(t)}h.normalize(),m.setXYZ(t+e,h.x,h.y,h.z)}}return d.setAttribute("normal",m),d}c(Xe,{computeMikkTSpaceTangents:()=>Ze,computeMorphedAttributes:()=>lt,deepCloneAttribute:()=>tt,deinterleaveAttribute:()=>st,deinterleaveGeometry:()=>rt,estimateBytesUsed:()=>at,interleaveAttributes:()=>it,mergeAttributes:()=>et,mergeGeometries:()=>$e,mergeGroups:()=>ht,mergeVertices:()=>nt,toCreasedNormals:()=>ct,toTrianglesDrawMode:()=>ot});var dt=class extends e.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new ft(e)})),this.register((function(e){return new vt(e)})),this.register((function(e){return new St(e)})),this.register((function(e){return new Dt(e)})),this.register((function(e){return new Pt(e)})),this.register((function(e){return new xt(e)})),this.register((function(e){return new Ct(e)})),this.register((function(e){return new yt(e)})),this.register((function(e){return new Et(e)})),this.register((function(e){return new gt(e)})),this.register((function(e){return new It(e)})),this.register((function(e){return new bt(e)})),this.register((function(e){return new wt(e)})),this.register((function(e){return new Bt(e)})),this.register((function(e){return new pt(e)})),this.register((function(e){return new Tt(e)})),this.register((function(e){return new Rt(e)}))}load(t,i,s,r){let a,n=this;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){let i=e.LoaderUtils.extractUrlBase(t);a=e.LoaderUtils.resolveURL(i,this.path)}else a=e.LoaderUtils.extractUrlBase(t);this.manager.itemStart(t);let o=function(e){r?r(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)},l=new e.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,(function(e){try{n.parse(e,a,(function(e){i(e),n.manager.itemEnd(t)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r,a={},n={},o=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Mt){try{a[At.KHR_BINARY_GLTF]=new Qt(e)}catch(e){return void(s&&s(e))}r=JSON.parse(a[At.KHR_BINARY_GLTF].content)}else r=JSON.parse(o.decode(e));else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));let l=new oi(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),n[t.name]=t,a[t.name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){let t=r.extensionsUsed[e],i=r.extensionsRequired||[];switch(t){case At.KHR_MATERIALS_UNLIT:a[t]=new mt;break;case At.KHR_DRACO_MESH_COMPRESSION:a[t]=new Ot(r,this.dracoLoader);break;case At.KHR_TEXTURE_TRANSFORM:a[t]=new Ft;break;case At.KHR_MESH_QUANTIZATION:a[t]=new Gt;break;default:i.indexOf(t)>=0&&void 0===n[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(a),l.setPlugins(n),l.parse(i,s)}parseAsync(e,t){let i=this;return new Promise((function(s,r){i.parse(e,t,s,r)}))}};function ut(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var At={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},pt=class{constructor(e){this.parser=e,this.name=At.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){let s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){let i=this.parser,s="light:"+t,r=i.cache.get(s);if(r)return r;let a,n=i.json,o=((n.extensions&&n.extensions[this.name]||{}).lights||[])[t],l=new e.Color(16777215);void 0!==o.color&&l.setRGB(o.color[0],o.color[1],o.color[2],e.LinearSRGBColorSpace);let h=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new e.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new e.PointLight(l),a.distance=h;break;case"spot":a=new e.SpotLight(l),a.distance=h,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,ti(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=i.createUniqueName(o.name||"light_"+t),r=Promise.resolve(a),i.cache.add(s,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,i=this.parser,s=i.json.nodes[e],r=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return i._getNodeRef(t.cache,r,e)}))}},mt=class{constructor(){this.name=At.KHR_MATERIALS_UNLIT}getMaterialType(){return e.MeshBasicMaterial}extendParams(t,i,s){let r=[];t.color=new e.Color(1,1,1),t.opacity=1;let a=i.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){let i=a.baseColorFactor;t.color.setRGB(i[0],i[1],i[2],e.LinearSRGBColorSpace),t.opacity=i[3]}void 0!==a.baseColorTexture&&r.push(s.assignTexture(t,"map",a.baseColorTexture,e.SRGBColorSpace))}return Promise.all(r)}},gt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}},ft=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){let s=this.parser,r=s.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],n=r.extensions[this.name];if(void 0!==n.clearcoatFactor&&(i.clearcoat=n.clearcoatFactor),void 0!==n.clearcoatTexture&&a.push(s.assignTexture(i,"clearcoatMap",n.clearcoatTexture)),void 0!==n.clearcoatRoughnessFactor&&(i.clearcoatRoughness=n.clearcoatRoughnessFactor),void 0!==n.clearcoatRoughnessTexture&&a.push(s.assignTexture(i,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),void 0!==n.clearcoatNormalTexture&&(a.push(s.assignTexture(i,"clearcoatNormalMap",n.clearcoatNormalTexture)),void 0!==n.clearcoatNormalTexture.scale)){let t=n.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new e.Vector2(t,t)}return Promise.all(a)}},vt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_DISPERSION}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=i.extensions[this.name];return t.dispersion=void 0!==s.dispersion?s.dispersion:0,Promise.resolve()}},bt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&r.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&r.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}},xt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_SHEEN}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){let s=this.parser,r=s.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[];i.sheenColor=new e.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;let n=r.extensions[this.name];if(void 0!==n.sheenColorFactor){let t=n.sheenColorFactor;i.sheenColor.setRGB(t[0],t[1],t[2],e.LinearSRGBColorSpace)}return void 0!==n.sheenRoughnessFactor&&(i.sheenRoughness=n.sheenRoughnessFactor),void 0!==n.sheenColorTexture&&a.push(s.assignTexture(i,"sheenColorMap",n.sheenColorTexture,e.SRGBColorSpace)),void 0!==n.sheenRoughnessTexture&&a.push(s.assignTexture(i,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}},Ct=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}},yt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_VOLUME}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){let s=this.parser,r=s.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],n=r.extensions[this.name];i.thickness=void 0!==n.thicknessFactor?n.thicknessFactor:0,void 0!==n.thicknessTexture&&a.push(s.assignTexture(i,"thicknessMap",n.thicknessTexture)),i.attenuationDistance=n.attenuationDistance||1/0;let o=n.attenuationColor||[1,1,1];return i.attenuationColor=(new e.Color).setRGB(o[0],o[1],o[2],e.LinearSRGBColorSpace),Promise.all(a)}},Et=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_IOR}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}},It=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_SPECULAR}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,i){let s=this.parser,r=s.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],n=r.extensions[this.name];i.specularIntensity=void 0!==n.specularFactor?n.specularFactor:1,void 0!==n.specularTexture&&a.push(s.assignTexture(i,"specularIntensityMap",n.specularTexture));let o=n.specularColorFactor||[1,1,1];return i.specularColor=(new e.Color).setRGB(o[0],o[1],o[2],e.LinearSRGBColorSpace),void 0!==n.specularColorTexture&&a.push(s.assignTexture(i,"specularColorMap",n.specularColorTexture,e.SRGBColorSpace)),Promise.all(a)}},Bt=class{constructor(e){this.parser=e,this.name=At.EXT_MATERIALS_BUMP}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&r.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}},wt=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){let i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&r.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}},St=class{constructor(e){this.parser=e,this.name=At.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;let r=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}},Dt=class{constructor(e){this.parser=e,this.name=At.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],n=s.images[a.source],o=i.textureLoader;if(n.uri){let e=i.options.manager.getHandler(n.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},Pt=class{constructor(e){this.parser=e,this.name=At.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],n=s.images[a.source],o=i.textureLoader;if(n.uri){let e=i.options.manager.getHandler(n.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return i.loadTextureImage(e,a.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},Tt=class{constructor(e){this.name=At.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){let e=i.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){let i=e.byteOffset||0,s=e.byteLength||0,a=e.count,n=e.byteStride,o=new Uint8Array(t,i,s);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(a,n,o,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){let t=new ArrayBuffer(a*n);return r.decodeGltfBuffer(new Uint8Array(t),a,n,o,e.mode,e.filter),t}))}))}return null}},Rt=class{constructor(e){this.name=At.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(t){let i=this.parser.json,s=i.nodes[t];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;let r=i.meshes[s.mesh];for(let e of r.primitives)if(e.mode!==jt.TRIANGLES&&e.mode!==jt.TRIANGLE_STRIP&&e.mode!==jt.TRIANGLE_FAN&&void 0!==e.mode)return null;let a=s.extensions[this.name].attributes,n=[],o={};for(let e in a)n.push(this.parser.getDependency("accessor",a[e]).then((t=>(o[e]=t,o[e]))));return n.length<1?null:(n.push(this.parser.createNodeMesh(t)),Promise.all(n).then((t=>{let i=t.pop(),s=i.isGroup?i.children:[i],r=t[0].count,a=[];for(let t of s){let i=new e.Matrix4,s=new e.Vector3,n=new e.Quaternion,l=new e.Vector3(1,1,1),h=new e.InstancedMesh(t.geometry,t.material,r);for(let e=0;e<r;e++)o.TRANSLATION&&s.fromBufferAttribute(o.TRANSLATION,e),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,e),o.SCALE&&l.fromBufferAttribute(o.SCALE,e),h.setMatrixAt(e,i.compose(s,n,l));for(let i in o)if("_COLOR_0"===i){let t=o[i];h.instanceColor=new e.InstancedBufferAttribute(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&t.geometry.setAttribute(i,o[i]);e.Object3D.prototype.copy.call(h,t),this.parser.assignFinalMaterial(h),a.push(h)}return i.isGroup?(i.clear(),i.add(...a),i):a[0]})))}},Mt="glTF",Lt=1313821514,kt=5130562,Qt=class{constructor(e){this.name=At.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Mt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let s=this.header.length-12,r=new DataView(e,12),a=0;for(;a<s;){let t=r.getUint32(a,!0);a+=4;let s=r.getUint32(a,!0);if(a+=4,s===Lt){let s=new Uint8Array(e,12+a,t);this.content=i.decode(s)}else if(s===kt){let i=12+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Ot=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=At.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(t,i){let s=this.json,r=this.dracoLoader,a=t.extensions[this.name].bufferView,n=t.extensions[this.name].attributes,o={},l={},h={};for(let e in n){let t=Kt[e]||e.toLowerCase();o[t]=n[e]}for(let e in t.attributes){let i=Kt[e]||e.toLowerCase();if(void 0!==n[e]){let r=s.accessors[t.attributes[e]],a=Ht[r.componentType];h[i]=a.name,l[i]=!0===r.normalized}}return i.getDependency("bufferView",a).then((function(t){return new Promise((function(i,s){r.decodeDracoFile(t,(function(e){for(let t in e.attributes){let i=e.attributes[t],s=l[t];void 0!==s&&(i.normalized=s)}i(e)}),o,h,e.LinearSRGBColorSpace,s)}))}))}},Ft=class{constructor(){this.name=At.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Gt=class{constructor(){this.name=At.KHR_MESH_QUANTIZATION}},Ut=class extends e.Interpolant{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let e=0;e!==s;e++)t[e]=i[r+e];return t}interpolate_(e,t,i,s){let r=this.resultBuffer,a=this.sampleValues,n=this.valueSize,o=2*n,l=3*n,h=s-t,c=(i-t)/h,d=c*c,u=d*c,A=e*l,p=A-l,m=-2*u+3*d,g=u-d,f=1-m,v=g-d+c;for(let e=0;e!==n;e++){let t=a[p+e+n],i=a[p+e+o]*h,s=a[A+e+n],l=a[A+e]*h;r[e]=f*t+v*i+m*s+g*l}return r}},_t=new e.Quaternion,Nt=class extends Ut{interpolate_(e,t,i,s){let r=super.interpolate_(e,t,i,s);return _t.fromArray(r).normalize().toArray(r),r}},jt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ht={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Vt={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},Wt={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},zt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},qt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yt={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},Jt="OPAQUE",Xt="MASK",Zt="BLEND";function $t(t){return void 0===t.DefaultMaterial&&(t.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),t.DefaultMaterial}function ei(e,t,i){for(let s in i.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=i.extensions[s])}function ti(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ii(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,s=t.weights.length;i<s;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,s=i.length;t<s;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function si(e){let t,i=e.extensions&&e.extensions[At.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+ri(i.attributes):e.indices+":"+ri(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+ri(e.targets[i]);return t}function ri(e){let t="",i=Object.keys(e).sort();for(let s=0,r=i.length;s<r;s++)t+=i[s]+":"+e[i[s]]+";";return t}function ai(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var ni=new e.Matrix4,oi=class{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new ut,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,r=-1,a=!1,n=-1;if("undefined"!=typeof navigator){let e=navigator.userAgent;s=!0===/^((?!chrome|android).)*safari/i.test(e);let t=e.match(/Version\/(\d+)/);r=s&&t?parseInt(t[1],10):-1,a=e.indexOf("Firefox")>-1,n=a?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||s&&r<17||a&&n<98?this.textureLoader=new e.TextureLoader(this.options.manager):this.textureLoader=new e.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){let a={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:i,userData:{}};return ei(r,a,s),ti(a,s),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){for(let e of a.scenes)e.updateMatrixWorld();e(a)}))})).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){let s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){let s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let s=i.clone(),r=(e,t)=>{let i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(let[i,s]of e.children.entries())r(s,t.children[i])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let s=e(t[i]);if(s)return s}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let s=0;s<t.length;s++){let r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){let i=e+":"+t,s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return i.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(t){let i=this.json.buffers[t],s=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===t)return Promise.resolve(this.extensions[At.KHR_BINARY_GLTF].body);let r=this.options;return new Promise((function(t,a){s.load(e.LoaderUtils.resolveURL(i.uri,r.path),t,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){let i=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+i)}))}loadAccessor(t){let i=this,s=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse){let t=zt[r.type],i=Ht[r.componentType],s=!0===r.normalized,a=new i(r.count*t);return Promise.resolve(new e.BufferAttribute(a,t,s))}let a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(t){let a,n,o=t[0],l=zt[r.type],h=Ht[r.componentType],c=h.BYTES_PER_ELEMENT,d=c*l,u=r.byteOffset||0,A=void 0!==r.bufferView?s.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(A&&A!==d){let t=Math.floor(u/A),s="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+t+":"+r.count,d=i.cache.get(s);d||(a=new h(o,t*A,r.count*A/c),d=new e.InterleavedBuffer(a,A/c),i.cache.add(s,d)),n=new e.InterleavedBufferAttribute(d,l,u%A/c,p)}else a=null===o?new h(r.count*l):new h(o,u,r.count*l),n=new e.BufferAttribute(a,l,p);if(void 0!==r.sparse){let i=zt.SCALAR,s=Ht[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,d=new s(t[1],a,r.sparse.count*i),u=new h(t[2],c,r.sparse.count*l);null!==o&&(n=new e.BufferAttribute(n.array.slice(),n.itemSize,n.normalized)),n.normalized=!1;for(let e=0,t=d.length;e<t;e++){let t=d[e];if(n.setX(t,u[e*l]),l>=2&&n.setY(t,u[e*l+1]),l>=3&&n.setZ(t,u[e*l+2]),l>=4&&n.setW(t,u[e*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}n.normalized=p}return n}))}loadTexture(e){let t=this.json,i=this.options,s=t.textures[e].source,r=t.images[s],a=this.textureLoader;if(r.uri){let e=i.manager.getHandler(r.uri);null!==e&&(a=e)}return this.loadTextureImage(e,s,a)}loadTextureImage(t,i,s){let r=this,a=this.json,n=a.textures[t],o=a.images[i],l=(o.uri||o.bufferView)+":"+n.sampler;if(this.textureCache[l])return this.textureCache[l];let h=this.loadImageSource(i,s).then((function(i){i.flipY=!1,i.name=n.name||o.name||"",""===i.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(i.name=o.uri);let s=(a.samplers||{})[n.sampler]||{};return i.magFilter=Vt[s.magFilter]||e.LinearFilter,i.minFilter=Vt[s.minFilter]||e.LinearMipmapLinearFilter,i.wrapS=Wt[s.wrapS]||e.RepeatWrapping,i.wrapT=Wt[s.wrapT]||e.RepeatWrapping,i.generateMipmaps=!i.isCompressedTexture&&i.minFilter!==e.NearestFilter&&i.minFilter!==e.LinearFilter,r.associations.set(i,{textures:t}),i})).catch((function(){return null}));return this.textureCache[l]=h,h}loadImageSource(t,i){let s=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((e=>e.clone()));let a=s.images[t],n=self.URL||self.webkitURL,o=a.uri||"",l=!1;if(void 0!==a.bufferView)o=this.getDependency("bufferView",a.bufferView).then((function(e){l=!0;let t=new Blob([e],{type:a.mimeType});return o=n.createObjectURL(t),o}));else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let h=Promise.resolve(o).then((function(t){return new Promise((function(s,a){let n=s;!0===i.isImageBitmapLoader&&(n=function(t){let i=new e.Texture(t);i.needsUpdate=!0,s(i)}),i.load(e.LoaderUtils.resolveURL(t,r.path),n,void 0,a)}))})).then((function(e){return!0===l&&n.revokeObjectURL(o),ti(e,a),e.userData.mimeType=a.mimeType||function(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":e.search(/\.ktx2($|\?)/i)>0||0===e.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"}(a.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[t]=h,h}assignTexture(e,t,i,s){let r=this;return this.getDependency("texture",i.index).then((function(a){if(!a)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((a=a.clone()).channel=i.texCoord),r.extensions[At.KHR_TEXTURE_TRANSFORM]){let e=void 0!==i.extensions?i.extensions[At.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=r.associations.get(a);a=r.extensions[At.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),r.associations.set(a,t)}}return void 0!==s&&(a.colorSpace=s),e[t]=a,a}))}assignFinalMaterial(t){let i=t.geometry,s=t.material,r=void 0===i.attributes.tangent,a=void 0!==i.attributes.color,n=void 0===i.attributes.normal;if(t.isPoints){let t="PointsMaterial:"+s.uuid,i=this.cache.get(t);i||(i=new e.PointsMaterial,e.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(t,i)),s=i}else if(t.isLine){let t="LineBasicMaterial:"+s.uuid,i=this.cache.get(t);i||(i=new e.LineBasicMaterial,e.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,this.cache.add(t,i)),s=i}if(r||a||n){let e="ClonedMaterial:"+s.uuid+":";r&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),n&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),n&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}t.material=s}getMaterialType(){return e.MeshStandardMaterial}loadMaterial(t){let i,s=this,r=this.json,a=this.extensions,n=r.materials[t],o={},l=[];if((n.extensions||{})[At.KHR_MATERIALS_UNLIT]){let e=a[At.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),l.push(e.extendParams(o,n,s))}else{let r=n.pbrMetallicRoughness||{};if(o.color=new e.Color(1,1,1),o.opacity=1,Array.isArray(r.baseColorFactor)){let t=r.baseColorFactor;o.color.setRGB(t[0],t[1],t[2],e.LinearSRGBColorSpace),o.opacity=t[3]}void 0!==r.baseColorTexture&&l.push(s.assignTexture(o,"map",r.baseColorTexture,e.SRGBColorSpace)),o.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,o.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(l.push(s.assignTexture(o,"metalnessMap",r.metallicRoughnessTexture)),l.push(s.assignTexture(o,"roughnessMap",r.metallicRoughnessTexture))),i=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===n.doubleSided&&(o.side=e.DoubleSide);let h=n.alphaMode||Jt;if(h===Zt?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===Xt&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&i!==e.MeshBasicMaterial&&(l.push(s.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new e.Vector2(1,1),void 0!==n.normalTexture.scale)){let e=n.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==n.occlusionTexture&&i!==e.MeshBasicMaterial&&(l.push(s.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&i!==e.MeshBasicMaterial){let t=n.emissiveFactor;o.emissive=(new e.Color).setRGB(t[0],t[1],t[2],e.LinearSRGBColorSpace)}return void 0!==n.emissiveTexture&&i!==e.MeshBasicMaterial&&l.push(s.assignTexture(o,"emissiveMap",n.emissiveTexture,e.SRGBColorSpace)),Promise.all(l).then((function(){let e=new i(o);return n.name&&(e.name=n.name),ti(e,n),s.associations.set(e,{materials:t}),n.extensions&&ei(a,e,n),e}))}createUniqueName(t){let i=e.PropertyBinding.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){let i=this,s=this.extensions,r=this.primitiveCache;function a(e){return s[At.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then((function(t){return li(t,e,i)}))}let n=[];for(let s=0,o=t.length;s<o;s++){let o=t[s],l=si(o),h=r[l];if(h)n.push(h.promise);else{let t;t=o.extensions&&o.extensions[At.KHR_DRACO_MESH_COMPRESSION]?a(o):li(new e.BufferGeometry,o,i),r[l]={primitive:o,promise:t},n.push(t)}}return Promise.all(n)}loadMesh(t){let i=this,s=this.json,r=this.extensions,a=s.meshes[t],n=a.primitives,o=[];for(let e=0,t=n.length;e<t;e++){let t=void 0===n[e].material?$t(this.cache):this.getDependency("material",n[e].material);o.push(t)}return o.push(i.loadGeometries(n)),Promise.all(o).then((function(s){let o=s.slice(0,s.length-1),l=s[s.length-1],h=[];for(let s=0,c=l.length;s<c;s++){let c,d=l[s],u=n[s],A=o[s];if(u.mode===jt.TRIANGLES||u.mode===jt.TRIANGLE_STRIP||u.mode===jt.TRIANGLE_FAN||void 0===u.mode)c=!0===a.isSkinnedMesh?new e.SkinnedMesh(d,A):new e.Mesh(d,A),!0===c.isSkinnedMesh&&c.normalizeSkinWeights(),u.mode===jt.TRIANGLE_STRIP?c.geometry=ot(c.geometry,e.TriangleStripDrawMode):u.mode===jt.TRIANGLE_FAN&&(c.geometry=ot(c.geometry,e.TriangleFanDrawMode));else if(u.mode===jt.LINES)c=new e.LineSegments(d,A);else if(u.mode===jt.LINE_STRIP)c=new e.Line(d,A);else if(u.mode===jt.LINE_LOOP)c=new e.LineLoop(d,A);else{if(u.mode!==jt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);c=new e.Points(d,A)}Object.keys(c.geometry.morphAttributes).length>0&&ii(c,a),c.name=i.createUniqueName(a.name||"mesh_"+t),ti(c,a),u.extensions&&ei(r,c,u),i.assignFinalMaterial(c),h.push(c)}for(let e=0,s=h.length;e<s;e++)i.associations.set(h[e],{meshes:t,primitives:e});if(1===h.length)return a.extensions&&ei(r,h[0],a),h[0];let c=new e.Group;a.extensions&&ei(r,c,a),i.associations.set(c,{meshes:t});for(let e=0,t=h.length;e<t;e++)c.add(h[e]);return c}))}loadCamera(t){let i,s=this.json.cameras[t],r=s[s.type];if(r)return"perspective"===s.type?i=new e.PerspectiveCamera(e.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===s.type&&(i=new e.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),ti(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){let i=this.json.skins[t],s=[];for(let e=0,t=i.joints.length;e<t;e++)s.push(this._loadNodeShallow(i.joints[e]));return void 0!==i.inverseBindMatrices?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(t){let s=t.pop(),r=t,a=[],n=[];for(let t=0,o=r.length;t<o;t++){let o=r[t];if(o){a.push(o);let i=new e.Matrix4;null!==s&&i.fromArray(s.array,16*t),n.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[t])}return new e.Skeleton(a,n)}))}loadAnimation(t){let i=this.json,s=this,r=i.animations[t],a=r.name?r.name:"animation_"+t,n=[],o=[],l=[],h=[],c=[];for(let e=0,t=r.channels.length;e<t;e++){let t=r.channels[e],i=r.samplers[t.sampler],s=t.target,a=s.node,d=void 0!==r.parameters?r.parameters[i.input]:i.input,u=void 0!==r.parameters?r.parameters[i.output]:i.output;void 0!==s.node&&(n.push(this.getDependency("node",a)),o.push(this.getDependency("accessor",d)),l.push(this.getDependency("accessor",u)),h.push(i),c.push(s))}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(c)]).then((function(t){let i=t[0],r=t[1],n=t[2],o=t[3],l=t[4],h=[];for(let e=0,t=i.length;e<t;e++){let t=i[e],a=r[e],c=n[e],d=o[e],u=l[e];if(void 0===t)continue;t.updateMatrix&&t.updateMatrix();let A=s._createAnimationTracks(t,a,c,d,u);if(A)for(let e=0;e<A.length;e++)h.push(A[e])}return new e.AnimationClip(a,void 0,h)}))}createNodeMesh(e){let t=this.json,i=this,s=t.nodes[e];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(e){let t=i._getNodeRef(i.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){let t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),r=[],a=i.children||[];for(let e=0,i=a.length;e<i;e++)r.push(t.getDependency("node",a[e]));let n=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(r),n]).then((function(e){let t=e[0],i=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,ni)}));for(let e=0,s=i.length;e<s;e++)t.add(i[e]);return t}))}_loadNodeShallow(t){let i=this.json,s=this.extensions,r=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];let a=i.nodes[t],n=a.name?r.createUniqueName(a.name):"",o=[],l=r._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return l&&o.push(l),void 0!==a.camera&&o.push(r.getDependency("camera",a.camera).then((function(e){return r._getNodeRef(r.cameraCache,a.camera,e)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(e){o.push(e)})),this.nodeCache[t]=Promise.all(o).then((function(i){let o;if(o=!0===a.isBone?new e.Bone:i.length>1?new e.Group:1===i.length?i[0]:new e.Object3D,o!==i[0])for(let e=0,t=i.length;e<t;e++)o.add(i[e]);if(a.name&&(o.userData.name=a.name,o.name=n),ti(o,a),a.extensions&&ei(s,o,a),void 0!==a.matrix){let t=new e.Matrix4;t.fromArray(a.matrix),o.applyMatrix4(t)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){let i=this.extensions,s=this.json.scenes[t],r=this,a=new e.Group;s.name&&(a.name=r.createUniqueName(s.name)),ti(a,s),s.extensions&&ei(i,a,s);let n=s.nodes||[],o=[];for(let e=0,t=n.length;e<t;e++)o.push(r.getDependency("node",n[e]));return Promise.all(o).then((function(t){for(let e=0,i=t.length;e<i;e++)a.add(t[e]);return r.associations=(t=>{let i=new Map;for(let[t,s]of r.associations)(t instanceof e.Material||t instanceof e.Texture)&&i.set(t,s);return t.traverse((e=>{let t=r.associations.get(e);null!=t&&i.set(e,t)})),i})(a),a}))}_createAnimationTracks(t,i,s,r,a){let n,o=[],l=t.name?t.name:t.uuid,h=[];switch(qt[a.path]===qt.weights?t.traverse((function(e){e.morphTargetInfluences&&h.push(e.name?e.name:e.uuid)})):h.push(l),qt[a.path]){case qt.weights:n=e.NumberKeyframeTrack;break;case qt.rotation:n=e.QuaternionKeyframeTrack;break;case qt.position:case qt.scale:n=e.VectorKeyframeTrack;break;default:if(1===s.itemSize)n=e.NumberKeyframeTrack;else n=e.VectorKeyframeTrack}let c=void 0!==r.interpolation?Yt[r.interpolation]:e.InterpolateLinear,d=this._getArrayFromAccessor(s);for(let e=0,t=h.length;e<t;e++){let t=new n(h[e]+"."+qt[a.path],i.array,d,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(t),o.push(t)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=ai(t.constructor),i=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s++)i[s]=t[s]*e;t=i}return t}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof e.QuaternionKeyframeTrack?Nt:Ut)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function li(t,i,s){let r=i.attributes,a=[];function n(e,i){return s.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(let e in r){let i=Kt[e]||e.toLowerCase();i in t.attributes||a.push(n(r[e],i))}if(void 0!==i.indices&&!t.index){let e=s.getDependency("accessor",i.indices).then((function(e){t.setIndex(e)}));a.push(e)}return e.ColorManagement.workingColorSpace!==e.LinearSRGBColorSpace&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${e.ColorManagement.workingColorSpace}" not supported.`),ti(t,i),function(t,i,s){let r=i.attributes,a=new e.Box3;if(void 0===r.POSITION)return;{let t=s.json.accessors[r.POSITION],i=t.min,n=t.max;if(void 0===i||void 0===n)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new e.Vector3(i[0],i[1],i[2]),new e.Vector3(n[0],n[1],n[2])),t.normalized){let e=ai(Ht[t.componentType]);a.min.multiplyScalar(e),a.max.multiplyScalar(e)}}let n=i.targets;if(void 0!==n){let t=new e.Vector3,i=new e.Vector3;for(let e=0,r=n.length;e<r;e++){let r=n[e];if(void 0!==r.POSITION){let e=s.json.accessors[r.POSITION],a=e.min,n=e.max;if(void 0!==a&&void 0!==n){if(i.setX(Math.max(Math.abs(a[0]),Math.abs(n[0]))),i.setY(Math.max(Math.abs(a[1]),Math.abs(n[1]))),i.setZ(Math.max(Math.abs(a[2]),Math.abs(n[2]))),e.normalized){let t=ai(Ht[e.componentType]);i.multiplyScalar(t)}t.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(t)}t.boundingBox=a;let o=new e.Sphere;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,t.boundingSphere=o}(t,i,s),Promise.all(a).then((function(){return void 0!==i.targets?function(e,t,i){let s=!1,r=!1,a=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(r=!0),void 0!==i.COLOR_0&&(a=!0),s&&r&&a)break}if(!s&&!r&&!a)return Promise.resolve(e);let n=[],o=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(s){let t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;n.push(t)}if(r){let t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(a){let t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l)]).then((function(t){let i=t[0],n=t[1],o=t[2];return s&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=n),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(t,i.targets,s):t}))}var hi=new WeakMap,ci=class extends e.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(t,i,s,r){let a=new e.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(e=>{this.parse(e,i,r)}),s,r)}parse(t,i,s=()=>{}){this.decodeDracoFile(t,i,null,null,e.SRGBColorSpace,s).catch(s)}decodeDracoFile(t,i,s,r,a=e.LinearSRGBColorSpace,n=()=>{}){let o={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:a};return this.decodeGeometry(t,o).then(i).catch(n)}decodeGeometry(e,t){let i=JSON.stringify(t);if(hi.has(e)){let t=hi.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s,r=this.workerNextTaskID++,a=e.byteLength,n=this._getWorker(r,a).then((i=>(s=i,new Promise(((i,a)=>{s._callbacks[r]={resolve:i,reject:a},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return n.catch((()=>!0)).then((()=>{s&&r&&this._releaseTask(s,r)})),hi.set(e,{key:i,promise:n}),n}_createGeometry(t){let i=new e.BufferGeometry;t.index&&i.setIndex(new e.BufferAttribute(t.index.array,1));for(let s=0;s<t.attributes.length;s++){let r=t.attributes[s],a=r.name,n=r.array,o=r.itemSize,l=new e.BufferAttribute(n,o);"color"===a&&(this._assignVertexColorSpace(l,r.vertexColorSpace),l.normalized=!(n instanceof Float32Array)),i.setAttribute(a,l)}return i}_assignVertexColorSpace(t,i){if(i!==e.SRGBColorSpace)return;let s=new e.Color;for(let i=0,r=t.count;i<r;i++)s.fromBufferAttribute(t,i),e.ColorManagement.toWorkingColorSpace(s,e.SRGBColorSpace),t.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(t,i){let s=new e.FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{s.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{let i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let s=di.toString(),r=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function di(){let e,t;function i(e,t,i,s,r,a){let n=a.num_components(),o=i.num_points()*n,l=o*r.BYTES_PER_ELEMENT,h=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,a,h,l,c);let d=new r(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:s,array:d,itemSize:n}}onmessage=function(s){let r=s.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":let s=r.buffer,a=r.taskConfig;t.then((e=>{let t=e.draco,n=new t.Decoder;try{let e=function(e,t,s,r){let a,n,o=r.attributeIDs,l=r.attributeTypes,h=t.GetEncodedGeometryType(s);if(h===e.TRIANGULAR_MESH)a=new e.Mesh,n=t.DecodeArrayToMesh(s,s.byteLength,a);else{if(h!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,n=t.DecodeArrayToPointCloud(s,s.byteLength,a)}if(!n.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+n.error_msg());let c={index:null,attributes:[]};for(let s in o){let n,h,d=self[l[s]];if(r.useUniqueIDs)h=o[s],n=t.GetAttributeByUniqueId(a,h);else{if(h=t.GetAttributeId(a,e[o[s]]),-1===h)continue;n=t.GetAttribute(a,h)}let u=i(e,t,a,s,d,n);"color"===s&&(u.vertexColorSpace=r.vertexColorSpace),c.attributes.push(u)}return h===e.TRIANGULAR_MESH&&(c.index=function(e,t,i){let s=3*i.num_faces(),r=4*s,a=e._malloc(r);t.GetTrianglesUInt32Array(i,r,a);let n=new Uint32Array(e.HEAPF32.buffer,a,s).slice();return e._free(a),{array:n,itemSize:1}}(e,t,a)),e.destroy(a),c}(t,n,new Int8Array(s),a),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(n)}}))}}}var ui=class{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){let i=this.workersResolve[e];if(i&&i(t),this.queue.length){let{resolve:t,msg:i,transfer:s}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,s)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{let s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}},Ai=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},pi=class{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);let i=this._offset,s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}},mi=[171,75,84,88,32,50,48,187,13,10,26,10];function gi(e){return(new TextDecoder).decode(e)}var fi,vi,bi,xi,Ci={env:{emscripten_notify_memory_growth:function(e){bi=new Uint8Array(vi.exports.memory.buffer)}}},yi=class{init(){return fi||(fi="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ei).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Ci))).then(this._init):WebAssembly.instantiate(Buffer.from(Ei,"base64"),Ci).then(this._init),fi)}_init(e){vi=e.instance,Ci.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!vi)throw new Error("ZSTDDecoder: Await .init() before decoding.");let i=e.byteLength,s=vi.exports.malloc(i);bi.set(e,s),t=t||Number(vi.exports.ZSTD_findDecompressedSize(s,i));let r=vi.exports.malloc(t),a=vi.exports.ZSTD_decompress(r,t,s,i),n=bi.slice(r,r+a);return vi.exports.free(s),vi.exports.free(r),n}},Ei="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",Ii=new WeakMap,Bi=0,wi=class t extends e.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new ui,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){let i=new e.FileLoader(this.manager);i.setPath(this.transcoderPath),i.setWithCredentials(this.withCredentials);let s=i.loadAsync("basis_transcoder.js"),r=new e.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let a=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([s,a]).then((([e,i])=>{let s=t.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(t.EngineFormat),"let _EngineType = "+JSON.stringify(t.EngineType),"let _TranscoderFormat = "+JSON.stringify(t.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(t.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=i,this.workerPool.setWorkerCreator((()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Bi>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Bi++}return this.transcoderPending}load(t,i,s,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let a=new e.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(t,(e=>{this.parse(e,i,r)}),s,r)}parse(e,t,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Ii.has(e))return Ii.get(e).promise.then(t).catch(i);this._createTexture(e).then((e=>t?t(e):null)).catch(i)}_createTextureFrom(t,i){let s,{type:r,error:a,data:{faces:n,width:o,height:l,format:h,type:c,dfdFlags:d}}=t;if("error"===r)return Promise.reject(a);if(6===i.faceCount)s=new e.CompressedCubeTexture(n,h,c);else{let t=n[0].mipmaps;s=i.layerCount>1?new e.CompressedArrayTexture(t,o,l,i.layerCount,h,c):new e.CompressedTexture(t,o,l,h,c)}return s.minFilter=1===n[0].mipmaps.length?e.LinearFilter:e.LinearMipmapLinearFilter,s.magFilter=e.LinearFilter,s.generateMipmaps=!1,s.needsUpdate=!0,s.colorSpace=Ti(i),s.premultiplyAlpha=!!(1&d),s}async _createTexture(t,i={}){let s=function(e){let t=new Uint8Array(e.buffer,e.byteOffset,mi.length);if(t[0]!==mi[0]||t[1]!==mi[1]||t[2]!==mi[2]||t[3]!==mi[3]||t[4]!==mi[4]||t[5]!==mi[5]||t[6]!==mi[6]||t[7]!==mi[7]||t[8]!==mi[8]||t[9]!==mi[9]||t[10]!==mi[10]||t[11]!==mi[11])throw new Error("Missing KTX 2.0 identifier.");let i=new Ai,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new pi(e,mi.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();let a=r._nextUint32();i.supercompressionScheme=r._nextUint32();let n=r._nextUint32(),o=r._nextUint32(),l=r._nextUint32(),h=r._nextUint32(),c=r._nextUint64(),d=r._nextUint64(),u=new pi(e,mi.length+s,3*a*8,!0);for(let t=0;t<a;t++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});let A=new pi(e,n,o,!0),p={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},m=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){let t={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=A._nextInt32(),t.sampleUpper=A._nextInt32()):(t.sampleLower=A._nextUint32(),t.sampleUpper=A._nextUint32()),p.samples[e]=t}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);let g=new pi(e,l,h,!0);for(;g._offset<h;){let e=g._nextUint32(),t=g._scan(e),s=gi(t);if(i.keyValue[s]=g._nextUint8Array(e-t.byteLength-1),s.match(/^ktx/i)){let e=gi(i.keyValue[s]);i.keyValue[s]=e.substring(0,e.lastIndexOf("\0"))}g._skip(e%4?4-e%4:0)}if(d<=0)return i;let f=new pi(e,c,d,!0),v=f._nextUint16(),b=f._nextUint16(),x=f._nextUint32(),C=f._nextUint32(),y=f._nextUint32(),E=f._nextUint32(),I=[];for(let e=0;e<a;e++)I.push({imageFlags:f._nextUint32(),rgbSliceByteOffset:f._nextUint32(),rgbSliceByteLength:f._nextUint32(),alphaSliceByteOffset:f._nextUint32(),alphaSliceByteLength:f._nextUint32()});let B=c+f._offset,w=B+x,S=w+C,D=S+y,P=new Uint8Array(e.buffer,e.byteOffset+B,x),T=new Uint8Array(e.buffer,e.byteOffset+w,C),R=new Uint8Array(e.buffer,e.byteOffset+S,y),M=new Uint8Array(e.buffer,e.byteOffset+D,E);return i.globalData={endpointCount:v,selectorCount:b,imageDescs:I,endpointsData:P,selectorsData:T,tablesData:R,extendedData:M},i}(new Uint8Array(t)),r=1000066e3===s.vkFormat&&167===s.dataFormatDescriptor[0].colorModel;if(0!==s.vkFormat&&(!r||this.workerConfig.astcHDRSupported))return async function(t){let i,{vkFormat:s}=t;if(void 0===Di[s])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");2===t.supercompressionScheme&&(xi||(xi=new Promise((async e=>{let t=new yi;await t.init(),e(t)}))),i=await xi);let r,a=[];for(let r=0;r<t.levels.length;r++){let n,o,l=Math.max(1,t.pixelWidth>>r),h=Math.max(1,t.pixelHeight>>r),c=t.pixelDepth?Math.max(1,t.pixelDepth>>r):0,d=t.levels[r];if(0===t.supercompressionScheme)n=d.levelData;else{if(2!==t.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");n=i.decode(d.levelData,d.uncompressedByteLength)}o=Pi[s]===e.FloatType?new Float32Array(n.buffer,n.byteOffset,n.byteLength/Float32Array.BYTES_PER_ELEMENT):Pi[s]===e.HalfFloatType?new Uint16Array(n.buffer,n.byteOffset,n.byteLength/Uint16Array.BYTES_PER_ELEMENT):n,a.push({data:o,width:l,height:h,depth:c})}if(Si.has(Di[s]))r=0===t.pixelDepth?new e.DataTexture(a[0].data,t.pixelWidth,t.pixelHeight):new e.Data3DTexture(a[0].data,t.pixelWidth,t.pixelHeight,t.pixelDepth);else{if(t.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new e.CompressedTexture(a,t.pixelWidth,t.pixelHeight),r.minFilter=1===a.length?e.LinearFilter:e.LinearMipmapLinearFilter,r.magFilter=e.LinearFilter}return r.mipmaps=a,r.type=Pi[s],r.format=Di[s],r.colorSpace=Ti(t),r.needsUpdate=!0,Promise.resolve(r)}(s);let a=i,n=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:a},[t]))).then((e=>this._createTextureFrom(e.data,s)));return Ii.set(t,{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Bi--,this}};wi.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},wi.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},wi.EngineFormat={RGBAFormat:e.RGBAFormat,RGBA_ASTC_4x4_Format:e.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:e.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:e.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:e.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:e.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:e.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:e.RGB_ETC1_Format,RGB_ETC2_Format:e.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:e.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:e.RGBA_S3TC_DXT1_Format},wi.EngineType={UnsignedByteType:e.UnsignedByteType,HalfFloatType:e.HalfFloatType,FloatType:e.FloatType},wi.BasisWorker=function(){let e,t,i,s=_EngineFormat,r=_EngineType,a=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",(function(s){let a=s.data;switch(a.type){case"init":e=a.config,function(e){t=new Promise((t=>{i={wasmBinary:e,onRuntimeInitialized:t},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}))}(a.transcoderBinary);break;case"transcode":t.then((()=>{try{let{faces:t,buffers:s,width:o,height:d,hasAlpha:u,format:A,type:p,dfdFlags:m}=function(t){let s,a=new i.KTX2File(new Uint8Array(t));function o(){a.close(),a.delete()}if(!a.isValid())throw o(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");if(a.isUASTC())s=n.UASTC;else if(a.isETC1S())s=n.ETC1S;else{if(!a.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");s=n.UASTC_HDR}let d=a.getWidth(),u=a.getHeight(),A=a.getLayers()||1,p=a.getLevels(),m=a.getFaces(),g=a.getHasAlpha(),f=a.getDFDFlags(),{transcoderFormat:v,engineFormat:b,engineType:x}=function(t,i,s,r){let a=l[t];for(let n=0;n<a.length;n++){let o=a[n];if(!(o.if&&!e[o.if]||!o.basisFormat.includes(t)||r&&o.transcoderFormat.length<2)&&(!o.needsPowerOfTwo||h(i)&&h(s)))return{transcoderFormat:o.transcoderFormat[r?1:0],engineFormat:o.engineFormat[r?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(s,d,u,g);if(!d||!u||!p)throw o(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!a.startTranscoding())throw o(),new Error("THREE.KTX2Loader: .startTranscoding failed");let C=[],y=[];for(let e=0;e<m;e++){let t=[];for(let i=0;i<p;i++){let s,n,l=[];for(let t=0;t<A;t++){let h=a.getImageLevelInfo(i,t,e);0===e&&0===i&&0===t&&(h.origWidth%4!=0||h.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),p>1?(s=h.origWidth,n=h.origHeight):(s=h.width,n=h.height);let c=new Uint8Array(a.getImageTranscodedSizeInBytes(i,t,0,v)),d=a.transcodeImage(c,i,t,e,v,0,-1,-1);if(x===r.HalfFloatType&&(c=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!d)throw o(),new Error("THREE.KTX2Loader: .transcodeImage failed.");l.push(c)}let h=c(l);t.push({data:h,width:s,height:n}),y.push(h.buffer)}C.push({mipmaps:t,width:d,height:u,format:b,type:x})}return o(),{faces:C,buffers:y,width:d,height:u,hasAlpha:g,dfdFlags:f,format:b,type:x}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:o,height:d,hasAlpha:u,format:A,type:p,dfdFlags:m}},s)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}}))}}));let o=[{if:"astcSupported",basisFormat:[n.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[r.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[r.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[r.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[r.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[r.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[r.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[n.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[r.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[r.UnsignedByteType,r.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[n.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[r.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[n.ETC1S]:o.filter((e=>e.basisFormat.includes(n.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[n.UASTC]:o.filter((e=>e.basisFormat.includes(n.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[n.UASTC_HDR]:o.filter((e=>e.basisFormat.includes(n.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function h(e){return e<=2||!(e&e-1)&&0!==e}function c(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}let i=new Uint8Array(t),s=0;for(let t=0;t<e.length;t++){let r=e[t];i.set(r,s),s+=r.byteLength}return i}};var Si=new Set([e.RGBAFormat,e.RGFormat,e.RedFormat]),Di={109:e.RGBAFormat,97:e.RGBAFormat,37:e.RGBAFormat,43:e.RGBAFormat,103:e.RGFormat,83:e.RGFormat,16:e.RGFormat,22:e.RGFormat,100:e.RedFormat,76:e.RedFormat,15:e.RedFormat,9:e.RedFormat,1000066e3:e.RGBA_ASTC_4x4_Format,166:e.RGBA_ASTC_6x6_Format,165:e.RGBA_ASTC_6x6_Format},Pi={109:e.FloatType,97:e.HalfFloatType,37:e.UnsignedByteType,43:e.UnsignedByteType,103:e.FloatType,83:e.HalfFloatType,16:e.UnsignedByteType,22:e.UnsignedByteType,100:e.FloatType,76:e.HalfFloatType,15:e.UnsignedByteType,9:e.UnsignedByteType,1000066e3:e.HalfFloatType,166:e.UnsignedByteType,165:e.UnsignedByteType};function Ti(t){let i=t.dataFormatDescriptor[0];return 1===i.colorPrimaries?2===i.transferFunction?e.SRGBColorSpace:e.LinearSRGBColorSpace:10===i.colorPrimaries?2===i.transferFunction?"display-p3":"display-p3-linear":(0===i.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${i.colorPrimaries}"`),e.NoColorSpace)}var Ri=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,s=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",r=WebAssembly.instantiate(a(s),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function a(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;++s){var r=e.charCodeAt(s);i[s]=r>96?r-97:r>64?r-39:r+4}var a=0;for(s=0;s<e.length;++s)i[a++]=i[s]<60?t[i[s]]:64*(i[s]-60)+i[++s];return i.buffer.slice(0,a)}function n(e,t,s,r,a,n){var o=i.exports.sbrk,l=s+3&-4,h=o(l*r),c=o(a.length),d=new Uint8Array(i.exports.memory.buffer);d.set(a,c);var u=e(h,s,r,c,a.length);if(0==u&&n&&n(h,l,r),t.set(d.subarray(h,h+s*r)),o(h-o(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},h=[],c=0;function d(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function u(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+n.toString()+A.toString(),i=new Blob([t],{type:"text/javascript"}),r=URL.createObjectURL(i),o=0;o<e;++o)h[o]=d(r);URL.revokeObjectURL(r)}function A(e){r.then((function(){var t=e.data;try{var s=new Uint8Array(t.count*t.size);n(i.exports[t.mode],s,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:s},[s.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:r,supported:!0,useWorkers:function(e){u(e)},decodeVertexBuffer:function(e,t,s,r,a){n(i.exports.meshopt_decodeVertexBuffer,e,t,s,r,i.exports[o[a]])},decodeIndexBuffer:function(e,t,s,r){n(i.exports.meshopt_decodeIndexBuffer,e,t,s,r)},decodeIndexSequence:function(e,t,s,r){n(i.exports.meshopt_decodeIndexSequence,e,t,s,r)},decodeGltfBuffer:function(e,t,s,r,a,h){n(i.exports[l[a]],e,t,s,r,i.exports[o[h]])},decodeGltfBufferAsync:function(e,t,s,a,d){return h.length>0?function(e,t,i,s,r){for(var a=h[0],n=1;n<h.length;++n)h[n].pending<a.pending&&(a=h[n]);return new Promise((function(n,o){var l=new Uint8Array(i),h=c++;a.pending+=e,a.requests[h]={resolve:n,reject:o},a.object.postMessage({id:h,count:e,size:t,source:l,mode:s,filter:r},[l.buffer])}))}(e,t,s,l[a],o[d]):r.then((function(){var r=new Uint8Array(e*t);return n(i.exports[l[a]],r,e,t,s,i.exports[o[d]]),r}))}}}(),Mi=Uint8Array,Li=Uint16Array,ki=Int32Array,Qi=new Mi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Oi=new Mi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fi=new Mi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gi=function(e,t){for(var i=new Li(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var r=new ki(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)r[a]=a-i[s]<<5|s;return{b:i,r:r}},Ui=Gi(Qi,2),_i=Ui.b,Ni=Ui.r;_i[28]=258,Ni[258]=28;var ji=Gi(Oi,0).b,Hi=new Li(32768);for(Ki=0;Ki<32768;++Ki)Vi=(61680&(Vi=(52428&(Vi=(43690&Ki)>>1|(21845&Ki)<<1))>>2|(13107&Vi)<<2))>>4|(3855&Vi)<<4,Hi[Ki]=((65280&Vi)>>8|(255&Vi)<<8)>>1;var Vi,Wi=function(e,t,i){for(var s=e.length,r=0,a=new Li(t);r<s;++r)e[r]&&++a[e[r]-1];var n,o=new Li(t);for(r=1;r<t;++r)o[r]=o[r-1]+a[r-1]<<1;n=new Li(1<<t);var l=15-t;for(r=0;r<s;++r)if(e[r])for(var h=r<<4|e[r],c=t-e[r],d=o[e[r]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)n[Hi[d]>>l]=h;return n},zi=new Mi(288);for(Ki=0;Ki<144;++Ki)zi[Ki]=8;for(Ki=144;Ki<256;++Ki)zi[Ki]=9;for(Ki=256;Ki<280;++Ki)zi[Ki]=7;for(Ki=280;Ki<288;++Ki)zi[Ki]=8;var Ki,qi=new Mi(32);for(Ki=0;Ki<32;++Ki)qi[Ki]=5;var Yi=Wi(zi,9),Ji=Wi(qi,5),Xi=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},Zi=function(e,t,i){var s=t/8|0;return(e[s]|e[s+1]<<8)>>(7&t)&i},$i=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},es=function(e){return(e+7)/8|0},ts=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],is=function(e,t,i){var s=new Error(t||ts[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,is),!i)throw s;return s},ss=function(e,t,i,s){var r=e.length;if(!r||t.f&&!t.l)return i||new Mi(0);var a=!i,n=a||2!=t.i,o=t.i;a&&(i=new Mi(3*r));var l=function(e){var t=i.length;if(e>t){var s=new Mi(Math.max(2*t,e));s.set(i),i=s}},h=t.f||0,c=t.p||0,d=t.b||0,u=t.l,A=t.d,p=t.m,m=t.n,g=8*r;do{if(!u){h=Zi(e,c,1);var f=Zi(e,c+1,3);if(c+=3,!f){var v=e[(P=es(c)+4)-4]|e[P-3]<<8,b=P+v;if(b>r){o&&is(0);break}n&&l(d+v),i.set(e.subarray(P,b),d),t.b=d+=v,t.p=c=8*b,t.f=h;continue}if(1==f)u=Yi,A=Ji,p=9,m=5;else if(2==f){var x=Zi(e,c,31)+257,C=Zi(e,c+10,15)+4,y=x+Zi(e,c+5,31)+1;c+=14;for(var E=new Mi(y),I=new Mi(19),B=0;B<C;++B)I[Fi[B]]=Zi(e,c+3*B,7);c+=3*C;var w=Xi(I),S=(1<<w)-1,D=Wi(I,w);for(B=0;B<y;){var P,T=D[Zi(e,c,S)];if(c+=15&T,(P=T>>4)<16)E[B++]=P;else{var R=0,M=0;for(16==P?(M=3+Zi(e,c,3),c+=2,R=E[B-1]):17==P?(M=3+Zi(e,c,7),c+=3):18==P&&(M=11+Zi(e,c,127),c+=7);M--;)E[B++]=R}}var L=E.subarray(0,x),k=E.subarray(x);p=Xi(L),m=Xi(k),u=Wi(L,p),A=Wi(k,m)}else is(1);if(c>g){o&&is(0);break}}n&&l(d+131072);for(var Q=(1<<p)-1,O=(1<<m)-1,F=c;;F=c){var G=(R=u[$i(e,c)&Q])>>4;if((c+=15&R)>g){o&&is(0);break}if(R||is(2),G<256)i[d++]=G;else{if(256==G){F=c,u=null;break}var U=G-254;if(G>264){var _=Qi[B=G-257];U=Zi(e,c,(1<<_)-1)+_i[B],c+=_}var N=A[$i(e,c)&O],j=N>>4;N||is(3),c+=15&N;k=ji[j];if(j>3){_=Oi[j];k+=$i(e,c)&(1<<_)-1,c+=_}if(c>g){o&&is(0);break}n&&l(d+131072);var H=d+U;if(d<k){var V=0-k,W=Math.min(k,H);for(V+d<0&&is(3);d<W;++d)i[d]=s[V+d]}for(;d<H;++d)i[d]=i[d-k]}}t.l=u,t.p=F,t.b=d,t.f=h,u&&(h=1,t.m=p,t.d=A,t.n=m)}while(!h);return d!=i.length&&a?function(e,t,i){return(null==i||i>e.length)&&(i=e.length),new Mi(e.subarray(t,i))}(i,0,d):i.subarray(0,d)},rs=new Mi(0);function as(e,t){return ss(e.subarray(function(e){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&is(6,"invalid zlib data"),1==(e[1]>>5&1)&&is(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)}(e),-4),{i:2},t,t)}var ns="undefined"!=typeof TextDecoder&&new TextDecoder;try{ns.decode(rs,{stream:!0})}catch(B){}function os(e,t,i){let s=i.length-e-1;if(t>=i[s])return s-1;if(t<=i[e])return e;let r=e,a=s,n=Math.floor((r+a)/2);for(;t<i[n]||t>=i[n+1];)t<i[n]?a=n:r=n,n=Math.floor((r+a)/2);return n}function ls(e,t){let i=1;for(let t=2;t<=e;++t)i*=t;let s=1;for(let e=2;e<=t;++e)s*=e;for(let i=2;i<=e-t;++i)s*=i;return i/s}function hs(t,i,s,r,a){let n=function(t,i,s,r,a){let n=a<t?a:t,o=[],l=os(t,r,i),h=function(e,t,i,s,r){let a=[];for(let e=0;e<=i;++e)a[e]=0;let n=[];for(let e=0;e<=s;++e)n[e]=a.slice(0);let o=[];for(let e=0;e<=i;++e)o[e]=a.slice(0);o[0][0]=1;let l=a.slice(0),h=a.slice(0);for(let s=1;s<=i;++s){l[s]=t-r[e+1-s],h[s]=r[e+s]-t;let i=0;for(let e=0;e<s;++e){let t=h[e+1],r=l[s-e];o[s][e]=t+r;let a=o[e][s-1]/o[s][e];o[e][s]=i+t*a,i=r*a}o[s][s]=i}for(let e=0;e<=i;++e)n[0][e]=o[e][i];for(let e=0;e<=i;++e){let t=0,r=1,l=[];for(let e=0;e<=i;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=s;++a){let s=0,h=e-a,c=i-a;e>=a&&(l[r][0]=l[t][0]/o[c+1][h],s=l[r][0]*o[h][c]);let d=e-1<=c?a-1:i-e;for(let e=h>=-1?1:-h;e<=d;++e)l[r][e]=(l[t][e]-l[t][e-1])/o[c+1][h+e],s+=l[r][e]*o[h+e][c];e<=c&&(l[r][a]=-l[t][a-1]/o[c+1][e],s+=l[r][a]*o[e][c]),n[a][e]=s;let u=t;t=r,r=u}}let c=i;for(let e=1;e<=s;++e){for(let t=0;t<=i;++t)n[e][t]*=c;c*=i-e}return n}(l,r,t,n,i),c=[];for(let e=0;e<s.length;++e){let t=s[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let e=0;e<=n;++e){let i=c[l-t].clone().multiplyScalar(h[e][0]);for(let s=1;s<=t;++s)i.add(c[l-t+s].clone().multiplyScalar(h[e][s]));o[e]=i}for(let t=n+1;t<=a+1;++t)o[t]=new e.Vector4(0,0,0);return o}(t,i,s,r,a);return function(t){let i=t.length,s=[],r=[];for(let a=0;a<i;++a){let i=t[a];s[a]=new e.Vector3(i.x,i.y,i.z),r[a]=i.w}let a=[];for(let e=0;e<i;++e){let t=s[e].clone();for(let i=1;i<=e;++i)t.sub(a[e-i].clone().multiplyScalar(ls(e,i)*r[i]));a[e]=t.divideScalar(r[0])}return a}(n)}var cs,ds,us,As=class extends e.Curve{constructor(t,i,s,r,a){super();let n=i?i.length-1:0,o=s?s.length:0;this.degree=t,this.knots=i,this.controlPoints=[],this.startKnot=r||0,this.endKnot=a||n;for(let t=0;t<o;++t){let i=s[t];this.controlPoints[t]=new e.Vector4(i.x,i.y,i.z,i.w)}}getPoint(t,i=new e.Vector3){let s=i,r=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(t,i,s,r){let a=os(t,r,i),n=function(e,t,i,s){let r=[],a=[],n=[];r[0]=1;for(let o=1;o<=i;++o){a[o]=t-s[e+1-o],n[o]=s[e+o]-t;let i=0;for(let e=0;e<o;++e){let t=n[e+1],s=a[o-e],l=r[e]/(t+s);r[e]=i+t*l,i=s*l}r[o]=i}return r}(a,r,t,i),o=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){let i=s[a-t+e],r=n[e],l=i.w*r;o.x+=i.x*l,o.y+=i.y*l,o.z+=i.z*l,o.w+=i.w*r}return o}(this.degree,this.knots,this.controlPoints,r);return 1!==a.w&&a.divideScalar(a.w),s.set(a.x,a.y,a.z)}getTangent(t,i=new e.Vector3){let s=i,r=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),a=hs(this.degree,this.knots,this.controlPoints,r,1);return s.copy(a[1]).normalize(),s}toJSON(){let e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map((e=>e.toArray())),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(t){return super.fromJSON(t),this.degree=t.degree,this.knots=[...t.knots],this.controlPoints=t.controlPoints.map((t=>new e.Vector4(t[0],t[1],t[2],t[3]))),this.startKnot=t.startKnot,this.endKnot=t.endKnot,this}},ps=class extends e.Loader{constructor(e){super(e)}load(t,i,s,r){let a=this,n=""===a.path?e.LoaderUtils.extractUrlBase(t):a.path,o=new e.FileLoader(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(e){try{i(a.parse(e,n))}catch(e){r?r(e):console.error(e),a.manager.itemError(t)}}),s,r)}parse(t,i){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Rs(e,0,t.length)}(t))cs=(new bs).parse(t);else{let e=Rs(t);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function s(t){let s=e[t-1];return e=e.slice(i+t),i++,s}for(let e=0;e<t.length;++e)if(s(1)===t[e])return!1;return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(ys(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ys(e));cs=(new vs).parse(e)}let s=new e.TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new ms(s,this.manager).parse(cs)}},ms=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ds=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=(new gs).parse(s);return this.parseScene(s,r,i),us}parseConnections(){let e=new Map;return"Connections"in cs&&cs.Connections.connections.forEach((function(t){let i=t[0],s=t[1],r=t[2];e.has(i)||e.set(i,{parents:[],children:[]});let a={ID:s,relationship:r};e.get(i).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});let n={ID:i,relationship:r};e.get(s).children.push(n)})),e}parseImages(){let e={},t={};if("Video"in cs.Objects){let i=cs.Objects.Video;for(let s in i){let r=i[s];if(e[parseInt(s)]=r.RelativeFilename||r.Filename,"Content"in r){let e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,a="string"==typeof r.Content&&""!==r.Content;if(e||a){let e=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=e}}}}for(let i in e){let s=e[i];void 0!==t[s]?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){let t,i=e.Content,s=e.RelativeFilename||e.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",s),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;{let e=new Uint8Array(i);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in cs.Objects){let i=cs.Objects.Texture;for(let s in i){let r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(t,i){let s=this.loadTexture(t,i);s.ID=t.id,s.name=t.attrName;let r=t.WrapModeU,a=t.WrapModeV,n=void 0!==r?r.value:0,o=void 0!==a?a.value:0;if(s.wrapS=0===n?e.RepeatWrapping:e.ClampToEdgeWrapping,s.wrapT=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){let e=t.Scaling.value;s.repeat.x=e[0],s.repeat.y=e[1]}if("Translation"in t){let e=t.Translation.value;s.offset.x=e[0],s.offset.y=e[1]}return s}loadTexture(t,i){let s=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),r=t.FileName.split(".").pop().toLowerCase(),a=s.has(r)?this.manager.getHandler(`.${r}`):this.textureLoader;if(!a)return console.warn(`FBXLoader: ${r.toUpperCase()} loader not found, creating placeholder texture for`,t.RelativeFilename),new e.Texture;let n=a.path;n||a.setPath(this.textureLoader.path);let o,l=ds.get(t.id).children;void 0!==l&&l.length>0&&void 0!==i[l[0].ID]&&(o=i[l[0].ID],(0===o.indexOf("blob:")||0===o.indexOf("data:"))&&a.setPath(void 0));let h=a.load(o);return a.setPath(n),h}parseMaterials(e){let t=new Map;if("Material"in cs.Objects){let i=cs.Objects.Material;for(let s in i){let r=this.parseMaterial(i[s],e);null!==r&&t.set(parseInt(s),r)}}return t}parseMaterial(t,i){let s=t.id,r=t.attrName,a=t.ShadingModel;if("object"==typeof a&&(a=a.value),!ds.has(s))return null;let n,o=this.parseParameters(t,i,s);switch(a.toLowerCase()){case"phong":n=new e.MeshPhongMaterial;break;case"lambert":n=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),n=new e.MeshPhongMaterial}return n.setValues(o),n.name=r,n}parseParameters(t,i,s){let r={};t.BumpFactor&&(r.bumpScale=t.BumpFactor.value),t.Diffuse?r.color=(new e.Color).fromArray(t.Diffuse.value):t.DiffuseColor&&("Color"===t.DiffuseColor.type||"ColorRGB"===t.DiffuseColor.type)&&(r.color=(new e.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(r.displacementScale=t.DisplacementFactor.value),t.Emissive?r.emissive=(new e.Color).fromArray(t.Emissive.value):t.EmissiveColor&&("Color"===t.EmissiveColor.type||"ColorRGB"===t.EmissiveColor.type)&&(r.emissive=(new e.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(r.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),r.opacity=1-(t.TransparencyFactor?parseFloat(t.TransparencyFactor.value):0),(1===r.opacity||0===r.opacity)&&(r.opacity=t.Opacity?parseFloat(t.Opacity.value):null,null===r.opacity&&(r.opacity=1-(t.TransparentColor?parseFloat(t.TransparentColor.value[0]):0))),r.opacity<1&&(r.transparent=!0),t.ReflectionFactor&&(r.reflectivity=t.ReflectionFactor.value),t.Shininess&&(r.shininess=t.Shininess.value),t.Specular?r.specular=(new e.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(r.specular=(new e.Color).fromArray(t.SpecularColor.value));let a=this;return ds.get(s).children.forEach((function(t){let s=t.relationship;switch(s){case"Bump":r.bumpMap=a.getTexture(i,t.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(i,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(i,t.ID);break;case"DisplacementColor":r.displacementMap=a.getTexture(i,t.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(i,t.ID);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(i,t.ID);break;case"ReflectionColor":r.envMap=a.getTexture(i,t.ID),void 0!==r.envMap&&(r.envMap.mapping=e.EquirectangularReflectionMapping);break;case"SpecularColor":r.specularMap=a.getTexture(i,t.ID),r.specularMap;break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(i,t.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",s)}})),r}getTexture(e,t){return"LayeredTexture"in cs.Objects&&t in cs.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ds.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in cs.Objects){let i=cs.Objects.Deformer;for(let s in i){let r=i[s],a=ds.get(parseInt(s));if("Skin"===r.attrType){let t=this.parseSkeleton(a,i);t.ID=s,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[s]=t}else if("BlendShape"===r.attrType){let e={id:s};e.rawTargets=this.parseMorphTargets(a,i),e.id=s,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(t,i){let s=[];return t.children.forEach((function(t){let r=i[t.ID];if("Cluster"!==r.attrType)return;let a={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),s.push(a)})),{rawBones:s,bones:[]}}parseMorphTargets(e,t){let i=[];for(let s=0;s<e.children.length;s++){let r=e.children[s],a=t[r.ID],n={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;n.geoID=ds.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,i.push(n)}return i}parseScene(t,i,s){us=new e.Group;let r=this.parseModels(t.skeletons,i,s),a=cs.Objects.Model,n=this;r.forEach((function(e){let t=a[e.ID];n.setLookAtProperties(e,t),ds.get(e.ID).parents.forEach((function(t){let i=r.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&us.add(e)})),this.bindSkeleton(t.skeletons,i,r),this.addGlobalSceneSettings(),us.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=Ds(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));let o=(new fs).parse();1===us.children.length&&us.children[0].isGroup&&(us.children[0].animations=o,us=us.children[0]),us.animations=o}parseModels(t,i,s){let r=new Map,a=cs.Objects.Model;var n=["Culling","DefaultAttributeIndex","InheritType","Lcl_Translation","Lcl_Rotation","Lcl_Scaling","RotationPivot","ScalingPivot","RotationActive","ScalingMax","RotationOffset","fbx_node_path","Shading","Version","attrName","attrType","currentUVSet","id","name","propertyList","singleProperty"];for(let o in a){let l=parseInt(o),h=a[o],c=ds.get(l),d=this.buildSkeleton(c,t,l,h.attrName);if(!d){switch(h.attrType){case"Camera":d=this.createCamera(c);break;case"Light":d=this.createLight(c);break;case"Mesh":d=this.createMesh(c,i,s);break;case"NurbsCurve":d=this.createCurve(c,i);break;case"LimbNode":case"Root":d=new e.Bone;break;default:d=new e.Group}d.name=h.attrName?e.PropertyBinding.sanitizeNodeName(h.attrName):"",d.userData.originalName=h.attrName,d.ID=l}Object.keys(h).forEach((e=>{n.includes(e)||(d.userData[e]=h[e].value)})),this.getTransformData(d,h),r.set(l,d)}return r}buildSkeleton(t,i,s,r){let a=null;return t.parents.forEach((function(t){for(let n in i){let o=i[n];o.rawBones.forEach((function(i,n){if(i.ID===t.ID){let t=a;a=new e.Bone,a.matrixWorld.copy(i.transformLink),a.name=r?e.PropertyBinding.sanitizeNodeName(r):"",a.userData.originalName=r,a.ID=s,o.bones[n]=a,null!==t&&a.add(t)}}))}})),a}createCamera(t){let i,s;if(t.children.forEach((function(e){let t=cs.Objects.NodeAttribute[e.ID];void 0!==t&&(s=t)})),void 0===s)i=new e.Object3D;else{let t=0;void 0!==s.CameraProjectionType&&1===s.CameraProjectionType.value&&(t=1);let r=1;void 0!==s.NearPlane&&(r=s.NearPlane.value/1e3);let a=1e3;void 0!==s.FarPlane&&(a=s.FarPlane.value/1e3);let n=window.innerWidth,o=window.innerHeight;void 0!==s.AspectWidth&&void 0!==s.AspectHeight&&(n=s.AspectWidth.value,o=s.AspectHeight.value);let l=n/o,h=45;void 0!==s.FieldOfView&&(h=s.FieldOfView.value);let c=s.FocalLength?s.FocalLength.value:null;switch(t){case 0:i=new e.PerspectiveCamera(h,l,r,a),null!==c&&i.setFocalLength(c);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),i=new e.Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),i=new e.Object3D}}return i}createLight(t){let i,s;if(t.children.forEach((function(e){let t=cs.Objects.NodeAttribute[e.ID];void 0!==t&&(s=t)})),void 0===s)i=new e.Object3D;else{let t;t=void 0===s.LightType?0:s.LightType.value;let r=16777215;void 0!==s.Color&&(r=(new e.Color).fromArray(s.Color.value));let a=void 0===s.Intensity?1:s.Intensity.value/100;void 0!==s.CastLightOnObject&&0===s.CastLightOnObject.value&&(a=0);let n=0;void 0!==s.FarAttenuationEnd&&(n=void 0!==s.EnableFarAttenuation&&0===s.EnableFarAttenuation.value?0:s.FarAttenuationEnd.value);let o=1;switch(t){case 0:i=new e.PointLight(r,a,n,o);break;case 1:i=new e.DirectionalLight(r,a);break;case 2:let t=Math.PI/3;void 0!==s.InnerAngle&&(t=e.MathUtils.degToRad(s.InnerAngle.value));let l=0;void 0!==s.OuterAngle&&(l=e.MathUtils.degToRad(s.OuterAngle.value),l=Math.max(l,1)),i=new e.SpotLight(r,a,n,t,l,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new e.PointLight(r,a)}void 0!==s.CastShadows&&1===s.CastShadows.value&&(i.castShadow=!0)}return i}createMesh(t,i,s){let r,a=null,n=null,o=[];return t.children.forEach((function(e){i.has(e.ID)&&(a=i.get(e.ID)),s.has(e.ID)&&o.push(s.get(e.ID))})),o.length>1?n=o:o.length>0?n=o[0]:(n=new e.MeshPhongMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(n)),"color"in a.attributes&&o.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(r=new e.SkinnedMesh(a,n),r.normalizeSkinWeights()):r=new e.Mesh(a,n),r}createCurve(t,i){let s=t.children.reduce((function(e,t){return i.has(t.ID)&&(e=i.get(t.ID)),e}),null),r=new e.LineBasicMaterial({name:e.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new e.Line(s,r)}getTransformData(e,t){let i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder=Ps("RotationOrder"in t?t.RotationOrder.value:0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(t,i){"LookAtProperty"in i&&ds.get(t.ID).children.forEach((function(i){if("LookAtProperty"===i.relationship){let s=cs.Objects.Model[i.ID];if("Lcl_Translation"in s){let i=s.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(i),us.add(t.target)):t.lookAt((new e.Vector3).fromArray(i))}}}))}bindSkeleton(t,i,s){let r=this.parsePoseNodes();for(let a in t){let n=t[a];ds.get(parseInt(n.ID)).parents.forEach((function(t){if(i.has(t.ID)){let i=t.ID;ds.get(i).parents.forEach((function(t){s.has(t.ID)&&s.get(t.ID).bind(new e.Skeleton(n.bones),r[t.ID])}))}}))}}parsePoseNodes(){let t={};if("Pose"in cs.Objects){let i=cs.Objects.Pose;for(let s in i)if("BindPose"===i[s].attrType&&i[s].NbPoseNodes>0){let r=i[s].PoseNode;Array.isArray(r)?r.forEach((function(i){t[i.Node]=(new e.Matrix4).fromArray(i.Matrix.a)})):t[r.Node]=(new e.Matrix4).fromArray(r.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in cs){if("AmbientColor"in cs.GlobalSettings){let t=cs.GlobalSettings.AmbientColor.value,i=t[0],s=t[1],r=t[2];if(0!==i||0!==s||0!==r){let t=(new e.Color).setRGB(i,s,r);us.add(new e.AmbientLight(t,1))}}"UnitScaleFactor"in cs.GlobalSettings&&(us.userData.unitScaleFactor=cs.GlobalSettings.UnitScaleFactor.value)}}},gs=class{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in cs.Objects){let i=cs.Objects.Geometry;for(let s in i){let r=ds.get(parseInt(s)),a=this.parseGeometry(r,i[s],e);t.set(parseInt(s),a)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){let s=i.skeletons,r=[],a=e.parents.map((function(e){return cs.Objects.Model[e.ID]}));if(0===a.length)return;let n=e.children.reduce((function(e,t){return void 0!==s[t.ID]&&(e=s[t.ID]),e}),null);e.children.forEach((function(e){void 0!==i.morphTargets[e.ID]&&r.push(i.morphTargets[e.ID])}));let o=a[0],l={};"RotationOrder"in o&&(l.eulerOrder=Ps(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);let h=Ds(l);return this.genGeometry(t,n,r,h)}genGeometry(t,i,s,r){let a=new e.BufferGeometry;t.attrName&&(a.name=t.attrName);let n=this.parseGeoNode(t,i),o=this.genBuffers(n),l=new e.Float32BufferAttribute(o.vertex,3);if(l.applyMatrix4(r),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new e.Float32BufferAttribute(o.colors,3)),i&&(a.setAttribute("skinIndex",new e.Uint16BufferAttribute(o.weightsIndices,4)),a.setAttribute("skinWeight",new e.Float32BufferAttribute(o.vertexWeights,4)),a.FBX_Deformer=i),o.normal.length>0){let t=(new e.Matrix3).getNormalMatrix(r),i=new e.Float32BufferAttribute(o.normal,3);i.applyNormalMatrix(t),a.setAttribute("normal",i)}if(o.uvs.forEach((function(t,i){let s=0===i?"uv":`uv${i}`;a.setAttribute(s,new e.Float32BufferAttribute(o.uvs[i],2))})),n.material&&"AllSame"!==n.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach((function(i,s){i!==e&&(a.addGroup(t,s-t,e),e=i,t=s)})),a.groups.length>0){let t=a.groups[a.groups.length-1],i=t.start+t.count;i!==o.materialIndex.length&&a.addGroup(i,o.materialIndex.length-i,e)}0===a.groups.length&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,t,s,r),a}parseGeoNode(e,t){let i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(s,r){void 0===i.weightTable[s]&&(i.weightTable[s]=[]),i.weightTable[s].push({id:t,weight:e.weights[r]})}))}))),i}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,s=0,r=!1,a=[],n=[],o=[],l=[],h=[],c=[],d=this;return e.vertexIndices.forEach((function(u,A){let p,m=!1;u<0&&(u=~u,m=!0);let g=[],f=[];if(a.push(3*u,3*u+1,3*u+2),e.color){let t=Bs(A,i,u,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[u]&&e.weightTable[u].forEach((function(e){f.push(e.weight),g.push(e.id)})),f.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let e=[0,0,0,0],t=[0,0,0,0];f.forEach((function(i,s){let r=i,a=g[s];t.forEach((function(t,i,s){if(r>t){s[i]=r,r=t;let n=e[i];e[i]=a,a=n}}))})),g=e,f=t}for(;f.length<4;)f.push(0),g.push(0);for(let e=0;e<4;++e)h.push(f[e]),c.push(g[e])}if(e.normal){let t=Bs(A,i,u,e.normal);n.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=Bs(A,i,u,e.material)[0],p<0&&(d.negativeMaterialIndices=!0,p=0)),e.uv&&e.uv.forEach((function(e,t){let s=Bs(A,i,u,e);void 0===l[t]&&(l[t]=[]),l[t].push(s[0]),l[t].push(s[1])})),s++,m&&(d.genFace(t,e,a,p,n,o,l,h,c,s),i++,s=0,a=[],n=[],o=[],l=[],h=[],c=[])})),t}getNormalNewell(t){let i=new e.Vector3(0,0,0);for(let e=0;e<t.length;e++){let s=t[e],r=t[(e+1)%t.length];i.x+=(s.y-r.y)*(s.z+r.z),i.y+=(s.z-r.z)*(s.x+r.x),i.z+=(s.x-r.x)*(s.y+r.y)}return i.normalize(),i}getNormalTangentAndBitangent(t){let i=this.getNormalNewell(t),s=(Math.abs(i.z)>.5?new e.Vector3(0,1,0):new e.Vector3(0,0,1)).cross(i).normalize(),r=i.clone().cross(s).normalize();return{normal:i,tangent:s,bitangent:r}}flattenVertex(t,i,s){return new e.Vector2(t.dot(i),t.dot(s))}genFace(t,i,s,r,a,n,o,l,h,c){let d;if(c>3){let t=[],r=i.baseVertexPositions||i.vertexPositions;for(let i=0;i<s.length;i+=3)t.push(new e.Vector3(r[s[i]],r[s[i+1]],r[s[i+2]]));let{tangent:a,bitangent:n}=this.getNormalTangentAndBitangent(t),o=[];for(let e of t)o.push(this.flattenVertex(e,a,n));d=e.ShapeUtils.triangulateShape(o,[])}else d=[[0,1,2]];for(let[e,c,u]of d)t.vertex.push(i.vertexPositions[s[3*e]]),t.vertex.push(i.vertexPositions[s[3*e+1]]),t.vertex.push(i.vertexPositions[s[3*e+2]]),t.vertex.push(i.vertexPositions[s[3*c]]),t.vertex.push(i.vertexPositions[s[3*c+1]]),t.vertex.push(i.vertexPositions[s[3*c+2]]),t.vertex.push(i.vertexPositions[s[3*u]]),t.vertex.push(i.vertexPositions[s[3*u+1]]),t.vertex.push(i.vertexPositions[s[3*u+2]]),i.skeleton&&(t.vertexWeights.push(l[4*e]),t.vertexWeights.push(l[4*e+1]),t.vertexWeights.push(l[4*e+2]),t.vertexWeights.push(l[4*e+3]),t.vertexWeights.push(l[4*c]),t.vertexWeights.push(l[4*c+1]),t.vertexWeights.push(l[4*c+2]),t.vertexWeights.push(l[4*c+3]),t.vertexWeights.push(l[4*u]),t.vertexWeights.push(l[4*u+1]),t.vertexWeights.push(l[4*u+2]),t.vertexWeights.push(l[4*u+3]),t.weightsIndices.push(h[4*e]),t.weightsIndices.push(h[4*e+1]),t.weightsIndices.push(h[4*e+2]),t.weightsIndices.push(h[4*e+3]),t.weightsIndices.push(h[4*c]),t.weightsIndices.push(h[4*c+1]),t.weightsIndices.push(h[4*c+2]),t.weightsIndices.push(h[4*c+3]),t.weightsIndices.push(h[4*u]),t.weightsIndices.push(h[4*u+1]),t.weightsIndices.push(h[4*u+2]),t.weightsIndices.push(h[4*u+3])),i.color&&(t.colors.push(n[3*e]),t.colors.push(n[3*e+1]),t.colors.push(n[3*e+2]),t.colors.push(n[3*c]),t.colors.push(n[3*c+1]),t.colors.push(n[3*c+2]),t.colors.push(n[3*u]),t.colors.push(n[3*u+1]),t.colors.push(n[3*u+2])),i.material&&"AllSame"!==i.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),i.normal&&(t.normal.push(a[3*e]),t.normal.push(a[3*e+1]),t.normal.push(a[3*e+2]),t.normal.push(a[3*c]),t.normal.push(a[3*c+1]),t.normal.push(a[3*c+2]),t.normal.push(a[3*u]),t.normal.push(a[3*u+1]),t.normal.push(a[3*u+2])),i.uv&&i.uv.forEach((function(i,s){void 0===t.uvs[s]&&(t.uvs[s]=[]),t.uvs[s].push(o[s][2*e]),t.uvs[s].push(o[s][2*e+1]),t.uvs[s].push(o[s][2*c]),t.uvs[s].push(o[s][2*c+1]),t.uvs[s].push(o[s][2*u]),t.uvs[s].push(o[s][2*u+1])}))}addMorphTargets(e,t,i,s){if(0===i.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;i.forEach((function(i){i.rawTargets.forEach((function(i){let a=cs.Objects.Geometry[i.geoID];void 0!==a&&r.genMorphGeometry(e,t,a,s,i.name)}))}))}genMorphGeometry(t,i,s,r,a){let n=void 0!==i.Vertices?i.Vertices.a:[],o=void 0!==i.PolygonVertexIndex?i.PolygonVertexIndex.a:[],l=void 0!==s.Vertices?s.Vertices.a:[],h=void 0!==s.Indexes?s.Indexes.a:[],c=3*t.attributes.position.count,d=new Float32Array(c);for(let e=0;e<h.length;e++){let t=3*h[e];d[t]=l[3*e],d[t+1]=l[3*e+1],d[t+2]=l[3*e+2]}let u={vertexIndices:o,vertexPositions:d,baseVertexPositions:n},A=this.genBuffers(u),p=new e.Float32BufferAttribute(A.vertex,3);p.name=a||s.attrName,p.applyMatrix4(r),t.morphAttributes.position.push(p)}parseNormals(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a,r=[];return"IndexToDirect"===i&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a,r=[];return"IndexToDirect"===i&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(t){let i=t.MappingInformationType,s=t.ReferenceInformationType,r=t.Colors.a,a=[];"IndexToDirect"===s&&(a=t.ColorIndex.a);for(let t=0,i=new e.Color;t<r.length;t+=4)i.fromArray(r,t),e.ColorManagement.toWorkingColorSpace(i,e.SRGBColorSpace),i.toArray(r,t);return{dataSize:4,buffer:r,indices:a,mappingType:i,referenceType:s}}parseMaterialIndices(e){let t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};let s=e.Materials.a,r=[];for(let e=0;e<s.length;++e)r.push(e);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(t){let i=parseInt(t.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;let s,r,a=i-1,n=t.KnotVector.a,o=[],l=t.Points.a;for(let t=0,i=l.length;t<i;t+=4)o.push((new e.Vector4).fromArray(l,t));if("Closed"===t.Form)o.push(o[0]);else if("Periodic"===t.Form){s=a,r=n.length-1-s;for(let e=0;e<a;++e)o.push(o[e])}let h=new As(a,n,o,s,r).getPoints(12*o.length);return(new e.BufferGeometry).setFromPoints(h)}},fs=class{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let i in t){let s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(void 0===cs.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=cs.Objects.AnimationCurveNode,t=new Map;for(let i in e){let s=e[i];if(null!==s.attrName.match(/S|R|T|DeformPercent/)){let e={id:s.id,attr:s.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=cs.Objects.AnimationCurve;for(let i in t){let s={id:t[i].id,times:t[i].KeyTime.a.map(Es),values:t[i].KeyValueFloat.a},r=ds.get(s.id);if(void 0!==r){let t=r.parents[0].ID,i=r.parents[0].relationship;i.match(/X/)?e.get(t).curves.x=s:i.match(/Y/)?e.get(t).curves.y=s:i.match(/Z/)?e.get(t).curves.z=s:i.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=s)}}}parseAnimationLayers(t){let i=cs.Objects.AnimationLayer,s=new Map;for(let r in i){let i=[],a=ds.get(parseInt(r));void 0!==a&&(a.children.forEach((function(s,r){if(t.has(s.ID)){let a=t.get(s.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===i[r]){let t=ds.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==t){let a=cs.Objects.Model[t.toString()];if(void 0===a)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);let n={modelName:a.attrName?e.PropertyBinding.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};us.traverse((function(e){e.ID===a.id&&(n.transform=e.matrix,e.userData.transformData&&(n.eulerOrder=e.userData.transformData.eulerOrder))})),n.transform||(n.transform=new e.Matrix4),"PreRotation"in a&&(n.preRotation=a.PreRotation.value),"PostRotation"in a&&(n.postRotation=a.PostRotation.value),i[r]=n}}i[r]&&(i[r][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===i[r]){let t=ds.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,a=ds.get(t).parents[0].ID,n=ds.get(a).parents[0].ID,o=ds.get(n).parents[0].ID,l=cs.Objects.Model[o],h={modelName:l.attrName?e.PropertyBinding.sanitizeNodeName(l.attrName):"",morphName:cs.Objects.Deformer[t].attrName};i[r]=h}i[r][a.attr]=a}}})),s.set(parseInt(r),i))}return s}parseAnimStacks(e){let t=cs.Objects.AnimationStack,i={};for(let s in t){let r=ds.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:a}}return i}addClip(t){let i=[],s=this;return t.layer.forEach((function(e){i=i.concat(s.generateTracks(e))})),new e.AnimationClip(t.name,-1,i)}generateTracks(t){let i=[],s=new e.Vector3,r=new e.Vector3;if(t.transform&&t.transform.decompose(s,new e.Quaternion,r),s=s.toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){let e=this.generateVectorTrack(t.modelName,t.T.curves,s,"position");void 0!==e&&i.push(e)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){let e=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);void 0!==e&&i.push(e)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){let e=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==e&&i.push(e)}if(void 0!==t.DeformPercent){let e=this.generateMorphTrack(t);void 0!==e&&i.push(e)}return i}generateVectorTrack(t,i,s,r){let a=this.getTimesForAllAxes(i),n=this.getKeyframeTrackValues(a,i,s);return new e.VectorKeyframeTrack(t+"."+r,a,n)}generateRotationTrack(t,i,s,r,a){let n,o;if(void 0!==i.x&&void 0!==i.y&&void 0!==i.z){let e=this.interpolateRotations(i.x,i.y,i.z,a);n=e[0],o=e[1]}let l=Ps(0);void 0!==s&&((s=s.map(e.MathUtils.degToRad)).push(l),s=(new e.Euler).fromArray(s),s=(new e.Quaternion).setFromEuler(s)),void 0!==r&&((r=r.map(e.MathUtils.degToRad)).push(l),r=(new e.Euler).fromArray(r),r=(new e.Quaternion).setFromEuler(r).invert());let h=new e.Quaternion,c=new e.Euler,d=[];if(!o||!n)return new e.QuaternionKeyframeTrack(t+".quaternion",[0],[0]);for(let t=0;t<o.length;t+=3)c.set(o[t],o[t+1],o[t+2],a),h.setFromEuler(c),void 0!==s&&h.premultiply(s),void 0!==r&&h.multiply(r),t>2&&(new e.Quaternion).fromArray(d,(t-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(d,t/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",n,d)}generateMorphTrack(t){let i=t.DeformPercent.curves.morph,s=i.values.map((function(e){return e/100})),r=us.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+r+"]",i.times,s)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,i=t[0];for(let s=1;s<t.length;s++){let r=t[s];r!==i&&(t[e]=r,i=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,i){let s=i,r=[],a=-1,n=-1,o=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(n=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];r.push(e),s[0]=e}else r.push(s[0]);if(-1!==n){let e=t.y.values[n];r.push(e),s[1]=e}else r.push(s[1]);if(-1!==o){let e=t.z.values[o];r.push(e),s[2]=e}else r.push(s[2])})),r}interpolateRotations(t,i,s,r){let a=[],n=[];a.push(t.times[0]),n.push(e.MathUtils.degToRad(t.values[0])),n.push(e.MathUtils.degToRad(i.values[0])),n.push(e.MathUtils.degToRad(s.values[0]));for(let o=1;o<t.values.length;o++){let l=[t.values[o-1],i.values[o-1],s.values[o-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;let h=l.map(e.MathUtils.degToRad),c=[t.values[o],i.values[o],s.values[o]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;let d=c.map(e.MathUtils.degToRad),u=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],A=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(A[0]>=180||A[1]>=180||A[2]>=180){let i=Math.max(...A)/180,s=new e.Euler(...h,r),l=new e.Euler(...d,r),c=(new e.Quaternion).setFromEuler(s),u=(new e.Quaternion).setFromEuler(l);c.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);let p=t.times[o-1],m=t.times[o]-p,g=new e.Quaternion,f=new e.Euler;for(let e=0;e<1;e+=1/i)g.copy(c.clone().slerp(u.clone(),e)),a.push(p+e*m),f.setFromQuaternion(g,r),n.push(f.x),n.push(f.y),n.push(f.z)}else a.push(t.times[o]),n.push(e.MathUtils.degToRad(t.values[o])),n.push(e.MathUtils.degToRad(i.values[o])),n.push(e.MathUtils.degToRad(s.values[o]))}return[a,n]}},vs=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Cs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,s){let r=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(r||a)return;let n=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(e,n):o?t.parseNodeProperty(e,o,i[++s]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){let i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:i},a=this.parseNodeAttr(s),n=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,r):i in n?("PoseNode"===i?n.PoseNode.push(r):void 0!==n[i].id&&(n[i]={},n[i][n[i].id]=n[i]),""!==a.id&&(n[i][a.id]=r)):"number"==typeof a.id?(n[i]={},n[i][a.id]=r):"Properties70"!==i&&(n[i]="PoseNode"===i?[r]:r),"number"==typeof a.id&&(r.id=a.id),""!==a.name&&(r.attrName=a.name),""!==a.type&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===s&&","===r&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===s){let e=r.split(",").slice(1),t=parseInt(e[0]),i=parseInt(e[1]),n=r.split(",").slice(3);n=n.map((function(e){return e.trim().replace(/^"/,"")})),s="connections",r=[t,i],function(e,t){for(let i=0,s=e.length,r=t.length;i<r;i++,s++)e[s]=t[i]}(r,n),void 0===a[s]&&(a[s]=[])}"Node"===s&&(a.id=r),s in a&&Array.isArray(a[s])?a[s].push(r):"a"!==s?a[s]=r:a.a=r,this.setCurrentProp(a,s),"a"===s&&","!==r.slice(-1)&&(a.a=Ts(r))}else this.parseNodeSpecialProperty(e,s,r)}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Ts(t.a))}parseNodeSpecialProperty(e,t,i){let s=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=s[0],a=s[1],n=s[2],o=s[3],l=s[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Ts(l)}this.getPrevNode()[r]={type:a,type2:n,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),r)}},bs=class{parse(e){let t=new xs(e);t.skip(23);let i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);let s=new Cs;for(;!this.endOfContent(t);){let e=this.parseNode(t,i);null!==e&&s.add(e.name,e)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),n=e.getString(a);if(0===s)return null;let o=[];for(let t=0;t<r;t++)o.push(this.parseProperty(e));let l=o.length>0?o[0]:"",h=o.length>1?o[1]:"",c=o.length>2?o[2]:"";for(i.singleProperty=1===r&&e.getOffset()===s;s>e.getOffset();){let s=this.parseNode(e,t);null!==s&&this.parseSubNode(n,i,s)}return i.propertyList=o,"number"==typeof l&&(i.id=l),""!==h&&(i.attrName=h),""!==c&&(i.attrType=c),""!==n&&(i.name=n),i}parseSubNode(e,t,i){if(!0===i.singleProperty){let e=i.propertyList[0];Array.isArray(e)?(t[i.name]=i,i.a=e):t[i.name]=e}else if("Connections"===e&&"C"===i.name){let e=[];i.propertyList.forEach((function(t,i){0!==i&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===i.name)Object.keys(i).forEach((function(e){t[e]=i[e]}));else if("Properties70"===e&&"P"===i.name){let e,s=i.propertyList[0],r=i.propertyList[1],a=i.propertyList[2],n=i.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),e="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[s]={type:r,type2:a,flag:n,value:e}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)}parseProperty(e){let t,i=e.getString(1);switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let s=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(0===r)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}let n=as(new Uint8Array(e.getArrayBuffer(a))),o=new xs(n.buffer);switch(i){case"b":case"c":return o.getBooleanArray(s);case"d":return o.getFloat64Array(s);case"f":return o.getFloat32Array(s);case"i":return o.getInt32Array(s);case"l":return o.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}},xs=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){let t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}},Cs=class{add(e,t){this[e]=t}};function ys(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Es(e){return e/46186158e3}var Is=[];function Bs(e,t,i,s){let r;switch(s.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=i;break;case"AllSame":r=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}"IndexToDirect"===s.referenceType&&(r=s.indices[r]);let a=r*s.dataSize,n=a+s.dataSize;return function(e,t,i,s){for(let r=i,a=0;r<s;r++,a++)e[a]=t[r];return e}(Is,s.buffer,a,n)}var ws=new e.Euler,Ss=new e.Vector3;function Ds(t){let i=new e.Matrix4,s=new e.Matrix4,r=new e.Matrix4,a=new e.Matrix4,n=new e.Matrix4,o=new e.Matrix4,l=new e.Matrix4,h=new e.Matrix4,c=new e.Matrix4,d=new e.Matrix4,u=new e.Matrix4,A=new e.Matrix4,p=t.inheritType?t.inheritType:0;t.translation&&i.setPosition(Ss.fromArray(t.translation));let m=Ps(0);if(t.preRotation){let i=t.preRotation.map(e.MathUtils.degToRad);i.push(m),s.makeRotationFromEuler(ws.fromArray(i))}if(t.rotation){let i=t.rotation.map(e.MathUtils.degToRad);i.push(t.eulerOrder||m),r.makeRotationFromEuler(ws.fromArray(i))}if(t.postRotation){let i=t.postRotation.map(e.MathUtils.degToRad);i.push(m),a.makeRotationFromEuler(ws.fromArray(i)),a.invert()}t.scale&&n.scale(Ss.fromArray(t.scale)),t.scalingOffset&&l.setPosition(Ss.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Ss.fromArray(t.scalingPivot)),t.rotationOffset&&h.setPosition(Ss.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(Ss.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(u.copy(t.parentMatrix),d.copy(t.parentMatrixWorld));let g=s.clone().multiply(r).multiply(a),f=new e.Matrix4;f.extractRotation(d);let v=new e.Matrix4;v.copyPosition(d);let b=v.clone().invert().multiply(d),x=f.clone().invert().multiply(b),C=n,y=new e.Matrix4;if(0===p)y.copy(f).multiply(g).multiply(x).multiply(C);else if(1===p)y.copy(f).multiply(x).multiply(g).multiply(C);else{let t=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(u)).clone().invert(),i=x.clone().multiply(t);y.copy(f).multiply(g).multiply(i).multiply(C)}let E=c.clone().invert(),I=o.clone().invert(),B=i.clone().multiply(h).multiply(c).multiply(s).multiply(r).multiply(a).multiply(E).multiply(l).multiply(o).multiply(n).multiply(I),w=(new e.Matrix4).copyPosition(B),S=d.clone().multiply(w);return A.copyPosition(S),B=A.clone().multiply(y),B.premultiply(d.invert()),B}function Ps(e){let t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Ts(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Rs(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,i))}var Ms={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},Ls={OFF:0,LOW:1,MEDIUM:2,HIGH:3},ks={SKY:0,SCENE:1,PARTICLES:5,GLOW:6,GLOW_MASK:7},Qs={OFF:0,VAPOR:1},Os={FLOOR:0,WALL:1,WALL_TOP:2,CEILING:3,PORTAL_WARP:4,ROOM_WARP:5,ITEM:6,SCRIPTED:7,HOVERABLE:8,CLICKABLE:9},Fs={FRONT:0,BACK:1,DOUBLE:2},Gs={MOVE:0,MOVE_X:1,MOVE_Y:2,LOOK:3,LOOK_X:4,LOOK_Y:5,JUMP:6,RUN:7,ACTION:8,ACTION_ALT:9,ITEM:10,MENU:11,PAUSE:12,MAP:13},Us={REGION:0,DRAG_REGION:1,BUTTON:2,THUMBSTICK:3,SLIDER:4,IMAGE:5,TEXT:6},_s={NONE:0,CLICK:1,HOVER:2,ACTIVE:3,DRAG:4,DROP:5},Ns={DEFAULT:0,BLENDED:1},js={VERBOSE_LEVEL:Ms,FILE_TYPE:{AUTO:-1,JPG:0,JPEG:0,PNG:1,WEBP:2,FBX:3,GLTF:4,GLB:5},ANTI_ALIASING:Ls,RENDER_LAYER:ks,SKY_HAZE:Qs,SHADOW_MAP:{OFF:0,BASIC:1,SOFT:2},CAMERA_EVENT:{MOVE:0,ROTATE:1,JUMP:2,FALL:3,LANDED:4,COLLISION:5},COLLIDER_TYPE:Os,GEOMETRY_SIDE:Fs,COLOR_SHIFT:{KEEP:0,sRGB_TO_LINEAR:1,LINEAR_TO_sRGB:2,WINDOWS_TO_UNIX:3,UNIX_TO_WINDOWS:4,LINEAR_TO_WINDOWS:5,WINDOWS_TO_LINEAR:6,LINEAR_TO_UNIX:7,UNIX_TO_LINEAR:8},USER_SPEED:{STOP:0,SLOW:1,BASE:2,BOOST:3},DEVICE_TYPE:{KEYBOARD:0,MOBILE:1,GAMEPAD:2,XR:3,VR:3,AR:3,OTHER:4},DEVICE_EVENT:{CONNECT:0,DISCONNECT:1,BUTTON_PRESS:2,AXIS_MOVE:3,AXIS_LOOK:4},DEVICE_BUTTON:{B_L:0,B_U:1,B_R:2,B_D:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,START:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},DEVICE_ACTION:Gs,HUD_ELEMENT:Us,HUD_ACTION:_s,HUD_DRAW:Ns};function Hs(e){return new ps(e)}var Vs=class{constructor(e={}){this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlEnums=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.pxlColliders=null,this.verbose=!1,this.pxlOptions={},this.runDebugger=!1,this.assetRoot=this.findInDict(e,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(e,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(e,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(e,"vidRoot","images/screenContent/"),this.workerList=[],this.oneTwoPFour=1/2.4,this.twelvePNineTwoDiv=1/12.92,this.onePOFiveFiveDiv=1/1.055}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlQuality=e.pxlQuality,this.pxlEnums=e.pxlEnums,this.pxlVideo=e.pxlVideo,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlUser=e.pxlUser,this.pxlEnv=e.pxlEnv,this.pxlAnim=e.pxlAnim,this.pxlDevice=e.pxlDevice,this.pxlShaders=e.pxlShaders,this.pxlColliders=e.pxlColliders,this.pxlOptions=e.pxlOptions,this.verbose=this.pxlOptions.verbose}setLogging(e=!1){this.runDebugger=e}log(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG)&&(console.log("---"),e.forEach((e=>{console.log(e)})))}warn(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN)&&e.forEach((e=>{console.warn(e)}))}debug(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG)&&e.forEach((e=>{console.log(e)}))}toggleDebugger(e=null){e||(e=!this.runDebugger),this.runDebugger=e}findInDict(e,t,i){return e.hasOwnProperty(t)?e[t]:(e[t]=i,i)}convertVertColor(e,t=this.pxlEnums.COLOR_SHIFT.KEEP){if(e.geometry&&e.geometry.attributes&&e.geometry.attributes.color){let i=e.geometry.attributes.color;for(let e=0;e<i.count;++e){let s=(new G.Color).fromBufferAttribute(i,e);this.pxlUtils.convertColor(s,t),i.setXYZ(e,s.r,s.g,s.b)}i.needsUpdate=!0}}checkForUserData(e,t,i){if(i.hasOwnProperty("userData")){if(i.hasOwnProperty("material")&&(i.userData.hasOwnProperty("doubleSided")&&i.userData.doubleSided?i.material.side=G.DoubleSide:i.material.side=G.FrontSide),i.userData.hasOwnProperty("pSystem")&&i.userData.pSystem){let s=this.pSystemBuild(i,e);s&&(e.pSystemList||(e.pSystemList={}),e.pSystemList[i.name]=s,t.add(s),i.parent.remove(i),i=s)}i.userData.hasOwnProperty("GlowPass")&&i.userData.GlowPass&&(e.geoList.GlowPass||(e.geoList.GlowPass=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW),e.geoList.GlowPass.push(i)),i.userData.hasOwnProperty("GlowPassMask")&&i.userData.GlowPass&&(e.geoList.GlowPassMask||(e.geoList.GlowPassMask=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW_MASK),e.geoList.GlowPassMask.push(i)),i.userData.hasOwnProperty("castShadow")&&i.userData.castShadow&&(i.castShadow=!0),i.userData.hasOwnProperty("receiveShadow")&&i.userData.receiveShadow&&(i.receiveShadow=!0),i.userData.hasOwnProperty("Shader")&&""!==i.userData.Shader&&(e.shaderGeoList||(e.shaderGeoList={}),e.shaderGeoList[i.name]=i),i.userData.hasOwnProperty("Emitter")&&""!==i.userData.Emitter&&(e.emitterList||(e.emitterList={}),e.emitterList[i.userData.Emitter]||(e.emitterList[i.userData.Emitter]={},e.emitterList[i.userData.Emitter].Emitter=[],e.emitterList[i.userData.Emitter].Particles=[]),e.emitterList[i.userData.Emitter].Emitter.push(i)),i.userData.hasOwnProperty("Hover")&&i.userData.Hover&&(e.hasHoverables=!0,e.hoverableList.push(i)),i.userData.hasOwnProperty("Click")&&i.userData.Click&&(e.hasClickables=!0,e.clickableList.push(i)),this.checkObjectInstancing(e,t,i),i.userData.hasOwnProperty("Scripted")&&(e.geoList.hasOwnProperty("Scripted")||(e.geoList.Scripted={}),e.geoList.Scripted[i.name]=i,i.children.forEach((s=>{if(s.name.includes("Geo")){let r=i.position,a=i.rotation,n=i.scale;s.position.set(r.x,r.y,r.z),s.rotation.set(a.x,a.y,a.z),s.scale.set(n.x,n.y,n.z),s.updateMatrix(),s.children.forEach((i=>{this.checkForColorSpace(e,i),this.checkForUserData(e,t,i),"Group"===i.type&&(i.position.set(r.x+i.position.x,r.y+i.position.y,r.z+i.position.z),i.rotation.set(a.x,a.y,a.z),i.scale.set(n.x,n.y,n.z)),i.updateMatrix()}))}else if(s.name.includes("Colliders")){let e=i.position,t=i.rotation,r=i.scale;s.position.set(e.x,e.y,e.z),s.rotation.set(t.x,t.y,t.z),s.scale.set(r.x,r.y,r.z),s.updateMatrix(),s.visible=!1}})))}}checkForColorSpace(e,t){t.type}checkForMeshSettings(e,t){t.hasOwnProperty("meshSettings")&&(t.meshSettings.hasOwnProperty("frontSided")&&(e.side=t.meshSettings.frontSided?G.FrontSide:G.BackSide),t.meshSettings.hasOwnProperty("doubleSided")&&(e.side=t.meshSettings.doubleSided?G.DoubleSide:G.FrontSide),t.meshSettings.hasOwnProperty("renderOrder")&&(e.renderOrder=t.meshSettings.renderOrder),t.meshSettings.hasOwnProperty("castShadow")&&(e.castShadow=t.meshSettings.castShadow),t.meshSettings.hasOwnProperty("receiveShadow")&&(e.receiveShadow=t.meshSettings.receiveShadow))}canAppendChildren(e,t){if("Group"!==t.type)return!1;let i=!0;return e.geoList.hasOwnProperty("Scripted")&&e.geoList.Scripted.hasOwnProperty(t.name)&&(i=!1),i}canAddToScene(e,t){let i=!0;return t.hasOwnProperty("userData")&&(t.userData.hasOwnProperty("Instance")||t.userData.hasOwnProperty("MobileInstance"))&&e.hasOwnProperty("baseInstancesNames")&&e.baseInstancesNames.hasOwnProperty(t.userData.Instance)&&(i=!1),i}checkIsGlassLiquid(e,t,i,s){let r=!1;if(i.userData.hasOwnProperty("isGlass")&&i.userData.isGlass&&(r=!0),i.userData.hasOwnProperty("isLiquid")&&i.userData.isLiquid&&(r=!0),!r)return!1;if(this.log("Glass Detected - ",i.name),!e.glassGroup){let i=new G.Group;e.glassGroup=i,t.add(i)}let a=i.material.clone();i.material=a,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=.5*i.material.specular.r+.1,i.material.specular.g=.5*i.material.specular.g+.1,i.material.specular.b=.5*i.material.specular.b+.1,i.material.side=G.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1+e.glassList.length,e.glassList.push(i),e.glassGroup.add(i);let n=i.geometry.clone(),o=i.material.clone();o.copy(i.material);let l=new G.Mesh(n,o);l.name=i.name+"_Front",l.material.shininess=40,l.material.side=G.FrontSide,l.matrixAutoUpdate=!1,l.renderOrder=1+e.glassList.length;let h=i.position,c=i.rotation,d=i.scale;return l.rotation.set(c.x,c.y,c.z),l.position.set(h.x,h.y,h.z),l.scale.set(d.x,d.y,d.z),l.updateMatrix(),i.parent.add(l),e.glassList.push(l),e.glassGroup.add(l),r}checkObjectInstancing(e,t,i){if(!e.hasOwnProperty("baseInstancesNames")||!e.hasOwnProperty("baseInstancesList")||!i.hasOwnProperty("userData")||!i.userData.hasOwnProperty("Instance")&&!i.userData.hasOwnProperty("MobileInstance"))return!1;if(!e.baseInstancesList.hasOwnProperty(i.userData.Instance))return this.warn(`Instance '${i.userData.Instance}' not found for ${i.name}`),!1;let s=i.name;this.log("Generate Instance - ",s),e.geoList.hasOwnProperty("InstanceObjects")||(e.geoList.InstanceObjects={});let r=new RegExp(/(instlod)\d+/,"i"),a=new RegExp(/\d+/,"i"),n=new RegExp(/(instlod)\d+(dist)/,"i"),o=new RegExp(/(instlod)\d+(skip)/,"i"),l={lod0:{mesh:i,dist:1}},h={mesh:i,instMesh:null,dist:1,skip:0},c={};try{Object.keys(i.userData).forEach((e=>{if(r.test(e)){let t=a.exec(e);if(!t||t.length<1)return;t=parseInt(t[0]);let s={};if(c.hasOwnProperty(t)||(c[t]=Object.assign({},h)),s=c[t],n.test(e)){let t=i.userData[e];s.dist=t}else if(o.test(e)){let t=i.userData[e];s.skip=t}else s.instMesh=i.userData[e]}}))}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}let d=i.children;for(let e=0;e<d.length;++e){if(!d[e].hasOwnProperty("userData"))continue;let t=d[e].userData;for(let e=0;e<t.length;++e){let i=t[e],s=r.test(i),l=Object.assign({},h);if(s){let e=a.exec(i);c.hasOwnProperty(e)&&(l=c[e])}if(n.test(i)){let e=t[i];l.dist=e}else if(o.test(i)){let e=t[i];l.skip=e}else l.instMesh=t[i]}}let u=Object.keys(l);try{for(let t=0;t<u.length;++t){let i=l[u[t]].mesh,r=i.position,a=i.rotation,n=i.scale,o=this.pxlOptions.mobile&&i.userData.hasOwnProperty("MobileInstance")?i.userData.MobileInstance:i.userData.Instance,h=e.baseInstancesList[o];if("Mesh"===i.type){let t=new G.Matrix4,o=new G.Vector3,l=new G.Vector3,c=new G.Quaternion,d=new G.Vector3(1,1,1),u=i.geometry.attributes.hasOwnProperty("color"),A=Object.keys(i.userData),p=A.map((e=>e.toLowerCase())),m=!1,g=0,f=1;p.includes("minscale")&&(m=!0,g=i.userData[A[p.indexOf("minscale")]]),p.includes("maxscale")&&(m=!0,f=i.userData[A[p.indexOf("maxscale")]]);let v={},b=[];for(let e=0;e<i.geometry.attributes.position.count;++e){o.fromBufferAttribute(i.geometry.attributes.position,e);let s=o.toArray();if(s=this.pxlUtils.flattenArrayToStr(s),!v.hasOwnProperty(s)){if(i.geometry.attributes.normal){l.fromBufferAttribute(i.geometry.attributes.normal,e);let t=l.clone();t=t.cross(new G.Vector3(0,1,0)).cross(t).normalize(),c.setFromUnitVectors(l,t)}else{let e=new G.Vector3(Math.random(),.1*Math.random(),Math.random()).normalize();l.copy(e);let t=new G.Vector3(0,1,0).cross(e).normalize();c.setFromUnitVectors(e,t)}let r=d;if(u){let t=i.geometry.attributes.color.getX(e);m&&(t=g+(f-g)*t),r=new G.Vector3(t,t,t)}t.compose(o,c,r),b.push(t.clone()),v[s]=!0}}if(b.length>0){let t=new G.InstancedMesh(h.geometry,h.material,b.length);t.instanceMatrix.setUsage(G.DynamicDrawUsage),t.userData=Object.assign({},i.userData),t.userData.pxlInstanceToMesh=!0,this.checkForMeshSettings(t,h.material);for(let e=0;e<b.length;++e)t.setMatrixAt(e,b[e]);t.visible=!0,t.position.set(r.x,r.y,r.z),t.rotation.set(a.x,a.y,a.z),t.scale.set(n.x,n.y,n.z),t.updateMatrix(),t.name=s+"Geo",e.geoList.InstanceObjects[s]=t,i.parent.add(t),i.visible=!1}}else{let t=new G.InstancedMesh(h.geometry,h.material,1);t.instanceMatrix.setUsage(G.DynamicDrawUsage),t.userData=Object.assign({},i.userData),t.userData.pxlInstanceToMesh=!1,this.checkForMeshSettings(t,h.material);let o=!1;if(i.userData.hasOwnProperty("fixInstMatrix")&&(o=!!i.userData.fixInstMatrix),o)t.rotation.set(a.x,a.y,a.z),t.position.set(r.x,r.y,r.z),t.scale.set(n.x,n.y,n.z);else{let e=new G.Matrix4;e.compose(r,(new G.Quaternion).setFromEuler(a),n),t.setMatrixAt(0,e)}t.visible=!0,t.updateMatrix(),t.name=s+"Geo",e.geoList.InstanceObjects[s]=t,i.parent.add(t),i.visible=!1,i.parent.remove(i)}}}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}this.verbose,this.pxlEnums.VERBOSE_LEVEL.DEBUG}pSystemBuild(e,t){if(!e.hasOwnProperty("userData")||!e.userData.hasOwnProperty("pSystem")||!e.userData.pSystem)return null;this.log("Processing Particle System - ",e.name);try{let i=e;if("Mesh"===i.type){let e=new G.Vector3,s=i.geometry.attributes.hasOwnProperty("color"),r=Object.keys(i.userData),a=r.map((e=>e.toLowerCase())),n=!1,o=0,l=1;a.includes("minscale")&&(n=!0,o=i.userData[r[a.indexOf("minscale")]]),a.includes("maxscale")&&(n=!0,l=i.userData[r[a.indexOf("maxscale")]]);let h={},c=[],d=i.geometry.attributes.hasOwnProperty("color"),u=[];for(let t=0;t<i.geometry.attributes.position.count;++t){e.fromBufferAttribute(i.geometry.attributes.position,t);let r=e.toArray();if(r=this.pxlUtils.flattenArrayToStr(r),!h.hasOwnProperty(r)){if(d&&(u.push(i.geometry.attributes.color.getX(t)),u.push(i.geometry.attributes.color.getY(t)),u.push(i.geometry.attributes.color.getZ(t))),s){let e=i.geometry.attributes.color.getX(t);n&&(e=o+(l-o)*e)}c.push(e.x),c.push(e.y),c.push(e.z),h[r]=!0}}if(c.length>0){let e=new G.Float32BufferAttribute(c,3),s=new G.BufferGeometry;s.setAttribute("position",e),s.userData=Object.assign({},i.userData),s.userData.pSystem=!0;let r=new G.Vector3(0,0,0);return r.equals(i.position)||(s.userData.pPosition=i.position),r.equals(i.rotation)||(s.userData.pRotation=i.rotation),r.equals(i.scale)||(s.userData.pScale=i.scale),s.computeBoundingBox(),s.computeBoundingSphere(),t.particleList[i.name]=s,void i.parent.remove(i)}}}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}}loadSceneFBX(e,t,i,s,r,a){""!==r&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[r]=0);var n=Hs();return n.load(e,(e=>{let t=e.children,i={},s=[];t.forEach(((e,t)=>{let r=e.name.toLowerCase();s.push(r),i[r]=t})),s.forEach((e=>{if(e.includes("camera")&&(t[i[e]].children.forEach(((e,t)=>{if(e.matrixAutoUpdate=!1,e.name.includes("position")){let t=e.position.clone();this.pxlCamera.cameraPrevPos=t.clone(),this.pxlCamera.camera.position.copy(t),this.pxlCamera.cameraPos.copy(t),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=t,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(t.clone())}else if(e.name.includes("lookat")){let t=e.position.clone();this.pxlCamera.cameraAimTarget.position.copy(t),this.pxlCamera.camera.lookAt(t),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new G.Vector3,this.pxlEnv.camInitLookAt=t,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(t.clone())}else if(e.name.includes("returnposition")){let t=e.position.clone();this.pxlEnv.camReturnPos=t}else if(e.name.includes("returnlookat")){let t=e.position.clone();this.pxlEnv.camReturnLookAt=t}})),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone()),e.includes("Items")){let s=t[i[e]].children,r=null,n=null,o=null,l=null,h=(e,t)=>{e.forEach((e=>{e.name.includes("Item")?(t.includes("LowGravity")?(null==n&&(n=new G.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:G.DoubleSide,depthTest:!0,depthWrite:!1})),e.material=n):t.includes("LizardKing")?(null==o&&(o=e.material.clone(),o.emissiveMap=o.map,o.emissive=new G.Color(8421504)),e.material=o):t.includes("StarField")||t.includes("InfinityZoom")&&(null==l&&(l=new G.ShaderMaterial({uniforms:{color:{value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:G.DoubleSide,depthTest:!0,depthWrite:!0})),e.material=l),this.pxlUser.itemList[t]=e):e.name.includes("ItemBase")&&(null==r&&(r=new G.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:G.DoubleSide,depthTest:!0,depthWrite:!1})),e.material=r,this.pxlUser.itemBaseList.push(e))}))};for(;s.length>0;){let e=s.pop();if("Group"===e.type){h(e.children,e.name),a[0].add(e),this.pxlUser.itemGroupList[e.name]=e,this.pxlUser.itemListNames.push(e.name)}}}})),""!==r&&(this.pxlEnv.geoList[r]=e,this.pxlEnv.geoLoadList[r]=1),this.pxlEnv.geoLoadList[r]=1}),void 0,(e=>{""!==r&&(this.pxlEnv.geoLoadList[r]=1)})),n}getSettings(){return{fileType:this.pxlEnums.FILE_TYPE.AUTO,filePath:"",meshKey:"",meshIsChild:!1,enableLogging:!1}}readSettings(e,t){let i=Object.assign(this.getSettings(),t);if(this.setLogging(i.enableLogging),(null===i.filePath||""===i.filePath)&&e.hasOwnProperty("sceneFile")&&(i.filePath=e.sceneFile),null===i.filePath||""===i.filePath)return this.warn("No Path Provided for Environment Load"),i.filePath=null,i;if(i.fileType===this.pxlEnums.FILE_TYPE.AUTO||"number"!=typeof i.fileType){let e=i.filePath.split(".").pop().toLowerCase();"fbx"===e?i.fileType=this.pxlEnums.FILE_TYPE.FBX:"glb"===e?i.fileType=this.pxlEnums.FILE_TYPE.GLB:"gltf"===e&&(i.fileType=this.pxlEnums.FILE_TYPE.GLTF)}return""===i.meshKey&&(i.meshKey=e.getName()),i.verified=!0,i}verifySettings(e,t){return t.hasOwnProperty("verified")&&t.verified?t:this.readSettings(e,t)}loadPath(e,t=null,i={}){let s=Object.assign(this.getSettings(),i);null!==t&&""!==t&&(s.filePath=t),s=this.readSettings(e,s),null!==s.filePath&&""!==s.filePath&&this.loadRoom(e,s)}loadRoom(e,t={}){let i=this.readSettings(e,t);if(null===i.filePath||""===i.filePath)return;let s=i.fileType;s===this.pxlEnums.FILE_TYPE.FBX?this.loadRoomFBX(e,i):(s===this.pxlEnums.FILE_TYPE.GLB||s===this.pxlEnums.FILE_TYPE.GLTF)&&this.loadRoomGLTF(e,i)}loadRoomGLTF(e,t={}){if(!(t=this.readSettings(e,t)).filePath)return;let i=new dt,s=new ci;s.setDecoderPath("https://threejs.org/examples/jsm/libs/draco/"),s.preload(),i.setDRACOLoader(s);let r=i;r.setMeshoptDecoder(Ri);let a=new wi;a.setTranscoderPath("https://threejs.org/examples/jsm/libs/basis/"),a.detectSupport(this.pxlEnv.engine),r.setKTX2Loader(a),this.loadRoomFile(r,e,t)}loadRoomFBX(e,t={}){if((t=this.readSettings(e,t)).filePath){var i=Hs();this.loadRoomFile(i,e,t)}}loadRoomFile(e,t,i={}){if(!(i=this.verifySettings(t,i)).filePath)return;let s=i.meshKey,r=i.filePath,a=t.materialList;this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[s]=0;let n=t.scene;return e.load(r,(e=>{var i,r,o;e.hasOwnProperty("scenes")&&!e.hasOwnProperty("children")&&(e=e.scene);let l=e.children;if(1===l.length){let e=l[0];e.name.toLowerCase().includes("scene")||(l=e.children)}let h={},c=[];if(l.forEach(((e,t)=>{let i=e.name.split("_")[0].toLowerCase();c.push(i),h[i]=t})),c.indexOf("camera")>-1){let e=[];this.log("Camera - ",l[h.camera]);let i=t.defaultCamLocation;l[h.camera].userData.hasOwnProperty("DefaultCam")&&(i=l[h.camera].userData.DefaultCam,t.defaultCamLocation=i),l[h.camera].children.forEach(((t,i)=>{let s=t.name.toLowerCase();s.includes("position")||s.includes("lookat")||s.includes("returnposition")||s.includes("returnlookat")?e.push(t):t.children.length>0&&e.push(...t.children)})),e.forEach(((e,i)=>{e.matrixAutoUpdate=!1;let s=e.parent.name.toLowerCase();s===l[h.camera].name.toLowerCase()&&(s="default"),t.camLocation.hasOwnProperty(s)||(t.camLocation[s]={},t.camLocation[s].position=new G.Vector3(0,0,-10),t.camLocation[s].lookat=new G.Vector3(0,0,0));let r=e.name.toLowerCase();if(r.includes("positionmobile")){let i=e.position.clone();t.cameraBooted=!0,t.camInitPos=i,t.camLocation[s].positionmobile=i}else if(r.includes("lookatmobile")){let i=e.position.clone();t.camInitLookAt=i,t.camLocation[s].lookatmobile=i}else if(r.includes("position")){let i=e.position.clone();t.cameraBooted=!0,t.camInitPos=i,t.camLocation[s].position=i}else if(r.includes("lookat")){let i=e.position.clone();t.camInitLookAt=i,t.camLocation[s].lookat=i}else if(r.includes("returnposition")){let i=e.position.clone();t.camReturnPos=i,t.camLocation[s].returnposition=i}else if(r.includes("returnlookat")){let i=e.position.clone();t.camReturnLookAt=i,t.camLocation[s].returnlookat=i}})),Object.keys(t.camLocation).forEach((e=>{let i=t.camLocation[e];i.hasOwnProperty("positionmobile")||(i.positionmobile=i.position),i.hasOwnProperty("lookatmobile")||(i.lookatmobile=i.lookat)}))}if(c.indexOf("AutoCamPaths")>-1){let e=l[h.AutoCamPaths].children;for(this.log("AutoCamPaths - ",l[h.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[t.getName()]=[];e.length>0;){let i=e.pop();if("Group"===i.type){let e={};i.children.forEach((t=>{t.matrixAutoUpdate=!1,e[t.name]=t})),i.visible=!1,i.matrixAutoUpdate=!1,n.add(i),this.pxlAutoCam.autoCamPaths[t.getName()].push(e)}}}if(c.indexOf("instances")>-1&&0===this.pxlQuality.detailLimit){let e=[...l[h.instances].children];this.log("Instances - ",l[h.instances]),e.length>0&&(t.hasOwnProperty("baseInstancesNames")||(t.baseInstancesNames=[]),t.hasOwnProperty("baseInstancesList")||(t.baseInstancesList={}),e.forEach(((e,i)=>{if(this.checkForColorSpace(t,e),this.checkForUserData(t,n,e),a.hasOwnProperty(e.name)){let t=null;e.material.map&&(t=e.material.map),e.material=a[e.name],this.checkForMeshSettings(e,e.material),t&&(e.material.uniforms.hasOwnProperty("diffuse")&&(e.material.uniforms.diffuse.value=t),e.material.hasOwnProperty("emissiveMap")&&(e.material.emissiveMap=t,e.material.emissive.r>0&&(e.material.emissiveIntensity=e.material.emissive.r))),e.matrixAutoUpdate=!1}t.baseInstancesNames.push(e),t.baseInstancesList[e.name]=e})))}if(c.indexOf("lights")>-1){let e=l[h.lights].children;for(this.log("Lights - ",l[h.lights]);e.length>0;){let i=e.pop();e.push(...i.children),i.type.includes("Light")&&(t.hasOwnProperty("lightList")||(t.lightList={}),t.geoList.hasOwnProperty("lights")||(t.geoList.lights=[]),"PointLight"===i.type&&(i.decay=Math.max(1.1,Math.min(3,i.intensity)),i.distance=0===i.distance?1e3*i.intensity:i.distance),t.lightList.hasOwnProperty(i.type)||(t.lightList[i.type]=[]),t.lightList[i.type].push(i),t.geoList.lights.push(i),i.matrixAutoUpdate=!1,n.add(i))}}if(c.includes("scene")||c.includes("mainscene")){let e=h.scene||h.mainscene,i=[...l[e].children];for(this.log("MainScene - ",l[e]);i.length>0;){let e=i.pop();if(this.log(`Cur Object - ${e.name}`),this.debug(e),this.checkForColorSpace(t,e),this.checkForUserData(t,n,e),e.isMesh){e.userData.hasOwnProperty("Show")&&(!e.userData.Show||0===e.userData.Show)&&(e.visible=!1),e.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),t.geoList[e.name]=e;let i=G.FrontSide;if((e.userData.hasOwnProperty("doubleSided")||e.userData.hasOwnProperty("DoubleSided"))&&(i=G.DoubleSide),(e.userData.hasOwnProperty("scripted")||e.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[e.name]=e),a.hasOwnProperty(e.name)){let t=null;e.material.map&&(t=e.material.map),e.material=a[e.name],this.checkForMeshSettings(e,e.material),t&&(e.material.uniforms.hasOwnProperty("diffuse")&&(e.material.uniforms.diffuse.value=t),e.material.hasOwnProperty("emissiveMap")&&(e.material.emissiveMap=t,e.material.emissive.r>0&&(e.material.emissiveIntensity=e.material.emissive.r))),e.matrixAutoUpdate=!1}else{let s=e.material;Array.isArray(e.material)||(s=[e.material]),this.checkIsGlassLiquid(t,n,e,s)||s.forEach((e=>{e.map&&!e.emissiveMap&&e.emissive.r>0&&(e.emissiveMap=e.map,e.emissiveIntensity=e.emissive.r,e.emissive=new G.Color(16777215)),e.side=i})),e.matrixAutoUpdate=!1}}else e.type.includes("Light")?(t.lightList.hasOwnProperty(e.type)||(t.lightList[e.type]=[]),t.lightList[e.type].push(e)):"Group"===e.type&&((e.userData.hasOwnProperty("scripted")||e.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[e.name]=e),i.push(...e.children))}n.add(...l[e].children)}if(c.indexOf("glass")>-1){let e=l[h.glass].children;if(this.log("Glass - ",l[h.glass]),e.length>0){if(!t.glassGroup){let e=new G.Group;t.glassGroup=e,n.add(e)}for(;e.length>0;){let i=e.pop();if(e.push(...i.children),i.isMesh){this.checkForColorSpace(t,i),this.checkForUserData(t,n,i);let e=i.material.clone();i.material=e,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=.5*i.material.specular.r+.1,i.material.specular.g=.5*i.material.specular.g+.1,i.material.specular.b=.5*i.material.specular.b+.1,i.material.side=G.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1,t.glassList.push(i),t.glassGroup.add(i);let s=i.geometry.clone(),r=i.material.clone();r.copy(i.material);let a=new G.Mesh(s,r);a.material.shininess=40,a.material.side=G.FrontSide,a.matrixAutoUpdate=!1,a.renderOrder=2;let o=i.position,l=i.rotation,h=i.scale;a.rotation.set(l.x,l.y,l.z),a.position.set(o.x,o.y,o.z),a.scale.set(h.x,h.y,h.z),a.updateMatrix(),n.add(a),t.glassList.push(a),t.glassGroup.add(a)}}}}if(c.indexOf("colliders")>-1){let e=l[h.colliders];this.log("Colliders - ",l[h.colliders]);let i=e.children;t.collidersExist=i.length>0;for(let e=0;e<i.length;++e){let s=i[e].name.toLowerCase(),r=i[e].children;for(;r.length>0;){let e=r.pop();r.push(...e.children),e.isMesh&&(e.visible=!1,"colliderwalls"===s?(t.antiColliderActive=!0,t.antiColliderList.push(e)):"collidertops"===s?(t.antiColliderTopActive=!0,t.antiColliderTopList.push(e)):("roomwarpzone"===s&&(t.hasRoomWarp=!0,t.roomWarp.push(e)),t.colliderActive=!0,t.colliderList.push(e)),e.matrixAutoUpdate=!1,n.add(e),t.geoList[e.name]=e)}}t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.FLOOR)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.FLOOR):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL_TOP)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL_TOP):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.ROOM)&&this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.ROOM)}if(c.indexOf("portalexit")>-1){let e=l[h.portalexit].children;for(this.log("PortalExit - ",l[h.portalexit]);e.length>0;){let i=e.pop();i.matrixAutoUpdate=!1,t.hasPortalExit=!0,t.portalList[i.name]=i}}if(c.indexOf("flatcolor")>-1){let e=l[h.flatcolor].children;for(this.log("FlatColor - ",l[h.flatcolor]);e.length>0;){let i=e.pop();if(e.push(...i.children),i.isMesh){this.checkForColorSpace(t,i),this.checkForUserData(t,n,i);let e=new G.MeshBasicMaterial({color:i.material.color.clone()});e.side=G.FrontSide,e.flatShading=!0,i.material=e,i.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),i.matrixAutoUpdate=!1,n.add(i)}}}if(c.indexOf("lambertcolor")>-1){let e=l[h.lambertcolor].children;for(this.log("LambertColor - ",l[h.lambertcolor]);e.length>0;){let i=e.pop();if(e.push(...i.children),i.isMesh){this.checkForColorSpace(t,i),this.checkForUserData(t,n,i);let e=new G.MeshLambertMaterial;if(i.material.map){let t=i.material.map.clone();e.map=t,i.material=e}else e.color=i.material.color.clone(),e.side=G.FrontSide,e.flatShading=!0,i.material=e;i.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),i.matrixAutoUpdate=!1,n.add(i)}}}if(c.indexOf("sky")>-1){let e=l[h.sky].children;for(this.log("Sky - ",l[h.sky]);e.length>0;){let s=e.pop();if(e.push(...s.children),s.isMesh){let e=null;a.hasOwnProperty(s.name)?(e=a[s.name],this.checkForMeshSettings(s,e)):e=new G.ShaderMaterial({uniforms:{diffuse:{type:"t",value:s.material.map},noiseTexture:{type:"t",value:null},fogColor:{value:n.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:t.camera.near},camFar:{type:"f",value:.85*t.camera.far},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag(this.pxlOptions.skyHaze)}),s.material=e,s.matrixAutoUpdate=!1,s.frustumCulled=!1,s.layers.set(this.pxlEnums.RENDER_LAYER.SKY),s.material.depthTest=!0,s.material.depthWrite=!1,null!=(i=s.material)&&i.uniforms.hasOwnProperty("noiseTexture")&&null!=t&&t.cloud3dTexture&&(s.material.uniforms.noiseTexture.value=t.cloud3dTexture),null!=(r=s.material)&&r.uniforms.hasOwnProperty("depthTexture")&&null!=(o=null==n?void 0:n.renderTarget)&&o.depthTexture&&(s.material.uniforms.envDiffuse.value=n.renderTarget.depthTexture),t.geoList[s.name]=s,t.materialList[s.name]=e,n.add(s)}}}if(c.indexOf("animatedtextures")>-1){let e=l[h.animatedtextures].children;for(this.log("AnimatedTextures - ",l[h.animatedtextures]);e.length>0;){let i=e.pop();if(e.push(...i.children),i.isMesh){this.checkForColorSpace(t,i),this.checkForUserData(t,n,i);let e={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:i.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new G.Vector3(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},s=this.pxlShaders.animated.animTextureVert(),r=this.pxlShaders.animated.animTextureFrag(),a=new G.ShaderMaterial({uniforms:e,vertexShader:s,fragmentShader:r,transparent:!0,side:G.FrontSide});i.material=a,i.matrixAutoUpdate=!1,n.add(i)}}}if(c.indexOf("scrollingtextures")>-1){let e=l[h.scrollingtextures].children;this.log("ScrollingTextures - ",l[h.scrollingtextures]);let i=1;for(;e.length>0;){i+=1;let s=e.pop();if(e.push(...s.children),s.isMesh){this.checkForColorSpace(t,s),this.checkForUserData(t,n,s);let e=s.name,r=.05;e.indexOf("_")>-1&&(r=e.split("_")[1],r=.01*parseInt(r));let a=new G.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:s.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:r},seed:{type:"f",value:1.1423*i},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:G.FrontSide});s.material=a,s.matrixAutoUpdate=!1,n.add(s)}}}if(c.indexOf("userscreens")>-1){let e=l[h.userscreens].children;this.log("UserScreens - ",l[h.userscreens]);let i=0,s=[new G.Vector3(1,0,0),new G.Vector3(0,1,0),new G.Vector3(0,0,1)],r=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],a=0,o=0,c=s.length;for(;e.length>0;){let l=e.pop();if(e.push(...l.children),l.isMesh){let e=new G.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:1.1423*i},alpha:{type:"f",value:1},boostPerc:{value:t.userScreenIntensity},scale:{value:new G.Vector2(100,100)},ratio:{value:new G.Vector2(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:s[a]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(r[o])}},vertexShader:t.userScreenVert,fragmentShader:t.userScreenFrag,transparent:!0,side:G.FrontSide});l.material=e,l.matrixAutoUpdate=!1,t.pxlEnv.camScreenData.screenGeoList.push(l),n.add(l),i+=1,a=i%c,o=Math.floor(i/3)%c}}}if(c.indexOf("items")>-1){let e=l[h.items].children;for(this.log("Items - ",l[h.items]);e.length>0;){let t=e.pop();if("Group"===t.type){let e=t.children;e.length>0&&(e.forEach((e=>{if(e.name.includes("Item")){let i=new G.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:G.DoubleSide,depthTest:!0,depthWrite:!1});e.material=i,this.pxlUser.itemList[t.name]=e}else if(e.name.toLowerCase().includes("base")){let t=new G.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:G.DoubleSide,depthTest:!0,depthWrite:!1});e.material=t,this.pxlUser.itemBaseList.push(e)}})),n.add(t),this.pxlUser.itemGroupList[t.name]=t,this.pxlUser.itemListNames.push(t.name))}}}if(c.includes("scripted")){let e=l[h.scripted].children;for(this.log("Scripted - ",l[h.scripted]);e.length>0;){let i=e.pop();i.isMesh&&(t.geoList[i.name]=i,n.add(i))}}if(c.includes("clickable")){let e=l[h.clickable];this.log("Clickable - ",l[h.clickable]);let i=e.children;for(let e=0;e<i.length;++e){let s=i[e].name,r=i[e].children;for(;r.length>0;){let e=r.pop();if(r.push(...e.children),e.isMesh){(new G.MeshBasicMaterial).color=new G.Color(16777215),e.material.emissive=new G.Color(4473924),e.material.emissiveMap=e.material.map,e.matrixAutoUpdate=!1,t.objectClickableObjectList[e.name]||(t.objectClickableObjectList[e.name]={}),t.objectClickableObjectList[e.name][s]=e,t.objectClickable.push(e),n.add(e),"Hover"===s&&(e.visible=!1)}}}}if(c.includes("markers")){let e=l[h.markers].children;for(this.log("Markers - ",l[h.markers]);e.length>0;){let i=e.pop();t.marker[i.name]=i.position}}this.pxlEnv.geoList[s]=e,this.pxlEnv.geoLoadList[s]=1,t.fbxPostLoad(),this.runDebugger=!1}),null,(e=>{i.hasOwnProperty("onError")?i.onError(e):(""!==s&&(this.pxlEnv.geoLoadList[s]=1),this.log("Error Loading FBX"),this.log(e),this.runDebugger=!1)})),e}loadAnimFBX(e,t,i,s,r){""===t&&(t=e.getName()),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[t]=0;let a=e.scene,n=e.materialList;var o=Hs();return o.load(i,(i=>{let o=i.children,l=[];o.forEach(((e,t)=>{let i=e.name.split("_")[0];l.push(i)})),i.traverse((t=>{if(this.checkForColorSpace(e,t),this.checkForUserData(e,a,t),t.isMesh&&(e.geoList[t.name]=t),n.hasOwnProperty(t.name)){let e=null;t.material.map&&(e=t.material.map),t.material=n[t.name],this.checkForMeshSettings(t,t.material),e&&(t.material.uniforms.hasOwnProperty("diffuse")&&(t.material.uniforms.diffuse.value=e),t.material.hasOwnProperty("emissiveMap")&&(t.material.emissiveMap=e,t.material.emissive.r>0&&(t.material.emissiveIntensity=t.material.emissive.r))),t.matrixAutoUpdate=!1}t.userData.hasOwnProperty("doubleSided")&&t.userData.doubleSided&&(t.material.side=G.DoubleSide)})),this.pxlAnim.initObject(t,i),this.log("Animation FBX - ",l[0]),a.add(i),i.frustumCulled=!1;var h=Hs();let c=[];Object.keys(s).forEach((e=>{let i=s[e],r=new Promise(((s,r)=>{h.load(i,(r=>{0===r.animations.length&&(this.log("No animations found in file",i),this.log(r),s()),this.pxlAnim.addClips(t,e,r),this.log("Animation Loaded",e),s()}),null,(e=>{this.log("Animation Load Error"),this.log(e),r(e)}))}));c.push(r)})),Promise.all(c).then((()=>{this.pxlAnim.setStateConnections(t,r),e.geoList[t]=i,this.pxlEnv.geoLoadList[t]=1,e.animPostLoad(t)})).catch((e=>{this.log("Error loading animations",e)}))}),null,(e=>{""!==t&&(this.pxlEnv.geoLoadList[t]=1)})),o}pxlShaderBuilder(e,t,i,s=null){var r,a={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};null!==e&&(a=Object.assign({},a,e));let n={uniforms:a,vertexShader:t,fragmentShader:i};return s&&(n.defines=s),(r=new G.ShaderMaterial(n)).transparent=!0,r.depthTest=!0,r}removeChildren(e){for(var t=0,i=e.children,s=0;s<i.length;++s)"Group"===i[s].type&&(e.remove(i[s]),t++);return t}findMesh(e){for(var t=null,i=e.children,s=0;s<i.length;++s)if("Mesh"===i[s].type){t=i[s];break}return t}getBBoxCentroid(e){try{var t=(new G.Box3).setFromObject(e),i=t.min,s=t.max,r=(new G.Vector3).addVectors(s,i).multiplyScalar(.5);e.userData={bbox:t,centroid:r}}catch(e){this.verbose>=Ms.ERROR&&(console.log("- - - - - - - - ERROR - - - - - - - -"),console.log("     Object does not exist.\n           - Error Info -"),console.log(e),console.log("- - - - - - - - - - - - - - - - - - -"))}}loadScript(e){return new Promise(((t,i)=>{let s=document.createElement("script");s.type="text/javascript",s.src=e,s.async=!0,s.onreadystatechange=()=>{t(!0)},s.onload=()=>{t(!0)},document.head.appendChild(s)}))}xmlHttp(){if("undefined"!=typeof window&&window.XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof window&&void 0!==window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new Error("No supported XMLHttpRequest implementation found.")}static getURLContent(e){return new Promise(((t,i)=>{let s=null;"undefined"!=typeof window&&window.XMLHttpRequest?s=new XMLHttpRequest:"undefined"!=typeof window&&void 0!==window.ActiveXObject&&(s=new window.ActiveXObject("Microsoft.XMLHTTP")),s.open("GET",e),s.onload=e=>{4===s.readyState&&s.status>=200&&s.status<300?t(s.response):t(s.statusText)},s.onerror=()=>i(s.statusText),s.send()}))}getExternalHTML(e,t){if(!window.XMLHttpRequest)return void window.open(e,"_blank");let i=this.xmlHttp();i.onreadystatechange=function(){4===this.readyState&&200===this.status&&t&&"function"==typeof t&&t(i.responseText)},i.open("GET",e,!0),i.responceType="document",i.send()}fetchURLStatus(e,t,i){fetch(e,{method:"HEAD"}).then((e=>{t(e.status,i)})).catch((e=>{t(404,i)}))}urlExistsFallback(e){return new Promise(((t,i)=>{let s=this.xmlHttp();s.open("HEAD",e,!0),s.send(),s.onreadystatechange=function(){this.readyState===this.DONE&&t(this.status<400)},s.onerror=e=>{t(!1)},s.ontimeout=e=>{t(!1)}}))}urlExists(e){return new Promise(((t,i)=>{this.urlExistsFallback(e).then((e=>{t(e)}))})).then((e=>e)).catch((e=>!1))}},Ws={height:{standing:1.75,stepSize:5},movement:{scalar:1,max:10,easing:.55},look:{pc:{invert:!1},mobile:{invert:!0}},headBounce:{height:.3,rate:.025,easeIn:.03,easeOut:.95},jump:{impulse:.75,holdMax:2.85,repeatDelay:.08},gravity:{ups:.3,max:15.5},deadZone:{controller:.1,touch:20,xr:.1}},zs={verbose:js.VERBOSE_LEVEL.NONE,fps:{pc:60,mobile:30},renderScale:{pc:1,mobile:1.5},fullLoadPreBoot:!0,staticCamera:!1,autoCamera:!1,allowStaticRotation:!1,userSettings:Object.assign({},Ws),subFrameCalculations:!1,pxlRoomRoot:"./pxlRooms",pxlAssetRoot:"./pxlAssets",showOnboarding:!0,onboarding:{pc:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-welcome-message"],buttonText:"close",buttonStyle:["guiButton"]},mobile:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-mobile-body"],buttonText:"start",buttonStyle:["guiButton","pxlGui-mobile-welcomeButton"]}},loaderPhrases:["...loading the pixels..."],antiAliasing:js.ANTI_ALIASING.LOW,collisionScale:{gridSize:50,gridReference:1e3},shadowMapBiasing:js.SHADOW_MAP.BASIC,loadEnvAssetFile:!1,skyHaze:js.SKY_HAZE.OFF,postProcessPasses:{roomGlowPass:!1,motionBlurPass:!1,mapComposerWarpPass:!1,chromaticAberrationPass:!1,lizardKingPass:!1,starFieldPass:!1,crystallinePass:!1}},Ks=class{static svgPromise(e,t,i=null,s=null){let r={},a=document.getElementById(t);if(!a)return;null!=i&&a.classList.add(i);let n=Promise.resolve(Vs.getURLContent(e));return n.then((e=>{a.innerHTML=e,r.svg=a.getElementsByTagName("svg")[0],null!=s&&r.svg.classList.add(s)})),r.promise=n,r}static svgRawPromise(e){let t={};return Promise.resolve(Vs.getURLContent(e)).then((e=>{let i=document.createElement("div");i.innerHTML=e,t.svg=i.getElementsByTagName("svg")[0]})),t}static svgIconPromise(e,t,i,s=null,r=null){let a=this,n={hover:null,mute:null,caret:null,indicator:null,waiting:[],state:null};n.eventType=i;let o=document.getElementById(t);if(!o)return;r?o.classList.add(r):o.classList.add("iconStyle"),n.parent=o.parentNode,n.parent.classList.add("iconHover"),n.parent.addEventListener("click",(e=>{a.iconEvent("click",n,i)}));let l=Promise.resolve(Vs.getURLContent(e));return l.then((e=>{if(o.innerHTML=e,n.svg=o.getElementsByTagName("svg")[0],n.svg){r?n.svg.classList.add(r):n.svg.classList.add("iconStyle");let e=n.svg.children,i=n.svg.getAttribute("xmlns"),a=n.svg.getAttribute("height"),l=n.svg.getAttribute("width");for(let r=0;r<e.length;++r){let h=e[r];if("speakerIcon"===t){let e=o.getAttribute("xmlns"),t=document.createElementNS(e,"rect");t.setAttribute("x",-1),t.setAttribute("y",-1),t.setAttribute("fill","white"),t.setAttribute("fill-opacity",0),t.setAttribute("height",a+2),t.setAttribute("width",l+2),t.setAttribute("z-index",-1),o.appendChild(t),n.hover=t,n.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}let c=h.getAttribute("id");if("mute"===c){n.mute=h,n.mute.style.transformOrigin="50% 50%",n.mute.style.filter="alpha(opacity=0)",n.mute.style.opacity="0",n.mute.style.transform="scale(0,0)",n.mute.style.transition="scale 1s, opacity .5s, filter .5s";let e=document.createElement("style");e.type="text/css",e.innerHTML="\n                                @keyframes loadingSpinner{\n                                    0%{\n                                        transform: rotate(0deg);\n                                    }\n                                    100%{\n                                        transform: rotate(360deg);\n                                    }\n                                }\n                            ",n.svg.appendChild(e);let t=Math.max(2,.25*Math.min(a,l)),r=.5*l,o=.5*a,c=document.createElementNS(i,"path");c.setAttribute("d",` M ${r} ${o-t} A ${t} ${t} 0 1 1 ${r-t} ${o} `),c.setAttribute("stroke","white"),c.setAttribute("stroke-width","2"),c.style.display="none",c.style.transformOrigin="50% 50%",c.style.animation="loadingSpinner 1s linear infinite",c.style.animationDuration="2s",c.style.animationPlayState="paused",n.indicator=c,n.svg.appendChild(c),this.toggleIcon(n,s)}else"caret"===c?(n.caret=h,n.caret.style.transformOrigin="50% 50%",n.caret.style.transition="transform .5s",this.flipIcon(n,!1)):"state"===c?(h.style.display="none",n.state=h):n.waiting.push(h)}let h=document.createElementNS(i,"rect");h.classList.add("iconHover"),h.setAttribute("x",0),h.setAttribute("y",0),h.setAttribute("height",a),h.setAttribute("width",l),n.svg.appendChild(h)}})),n.promise=l,n}static svgButtonPromise(e,t,i=null,s=!1,r=null){if("string"==typeof t&&!(t=document.getElementById(t)))return;let a=this;Promise.resolve(Vs.getURLContent(e)).then((e=>{t.innerHTML=e;let n=t.getElementsByTagName("svg");if(n.length>0&&(n=n[0],i&&(i="string"==typeof i?[i]:i).forEach((e=>{n.classList.add(e)})),s)){let e=n.getAttribute("xmlns"),t=parseInt(n.getAttribute("height")),i=parseInt(n.getAttribute("width")),s=document.createElementNS(e,"rect");s.setAttribute("x",-1),s.setAttribute("y",-1),s.setAttribute("fill","white"),s.setAttribute("fill-opacity",0),s.setAttribute("height",t+2),s.setAttribute("width",i+2),s.setAttribute("z-index",-1),n.appendChild(s);let o=n.getElementById("state");o&&o.setAttribute("fill-opacity",this.toggleOpacity[0]),r&&(n.onclick=e=>{a.svgCheckClick(e,r)},a.pxlDevice.mobile?(n.ontouchstart=e=>{a.svgStylize(e,!0)},n.ontouchend=e=>{a.svgStylize(e,!1)}):(n.onmouseover=e=>{a.svgStylize(e,!0)},n.onmouseout=e=>{a.svgStylize(e,!1)}))}}))}},qs=class{constructor(e,t="Metal-Asylum",i="./assets/",s="./assets/GUI/"){this.projectTitle=t,this.verbose=e,this.mobile=!1,this.pxlOptions=null,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=i,this.guiRoot=s,this.introHelpActive=!0,this.branding={title:t,loader:s+".svg",logo:s+".svg",medalion:s+".svg",stack:s+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=8,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!1,loadingBranding:!1},this.settingsFields={changeUsername:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlFile=e.pxlFile,this.pxlCookie=e.pxlCookie,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUtils=e.pxlUtils,this.pxlUser=e.pxlUser,this.pxlDevice=e.pxlDevice,this.pxlAutoCam=e.pxlAutoCam,this.pxlCamera=e.pxlCamera,this.pxlNavCanvas=e.pxlNavCanvas,this.pxlQuality=e.pxlQuality,this.pxlEnv=e.pxlEnv,this.mobile=e.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),e.pxlDevice.subscribe("resize",this.resize.bind(this)),this.createContainer(),this.createFailState(),this.buildConsole()}init(){this.cssBuildClasses()}createContainer(){let e;this.pxlOptions.hasOwnProperty("container")&&this.pxlOptions.container instanceof HTMLElement?e=this.pxlOptions.container:(e=document.createElement("div"),e.id="pxlNav-container",e.classList.add("pxlNav-mainContainerStyle"),document.body.appendChild(e)),this.guiWindows.container={active:!0,gui:e}}addToContainer(e){this.guiWindows.container||this.createContainer(),this.guiWindows.container.gui.appendChild(e)}createFailState(){var e,t;let i=document.createElement("div");i.id="pxlNav-failState",i.classList.add("pxlNav-failStateStyle"),null!=(t=null==(e=this.guiWindows)?void 0:e.container)&&t.gui?this.guiWindows.container.gui.appendChild(i):document.body.appendChild(i),this.guiWindows.failState={active:!0,gui:i}}addToFailState(e){this.guiWindows.failState||this.createFailState(),this.guiWindows.failState.gui.appendChild(e)}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),this.addToContainer(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML=`\n            <div id="loaderLogoBranding" class='pxlLoaderLogo'></div>\n            <div class='loadStyleParent'>\n              <div id='pxlLoader' class='loadStyle'></div>\n              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>\n            </div>\n            <div id="loaderBranding" class='pxlLoaderTitle'>${this.projectTitle}</div>\n            <div id="loaderMessage" class='pxlLoaderMessage'></div>\n          `,this.addToContainer(this.mapPrompt);let e=document.getElementById("loaderMessage");if(e){let t=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];e.innerHTML=t}this.buildGuiStatus.loadingBranding&&Ks.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";let t=document.createElement("div");t.classList.add("pxlNav-crashPromptBackgroundStyle"),this.addToFailState(t);let i,s=document.createElement("div");s.classList.add("pxlNav-canvasCrashPromptStyle"),t.appendChild(s),this.pxlQuality&&(i=0===parseInt(this.pxlQuality.detailLimit)?`Looks like your computer is having a hard time, but we’ve got your fix.\n          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload ${this.projectTitle}.`:`Looks like your computer is still having trouble, but we’ve got another fix for ya.\n          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload ${this.projectTitle} again.`),s.innerHTML=i;let r=document.getElementById("pxlNav-crashLink");r&&(r.onclick=this.crashLinkTrigger.bind(this))}stepLoader(e=""){this.pxlLoaderCount+=1;let t=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);100===t&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=t+"%",this.verbose>=Ms.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+e)}setLoaderPhrases(e,t=!0){e&&e.length>0&&(t&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(e),this.setLoaderObjMessage())}setLoaderObjMessage(){let e=document.getElementById("loaderMessage");if(e){let t=Math.floor(17391.537193*Math.random()*this.loaderPhrases.length%this.loaderPhrases.length),i=this.loaderPhrases[t];e.innerHTML=i}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){var e;this.updateGuiPositions(),null!=(e=this.pxlUser)&&e.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.resetHelpTextPlacement(),["videoinput","audioinput","audiooutput"].forEach((e=>{let t=null,i=null;"videoinput"===e?(t="camChoiceOptionsBlock",i=this.hudIcons.camChoiceIcon):"audioinput"===e?(t="micChoiceOptionsBlock",i=this.hudIcons.micChoiceIcon):"audiooutput"===e&&(t="speakerChoiceOptionsBlock",i=this.hudIcons.speakerChoiceIcon);let s=document.getElementById(t);if(s&&i){let e=s.getBoundingClientRect().width,t=i.parent.getBoundingClientRect();s.style.left=t.x-.5*e,s.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}})),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach((e=>{let t=this.textDescriptions[e];if(t){let i=document.getElementById("helpText_"+e);if(!i)return;let s=document.getElementById(e);if(s){let e=2,r=t.pos,a=t.offset?t.offset:[0,0],n=s.getBoundingClientRect(),o=i.getBoundingClientRect(),l=0,h=0,c=!1;r[1]<0?(h=n.y+o.height*r[1],c=!0):0===r[1]?h=n.y+.5*n.height-.5*o.height:r[1]>0&&(h=n.y+n.height+o.height*(r[1]-1),c=!0),c?r[0]<0?l=n.x+n.width+o.width*r[0]:0===r[0]?l=n.x+.5*n.width-.5*o.width:r[0]>0&&(l=n.x+n.width*(r[0]-1)):r[0]<0?l=n.x+o.width*r[0]:0===r[0]?l=n.x+.5*n.width-.5*o.width:r[0]>0&&(l=n.x+2*n.width*r[0]),l+=a[0],l+o.width>this.sW-e?l=this.sW-e-o.width:l<e&&(l=e),h+=a[1],i.style.left=l,i.style.top=h}else i.style.display="none"}}))}refreshPage(){window.location.reload()}crashLinkTrigger(e){let t=window.location.search.match(/[a-zA-Z0-9=]+/g);if(t){let e="?";t.forEach((t=>{let i=t.split("=");"dlimit"===i[0]?e+=i[0]+"="+(parseInt(i[1])+1)+"&":e+=t+"&"})),window.location.search=e}else window.location.search="?dlimit=1"}guiToggleVisibility(e=null){if(e=null===e?!this.hudVisibility:e,this.hudVisibility=e,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),e){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){let e=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=e}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=e?"grid":"none")}cssBuildClasses(){let e=document.createElement("style");e.type="text/css",e.innerHTML="\n\t\t\t.fader{\n\t\t\t\ttransition: opacity .8s, filter .8s;\n\t\t\t}\n\t\t\t.visOn{\n\t\t\t\tfilter:alpha(opacity=100);\n\t\t\t\topacity:1.0;\n\t\t\t}\n\t\t\t.visOff{\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0.0;\n\t\t\t}\n\t\t",document.getElementsByTagName("head")[0].appendChild(e)}prepPromptFader(e,t=!1){let i=e;"string"==typeof i&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){var r;"string"==typeof e&&(e=document.getElementById(e)),e&&(e.hasOwnProperty("gui")&&(e=e.gui),(null==(r=e.classList)?void 0:r.value.indexOf("fader"))<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!==i&&e.setAttribute("fadeOut",1e3*i))}),50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{let t=e.parentNode;t&&t.removeChild(e)}))})):setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)))}buildConsole(){let e=document.createElement("div");e.id="consoleBlock",e.classList.add("consoleBlockStyle"),this.addToContainer(e),this.guiWindows.consoleBlock={active:!1,gui:e}}buildMessageBlock(e,t="Info"){let i=document.createElement("div");this.msgCount++,i.id="messageBlock-"+this.msgCount,i.classList.add("messageBlockStyle"),i.classList.add("message"+t);let s=this,r=document.createElement("div");r.classList.add("messageCloseBtn"),r.innerHTML="X",r.addEventListener("click",(function(){s.removeMessage(i)}));let a=document.createElement("div");a.classList.add("messageTopBarStyle");let n=document.createElement("div");n.classList.add("messageHeaderStyle"),n.innerHTML=t,a.appendChild(n),a.appendChild(r),i.appendChild(a);let o=document.createElement("div");return o.classList.add("messageContentStyle"),o.innerHTML=e,i.appendChild(o),i}print(e){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));let t=this.guiWindows.consoleBlock.gui,i=this.buildMessageBlock(e);t.appendChild(i)}buildHudBlock(){if(!this.buildGuiStatus.hud)return;let e=document.createElement("div");e.id="hudBlock",e.classList.add("hudBlockStyle"),this.hudBlock.obj=e,this.addToContainer(this.hudBlock.obj),this.hudBlock.obj.style.display="none";let t=this;this.hudBlock.obj.addEventListener("click",(e=>{t.toggleHudBlock(!1,!0)}))}toggleHudBlock(e=null,t=!1){if(!this.hudBlock)return;e=null===e?!this.hudBlock.active:e,this.hudBlock.active=e;let i=!1;e?i="inline-block":this.checkOpenWindows(t)||(i="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&!1!==i&&(this.hudBlock.obj.style.display=i)}checkOpenWindows(e=!1){let t=Object.keys(this.guiWindows),i=!1;return t.forEach((t=>{["container","failState","chatBoxGui"].includes(t)||(e&&(this.guiWindows[t].button&&this.flipIcon(this.guiWindows[t].button,!1),this.guiWindows[t].gui&&this.guiWindows[t].active&&(this.guiWindows[t].active=!1,this.promptFader(this.guiWindows[t].gui,!1),"settingsGui"===t&&this.togglePxlNavDataDisplay(!1))),i=i||this.guiWindows[t].active)})),i}checkFocus(e=null,t=null){!0===t&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(this.mobile||!this.buildGuiStatus.userTopBar)return;let e=document.createElement("div");e.id="hud_topBar",e.classList.add("hud_topBarBlockStyle"),this.hudTopBar=e,this.addToContainer(this.hudTopBar);let t,i="";i='<div id="statsIcon"></div>',i+='</div>\n\t\t<div id="usersIconParent">\n\t\t\t<div id="usersIcon"></div>',t='\n\t\t\t<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>\n\t\t\t<div id="hud_topBarParent" class="hud_topBarParentStyle">\n\t\t<div id="statsIconParent">\n\t\t\t<div id="statsIcon"></div></div>\n\t\t<div id="usersIconParent">\n\t\t\t<div id="usersIcon"></div>\n\t\t</div>\n\t\t<div  class="hud_topBarVSpacerStyle"></div>\n\t\t\t</div>\n\t\t',e.innerHTML=t,this.hudIcons.statsIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_stats.svg`,"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally((()=>{})),this.hudIcons.usersIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_user.svg`,"usersIcon","users");let s=document.createElement("div");s.id="hud_pxlNavData",s.classList.add("hud_pxlNavDataParentStyle"),e.appendChild(s),this.pxlNavData.gui=s;let r=document.createElement("div");r.id="hud_pxlNavData",r.classList.add("hud_pxlNavDataStyle"),s.appendChild(r),t='\n      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>\n      <div class="hud_pxlNavData_UL gui_boldText">↑</div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>\n      <div class="hud_pxlNavData_DL gui_boldText">↓</div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>\n    ',r.innerHTML=t,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];let e=document.createElement("div");e.classList.add("userControlBlockStyle"),this.addToContainer(e),this.userControlBlock.gui=e,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){let e=document.createElement("div");e.id="hud_medalionBar",e.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=e,this.addToContainer(this.hudMedalionBar);let t=`\n        <div id="medalionIconParent" class="hud_speakerIconStyle">\n          <div id="medalionIcon"></div>\n        </div>\n        <div id="medalionTitle" class="medalionTitleStyle">${this.branding.title}</div>\n      `;this.hudMedalionBar.innerHTML=t;let i=document.getElementById("medalionIcon"),s=document.getElementById("medalionTitle");i.addEventListener("mouseover",(()=>{s.classList.add("medalionTitleGrowStyle")})),i.addEventListener("mouseout",(()=>{s.classList.remove("medalionTitleGrowStyle")})),this.hudIcons.medalionIcon=Ks.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(!this.buildGuiStatus.bottomBar)return;let e=document.createElement("div");e.id="hud_bottomBar",e.classList.add("hud_bottomBarStyle"),this.hudBottomBar=e,this.addToContainer(this.hudBottomBar);let t="";if(t+='\n    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">\n        <div id="settingsIconParent" class="hud_settingsIconStyle">\n          <object id="settingsIcon"></object>\n        </div>\n  <div></div>\n        <div id="helpIconParent" class="hud_helpIconStyle">\n          <object id="helpIcon"></object>\n        </div>\n        ',!this.mobile&&this.buildGuiStatus.verseList&&(t+='<div class="hud_usersIconStyle">\n            <div id="multiverseIcon"></div>\n          </div>\n          <div></div>'),t+="</div>",this.mobile||(t+='\n        <div class="hud_micCamIconsBlockStyle">\n          <div id="speakerIconParent" class="hud_speakerIconStyle">\n            <div id="speakerIcon"></div>\n          </div>\n          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">\n            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="speakerChoiceIconParent">\n              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="micIconParent" class="hud_micIconStyle">\n            <div id="micIcon"></div>\n          </div>\n          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">\n            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="micChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="camIconParent" class="hud_camIconStyle">\n            <div id="camIcon"></div>\n          </div>\n          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">\n            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="camChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n        </div>\n\n        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">\n          <div class="guiVerseHudTitle">\n            <span id="guiVerseTitle"></span>\n          </div>\n          <div></div>\n          <div id="chatIconParent" class="hud_chatIconStyle">\n            <div id="chatIcon"></div>\n          </div>\n          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>\n        </div>\n      '),this.hudBottomBar.innerHTML=t,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_chat.svg`,"chatIcon","chat"),this.mobile||this.pxlAutoCam.enabled){let e=document.getElementById("hud_chatIconBlock");e.style.gridAutoColumns="max-content max-content auto max-content",e.style.margin="0px 10px"}else this.hudIcons.multiverseIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_multiverse.svg`,"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_ProxAudio.svg`,"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_mic.svg`,"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_camera.svg`,"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_help.svg`,"helpIcon","help"),this.hudIcons.settingsIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_settings.svg`,"settingsIcon","settings")}prepArtistInfo(e=null){var t;if(null!=(t=this.pxlEnv)&&t.postIntro&&""!==e){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let t=document.createElement("div");t.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=t;let i=document.createElement("div");i.classList.add("hud_aristInfoButtonStyle"),t.appendChild(i);let s=this;i.onclick=()=>{s.toggleArtistInfo()},this.hudElements.artistInfo.button=i;let r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",i.appendChild(r),this.hudElements.artistInfo.buttonText=r;let a=document.createElement("div");a.classList.add("hud_aristInfoCarrotXStyle"),a.id="artistInfoCarrotX",i.appendChild(a);let n=document.createElement("div");n.classList.add("hud_aristInfoInner"),n.innerHTML=e,t.appendChild(n),this.hudElements.artistInfo.inner=n,this.addToContainer(t),this.hudElements.artistInfo.closeSvg=Ks.svgPromise(`${this.guiRoot}global/carrotClose_animated.svg`,"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally((()=>{this.artistInfoButtonPrep()}))}this.toggleArtistInfo(!1),null!==e&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(e=0){let t=this.hudElements.artistInfo.closeSvg.svg;if(t){let i=t.getElementById("carrotToClone_on"),s=t.getElementById("carrotToClone_off");i&&s?(this.hudElements.artistInfo.onAnim=i,this.hudElements.artistInfo.offAnim=s):2===e||setTimeout((()=>{this.artistInfoButtonPrep(e+=1)}),100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(e=null){e=null===e?!this.hudElements.artistInfo.active:e,this.hudElements.artistInfo.active=e;let t=this.hudElements.artistInfo.innerHeight,i=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let a=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":a+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(e=null){var t;if(null!=(t=this.pxlEnv)&&t.postIntro&&""!==e){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let t=document.createElement("div");t.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=t;let i=document.createElement("div");i.classList.add("hud_aristInfoButtonStyle"),t.appendChild(i);let s=this;i.onclick=()=>{s.togglePageDisplay()},this.hudElements.artistInfo.button=i;let r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",i.appendChild(r),this.hudElements.artistInfo.buttonText=r;let a=document.createElement("div");a.classList.add("hud_aristInfoCarrotXStyle"),a.id="artistInfoCarrotX",i.appendChild(a);let n=document.createElement("div");n.classList.add("hud_aristInfoInner"),n.innerHTML=e,t.appendChild(n),this.hudElements.artistInfo.inner=n,this.addToContainer(t)}this.togglePageDisplay(!1),null!==e&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(e=null){var t;if(this.hudElements.artistInfo){e=null===e?!this.hudElements.artistInfo.active:e,null!=(t=this.hudElements)&&t.artistInfo&&(this.hudElements.artistInfo.active=e);let i=this.hudElements.artistInfo.innerHeight,s=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),r=this.hudElements.artistInfo.baseHeight,a=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?s+"px":a+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let n=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":n+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(e,t,i=null){if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),"click"===e)switch(i){case"chat":this.toggleChatBox();break;case"musicToggle":this.pxlAudio.djPlayerMuteToggle(),this.toggleIcon(t,!this.pxlAudio.djMuted,!0);break;case"userSpeakerToggle":this.setUserControls(t);break;case"speakerToggle":this.toggleIcon(t,!1,!0);break;case"speakerChoice":let e="audiooutput";this.flipIcon(t,this.guiWindows[e]&&this.guiWindows[e].active);break;case"help":let i=!!this.guiWindows.helpGui&&this.guiWindows.helpGui.active;this.checkOpenWindows(!0),this.helpGuiToggle(!i);break;case"info":let s=!!this.guiWindows.infoGui&&this.guiWindows.infoGui.active;this.checkOpenWindows(!0),this.infoGuiToggle(!s);break;case"settings":let r=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active;this.checkOpenWindows(!0),this.settingsGuiToggle(!r);break;case"userProfile":this.toggleUserProfile()}}setMicVolumeLevel(e){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);let t=12-11*e;this.hudIcons.micIcon.volumeMask.setAttribute("y",t)}toggleIcon(e,t,i=!1){if(e){if(e.mute.style.filter=t?"alpha(opacity=0)":"alpha(opacity=100)",e.mute.style.opacity=t?"0":"1",e.mute.style.transform=t?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(e.eventType))return;let s={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[e.eventType];s&&i&&this.loadingDeviceChange(s,t)}}flipIcon(e,t){e.caret.style.transform=`rotate( ${t?"180deg":"0deg"} )`}loadingDeviceChange(e,t=!0){let i=null;"speaker"===e?i=this.hudIcons.speakerIcon:"audio"===e?i=this.hudIcons.micIcon:"video"===e&&(i=this.hudIcons.camIcon),i.indicator.style.display=t?"inline-block":"none",i.indicator.style.animationPlayState=t?"running":"paused",i.waiting.forEach((e=>{e.setAttribute("fill-opacity",t?".5":"1")})),t&&setTimeout((()=>{this.loadingDeviceChange(e,!1)}),1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";let e='\n          <audio id="djStream" playsinline muted>\n            <source src="'+this.pxlAudio.djUrlSource+'"></source>\n          </audio>\n          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>\n              <td align="left">\n                  <div id="djPlayerVol"></div>\n              </td><td valign="center" align="left" width=100%>\n                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>\n              </td></tr>\n          </tbody></table>';this.djPlayerObj.innerHTML=e,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=Ks.svgIconPromise(`${this.guiRoot}icons/icon_music.svg`,"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(e,t){this.activeItem.innerHTML=t,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout((()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"}),1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),this.addToContainer(this.activeItem)}updateGuiPositions(){if(this.loading){let e=this.radioControls.length,t=!1;for(let i=0;i<e;++i){if(!this.radioControls[i][3]){t=!0;break}let e=this.radioControls[i][0],s=this.radioControls[i][2].getBoundingClientRect(),r=s.width+2*this.buttonPadding,a=s.height+2*this.buttonPadding,n=s.top-this.buttonPadding,o=s.left-this.buttonPadding;e.style.width=r,e.style.height=a,e.style.top=n,e.style.left=o,this.radioControls[i][1].style.width=r,this.radioControls[i][1].style.height=a,this.radioControls[i][1].style.top=n,this.radioControls[i][1].style.left=o}this.loading=t}}togglGuiWindow(e=null,t=!1){"helpGui"===e?this.helpGuiToggle(t,!1):"infoGui"===e?this.infoGuiToggle(t,!1):"settingsGui"===e&&this.settingsGuiToggle(t,!1)}svgCheckClick(e=null,t=null){if(t){if("close"===t)return void this.toggleGuiWindowContainer(null,!1,!0);if("ft1"===t)return;if("ft2"===t)return;if("ft3"===t)return void this.toggleInviteUser();if("ft4"===t)return;if("ft5"===t)return void this.pxlAutoCam.toggleAutoCam()}}svgStylize(e=null,t=!1){if(!e)return;let i=e.path?e.path[1]:e.target.parentNode,s=i.getElementById("state");if(s){let e=t?"white":"none";s.setAttribute("fill",e)}let r=i.getElementById("hover");r&&r.setAttribute("fill","white")}renderQualitySettings(e){this.pxlQuality.percent=e,this.pxlQuality.screenResPerc=.75*e+.25,this.pxlQuality.mapAutoQualityUpdate(e,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){var e;this.pxlNavData.active&&null!=(e=this.pxlNavData)&&e.fps&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){var e,t;let i=document.createElement("div");i.classList.id="guiWindowBackground",i.classList.add("guiWindowBackground"),i.classList.add("fader"),i.classList.add("visOff"),i.style.display="none";let s=this;i.onclick=e=>{s.toggleGuiWindowContainer(e,!1,!0)},this.guiWindowBG=i,null!=(t=null==(e=this.guiWindows)?void 0:e.container)&&t.gui?this.guiWindows.container.gui.appendChild(i):document.body.appendChild(i)}toggleGuiWindowContainer(e,t,i=!1){if(e){let t=(e.path?e.path[0]:e.target).getAttribute("id");if("guiWindowBackground"!==t&&!["pxlNav-container","pxlnav-react-container","pxlnav-next-container","gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(t))return null}let s=this.checkOpenWindows(i);this.guiWindowBG&&s===t&&this.promptFader(this.guiWindowBG,t,null,!1),t?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){var e,t,i;this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;let s=document.createElement("div");s.id="gui_helpGuiWindow",s.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(s),this.guiWindowBG.appendChild(s);let r="",a="";if(""!==(null==(e=this.pxlOptions.onboarding.pc)?void 0:e.message)){r=this.pxlOptions.onboarding.pc.message,r=this.formatWelcomeMessage(r);let e="";this.pxlOptions.onboarding.pc.messageStyle.length>0&&(e=this.pxlOptions.onboarding.pc.messageStyle.join(" ")),a=`<div class="${e}" id="guiWelcomeMessage">${r}</div>`}let n="close",o="guiButton";""!==(null==(t=this.pxlOptions.onboarding.pc)?void 0:t.buttonText)&&(n=this.pxlOptions.onboarding.pc.buttonText),(null==(i=this.pxlOptions.onboarding.pc)?void 0:i.buttonStyle.length)>0&&(o=this.pxlOptions.onboarding.pc.buttonStyle.join(" "));let l="";l+=`\n      <div id="gui_helpContent" class="gui_contentStyle">\n      ${a}\n    <div class="gui_body">\n      <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">\n      <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>\n      <div class="gui_helpGui_ASDWorUDLR">\n        <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>\n        <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>\n        <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>\n      </div>\n      <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">WASD</span> or<br><span class="gui_boldText">ARROWS</span> keys to move around</div>\n      </div>\n      <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">\n      <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>\n      <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>\n      <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>\n      </div>\n    </div>\n    <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">\n            You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings (G)</span> <span id="gui_helpGui_settingIcon"></span> menu\n            <br> To show this screen again, open the <span class="gui_boldText">Help (H)</span> screen\n            <br> For additional info, see the <span class="gui_boldText">Info (I)</span> screen\n          </div>\n    <div id="guiHelpFooter" class="gui_footer">\n      <div class="${o}" id="guiHelpBackButton">${n}</div>\n    </div>\n    <div class="gui_spacer"></div>\n      </div>\n    `,s.innerHTML=l,[[this.guiRoot+"keyboard_asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard_udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse_outline.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach((e=>{Ks.svgButtonPromise(...e)}));let h=this,c=document.getElementById("guiHelpBackButton");c&&(c.onclick=e=>{h.introHelpActive&&(h.introHelpActive=!1,h.pxlEnv.postHelpIntro()),h.svgCheckClick(e,"close")});let d=document.getElementById("gui_helpGui_settingIcon");d&&this.hudIcons.settingsIcon&&(d.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,d.style.position="relative",d.style.top="7.3px",d.style.width="30px",d.style.padding="2px",d.style.cursor="pointer",d.children[0].style.height="26px",d.onclick=()=>{h.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=s,setTimeout((()=>{this.resize()}),50)}helpGuiToggle(e=null,t=!0){this.guiWindows.helpGui||this.helpGuiBuild(),e=null===e?!this.guiWindows.helpGui.active:e,this.guiWindows.helpGui.active=e,this.promptFader(this.guiWindows.helpGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.promptFader(this.guiWindows.container,!0),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout((()=>{this.resetHelpTextPlacement()}),20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;let e=document.createElement("div");e.id="gui_infoGuiWindow",e.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="";t+=`\n    <div id="gui_infoContent" class="gui_contentInfoStyle">\n  <div class="gui_infoBody">\n    <div id="gui_infoGuiParent" class="gui_infoGuiParent">\n    <br>${this.projectTitle}\n    <br>&nbsp;&nbsp; Created by <a href="https://github.com/ProcStack" target="_blank">Kevin Edzenga / ProcStack</a> 2024; 2025\n    <br>\n    <br>If any bugs are found in pxlNav, you can share them on the GitHub issues page:\n    <br>&nbsp;&nbsp; <a href="https://github.com/ProcStack/pxlNav/issues" target="_blank">pxlNav / issues</a>\n    <br>\n    </div>\n  </div>\n\n  <div id="guiInfoFooter" class="gui_footer">\n    <div class="guiButton" id="guiInfoBackButton">close</div>\n  </div>\n    </div>\n  `,e.innerHTML=t;let i=this;document.getElementById("guiInfoBackButton").onclick=e=>{i.svgCheckClick(e,"close")},this.guiWindows.infoGui.gui=e}infoGuiToggle(e=null,t=!0){this.guiWindows.infoGui||this.infoGuiBuild(),e=null===e?!this.guiWindows.infoGui.active:e,this.guiWindows.infoGui.active=e,this.promptFader(this.guiWindows.infoGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){}settingsGuiBuild(){this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;let e=document.createElement("div");e.id="gui_settingsGuiWindow",e.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="Default";t=t||"";let i='\n    <div id="gui_settingsContent" class="gui_contentSettingsStyle">\n  <div class="gui_settingsBody">\n    <div class="gui_settingsParentGrid">\n    ';this.settingsFields.changeUsername&&(i+=`\n        \x3c!-- -- Username -- -- --\x3e\n        <div class="cellMargin settings_icon" id="settings_user"></div>\n        <div class="settings_optionHeader">Username</div>\n        <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">\n            <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">\n              <input type="text" placeholder="Set your username" value="${t}" id="settings_usernameInput" class="settings_usernameInput"></input>\n              <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">\n            </div>\n            <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>\n        </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      `),i+='\n      \x3c!-- -- Left/Right -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_left_right"></div>\n    <div class="settings_optionHeader">Left/Right</div>\n    <div class="settings_radio" id="settingsRadioBlock_leftRight">\n      <span>\n      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>\n      <label for="settings_tankTurning">Turn</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>\n      <label for="settings_strafing">Strafe</label>\n      </span>\n    </div>\n      \x3c!-- -- Mouse -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_mouse"></div>\n    <div class="settings_optionHeader">Mouse Looking</div>\n    <div class="settings_radio" id="settingsRadioBlock_mouse">\n      <span>\n      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>\n      <label for="settings_dragLooking">Native</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>\n      <label for="settings_pointLooking">Inverted</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n    <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- Graphics Quality -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_graphics"></div>\n    <div class="settings_optionHeader">Graphics Quality</div>\n    <div class="settings_radio" id="settingsRadioBlock_graphics">\n      <span>\n      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>\n      <label for="settings_graphicsQuality_low">Low</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>\n      <label for="settings_graphicsQuality_med">Medium</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>\n      <label for="settings_graphicsQuality_high">High</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>\n      <label for="settings_graphicsQuality_custom">Custom</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- --\x3e\n      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_render"></div>\n      <div class="settings_optionHeader">Render Resolution</div>\n      <div class="settings_radio" id="settingsRadioBlock_resolution">\n      <span>\n        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>\n        <label for="settings_render_25">25%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>\n        <label for="settings_render_50">50%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>\n        <label for="settings_render_75">75%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>\n        <label for="settings_render_100">100%</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_fog"></div>\n      <div class="settings_optionHeader">Fog Quality</div>\n      <div class="settings_radio" id="settingsRadioBlock_fog">\n      <span>\n        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>\n        <label for="settings_noRedFog">Low</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>\n        <label for="settings_cheapResFog">Medium</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>\n        <label for="settings_highResFog">High</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_bloom"></div>\n      <div class="settings_optionHeader">Bloom Effects</div>\n      <div class="settings_radio" id="settingsRadioBlock_bloom">\n      <span>\n        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>\n        <label for="settings_noBloom">Off</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>\n        <label for="settings_bloomActive">On</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      </div>\n    </div>\n      <div class="settingsGridSpan settingsEmptySpacer"></div>\n    </div>\n    <div class="guiSettingsFooterButtons">\n    <div class="guiButton" id="guiSettingsBackButton">close</div>\n    </div>\n  </div>\n    </div>\n  ',e.innerHTML=i,this.guiWindows.settingsGui.gui=e;let s=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider"),document.getElementById("guiSettingsBackButton").onclick=e=>{s.svgCheckClick(e,"close")},[[this.guiRoot+"settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach((e=>{Ks.svgButtonPromise(...e)}));let r,a,n=document.getElementById("settings_usernameInput");if(n){n.onkeyup=e=>{s.keyUsernameSet(e)},n.onkeydown=e=>{s.keyDownUsernameSet(e)},this.guiWindows.settingsGui.usernameInput=n,document.getElementById("settings_sendUsername").addEventListener("click",(()=>{s.sendUsernameUpdate(n)}));let e=document.getElementById("settings_usernameResponseMessage");e&&(this.guiWindows.settingsGui.usernameReturn=e)}this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),r=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=parseInt(i.value);i.addEventListener("change",(e=>{s.pxlQuality.setQualityLevel(n),s.setRadioValues()}))}r=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=parseFloat(i.value);i.addEventListener("change",(e=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({resolution:n}),s.pxlQuality.setQualityCookie(3)}))}r=["settings_noRedFog","settings_cheapResFog","settings_highResFog"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=i.value;i.addEventListener("change",(e=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({fog:n}),s.pxlQuality.setQualityCookie(3)}))}r=["settings_noBloom","settings_bloomActive"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=1===i.value;i.addEventListener("change",(e=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({bloom:n}),s.pxlQuality.setQualityCookie(3)}))}r=["settings_tankTurning","settings_strafing"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=1===i.value;i.addEventListener("change",(e=>{s.pxlQuality.setGraphicsSettings({leftRight:n},null)}))}r=["settings_dragLooking","settings_pointLooking"],a=r.length;for(let e=0;e<a;++e){let t=r[e],i=document.getElementById(t);this.setRadioStyle(i,e,a);let n=1===i.value;i.addEventListener("change",(e=>{s.pxlQuality.setGraphicsSettings({mouse:n},null)}))}this.setRadioValues()}setRadioStyle(e,t,i){let s="settings_radio_label_mid";0===t?s="settings_radio_label_start":t===i-1&&(s="settings_radio_label_end"),e.parentNode.children[1].classList.add(s)}setRadioValues(){let e=this.pxlQuality.settings;Object.keys(e).forEach((t=>{let i=document.getElementById("settingsRadioBlock_"+t);if(i){let s="resolution"===t?4*e[t]-1:~~e[t];i.children[s].children[0].checked=!0}}))}settingsGuiAdvObjSizing(e=!0){let t=this.guiWindows.settingsGui.advObj,i=t.offsetHeight;t.style.maxHeight=(e?i:0)+"px",t.setAttribute("maxHeight",i)}settingsGuiToggle(e=null,t=!0){var i,s;this.guiWindows.settingsGui||this.settingsGuiBuild(),(e=null===e?!this.guiWindows.settingsGui.active:e)&&null!=(s=null==(i=this.guiWindows)?void 0:i.settingsGui)&&s.usernameReturn&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=e,this.promptFader(this.guiWindows.settingsGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.toggleHudBlock(e,!1),this.togglePxlNavDataDisplay(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(e=null){var t;null===e&&(e=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active),this.pxlNavData.active=e;let i=this.pxlNavData.height||200;null!=(t=this.pxlNavData)&&t.gui&&(this.pxlNavData.gui.style.maxHeight=e?i+"px":"0px",e||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight))}renderRadius(e){this.pxlEnv.mapGlowPass.strength=Number(e),this.pxlEnv.roomBloomPass.strength=Number(e)}renderThreshold(e){this.pxlEnv.mapGlowPass.threshold=Number(e),this.pxlEnv.roomBloomPass.threshold=Number(e)}renderGlowRadius(e){this.pxlEnv.mapGlowPass.radius=Number(e),this.pxlEnv.roomBloomPass.radius=Number(e)}renderResolution(e){this.pxlQuality.screenResPerc=.75*e+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;let e=document.createElement("div");e.id="gui_inviteUserWindow",e.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(e),this.addToContainer(e);let t=window.location+"";t=t.replace(/^https?:\/\//,"");let i="";i+=`\n        <div class="gui_inviteUserBody">\n          <div class="iu_urlStyle">${t}</div>\n          <div id="iu_copy" class="iu_copyStyle">Copy</div>\n        </div>\n    `,e.innerHTML=i;let s=this.pxlUtils,r=document.getElementById("iu_copy");r.addEventListener("click",(()=>{s.copyRoomUrl()?r.innerText="Copied":r.innerText="Error",r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout((()=>{r.innerText="Copy",clearTimeout(r.timeout)}),2e3)})),this.guiWindows.inviteUserGui.gui=e}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){let e=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=e.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-e.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=e.height}}toggleInviteUser(e=null){this.guiWindows.inviteUserGui||this.inviteUserBuild(),e=null===e?!this.guiWindows.inviteUserGui.active:e,this.guiWindows.inviteUserGui.active=e,this.promptFader(this.guiWindows.inviteUserGui.gui,e),this.inviteUserPosition()}formatWelcomeMessage(e){let t=this.projectTitle;return e.replace(/%projectTitle%/g,t)}buildMobileWelcome(){var e,t,i,s;this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;let r=document.createElement("div");r.id="gui_mobileWelcomeGuiWindow",r.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(r),this.guiWindowBG.appendChild(r);let a="",n="";if(""!==(null==(e=this.pxlOptions.onboarding.mobile)?void 0:e.message)){a=this.pxlOptions.onboarding.mobile.message,a=this.formatWelcomeMessage(a);let e="";(null==(t=this.pxlOptions.onboarding.mobile)?void 0:t.messageStyle.length)>0&&(e=this.pxlOptions.onboarding.mobile.messageStyle.join(" "),e=`class="${e}"`),n=`<div id="gui_mobileWelcomeMessage" ${e}>${a}</div>`}let o="guiButton";(null==(i=this.pxlOptions.onboarding.mobile)?void 0:i.buttonStyle.length)>0&&(o=this.pxlOptions.onboarding.mobile.buttonStyle.join(" "));let l="enter";""!==(null==(s=this.pxlOptions.onboarding.mobile)?void 0:s.buttonText)&&(l=this.pxlOptions.onboarding.mobile.buttonText);let h="";h+=`\n    <div id="gui_helpContent" class="gui_contentStyle">\n  <div class="pxlGui-mobile-body">\n    ${n}\n  </div>\n  <div id="gui_helpGui_hotKeys" class="gui_helpGui_mobileHud">\n    Tap-&-Drag the <span class="gui_boldText">Left Circle</span> to move you,\n    <br>The <span class="gui_boldText">Right Circle</span> to look around;\n    <br>\n    <br> Tap the <span class="gui_boldText">upper</span> half of the screen to jump\n    <br>\n    <br> If the screen is black behind this message,\n    <br> Please <span id="refeshPxlPage">refresh</span> the page\n  </div>\n  <div id="guiHelpFooter" class="gui_footer">\n    <div class="${o}" id="guiMobileWelcomeButton">${l}</div>\n  </div>\n  <div class="gui_spacer"></div>\n    </div>\n  `,r.innerHTML=h;let c=document.getElementById("refeshPxlPage");c&&(c.onclick=e=>{e.preventDefault(),this.refreshPage()});let d=this;document.getElementById("guiMobileWelcomeButton").onclick=e=>{d.toggleMobileWelcome(!1),d.pxlEnv.postHelpIntro(),d.promptFader(this.guiWindowBG,!1,null,!1),this.pxlDevice.requestFullScreen()},this.guiWindows.mobileGui.gui=r}toggleMobileWelcome(e=null){this.guiWindows.mobileGui||this.buildMobileWelcome(),null===e||this.guiWindows.mobileGui.active!==e?(e=null===e?!this.guiWindows.mobileGui.active:e,this.guiWindows.mobileGui.active=e,e?this.promptFader(this.guiWindows.mobileGui.gui,e):this.promptFader(this.guiWindows.mobileGui.gui,e,null,!0),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e)):console.error("Mobile welcome already set to active: "+e)}ctaBuildPopup(e=""){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.cta).then((e=>{this.ctaContentLoading=!1,this.googleDocHTML=e,this.ctaDisplayPopup()}))))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);let e=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");let t=document.createElement("div");t.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(t),this.addToContainer(this.actionPopUp);let i=null;""!==e&&e?(t.innerHTML=e,t.classList.add("iframeGoogleLinkDoc")):(i=document.createElement("iframe"),i.src="",i.classList.add("iframeGoogleLinkDoc"),t.appendChild(i),i.referrerpolicy="unsafe-url");let s=this;this.actionPopUp.onclick=function(e){"ctaPopup"===e.srcElement.getAttribute("id")&&(s.promptFader(this,!1,null,!0),s.actionPopUp=null)},i?i.onload=function(){setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}:setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}getUserControls(e){if(!e)return[null];let t=e,i=t.userStatusGui,s=t.audio,r=t.audioMuted,a=t.userSoundGui;return{curAvatar:t,curName:t.displayName,curAudio:s,curAudioMuted:r,curGui:i,curNameGui:t.userNameGui,curAudioGui:a,curVerse:t.verse}}async setUserControlPosition(){if(this.userControlBlock){let e=0;if(this.hudTopBar){let t=this.hudTopBar.getBoundingClientRect();e=t.y+t.height}this.userControlBlock.gui.style.top=e+"px"}}buildUserSpeaker(){let e={},t=this.userControlBlock.speakerIcon.svg.cloneNode(!0);t.classList.add("userControlSpeakerStyle"),t.classList.add("userControlSpeakerButtonStyle"),e.gui=t,e.remoteMuted=!1,e.volPrev=0;let i=t.children;for(let t=0;t<i.length;++t){let s=i[t],r=s.getAttribute("id");e[r]=s,"mute"===r?s.classList.add("userControlVisStyle"):"button"===r&&s.classList.add("userControlSpeakerButtonStyle")}let s=e.volLines.children;for(let t=0;t<s.length;++t){let i=s[t];e[i.getAttribute("id")]=i}s=e.remoteMutedLines.children;for(let t=0;t<s.length;++t){let i=s[t];e[i.getAttribute("id")]=i}return e}async addUserControls(e,t=!1){let{curAvatar:i,curName:s}=this.getUserControls(e),r=document.createElement("div");r.classList.add("userControlProximityOff"),r.classList.add("userControlParentStyle"),r.classList.add("userControlSpeakerButtonStyle"),this.mobile&&(r.style.display="none");let a=this;r.onclick=()=>{a.setUserControlMute(e)},i.userStatusGui=r,this.userControlBlock.gui.appendChild(r);let n=document.createElement("div");n.classList.add("userControlInnerParentStyle"),r.appendChild(n);let o=document.createElement("div");o.classList.add("userControlSpeakerParentStyle");let l=this.buildUserSpeaker();o.appendChild(l.gui),i.userSoundGui=l,n.appendChild(o);let h=document.createElement("div");h.classList.add("userControlNameStyle"),h.innerText=s,i.userNameGui=h,n.appendChild(h),this.setUserControlColor(e)}async setUserControlVolume(e,t,i=!0){if(this.userControlBlock.activeList.includes(e)){let{curAudioGui:s,curAudioMuted:r}=this.getUserControls(e);s&&(!r||0===t)&&(s.remoteMuted?t=0:i&&t>0&&(t*=2,t=Math.min(1,Math.max(t,.5*(t+s.volPrev)))),s.volPrev=t,s.volLines.style.opacity=t,s.volLines.style.filter="alpha(opacity="+100*t+")")}}async setUserControlMute(e){let{curAvatar:t,curAudio:i,curAudioMuted:s,curAudioGui:r}=this.getUserControls(e);if(i){let a=!s;a?(this.setUserControlVolume(e,0,!1),r.mute.classList.add("userControlVisible"),i.volume=0,i.muted=!0):(r.mute.classList.remove("userControlVisible"),i.muted=!1,i.volume=1),t.audioMuted=a}}async setUserControlRemoteMute(e,t=null,i=!0,s="#ffffff"){let{curAudio:r,curAudioGui:a}=this.getUserControls(e);if(a){null===t&&(t=!!r&&r.muted);let n="object"==typeof t?t.muted:t;a.remoteMuted=n,a.base.setAttribute("fill",n?"#ff0000":s),a.remoteMutedLines.style.display=n||!i?"inline-block":"none",a.remoteS1.setAttribute("stroke",i?"#ff0000":s),a.remoteS2.setAttribute("stroke",i?"#ff0000":s),this.setUserControlVolume(e,0,!1)}}async setUserControlVis(e,t=null,i=!1){let{curGui:s}=this.getUserControls(e);if(s){let i="userControlProximityOff";if(null===t&&(t=!s.classList.contains(i)),t)s.classList.remove(i),s.style.maxWidth=s.children[0].getBoundingClientRect().width+"px",this.setUserControlVolume(e,0),this.userControlBlock.activeList.includes(e)||this.userControlBlock.activeList.push(e);else{s.classList.add(i),s.style.maxWidth="30px";let t=this.userControlBlock.activeList.indexOf(e);t>-1&&this.userControlBlock.activeList.splice(t,1)}this.userControlBlock.gui.style.padding=0===this.userControlBlock.activeList.length?"0px":"5px"}}async deleteUserControlVis(e){let{curGui:t}=this.getUserControls(e);if(t){t.classList.add("userControlProximityOff"),t.style.maxWidth="30px";let i=this.userControlBlock.activeList.indexOf(e);i>-1&&this.userControlBlock.activeList.splice(i,1),this.userControlBlock.gui.style.padding=0===this.userControlBlock.activeList.length?"0px":"5px",t&&t.parentNode.removeChild(t)}}userControlsSwap(e,t){let i=this.userControlBlock.activeList.indexOf(e);i>-1&&(this.userControlBlock.activeList.splice(i,1),this.userControlBlock.activeList.includes(t)||this.userControlBlock.activeList.push(t))}setUserControlColor(e,t=null){let{curAvatar:i,curGui:s,curAudioGui:r,curVerse:a}=this.getUserControls(e);null===t&&(t="#ffffff"),s.style.color=t,r.base.setAttribute("fill",t),r.mute.setAttribute("stroke",t),r.mid.setAttribute("fill",t),r.max.setAttribute("fill",t),r.volPrev=0,r.volLines.style.opacity=0,r.volLines.style.filter="alpha(opacity=0)";let n=this;i.userStatusGui.onclick=()=>{n.setUserControlMute(e)},this.setUserControlRemoteMute(e,null,!0,t)}toggleUserControls(e){if(!e)return null}},Ys=class{constructor(t,i){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=t,this.pxlEnv=t.pxlEnv,this.guiManager=i,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.clickThroughListener=this.clickThroughCheck.bind(this),this.shaderSliderValues=new e.Vector3,this.editorWidthMinMax={min:30,max:70}}addSlider(e,t,i,s,r,a,n,o){"string"==typeof e&&(e=document.getElementById(e));let l=document.createElement("div");l.style.display="grid",l.style.gridAutoFlow="column",l.style.alignItems="center",l.style.gridAutoColumns="max-content auto max-content",l.innerHTML="<div class='input_sliderLabel'>"+t+" : </div>";let h=document.createElement("input");h.type="range",h.classList.add("input_sliderRange"),h.min=s,h.max=r,h.step=a,h.value=i,l.appendChild(h);let c=document.createElement("input");c.type="number",c.classList.add("gui_defaultInput"),c.classList.add("input_numberInput"),c.value=i,l.appendChild(c),c.onchange=e=>{h.value=e.target.value},h.onchange=e=>{c.value=e.target.value,n(e.target.value,...o)},h.oninput=e=>{c.value=e.target.value,n(e.target.value,...o)},e.appendChild(l)}updateShaderTextFields(e=null){let t,i,s,r;e||(e=this.pxlEnv.currentRoom===this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(e,this.shaderSliderValues)}catch(e){return}i=s=r="Unable To Load";try{t.uniforms.sliders={type:"v",value:this.shaderSliderValues},i=JSON.stringify(t.uniforms),s=t.vertexShader,r=t.fragmentShader,i="";for(let e in t.uniforms){let s="float",r={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if(s=typeof t.uniforms[e].value,"object"===s){if(s="",!t.uniforms[e].value)continue;s="image"in t.uniforms[e].value?"sampler2D":s+"vec"+Object.keys(t.uniforms[e].value).length}else r.hasOwnProperty(t.uniforms[e].type)&&(s="i"===t.uniforms[e].type?"i":""),r.hasOwnProperty(t.uniforms[e].type)&&(s=r[t.uniforms[e].type]);i+=`uniform ${s} ${e};   `}s=s.replace(/[\t]/g,"  "),r=r.replace(/[\t]/g,"  ")}catch(e){console.log("Error Reading Shader"),console.log(e)}t&&(t.needsUpdate=!0,this.children.uniformsObj.value=i,this.children.vertObj.value=s,this.children.fragObj.value=r)}buildShaderEditor(){let e="shaderGui",t=document.createElement("div");t.id="guiShaderEditorBlock",t.classList.add("gui_shaderEditorBlockStyle"),t.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(t),this.pxlEnv.pxlGuiDraws.guiWindows[e]={},this.pxlEnv.pxlGuiDraws.guiWindows[e].gui=t,this.pxlEnv.pxlGuiDraws.guiWindows[e].active=!1,this.gui=t;let i=document.createElement("div");i.id="guiShaderHelpBlock",i.classList.add("gui_shaderHelpBlockStyle"),i.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(i),this.pxlEnv.pxlGuiDraws.guiWindows[e].help=i,this.helpGui=i;let s=this.pxlEnv.currentRoom,r=this.pxlEnv.roomSceneList[s].geoList,a=Object.keys(r),n="";a.forEach((e=>{if(["Mesh","Points"].includes(r[e].type)&&"ShaderMaterial"===r[e].material.type){let t=e.substring(0,1).toUpperCase()+e.substring(1,e.length);n+="<option value='geo_"+e+"'>"+t+"</option>"}}));this.pxlEnv.pxlGuiDraws.guiWindows[e].currentShader="script_fog";let o=`\n    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">\n      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">\n      <div class="gui_shaderEditorOptionBlock">\n        <div class="gui_shaderEditorTitleBlock">\n        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">\n            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>\n            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">\n              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>\n              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">\n                <option value="script_avatar" >Avatar</option>\n                <option value="script_fog" selected>Fog</option>\n                <option value="script_dArrows">Direction Arrows</option>\n                <option value="script_userScreens">User Screens</option>\n                <option value="script_warpZonePortals">Warp Zone Portals</option>\n                <option value="script_lizardking">Item; Lizard King</option>\n                <option value="script_majorTom">Item; Major Tom</option>\n                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>\n                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>\n                ${n}\n              </select>\n            </div>\n            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">\n              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>\n              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>\n              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>\n              <span class="gui_shaderEditorOptionBarSpacer"> </span>\n              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>\n            </div>\n          </div>\n        </div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n        <div id="guiShaderUserSliders"></div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n      </div>\n      </div>\n\n      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">\n        <span style='height:12px'>Uniforms -</span>\n        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>\n        <span style='height:12px'>Vertex Shader -</span>\n        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>\n        <span style='height:12px'>Fragment Shader -</span>\n        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>\n      </div>\n      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>\n    </div>\n    `,l="<div class='gui_shaderHelpSpacerStyle'></div>";o+=`\n    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">\n      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>\n      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>\n      ${l}\n      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>\n      ${l}\n      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>\n      ${l}\n    </div>\n    `,t.innerHTML=o,document.body.appendChild(t);let h=document.getElementById("guiShaderUserSliders");this.parentObj=h;let c=this.shaderSliderValues,d=(e,...t)=>{c[t[0]]=e};this.addSlider(h,"sliders.x",0,-1,1,1e-4,d,["x"]),this.addSlider(h,"sliders.y",0,-5,5,.001,d,["y"]),this.addSlider(h,"sliders.z",0,-10,10,.001,d,["z"]),this.children.shaderSliders=h,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");let u=document.getElementById("gui_shaderEditorFontSize");u.style.justifySelf="end",u.style.marginTop="2px",u.style.marginRight="3px",u.style.userSelect="none",u.style.display="flex",u.style.alignItems="center";let A=this;this.children.shaderSelect.onchange=e=>{A.updateShaderTextFields(this.children.shaderSelect.value)},document.getElementById("gui_shaderEditorFontSmaller").onclick=e=>{A.shiftFontSize(-.15)},document.getElementById("gui_shaderEditorFontLarger").onclick=e=>{A.shiftFontSize(.15)},document.getElementById("gui_shaderEditorCloseButton").onclick=e=>{A.toggleShaderEditor()},this.children.updateObj.addEventListener("click",(()=>{this.isEditing=!1;let e=document.getElementById("shaderEditor_uniformInput").value,t=document.getElementById("shaderEditor_vertInput"),i=t.value,s=document.getElementById("shaderEditor_fragInput"),r=s.value,a=document.createElement("div");a.innerHTML=e,e=a.innerText,a.innerHTML=i,i=a.innerText,a.innerHTML=r,r=a.innerText,A.pxlEnv.roomSceneList[A.pxlEnv.currentRoom].setShader(e,i,r),t.blur(),s.blur(),A.guiManager.pxlNavCanvas.focus()})),this.children.vertObj.onfocus=e=>{A.focusShaderMessage(e,"vertObj")},this.children.vertObj.onkeydown=e=>{A.keyShaderMessage(e)},this.children.vertObj.onmousedown=e=>{A.mDownShaderMessage(e)},this.children.vertObj.onclick=e=>{A.clickShaderMessage(e)},this.children.vertObj.ondblclick=e=>{A.dblclickShaderMessage(e)},this.children.fragObj.onfocus=e=>{A.focusShaderMessage(e,"fragObj")},this.children.fragObj.onkeydown=e=>{A.keyShaderMessage(e)},this.children.fragObj.onmousedown=e=>{A.mDownShaderMessage(e)},this.children.fragObj.onclick=e=>{A.clickShaderMessage(e)},this.children.fragObj.ondblclick=e=>{A.dblclickShaderMessage(e)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(e){let t=document.getElementById("gui_shaderEditorParent");if(!t)return;t.hasAttribute("styleStore")||t.setAttribute("styleStore",1);let i=parseFloat(t.getAttribute("styleStore"))+e;t.setAttribute("styleStore",i),t.style.fontSize=i+"em";let s=document.getElementById("shaderEditor_uniformInput");s&&(s.style.fontSize=i+"em");let r=document.getElementById("shaderEditor_vertInput");r&&(r.style.fontSize=i+"em");let a=document.getElementById("shaderEditor_fragInput");a&&(a.style.fontSize=i+"em"),setTimeout((()=>{this.resizeShaderElements()}),130)}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(e){this.mouseX=e.x,this.mouseY=e.y}clickShaderMessage(e){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){let t=Math.abs(this.mouseX-e.x),i=Math.abs(this.mouseY-e.y);if(Math.max(t,i)<5){let t=e.target,i=t.selectionStart,s=t.selectionEnd;i!==s&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=i,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=s)}}}dblclickShaderMessage(e){let t=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,i=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,s=e.target,r=s.value.substring(t,i+20),a=r.match(/[a-zA-Z0-9._[\]]+/);a&&!r[0].match(/\n/)&&(i=t+a[0].length),s.setSelectionRange(t,i),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout((()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1}),500)}keyShaderMessage(e){if(e.repeat)return!1;let t=e.key,i=e.code,s=e.shiftKey,r=e.ctrlKey,a=i.includes("Numpad");if(!("Enter"===t||"Tab"===t||"KeyD"===i&&r||"KeyK"===i&&r||a&&r||i.includes("Arrow")&&r))return!1;e.preventDefault();let n=e.target;if("NumpadAdd"===i){let e=window.getComputedStyle(n),t=parseFloat(e.fontSize)+2;return n.style.fontSize=t,!1}if("NumpadSubtract"===i){let e=window.getComputedStyle(n),t=parseFloat(e.fontSize)-2;return n.style.fontSize=t,!1}let o=n.selectionStart,l=n.selectionEnd,h=n.value;if(i.includes("Arrow")){if(o===l)return!1;let e,t,s,r=h.substring(o,l);if("ArrowUp"===i?(t=h.substring(0,o),o=t.search(/.*$/),i="ArrowLeft"):"ArrowDown"===i&&(t=h.substring(l,h.length),l=t.search(/\n/)+l,i="ArrowRight"),"ArrowLeft"===i){e=new RegExp(r+".*","gm"),t=h.substring(0,o);let i=[...t.matchAll(r,"g")];if(0===i.length&&(i=[...h.matchAll(r,"g")],0===i.length))return!1;s=i.pop().index}if("ArrowRight"===i){e=new RegExp(r,"m"),t=h.substring(l,h.length);let i=e.exec(t);if(i)s=i.index+l;else{if(i=e.exec(h),!i)return!1;s=i.index}}if(s>-1){let e=s+r.length;n.setSelectionRange(s,e);let t=n.getBoundingClientRect(),i=window.getComputedStyle(n).font,a=[h.slice(0,s),"<span id='tmpShaderPosition'>.</span>",h.slice(s)].join("");a=a.replace(/(?:\r\n|\r|\n)/g,"<br>");let o=document.createElement("div");o.style.position="fixed",o.style.width=t.width,o.style.height=t.height,o.style.overflowY="scroll",o.style.font=i,o.innerHTML=a,document.body.appendChild(o);let l=o.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(o),n.scrollTo(0,l)}return!1}if("Enter"===t&&r)return this.children.updateObj.click(),n.focus(),n.setSelectionRange(o,l),!1;if(a){let e=h.substring(o,l),t=e.length>0,s=h.substr(o-1,1);s=/[\w|\d]/.test(s)&&0===e.length?" ":"";let r=h.substr(l+1,1);r=/[\w|\d]/.test(r)&&0===e.length?" ":"";let a=o+s.length;if("Numpad1"===i){let i="float(";a+=i.length,e=t?e:".0",e=i+e+")"}else if("Numpad2"===i){let i="vec2(";a+=i.length,e=t?e:".0, .0",e=i+e+")"}else if("Numpad3"===i){let i="vec3(";a+=i.length,e=t?e:".0, .0, .0",e=i+e+")"}return e=s+e+r,document.execCommand("insertText",!1,e),t||n.setSelectionRange(a,a),!1}let c=Math.min(o,l),d=h.substr(0,c);if("KeyK"===i){let e,t,i,r=!1;if(o!==l&&(e=d.search(/.*$/),t=l,i=h.substring(e,l),r=/\n/.test(i)),!r){let e=d.search(/[\S\w].*$/);if(-1===e){if(e=h.substring(c,h.length).search(/(?:[^\s])/),-1===e)return!1;e+=c}let t=e,i=t,r="";if(s){if(i+=2,"//"!==h.substr(t,2))return!1;o-=2,l-=2}else{if("//"===h.substr(t,2))return!1;r="//",o+=2,l+=2}return n.setSelectionRange(t,i),document.execCommand("insertText",!1,r),n.setSelectionRange(o,l),!1}if(r){let i=t+h.substring(t,h.length).search(/\n./),r=h.substring(e,i),a=s?-2:2,c=[...r.matchAll(/[\S\w].*/g)],d=[],u=o-e,A=t-e;return c.forEach((e=>{let t=e.index;d.push(t)})),d=d.reverse(),d.forEach((e=>{let t=r.substr(e,2);if(s){if("//"!==t)return;r=r.substring(0,e)+r.substring(e+2,r.length)}else{if("//"===t)return;r=r.substring(0,e)+"//"+r.substring(e,r.length)}o+=e<u?a:0,l+=e<A?a:0})),n.setSelectionRange(e,i),document.execCommand("insertText",!1,r),n.setSelectionRange(o,l),!1}return!1}let u=d.split("\n");if("Enter"===t||"Tab"===t){let e=u.pop();0===e.length&&(e=u.pop());let i=e.replace(/[\S\w].*$/g,"");"Tab"===t?(i=0===i.length?" ":i.substr(0,1),i=" "===i?"  ":"\t"):i="\n"+i;let r=i,a=o,c=l;if("Tab"===t&&o!==l){let e=h.substring(o,l);e=e.split("\n"),e=s?e.map((e=>""===e?e:e.replace(i,""))):e.map((e=>""===e?e:i+e)),r=e.join("\n"),c=a+r.length}else a+=r.length,c=a;return document.execCommand("insertText",!1,r),n.setSelectionRange(a,c),!1}if("KeyD"===i&&r)if(o===l){let e=h.split("\n");u.pop();let t=e[u.length],i=[...u,t].join("\n").length;t="\n"+t,n.setSelectionRange(i,i),document.execCommand("insertText",!1,t),i=c+t.length,n.setSelectionRange(i,i)}else{let e=h.substring(o,l);n.setSelectionRange(l,l),document.execCommand("insertText",!1,e),l+=e.length,n.setSelectionRange(l,l)}return!1}updateShaderList(){let e=this.children.shaderSelect;if(!e)return console.log("No Object shader pulldown found."),void console.log(this.gui);let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),i=Object.keys(t),s="",r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();i.forEach((e=>{s+=`<option value="${e}" ${e===r?" selected":""}>${t[e]}</option>`})),e.innerHTML=s}resize(e){this.resizeShaderElements()}resizeShaderElements(){let e=0;if(this.hudBottomBar&&(e=this.hudBottomBar.offsetHeight),this.children.headerBar&&(e+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=window.innerHeight-e;let t=this.children.vertObj.getBoundingClientRect().top,i=this.children.updateObj.getBoundingClientRect().height;i+=40;let s=window.innerHeight-i-t;this.children.vertObj.style.maxHeight=.4*s+"px",this.children.vertObj.displayHeight=.4*s,this.children.fragObj.style.maxHeight=.6*s+"px",this.children.fragObj.displayHeight=.6*s,this.children.fieldBodyHeight=s}}toggleShaderEditor(e=null){this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),e=null===e?!this.active:e,this.active=e,this.guiManager.promptFader(this.gui,e),this.guiManager.promptFader(this.helpGui,e),this.pxlEnv.emit("shaderEditorVis",e),e?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout((()=>{this.resizeShaderElements()}),130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur(),document.getElementById("guiShaderEditorBlock").style.maxWidth=this.editorWidthMinMax.min+"vw";let e=document.getElementById("gui_shaderHelpBlock");e&&(e.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");let t=document.getElementById("shaderEditor_loadShader");t&&(t.style.maxWidth="85px"),this.disconnectFocusListener(),this.updateHeaderBar(),setTimeout((()=>{this.resizeShaderElements()}),130)}focusShaderMessage(e,t){var i;this.isEditing=!0;let s=this.children,r=s.vertObj.displayHeight,a=s.fragObj.displayHeight,n=Math.max(150,.135*window.innerHeight),o=s.fieldBodyHeight-n;r="vertObj"===t?o:n,a="fragObj"===t?o:n,s.vertObj.style.maxHeight=r+"px",s.fragObj.style.maxHeight=a+"px",this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",null!=(i=this.children)&&i.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");let l=document.getElementById("gui_shaderHelpBlock");l&&(l.style.left=this.editorWidthMinMax.max+"vw"),this.connectFocusListener(),this.updateHeaderBar()}clickThroughCheck(e){let t=e.x,i=e.y,s=document.elementsFromPoint(t,i);for(let e=0;e<s.length;++e)if("gui_shaderEditorParent"===s[e].id)return;this.blurShaderEditor()}connectFocusListener(){document.addEventListener("mousedown",this.clickThroughListener)}disconnectFocusListener(){document.removeEventListener("mousedown",this.clickThroughListener)}},Js=class{constructor(e="hudRegion",t={}){this.name=e,this.object=null,this.type=Us.REGION,this.pxlOptions=null,this.pxlEnums=null,this.pxlDevice=null,this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=0,this.dragThreshold=10,this.startPos=null,this.currentPos=null,this.previousPos=null,this.startDelta={x:0,y:0},this.stepDelta={x:0,y:0},this.defaultObject={pos:{x:0,y:0},bbox:{width:0,height:0},draw:Ns.DEFAULT,style:[],objectStyles:[],objectStyleKeys:[]},this.defaultObjectStyleEntry={object:"parent",base:["pxlNav-hudElement-thumbstick-default"],hover:["pxlNav-hudElement-thumbstick-hover"],active:["pxlNav-hudElement-thumbstick-active"]},"object"!=typeof t&&(t={}),(t=Object.assign(this.defaultObject,t)).objectStyles.length>0&&t.objectStyles.forEach((e=>{t.objectStyleKeys.push(e.object)})),this.data=t,this.callbacks=[]}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlEnums=e.pxlEnums,this.pxlDevice=e.pxlDevice}build(){let e=this.createMainElement();return e.classList.add("pxlNav-hudElement-region"),this.object=e,this.object.ontouchstart=this.ontouchstart.bind(this),this.object.ontouchend=this.ontouchend.bind(this),e}createMainElement(){let e=document.createElement("div");return this.data.hasOwnProperty("id")&&(e.id=this.data.id),this.data.hasOwnProperty("style")&&this.data.style.forEach((t=>{e.classList.add(t)})),this.object=e,e}ontouchstart(e){this.emit(!0)}ontouchmove(e){}ontouchend(e){this.emit(!1)}updateStyle(){}subscribe(e){this.callbacks.push(e)}emit(e){this.callbacks.forEach((function(t){t(e)}))}},Xs=class extends Js{constructor(e="hudDrawRegion",t={}){super(e,t),this.type=Us.DRAG_REGION,this.dragThreshold=10}build(){let e=this.createMainElement();return e.classList.add("pxlNav-hudElement-dragRegion"),e}ontouchstart(e){}ontouchmove(e){}ontouchend(e){}},Zs=class extends Js{constructor(e,t={}){super(e,t),this.type=Us.THUMBSTICK,this.block=null,this.currentState=_s.NONE,this.innerObj=null,this.blockStyleOverrides=null,this.parentStyleOverrides=null,this.innerStyleOverrides=null}build(){let e=this.createMainElement();e.classList.add("pxlNav-hudElement-thumbstick-block");let t=document.createElement("div");t.classList.add("pxlNav-hudElement-thumbstick"),e.appendChild(t);let i=document.createElement("div");if(i.classList.add("pxlNav-hudElement-thumbstick-inner"),t.appendChild(i),e.ontouchstart=this.ontouchstart.bind(this),e.ontouchmove=this.ontouchmove.bind(this),e.ontouchend=this.ontouchend.bind(this),this.block=e,this.object=t,this.innerObj=i,this.data.hasOwnProperty("objectStyleKeys")&&this.data.objectStyleKeys.length>0){let s=this.data.objectStyleKeys.indexOf("block"),r=this.data.objectStyleKeys.indexOf("parent"),a=this.data.objectStyleKeys.indexOf("inner");s>=0&&(this.blockStyleOverrides=this.data.objectStyles[s],this.blockStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((t=>{e.classList.add(t)}))),r>=0&&(this.parentStyleOverrides=this.data.objectStyles[r],this.parentStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((e=>{t.classList.add(e)}))),a>=0&&(this.innerStyleOverrides=this.data.objectStyles[a],this.innerStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((e=>{i.classList.add(e)})))}return e}getTouchId(e){if(!e.touches||e.touches.length<1)return-1;if(1===e.touches.length)return e.touches[0].identifier;let t=null;for(let i=0;i<e.touches.length;++i){let s=e.touches[i];if(s.target===this.block){t=s.identifier;break}}return t}getTouchInfo(e){if(-1===this.touchId||!e.touches||e.touches.length<1)return null;let t=null;for(let i=0;i<e.touches.length;++i)if(e.touches[i].identifier===this.touchId){t=e.touches[i];break}return t}ontouchstart(e){e.preventDefault(),e.stopPropagation(),this.isDown=!0,this.isDragging=!1,this.dragCount=-1,this.touchId=this.getTouchId(e);let t=this.getTouchInfo(e);t&&(this.startPos={x:t.clientX,y:t.clientY},this.updateStyle())}ontouchmove(e){var t,i;if(e.preventDefault(),e.stopPropagation(),this.isDown){this.dragCount++,this.isDragging||(Math.abs(this.startDelta.x)>this.pxlOptions.userSettings.deadZone.touch||Math.abs(this.startDelta.y)>this.pxlOptions.userSettings.deadZone.touch)&&(this.isDragging=!0);let s=this.getTouchInfo(e);if(!s)return;let r=(null==(t=this.currentPos)?void 0:t.x)||s.clientX,a=(null==(i=this.currentPos)?void 0:i.y)||s.clientY;this.previousPos={x:r,y:a},this.currentPos={x:s.clientX,y:s.clientY},this.startDelta={x:this.currentPos.x-this.startPos.x,y:this.currentPos.y-this.startPos.y},this.stepDelta={x:this.currentPos.x-this.previousPos.x,y:this.currentPos.y-this.previousPos.y},this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:this.currentPos,startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!0}),this.updateStyle()}}ontouchend(e){e.preventDefault(),e.stopPropagation(),this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:Object.assign({},this.currentPos),startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!1}),this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=-1,this.currentPos=null,this.startPos=null,this.prevPos=null,this.updateStyle()}updateStyle(){if(this.innerObj&&this.object)if(this.isDown&&!this.isDragging)this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.currentState=_s.HOVER;else if(this.isDragging){if(this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.innerStyleOverrides),this.currentState!==_s.ACTIVE){let e=this.object.getBoundingClientRect(),t=e.width/2+e.left,i=e.height/2+e.top,s=Math.max(.085*-this.pxlDevice.sW,Math.min(.085*this.pxlDevice.sW,this.startPos.x-t)),r=Math.max(.095*-this.pxlDevice.sH,this.startPos.y-i);this.object.style.left=s+"px",this.object.style.top=r+"px"}let e=this.startDelta.x,t=this.startDelta.y,i=Math.max((e**2+t**2)**.5,1);i>80&&(e=e/i*80,t=t/i*80),this.innerObj.style.left=e+"px",this.innerObj.style.top=t+"px",this.currentState=_s.ACTIVE}else this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.object.style.left="0px",this.object.style.top="0px",this.currentState=_s.NONE}toggleStyle(e,t){if(e===t.currentAction)return;let i=[this.pxlEnums.HUD_ACTION.NONE,this.pxlEnums.HUD_ACTION.HOVER,this.pxlEnums.HUD_ACTION.ACTIVE],s=i.indexOf(e),r=null;"block"===t.object?r=this.block:"parent"===t.object?r=this.object:"inner"===t.object&&(r=this.innerObj),i.forEach(((e,i)=>{i!==s?t[e].forEach((e=>{r.classList.remove(e)})):t[e].forEach((e=>{r.classList.add(e)}))})),t.currentAction=e}subscribe(e){this.callbacks.push(e)}};F();var $s={Utils:class{constructor(t="images/assets/",i){this.assetRoot=t,this.mobile=i,this.pxlTimer=null,this.pxlEnums=null,this.verboseLoading=!1,this.texLoader=new e.ImageLoader,this.textLoaderArray=[],this.channelFormats=[e.AlphaFormat,e.RedFormat,e.RGFormat,e.RGBFormat,e.RGBAFormat,e.DepthFormat]}get curMS(){return this.pxlTimer.curMS}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlEnums=e.pxlEnums}updateUrl(e,t={},i=""){window.history.replaceState?window.history.replaceState(t,i,e):window.history.pushState(t,i,e)}copyRoomUrl(){let e=window.location,t=document.activeElement,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();let s=!1;try{s=document.execCommand("copy")?"successful":"unsuccessful"}catch(e){}return document.body.removeChild(i),t.focus(),s}checkInt(e){return e%1==0}degToRad(e){return e*(Math.PI/180)}toHundreths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,2))}}toTenths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,1))}}getDateTime(){let e=new Date;return[(e.getFullYear()+"").padStart(2,"0")+"-"+(e.getMonth()+1+"").padStart(2,"0")+"-"+(e.getDate()+"").padStart(2,"0"),(e.getHours()+"").padStart(2,"0")+":"+(e.getMinutes()+"").padStart(2,"0")+":"+(e.getSeconds()+"").padStart(2,"0")]}cleanStrict(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9])\w+/g);return i&&(t=i.join(" ")),t}cleanBasic(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9\s\w-+()[\]])+/g);return i&&(t=i.join("")),t}cleanString(e){let t=document.createElement("div");return t.innerHTML=e,t=t.innerText,t}toNearestStr(e,t=2){return e.toFixed(t)}arrayToStr(e,t=2){let i=[];return e.forEach((e=>{i.push(this.toNearestStr(e,t))})),i}flattenArrayToStr(e,t=2,i=","){return this.arrayToStr(e,t).join(i)}randomFloat(e,t){return Math.random()*(t-e)+e}screenToNDC(t,i,s,r){let a=t/s*2-1,n=-i/r*2+1;return new e.Vector2(a,n)}componentToHex(e){return e.toString(16).padStart(2,"0")}rgbToHex(e,t,i){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(e))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(t))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(i))))}hexToRgb(e){let t,i,s;return 3===(e="#"===e[0]?e.substr(1,6):e.substr(0,6)).length?(t=e[0]+e[0],i=e[1]+e[1],s=e[2]+e[2]):(t=e[0]+e[1],i=e[2]+e[3],s=e[4]+e[5]),t=parseInt(t,16),i=parseInt(i,16),s=parseInt(s,16),[t,i,s]}stringToRgb(e,t=null,i=!1){let s=[255,0,0];if(e){let t=e.length,i="";for(let s=0;s<t;++s)i+=e[t-1-s].charCodeAt(0).toString(16);let r=i.length;if(r>6){let t=1;"tussin"===e?t=0:"fexofenadine"===e&&(t=-1);let s=Math.max(0,parseInt((r-6)/2+t));i=i.substr(s,6)}s=this.hexToRgb(i)}if(null!=t){let e=Math.max(...s),i=Math.min(...s),r=e*t;s[0]=parseInt(Math.min(255,(s[0]-i)/(e-i)*255+r)),s[1]=parseInt(Math.min(255,(s[1]-i)/(e-i)*255+r)),s[2]=parseInt(Math.min(255,(s[2]-i)/(e-i)*255+r))}return!0===i&&(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255),s}colorTosRGB(e){return"object"==typeof e&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.tosRGB(e.r),e.g=this.tosRGB(e.g),e.b=this.tosRGB(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.tosRGB(e.x),e.y=this.tosRGB(e.y),e.z=this.tosRGB(e.z))),e}tosRGB(e){return e<=.0031308?e*=12.92:e=1.055*Math.pow(e,this.oneTwoPFour)-.055,e}colorToLinear(e){return"object"==typeof e&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.toLinear(e.r),e.g=this.toLinear(e.g),e.b=this.toLinear(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.toLinear(e.x),e.y=this.toLinear(e.y),e.z=this.toLinear(e.z))),e}toLinear(e){return e<=.04045?e*=this.twelvePNineTwoDiv:e=Math.pow((e+.055)*this.onePOFiveFiveDiv,2.4),e}gammaCorrectColor(e,t="2.2",i="1.8"){return"object"==typeof e&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.gammaCorrect(e.r,t,i),e.g=this.gammaCorrect(e.g,t,i),e.b=this.gammaCorrect(e.b,t,i)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.gammaCorrect(e.x,t,i),e.y=this.gammaCorrect(e.y,t,i),e.z=this.gammaCorrect(e.z,t,i))),e}gammaCorrection(e,t="2.2",i="1.8"){let s=Math.pow(e,t);return Math.pow(s,1/i)}convertColor(e,t=this.pxlEnums.COLOR_SHIFT.KEEP){if(t===this.pxlEnums.COLOR_SHIFT.KEEP)return e;let i=e.clone();switch(t){case this.pxlEnums.COLOR_SHIFT.sRGB_TO_LINEAR:i=this.colorTosRGB(i);break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_sRGB:i=this.colorToLinear(i);break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_UNIX:i=this.gammaCorrectColor(i,"2.2","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.8","2.2");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.0","2.2");break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_LINEAR:i=this.gammaCorrectColor(i,"2.2","1.0");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_UNIX:i=this.gammaCorrectColor(i,"1.0","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_LINEAR:i=this.gammaCorrectColor(i,"1.8","1.0")}return i}randomizeArray(e){let t=[...e],i=[];for(;t.length>0;){let e=1===t.length?0:parseInt(21*Math.random()*t.length)%t.length;i.push(t.splice(e,1)[0])}return i}getRandom(e,t=1.14){return e[Math.floor(Math.random(t)*e.length)]}applyTransformList(e,t){var i=t.r;e.rotateX(i[0]),e.rotateY(i[1]),e.rotateZ(i[2]),void 0!==t.rOrder&&(e.rotation.order=t.rOrder);var s=t.t;e.position.set(s[0],s[1],s[2]);var r=t.s;e.scale.set(r[0],r[1],r[2]),e.matrixAutoUpdate=!1,e.updateMatrix()}vec2(t=null,i=null){return new e.Vector2(t,i)}vec3(t=0,i=0,s=0){return new e.Vector3(t,i,s)}loadTexture(t,i=null,s={}){t.includes("/")||(t=this.assetRoot+t);let r=null;if(void 0!==this.textLoaderArray[t])r=this.textLoaderArray[t];else{r=new e.Texture;let a=Object.keys(s);this.texLoader.load(t,(e=>{null!=i&&(r.format=this.channelFormats[i]),r.image=e,r.needsUpdate=!0,a.length>0&&a.forEach((e=>{r[e]=s[e]}))}),void 0,(e=>{console.error(" TextureLoader :: Error loading texture :: "+t),console.error(e)})),this.textLoaderArray[t]=r}return r}getVideoTexture(t){let i=new e.VideoTexture(t);return i.minFilter=e.LinearFilter,i.magFilter=e.LinearFilter,i.format=e.RGBFormat,i}getCanvasTexture(t){let i=new e.CanvasTexture(t);return{texture:i,material:new e.MeshBasicMaterial({map:i})}}dupeArray(e,t){return Array.from({length:t}).fill(e)}},FileIO:Vs,QualityController:class{constructor(t,i=!1,s={}){this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlRendering=null,this.pxlEnv=null,this.msLog=0,this.prevMS=.001*(new Date).getTime(),this.autoQuality=!1,this.percent=1,this.verbose=t,this.screenResPerc=1,this.mBlurPercMult=i?.65:1,this.bloomPercMult=i?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new e.Vector3(30,0,.001*(new Date).getTime()),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(s).includes("dlimit")?s.dlimit:0,this.detailLimit=null!=this.detailLimitOverride?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlCookie=e.pxlCookie,this.pxlDevice=e.pxlDevice,this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv}init(){if(null!=this.detailLimitOverride?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=Ms.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse")),this.pxlCookie.hasCookie("qualitySetting")){let e=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=e,this.settingsQualityChoice=e}}step(){this.mapFpsQualitCheck()}attachModule(e=null){e&&this.moduleQualityList.push(e)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();let e=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=e,this.benchmarkRating=1-Math.min(1,Math.max(0,(e-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];let t=Math.min(1,Math.max(0,this.benchmarkRating));t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t,this.setFromBenchmark?this.setQualityLevel(this.qualityStep):(null===this.settingsQualityChoice&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach((e=>{this.settingsCustom[e]=this.settings[e]}))),this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;let e=1;this.fpsCounter.x<15&&(e=-1);let t=Math.min(1,Math.max(0,this.percent+this.shiftRate*e));this.autoQuality&&this.mapAutoQualityUpdate(t,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(e=null,t=!1){let i=Math.min(1,Math.max(0,e));i=Math.ceil(Math.max(.05,i)*this.qualityMaxSteps)-1,this.qualityStep=i}setGraphicsSettings(e=null,t=3){if(null===e)if(0===this.qualityStep)e=this.settingsLow;else if(1===this.qualityStep)e=this.settingsMedium;else{if(2!==this.qualityStep)return;e=this.settingsHigh}3===t&&this.checkCustomDict(),Object.keys(e).forEach((i=>{this.setComponentQuality(i,e[i]),this.settings[i]=e[i],3===t&&(this.settingsCustom[i]=e[i])})),this.setDependentSettings(),this.colliderPrevObjHit=null,null!=t&&(this.settings.graphics=t)}reapplySettings(){Object.keys(this.settingsLow).forEach((e=>{this.setComponentQuality(e,this.settings[e],!1)})),this.setDependentSettings()}setQualityLevel(e){this.pxlDevice.mobile&&(e=1),this.setQualityCookie(e),0===e?this.setLowQuality():1===e?this.setMediumQuality():2===e?this.setHighQuality():3===e&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(null===this.settingsCustom){this.settingsCustom={};let e=this.settingsHigh;this.settingsQualityChoice&&(0===this.settingsQualityChoice?e=this.settingsLow:1===this.settingsQualityChoice?e=this.settingsMedium:2===this.settingsQualityChoice&&(e=this.settingsHigh)),Object.assign(this.settingsCustom,e)}}setQualityCookie(e){this.pxlCookie.setCookie("qualitySetting",e)}setComponentQuality(e,t,i=!0){switch(e){case"leftRight":case"mouse":this.settings[e]=t;break;case"resolution":this.screenResPerc=t,this.pxlDevice.resizeRenderResolution(),this.settings[e]=t,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*t);break;case"fog":this.pxlRendering.mapOverlayHeavyPass&&(this.pxlRendering.mapOverlayHeavyPass.enabled=2===t),this.pxlRendering.mapOverlayPass&&(this.pxlRendering.mapOverlayPass.enabled=1===t),this.pxlRendering.mapOverlaySlimPass&&(this.pxlRendering.mapOverlaySlimPass.enabled=0===t),this.pxlRendering.mapBoxAAPass.enabled&&(this.pxlRendering.mapBoxAAPass.enabled=2===t),this.pxlRendering.mapCrossAAPass.enabled&&(this.pxlRendering.mapCrossAAPass.enabled=1===t),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=1),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0===t?.7:.3),this.settings[e]=t;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=t?.4:1,this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=t),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=t),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=t),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=t?.65:.8,this.pxlEnv.userScreenIntensity.y=t?0:.8),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0===t?.7:.3),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t;break;case"motion":this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t}i&&this.pxlCookie.setCookie(e,t)}setDependentSettings(){var e,t;let i=1,s=0,r=.6,a=!1,n=!1,o=!1,l=!1,h=!1,c=!1;2===this.settings.fog?(a=!1,n=!0,o=!1,l=!1,h=!0,c=!1,i=.5):1===this.settings.fog?(a=!1,n=!1,o=!0,l=!1,h=!1,c=!0,i=.5):(a=!1,o=!1,l=!0,h=!1,c=!1,i=.4),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=a),n&&(this.pxlRendering.mapOverlayHeavyPass.enabled=n),o&&(this.pxlRendering.mapOverlayPass.enabled=o),l&&(this.pxlRendering.mapOverlaySlimPass.enabled=l),h&&(this.pxlRendering.mapBoxAAPass.enabled=h),c&&(this.pxlRendering.mapCrossAAPass.enabled=c),this.settings.bloom?(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!0),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!0),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!0),this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,s=1,r=.25):(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!1),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!1),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!1),null!=(e=this.pxlRendering.mapComposerGlow)&&e.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.mapComposerGlow.renderTarget2),this.pxlRendering.engine.clear()),null!=(t=this.pxlRendering.roomGlowPass)&&t.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.roomGlowPass.renderTarget2),this.pxlRendering.engine.clear()),this.pxlRendering.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,i=1,s=0,r=.5);let d=this.pxlEnv.geoList.Circular_Gate;d&&(d.material.uniforms.bloomBoost.value=s),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);let u=this.pxlEnv.geoList.CirculateGateVideoSphere;u&&(u.material.color.r=r,u.material.color.g=r,u.material.color.b=r),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=i),this.pxlEnv.pxlCamera.colliderCurObjHit=null}},CookieManager:class{constructor(e=!1,t="pxlNav-",i="/",s=30){let r="-"===t.substring(-1)?t:t+"-";this.prepend=r,this.verbose=e,this.exp=s,this.path="path="+i,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}log(...e){this.verbose>=Ms.INFO&&(console.log("-- Cookie Manager --"),e.forEach((e=>{console.log(e)})))}getExpiration(){let e=new Date;return e.setTime(e.getTime()+24*this.exp*60*60*1e3),"expires="+e.toGMTString()+";"}isEqual(e){return!!this.hasCookie(e)&&(this.log(e),this.readCookie(e)===this.variableToString(e))}getRegexp(e){return new RegExp("(?="+e+").*?((?=;)|(?=$))","g")}getClearCookieRegexp(e){return new RegExp("(?="+e+").*?(?==)","g")}pullData(){let e=document.cookie,t=this.getRegexp(this.prepend),i=e.match(t),s={};return i&&i.forEach((e=>{let t=e.split("=")[0].replace(this.prepend,""),i=e.split("=")[1].replace(this.sub,";");s[t]=i})),s}valueToString(e){let t=typeof e;return isNaN(Number(e))?"string"===t?"'"+e+"'":"boolean"===t?e?"true":"false":null==e?"null":isNaN(Number(e))?"NaN":e:e}variableToString(e){return Array.isArray(e)?"["+e.map((e=>Array.isArray(e)?this.variableToString(e):this.valueToString(e))).join(",")+"]":this.valueToString(e)}hasCookie(e){return document.cookie.includes(this.prepend+e)}readCookie(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e);return document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e),i=document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return"true"===i?i=!0:"false"===i?i=!1:parseInt(i)===i?i=parseInt(i):parseFloat(i)===i&&(i=parseFloat(i)),i}return null}evalCookie(e){if(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e);return this.log("Eval Cookie has been limited, responce is: "),this.log(document.cookie.match(t)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}{let e=this.getRegexp(this.prepend);return this.log("Eval Cookie has been limited, may error."),document.cookie.match(e).forEach((e=>{e.replace(this.prepend,"").replace(this.sub,";")})),!0}}setCookie(e,t){(t=this.variableToString(t)).replace&&t.replace(";",this.sub),document.cookie=this.prepend+e+"="+t+";"+this.getExpiration()+this.path}addDictionary(e){let t=Object.keys(e);for(let i=0;i<t.length;++i){let s=e[t[i]];s=this.variableToString(s),s.replace&&s.replace(";",this.sub),document.cookie=this.prepend+t[i]+"="+s+";"+this.getExpiration()+this.path}}parseDict(e){let t=Object.keys(e),i=!1;return t.forEach((t=>{this.hasCookie(t)&&(e[t]=this.parseCookie(t),i=!0)})),i}clearCookie(e){if(e)"string"==typeof e&&(e=[e]),e.forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}));else{let e=this.getClearCookieRegexp(this.prepend);document.cookie.match(e).forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}))}}},Timer:class{constructor(){this.active=!1,this.msRunner=new e.Vector2(0,0),this.msLog=0,this.fpsStats=-1,this._msRate=.001,this.baseRate=.001;let t=(new Date).getTime()*this._msRate;this._bootMS=t,this._prevWorldMS=t,this._curMS=t,this._prevMS=t,this.deltaTime=0,this.avgDeltaTime=0,this.avgDeltaRate=.7,this.videoFeeds=[],this.booted=!1}init(){this.booted||(this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step(),this.booted=!0)}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=(new Date).getTime()*this._msRate}get prevMS(){return this._prevMS}set prevMS(e){this._prevMS=e}scaleTime(e){this._msRate=this.baseRate*e}start(){this.play()}pause(e=null){return this.active=null===e?!this.active:!!e,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){let e=this._curMS;if(this.updateTime(),this._curMS===e)return void(this._curMS=e);this.prevMS=e,-1!==this.fpsStats&&this.fpsStats.update();let t=this.curMS-this.prevMS;this.avgDeltaTime=this.deltaTime*(1-this.avgDeltaRate)+t*this.avgDeltaRate,this.deltaTime=t,this.msRunner.x+=t>0?t:0,this.msRunner.y=this.avgDeltaTime}getLerpRate(e){return 1-Math.pow(.5,this.deltaTime*e)}getLerpAvgRate(e){return 1-Math.pow(.5,this.avgDeltaTime*e)}},User:class{constructor(e=null){this.pxlEnums=null,this.pxlEnv=null,this.pxlTimer=null,this.id=null,this.Stats=null,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.moveSpeed=1,this.moveSpeedSlow=.5,this.moveSpeedBase=1,this.moveSpeedBoost=2,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lizardKingPass=null,this.sField=0,this.sFieldWarp=0,this.starFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.crystallinePass=null}setDependencies(e){this.pxlEnums=e.pxlEnums,this.pxlEnv=e.pxlEnv,this.pxlTimer=e.pxlTimer}setSlowSpeed(e){e=Math.max(.001,e),this.moveSpeedSlow=e}setBaseSpeed(e){e=Math.max(.001,e),this.moveSpeedBase=e}setBoostSpeed(e){e=Math.max(.001,e),this.moveSpeedBoost=e}setSpeed(e){switch(e){case this.pxlEnums.USER_SPEED.STOP:this.moveSpeed=0;break;case this.pxlEnums.USER_SPEED.SLOW:this.moveSpeed=this.moveSpeedBase*this.moveSpeedSlow;break;case this.pxlEnums.USER_SPEED.BASE:this.moveSpeed=this.moveSpeedBase;break;case this.pxlEnums.USER_SPEED.BOOST:this.moveSpeed=this.moveSpeedBase*this.moveSpeedBoost;break;default:this.moveSpeed=this.moveSpeedBase}}checkItemWearOff(e){return this.itemActiveList.length>0&&this.itemActiveTimer[0]-e<=0&&(this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0)}checkItemPickUp(e){return"LowGravity"===e?0===this.lowGrav&&(this.lowGrav=1,!0):"LizardKing"===e?0===this.lKing&&(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lizardKingPass.enabled=!0,!0):"StarField"===e?0===this.sField&&(this.sField=1,this.starFieldPass.enabled=!0,!0):"InfinityZoom"===e?0===this.iZoom&&(this.iZoom=1,this.crystallinePass.enabled=!0,!0):void 0}toggleTankRotate(e=null){this.tankStrafe=null===e?!this.tankStrafe:e,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(e=null){this.invertMouse=null===e?!this.invertMouse:e,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){}},Device:class{constructor(t,i,s){this.projectTitle=t,this.pxlCore=i,this.pxlRendering=null,this.pxlEnv=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.allowCursorSwap=!1,this.longTouchLength=.75;let r=window.innerWidth,a=window.innerHeight;this.sW=r,this.sH=a,this.lookRange=.3,this.lookXScalar=1/(this.sW*this.lookRange),this.lookYScalar=1/(this.sH*this.lookRange),this.touchScreen=!1,this.x=.5*r,this.y=.5*a,this.screenRes=new e.Vector2(1/r,1/a),this.screenAspect=new e.Vector2(1,1),this.screenRatio=new e.Vector2(r/a,a/r),this.origRes=new e.Vector2(r,a),this.screenResDeltaPerc=new e.Vector2(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new e.Vector3(1,1,1),this.lightShift=new e.Vector2(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=s,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=r/2,this.mouseY=a/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new e.Vector2(1,1),velocityEase:new e.Vector2(0,0),velocityEasePrev:null,velocity:new e.Vector2(0,0),mBlurVelInf:new e.Vector2(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new e.Vector2(0,0),netDistYPerc:0,curDistance:new e.Vector2(0,0),curFadeOut:new e.Vector2(0,0),curStepDistance:new e.Vector2(0,0),initialQuat:new e.Quaternion,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={}}setDependencies(e){this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv,this.pxlEnums=e.pxlEnums,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUser=e.pxlUser,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality,this.pxlOptions=e.pxlOptions}init(){this.setGammaCorrection();let e=this;(!this.pxlOptions.staticCamera||this.pxlOptions.allowStaticRotation&&this.pxlOptions.staticCamera)&&(document.addEventListener("mousedown",(t=>{e.onmousedown(e,t)}),!1),document.addEventListener("mousemove",(t=>{e.onmousemove(e,t)}),!1),document.addEventListener("mouseup",(t=>{e.onmouseup(e,t)}),!1),document.addEventListener("touchstart",(function(t){e.touchstart(e,t)}),{passive:!0}),document.addEventListener("touchmove",(function(t){e.touchmove(e,t)}),{passive:!0}),document.addEventListener("touchend",(function(t){e.touchend(e,t)}),{passive:!0})),document.addEventListener("contextmenu",(t=>{e.oncontextmenu(t)}),!1),window.addEventListener("resize",(t=>{e.resizeRenderResolution()}),!1),document.onkeydown=t=>{e.onkeydown(e,t)},document.onkeyup=t=>{e.onkeyup(e,t)};let t=this;document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this),!1),"object"==typeof window.onblur&&(window.onblur=this.resetUserInput.bind(this)),window.addEventListener("beforeunload",(e=>{if(!0===t.controlKey)return e.preventDefault(),e.returnValue="Close tab?",t.controlKey=!1,t.mapLockCursor(!1,0),"Close tab?"})),window.addEventListener("unhandledrejection",(e=>(this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR?console.error("Unhandled promise rejection:",e.reason):e.preventDefault(),!1)))}step(){this.addMoveDelta()}setGammaCorrection(e=null){if(null!=e)return this.gammaCorrection.x=1/e,this.gammaCorrection.y=e,void(this.gammaCorrection.z=e);let t=1.5,i=1.1,s=1.2,r=.5;if(window&&window.navigator&&window.navigator.userAgent){let e=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(e&&e.length>0)t=2.2,i=.95,s=1,r=0;else{let e=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);e&&e.length>0?(t=1.8,i=.9,s=.97,r=.1):(t=1.8,i=.7,s=.96,r=.1)}}this.gammaCorrection.x=1/t,this.gammaCorrection.y=s,this.gammaCorrection.z=r,this.lightShift.x=i}getRenderScalar(){let e=1;return this.mobile&&0!==this.pxlOptions.renderScale.mobile?e=this.pxlOptions.renderScale.mobile:0!==this.pxlOptions.renderScale.pc&&(e=this.pxlOptions.renderScale.pc),e}setCanvasSize(e,t){this.pxlGuiDraws.pxlNavCanvas.width=e,this.pxlGuiDraws.pxlNavCanvas.height=t;let i=this.getRenderScalar();if(1!==i){let e=1/i;this.pxlGuiDraws.pxlNavCanvas.style.transform="scale("+e+")"}else this.pxlGuiDraws.pxlNavCanvas.style.transform=""}runHiddenCalcs(){this.windowHidden&&setTimeout((()=>{this.runHiddenCalcs()}),100)}onVisibilityChange(){this.windowHidden=document.hidden,this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.pxlCamera.workerFunc("focus",!document.hidden),this.runHiddenCalcs()}resetUserInput(e){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(e):this.mapOnUp(e))}requestFullScreen(){let e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;t&&t.call(e)}onmousemove(e,t){e.mapOnMove(t)}onmousedown(e,t){e.mapOnDown(t)}onmouseup(e,t){e.mapOnUp(t)}oncontextmenu(e){return e.preventDefault(),!1}touchstart(e,t){e.startTouch(t)}touchmove(e,t){e.doTouch(t)}touchend(e,t){e.endTouch(t)}onkeydown(e,t){e.keyDownCall(t)}onkeyup(e,t){e.keyUpCall(t)}get active(){return this.inputActive}set active(e){this.inputActive=!!e}preventDefault(e){(e=e||window.event).preventDefault(e)&&e.preventDefault(e)(),e.returnValue=!1}setCursor(e){this.allowCursorSwap&&("activeLatch"===e&&(e=["grab","grabbing","all-scroll"][this.touchMouseData.button]),document.body.style.cursor=e)}hideAddressBar(){setTimeout((function(){window.scrollTo(0,1)}),0)}getMouseXY(e){if(this.mobile)try{let t=e.touches[0];this.mouseX=t.pageX,this.mouseY=t.pageY}catch(e){}else{let t=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(e.movementX||e.mozMovementX||e.webkitMovementX||0)*t,this.mouseY+=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*t):(this.mouseX=e.clientX,this.mouseY=e.clientY)}}mapLockCursor(e=!1,t){if(this.canCursorLock&&!this.mobile){if(2===t?(!e&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:!e&&!this.cursorRightButtonLockActive&&(this.cursorRightButtonLockActive=!0),e=e||this.cursorRightButtonLockActive):e||(this.cursorRightButtonLockActive=e),!0===e){this.pxlGuiDraws.pxlNavCanvas.focus();let e=this.pxlGuiDraws.pxlNavCanvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock;try{e.requestPointerLock()}catch(e){}}else document.pointerLockElement&&document.exitPointerLock();this.cursorLockActive=e}}mapOnDown(t){let i=t.target;i.getAttribute&&i.getAttribute("id")===this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(t),this.touchMouseData.button=t.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new e.Vector2(0,0),this.touchMouseData.curStepDistance=new e.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,t.button))}mapOnMove(t){let i=t.target;if(i.getAttribute&&i.getAttribute("id")===this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(t),this.getMouseXY(t),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;let t=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(t),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=8e-4*(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250),this.touchMouseData.curFadeOut.add(t.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(t){let i=t.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),i.getAttribute&&i.getAttribute("id")===this.pxlCore){if(this.pxlGuiDraws.checkFocus(i.getAttribute("id"),!0),!this.mobile)return this.preventDefault(t),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,t.button),t.preventDefault(),!1;this.pxlAutoCam.getNextPath(!1,1)}}startTouch(t){let i=t.target;if(!i.getAttribute||i.getAttribute("id")!==this.pxlCore||!this.pxlTimer.active)return;this.touchScreen=!0;let s=t.touches[0];this.mouseX=s.pageX,this.mouseY=s.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new e.Vector2(0,0),this.touchMouseData.curStepDistance=new e.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;let r=i.getAttribute("id");if(this.objectPercList.includes(r)){"djPlayerVolume"===r&&(i=this.pxlAudio.djVolumeParentObj,r=i.getAttribute("id"));let e=i.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=i,this.objectPerc.left=e.left,this.objectPerc.top=e.top,this.objectPerc.width=e.width,this.objectPerc.height=e.height,this.objectPerc.startX=this.mouseX-e.left,this.objectPerc.startY=this.mouseY-e.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[r]&&this.objectPercFuncList[r](t)}}doTouch(t){if(!this.touchMouseData.active)return;let i=t.touches[0];if(this.mouseX=i.pageX,this.mouseY=i.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,void 0!==t.touches[1])return void(t.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,i=t.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[i.pageX,i.pageY])));let s=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(s),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(s.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}endTouch(t){if(this.touchMouseData.active){if(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock)return void(this.touchMouseData.lock=!1);this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger()}}async keyDownCall(e){if(this.emit("keydown",e),e.ctrlKey&&(this.controlKey=!0),void 0===document.activeElement.type&&this.pxlTimer.active){if(e.repeat)return;let t=e.keyCode||e.which;(37===t||65===t)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[0]=1,this.pxlCamera.deviceKey(0,!0)),e.ctrlKey&&87===t&&1===this.directionKeysPressed[1]&&e.this.preventDefault(e)(),(38===t||87===t)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[1]=1,this.pxlCamera.deviceKey(1,!0)),(39===t||68===t)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[2]=1,this.pxlCamera.deviceKey(2,!0)),(40===t||83===t)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[3]=1,this.pxlCamera.deviceKey(3,!0)),(16===t||224===t)&&this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!0),32===t&&this.deviceAction(this.pxlEnums.DEVICE_ACTION.JUMP,{},!0)}}async keyUpCall(e){var t,i;if(this.emit("keyup",e),e.ctrlKey)return this.controlKey=!1,e.preventDefault(),!1;if(void 0===document.activeElement.type){let s=e.keyCode||e.which,r=e.code||e.which;if(!e.isTrusted)return!1;if(e.ctrlKey||e.altKey||e.code.includes("F"))return e.preventDefault(),!1;if("Backquote"===r)return void this.pxlGuiDraws.guiToggleVisibility();if(89===s&&this.pxlGuiDraws.toggleShaderEditor(),220===s){let e=this.pxlQuality.screenResPerc;this.pxlQuality.screenResPerc=1,this.pxlEnv.mapRender(!1);let t=this.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),i=atob(t.split(",")[1]),s=i.length,r=new Uint8Array(s);for(let e=0;e<s;++e)r[e]=i.charCodeAt(e);let a=URL.createObjectURL(new Blob([r])),n=new Date,o=n.getDate(),l=n.getMonth()+1,h=n.getFullYear()+"-"+l+"-"+o+"_"+n.getHours()+"-"+n.getMinutes()+"-"+n.getSeconds(),c=document.createElement("a");return c.download=this.projectTitle+"_"+h+".png",c.href=a,document.body.appendChild(c),c.click(),c.parentNode.removeChild(c),this.pxlQuality.screenResPerc=e,void this.pxlEnv.mapRender(!1)}if(this.pxlTimer.active){if((37===s||65===s)&&(this.directionKeysPressed[0]=0,this.pxlCamera.deviceKey(0,!1)),(38===s||87===s)&&(this.directionKeysPressed[1]=0,this.pxlAutoCam.active&&this.pxlAutoCam.step(!0),this.pxlCamera.deviceKey(1,!1)),(39===s||68===s)&&(this.directionKeysPressed[2]=0,this.pxlCamera.deviceKey(2,!1)),(40===s||83===s)&&(this.directionKeysPressed[3]=0,this.pxlAutoCam.active&&this.pxlAutoCam.setRoom(!0),this.pxlCamera.deviceKey(3,!1)),this.directionKeysPressed.includes(1)||(this.directionKeyDown=!1),16===s||224===s)return void this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!1);if(32===s)return void this.deviceAction(this.pxlEnums.DEVICE_ACTION.JUMP,{},!1);if(!this.directionKeyDown&&(53===s||101===s))return void this.pxlAutoCam.preAutoCamToggle();if(221===s)return void((null==(i=null==(t=this.pxlUser)?void 0:t.itemInactiveCmd)?void 0:i.length)>0&&this.pxlUser.itemInactiveCmd.pop())}if(27===s||13===s&&!e.ctrlKey)return this.pxlGuiDraws.toggleHudBlock(!1,!0),void this.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);if(e.altKey||e.ctrlKey||e.shiftKey)return;if(73===s)return void this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.infoIcon,"info");if(71===s)return void this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.settingsIcon,"settings");if(191===s||72===s)return void this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help");if(66===s)return void this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");if(78===s)return void this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");if(80===s)return void this.deviceAction(this.pxlEnums.DEVICE_ACTION.PAUSE)}}deviceAction(e,t,i=null){switch(e){case this.pxlEnums.DEVICE_ACTION.MOVE:this.addMoveDelta(t);break;case this.pxlEnums.DEVICE_ACTION.LOOK:this.addLookDelta(t);break;case this.pxlEnums.DEVICE_ACTION.JUMP:this.pxlCamera.camJumpKey(i);break;case this.pxlEnums.DEVICE_ACTION.RUN:let e=i?this.pxlEnums.USER_SPEED.BOOST:this.pxlEnums.USER_SPEED.BASE;this.pxlUser.setSpeed(e);break;case this.pxlEnums.DEVICE_ACTION.ACTION:case this.pxlEnums.DEVICE_ACTION.ACTION_ALT:case this.pxlEnums.DEVICE_ACTION.ITEM:case this.pxlEnums.DEVICE_ACTION.MENU:break;case this.pxlEnums.DEVICE_ACTION.PAUSE:this.togglePause(i);case this.pxlEnums.DEVICE_ACTION.MAP:}}addMoveDelta(e=null){let t=!1;if(this.pxlOptions.mobile&&!this.pxlOptions.staticCamera&&(null!==e||this.directionKeyDown)){if(null!==e){if(e.hasOwnProperty("status")&&(t=e.status),t){let t=Math.abs(e.startDelta.x),i=Math.abs(e.startDelta.y),s=this.pxlOptions.userSettings.deadZone.touch,r=t>s?e.startDelta.x-s*Math.sign(e.startDelta.x):0,a=i>s?e.startDelta.y-s*Math.sign(e.startDelta.y):0,n=this.sW/this.sH,o=this.sH/this.sW;r=Math.min(r*this.lookXScalar,1)*this.pxlOptions.userSettings.movement.max*n,a=Math.min(a*this.lookYScalar,1)*this.pxlOptions.userSettings.movement.max*o,this.pxlCamera.cameraMovement[0]=.7*(this.pxlCamera.cameraMovement[0]+r),this.pxlCamera.cameraMovement[1]=.7*(this.pxlCamera.cameraMovement[1]+a),this.userInputMoveScalar=Math.max(this.pxlCamera.cameraMovement[0]**2,this.pxlCamera.cameraMovement[1]**2)**.5,this.userInputMoveScalar=this.userInputMoveScalar*this.userInputMoveScalar*this.userInputMoveScalar*1.5,this.userInputMoveScalar+=this.userInputMoveScalar>1?30*(this.userInputMoveScalar-1):0,this.userInputMoveScalar>1?this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!0):this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!1)}}else t=this.directionKeyDown;this.directionKeyDown=t,t?(this.directionKeysPressed[0]=this.pxlCamera.cameraMovement[0]<0?1:0,this.directionKeysPressed[1]=this.pxlCamera.cameraMovement[1]<0?1:0,this.directionKeysPressed[2]=this.pxlCamera.cameraMovement[0]>0?1:0,this.directionKeysPressed[3]=this.pxlCamera.cameraMovement[1]>0?1:0,this.pxlCamera.userInputMoveScalar.x=this.pxlCamera.cameraMovement[0],this.pxlCamera.userInputMoveScalar.y=this.pxlCamera.cameraMovement[1],this.pxlCamera.cameraMovementEase=1,this.pxlUser.setSpeed(this.userInputMoveScalar*this.pxlEnums.USER_SPEED.BASE)):(this.directionKeysPressed[0]=0,this.directionKeysPressed[1]=0,this.directionKeysPressed[2]=0,this.directionKeysPressed[3]=0,this.pxlCamera.cameraMovementEase=.85)}}addLookDelta(t){let i=!1;if(t.hasOwnProperty("status")&&(i=t.status),this.mouseX=t.currentPos.x,this.mouseY=t.currentPos.y,i)0===t.dragCount?(this.touchScreen=!0,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new e.Vector2(0,0),this.touchMouseData.curStepDistance=new e.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS):(this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new e.Vector2(t.startDelta.x,t.startDelta.y),this.touchMouseData.curStepDistance=new e.Vector2(t.stepDelta.x,t.stepDelta.y),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(new e.Vector2(t.previousPos.x,t.previousPos.y).sub(this.touchMouseData.endPos)),this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height));else{if(this.touchScreen=!1,this.touchMouseData.dragTotal+=t.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new e.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock)return void(this.touchMouseData.lock=!1);this.pxlAutoCam.touchBlender=!0}}togglePause(e=null){null===e&&(e=!this.pxlTimer.active),this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlTimer.pause(e),this.pxlTimer.active&&this.pxlEnv.mapRender(),this.pxlCamera.workerFunc("activeToggle",this.pxlTimer.active)}resizeRenderResolution(t=null,i=null){let s=window.innerWidth,r=window.innerHeight;s=t||s,r=i||r;let a=this.getRenderScalar();if(s*=a,r*=a,this.mapW=(this.sW=s)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=r)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW*this.screenRes.x,this.screenRatio.y=this.sH*this.screenRes.y,this.pxlEnv.geoList.HDRView){let e=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=e}if(this.touchMouseData.mBlurVelInf=new e.Vector2(2*this.screenRes.x,2*this.screenRes.y),!this.pxlEnv.mapGlowPass)return;this.pxlEnv.scene.renderTarget.setSize(this.mapW,this.mapH),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW,this.mapH),this.setCanvasSize(this.sW,this.sH),this.pxlRendering.resize(this.mapW,this.mapH),this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);let n=window.innerWidth/window.innerHeight;this.pxlCamera.setAspect(n);let o=[this.sW/this.sH,this.sH/this.sW],l=[1,1];l[0]=n>o[0]?1:this.sW/(this.sH*o[0]),l[1]=n>o[1]?this.sH/(this.sW*o[1]):1,l[0]>1?(l[1]*=1/l[0],l[0]=1):l[1]>1&&(l[0]*=1/l[1],l[1]=1),this.screenAspect.x=l[0]*(1/.5**.5),this.screenAspect.y=l[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlRendering.updateCompUniforms(),this.pxlEnv.roomNameList.forEach((e=>{var t;this.pxlEnv.roomSceneList[e].pxlCamAspect=n,null!=(t=this.pxlEnv.roomSceneList[e])&&t.resize&&this.pxlEnv.roomSceneList[e].resize(this.mapW,this.mapH)})),this.emit("resize",{rawWidth:window.innerWidth,rawHeight:window.innerHeight,width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:n}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}subscribe(e,t){this.subscriptableEvents.includes(e)?(this.callbackList[e]||(this.callbackList[e]=[]),this.callbackList[e].push(t)):console.error("Event type not subscribable: ",e)}unsubscribe(e,t){let i=-1;return this.callbackList[e]&&(i=this.callbackList[e].indexOf(t),i>=0&&this.callbackList[e].splice(i,1)),i>=0}emit(e,t){this.callbackList.hasOwnProperty(e)&&this.callbackList[e].forEach((e=>{e(t)}))}},Colliders:class{constructor(e=!1,t=100,i=500){this.pxlEnv=null,this.pxlUtils=null,this.verbose=e,this.delimiter=",",this.roomColliderData={},this.baseGridSize=t,this.degToRad=Math.PI/180,this.epsilon=1e-5,this.colliderBoundsReference=i,this.prevGridKey=""}setDependencies(e){this.pxlEnv=e,this.pxlUtils=e.pxlUtils}log(e){this.verbose>=Ms.INFO&&console.log(e)}debug(e){this.verbose>=Ms.DEBUG&&console.log(e)}warn(e){this.verbose>=Ms.WARN&&console.warn(e)}error(e){this.verbose>=Ms.ERROR&&console.error(e)}init(){}start(){}stop(){}step(){}prepColliders(t,i=Os.FLOOR,s=null){if(t.hasColliders()){s||(s=this.baseGridSize);let r=1/s;if(i===Os.HOVERABLE||i===Os.CLICKABLE)return void this.prepInteractables(t,i);let a=t.getName(),n=t.getColliders(i);this.roomColliderData.hasOwnProperty(a)||(this.roomColliderData[a]={}),this.roomColliderData[a].hasOwnProperty(i)||(this.roomColliderData[a][i]={},this.roomColliderData[a][i].helper=null,this.roomColliderData[a][i].count=0,this.roomColliderData[a][i].gridSize=s,this.roomColliderData[a][i].gridSizeInv=r,this.roomColliderData[a][i].faceVerts={},this.roomColliderData[a][i].faceGridGroup={});let o={min:new e.Vector2(1/0,1/0),max:new e.Vector2(-1/0,-1/0)};n.forEach((t=>{let i=t.geometry.attributes.position.array,s=i.length/3;for(let t=0;t<s;++t){let s=new e.Vector2(i[3*t],i[3*t+2]);o.min.min(s),o.max.max(s)}}));let l=o.max.clone().sub(o.min),h=Math.abs(Math.max(l.x,l.z)),c=Math.min(1,h/this.colliderBoundsReference);if(c<1){let e=s;r=1/(s*=c),this.roomColliderData[a][i].gridSize=s,this.roomColliderData[a][i].gridSizeInv=r,this.debug("Grid size adjusted for pxlRoom: "+a+"; from "+e+" to "+s+" units; "+c+"%"),this.debug("Reference bound set to: "+this.colliderBoundsReference+" units"),this.debug("Total pxlRoom bounds found: "+h+" units")}else this.debug("-- Grid size unchanged for pxlRoom '"+a+"', collider bounds within reference bounds --");this.debug("Collider bounds: {x:"+o.min.x+", y:"+o.min.y+"} -to- {x:"+o.max.x+", y:"+o.max.y+" }");let d=-1,u=0;n.forEach((t=>{d++;let s=t.geometry.attributes.position.array,n=s.length/3,o=t.matrixWorld;for(let l=0;l<n;++l){let n=9*l,h=new e.Vector3(s[n],s[n+1],s[n+2]),c=new e.Vector3(s[n+3],s[n+4],s[n+5]),A=new e.Vector3(s[n+6],s[n+7],s[n+8]);if(h.applyMatrix4(o),c.applyMatrix4(o),A.applyMatrix4(o),0===h.length()&&0===c.length()&&0===A.length())continue;let p=Math.min(h.x,c.x,A.x),m=Math.max(h.x,c.x,A.x),g=Math.min(h.z,c.z,A.z),f=Math.max(h.z,c.z,A.z),v=Math.floor(p*r),b=Math.floor(m*r),x=Math.floor(g*r),C=Math.floor(f*r);u++;let y=c.clone().sub(h),E=A.clone().sub(h),I=y.clone().cross(E),B=y.dot(y),w=y.dot(E),S=E.dot(E),D=1/(B*S-w*w),P=""!==t.name?t.name:"collider_"+d,T=this.getGridKey(P,"_face_",this.flattenVector3(h),this.flattenVector3(c),this.flattenVector3(A)),R={object:t,name:t.name,key:T,verts:[h,c,A],edge0:y,edge1:E,normal:I,dotE0E0:B,dotE0E1:w,dotE1E1:S,areaInv:D};if(this.roomColliderData[a][i].faceVerts[T]=R,v!==b||x!==C)for(let e=v;e<=b;++e)for(let t=x;t<=C;++t)this.addFaceToGridLocation(a,i,e,t,T);else this.addFaceToGridLocation(a,i,v,x,T)}}));let A=Object.keys(this.roomColliderData[a][i].faceGridGroup);for(let e=0;e<A.length;++e){let t=this.roomColliderData[a][i].faceGridGroup[A[e]];this.roomColliderData[a][i].faceGridGroup[A[e]]=[...new Set(t)]}this.roomColliderData[a][i].count=u,this.debug(" -- Collider Count for "+a+" : "+u)}else this.debug(" -- No colliders found for room: "+t.getName()),this.debug("      If you didn't intend on including collider objects in your FBX, something went wrong. Please check your FBX for unintentional collider user-detail attributes on mainScene objects.")}prepInteractables(t,i=Os.HOVERABLE){if(!t.hasColliderType(i))return;let s=t.getName(),r=t.getColliders(i);0!==r.length&&(this.roomColliderData.hasOwnProperty(s)||(this.roomColliderData[s]={}),r.forEach((t=>{let r=t.geometry.attributes.position.array,a=r.length/3,n=t.name;if(!this.roomColliderData[s].hasOwnProperty(n)){this.roomColliderData[s][n]={},this.roomColliderData[s][n].hoverable=i===Os.HOVERABLE,this.roomColliderData[s][n].clickable=i===Os.CLICKABLE,this.roomColliderData[s][n].gridSize=this.baseGridSize,this.roomColliderData[s][n].faceVerts={};for(let i=0;i<a;++i){let a=9*i,o=new e.Vector3(r[a],r[a+1],r[a+2]),l=new e.Vector3(r[a+3],r[a+4],r[a+5]),h=new e.Vector3(r[a+6],r[a+7],r[a+8]),c=l.clone().sub(o),d=h.clone().sub(o),u=c.clone().cross(d),A=this.getGridKey(n,"_",this.flattenVector3(o),this.flattenVector3(l),this.flattenVector3(h)),p={object:t,key:A,verts:[o,l,h],edge0:c,edge1:d,normal:u};this.roomColliderData[s][n].faceVerts[A]=p}}})))}isGridEdgeIntersecting(e,t,i,s,r,a){let n=t.x,o=t.z,l=0!==n?(i-e.x)/n:1/0,h=0!==n?(s-e.x)/n:-1/0,c=0!==o?(r-e.z)/o:1/0,d=0!==o?(a-e.z)/o:-1/0,u=Math.max(Math.min(l,h),Math.min(c,d)),A=Math.min(Math.max(l,h),Math.max(c,d));return A>=u&&A>=0&&u<=1}getGridKey(...e){return e.join(this.delimiter)}flattenVector3(e){return this.getGridKey(this.pxlUtils.toNearestStr(e.x),this.pxlUtils.toNearestStr(e.y),this.pxlUtils.toNearestStr(e.z))}addFaceToGridLocation(e,t,i,s,r){let a=this.getGridKey(i,s);this.roomColliderData[e][t].faceGridGroup[a]||(this.roomColliderData[e][t].faceGridGroup[a]=[]),this.roomColliderData[e][t].faceGridGroup[a].push(r)}castRay(e,t,i,s=Os.FLOOR,r=Fs.DOUBLE,a=!0){if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(s))return this.error("Room '"+e+"' does not have collider data for type: "+s),this.error(" -- Please register any collider objects with `pxlColliders.prepColliders()` or `pxlColliders.prepInteractables` first -- "),[];let n=this.roomColliderData[e][s],o=1/n.gridSize,l=Math.floor(t.x*o),h=Math.floor(t.z*o),c=this.getGridKey(l,h),d=1,u=1;if(r===Fs.FRONT?d=0:r===Fs.BACK&&(u=0),!n.faceGridGroup.hasOwnProperty(c))return[];let A=n.faceGridGroup[c],p={};A.forEach((e=>{let s=n.faceVerts[e],r=s.verts[0],a=s.edge0,o=s.edge1,l=i.clone().cross(o),h=a.dot(l);if(h*d>-this.epsilon&&h*u<this.epsilon)return;let c=t.clone().sub(r),A=c.dot(l);if(A<0||A>h)return;let m=c.clone().cross(a),g=i.dot(m);if(g<0||A+g>h)return;let f=1/h;A*=f,g*=f;let v=f*o.dot(m);if(v>this.epsilon){let e=t.clone().add(i.clone().multiplyScalar(v));p[v]={object:s.object,pos:e,dist:v}}}));let m=Object.keys(p);m.sort();let g=[];for(let e=0;e<m.length;++e)g.push(p[m[e]]);if(n.helper){let t=g.length>0?g[0]:-1;this.setHelperActiveFace(e,s,t)}return g}castGravityRay(e,t,i=Os.FLOOR,s=!0){if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(i))return[];let r=this.roomColliderData[e][i],a=r.gridSize,n=r.faceGridGroup,o=1/a,l=Math.floor(t.x*o),h=Math.floor(t.z*o),c=[this.getGridKey(l-1,h-1),this.getGridKey(l-1,h),this.getGridKey(l,h-1),this.getGridKey(l,h),this.getGridKey(l+1,h),this.getGridKey(l,h+1),this.getGridKey(l+1,h+1)],d=[];for(let e=0;e<c.length;++e)null!=n&&n.hasOwnProperty(c[e])&&d.push(...n[c[e]]);if(d=Object.keys(r.faceVerts),0===d.length)return[];d=[...new Set(d)];let u={};for(let e=0;e<d.length;++e){let i=r.faceVerts[d[e]],a=i.verts[0],n=i.verts[1],o=i.verts[2],l=t.clone().sub(a),h=i.normal,c=l.dot(h)/h.dot(h),A=t.clone().sub(h.clone().multiplyScalar(c)),p=o.sub(a),m=n.sub(a),g=A.clone().sub(a),f=p.dot(p),v=p.dot(m),b=p.dot(g),x=m.dot(m),C=m.dot(g),y=f*x-v*v;if(0===y)continue;y=1/(f*x-v*v);let E=(x*b-v*C)*y,I=(f*C-v*b)*y;if(E>=0&&I>=0&&E+I<1){let e=a.clone().add(p.multiplyScalar(E)).add(m.multiplyScalar(I)),r=t.distanceTo(e),n={object:i.object,pos:e,dist:r};if(u[r]=n,!s)return[n]}}let A=Object.keys(u);A.sort();let p=[];for(let e=0;e<A.length;++e)p.push(u[A[e]]);if(r.helper){let t=p.length>0?p[0]:-1;this.setHelperActiveFace(e,i,t)}return p}castInteractRay(t,i=[],s=null,r=e.Vector2(0,0),a=!0){if(null===s)return this.error("No camera provided for castInteractRay()"),[];let n=new e.Vector3(0,0,0);s.getWorldDirection(n);let o=s.position.clone(),l=s.fov*this.degToRad,h=Math.tan(.5*l),c=s.aspect,d=r.x*c*h,u=r.y*h,A=new e.Vector3(d,u,-1).applyMatrix4(s.matrixWorld).sub(s.position).normalize(),p={};i.forEach((e=>{let i=e.name,s=this.roomColliderData[t][i].faceVerts;Object.keys(s).forEach((t=>{let i=s[t],r=i.verts[0],n=i.verts[1],l=i.verts[2],h=i.edge0,c=i.edge1,d=i.normal,u=d.dot(A);if(Math.abs(u)<1e-6)return;let m=(d.dot(r)-d.dot(o))/u;if(m<0)return;let g=o.clone().add(A.clone().multiplyScalar(m)),f=r.clone().sub(g),v=n.clone().sub(g),b=l.clone().sub(g),x=v.clone().cross(b).length(),C=b.clone().cross(f).length(),y=f.clone().cross(v).length(),E=x+C+y,I=x/E,B=C/E,w=y/E;if(I>=0&&I<=1&&B>=0&&B<=1&&w>=0&&w<=1){let t=r.clone().add(h.multiplyScalar(I)).add(c.multiplyScalar(B)),i=o.distanceTo(t);if(p[i]={obj:e,pos:g},!a)return{obj:e,pos:g}}}))}));let m=Object.keys(p);m.sort();let g={order:[],hits:{},hitCount:0};for(let e=0;e<m.length;++e){let t=p[m[e]].obj,i=p[m[e]].pos,s=t.name;g.order.push(t),g.hits.hasOwnProperty(s)||(g.hits[s]=[]),g.hits[s].push(i),g.hitCount++}return g}toColorId(e,t=256){let i=1/t,s=1/(t*t);return[Math.floor(e*s)%t*i,Math.floor(e*i)%t*i,e%t*i]}getRandomColorIdList(e=64){let t=Array.from({length:e},((e,t)=>t)),i=parseInt(Math.floor(t.length/3));i+=1&i?0:1;let s=[];for(let r=0;r<e&&0!==t.length;++r){if(1===t.length){s.push(t.pop());break}let e=i*r%t.length,a=t.splice(e,1);s.push(a[0])}return s}buildHelper(t,i=Os.FLOOR){let s=t.getName(),r=this.roomColliderData[s][i],a=r.count;this.log("Building helper for "+s+" with "+a+" triangles");let n=new e.BufferGeometry,o=[],l=[],h=[],c=this.getRandomColorIdList(a),d=parseInt(a**.5);Object.keys(r.faceVerts).forEach(((e,t)=>{let i=r.faceVerts[e].verts;o.push(i[0].x,i[0].y+.1,i[0].z),o.push(i[1].x,i[1].y+.1,i[1].z),o.push(i[2].x,i[2].y+.1,i[2].z),h.push(0,0,0);let s=this.toColorId(c[t],d);l.push(...s,...s,...s)}));let u=new Float32Array(o),A=new Float32Array(l),p=new Float32Array(h);n.setAttribute("position",new e.BufferAttribute(u,3)),n.setAttribute("colorId",new e.BufferAttribute(A,3)),n.setAttribute("visibility",new e.BufferAttribute(p,1));let m=new e.ShaderMaterial({uniforms:{visibleFaceId:{value:-1}},vertexShader:"\nuniform float visibleFaceId;\n\nattribute vec3 colorId;\nattribute float visibility;\n\nvarying vec4 vCd;\nvarying float vVisibility;\n\nvoid main() {\n  vVisibility = visibility*.5+.5;\n\n  vCd = vec4( normalize(colorId), 0.50 ); // Pre-calculated Blue for visible face\n  if (visibleFaceId === 1.0) {\n    vCd = vec4( 0.0, 1.0, 0.0, 1.0 ); // Green for visible face\n  }\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nvarying vec4 vCd;\nvarying float vVisibility;\n\nvoid main() {\n\n  vec4 Cd = vCd;\n  //Cd.a *= vVisibility;\n  //Cd.rgb = vec3( vVisibility );\n\n  gl_FragColor = Cd;\n}\n"});m.side=e.DoubleSide,m.transparent=!0,m.depthTest=!0,m.depthWrite=!1,m.blending=e.AdditiveBlending;let g=new e.Mesh(n,m);return g.renderOrder=2,this.roomColliderData[s][i].helper=g,g}stepHelper(e,t=Os.FLOOR){let i=e.getName(),s=1/this.roomColliderData[i][t].gridSize,r=Math.floor(e.position.x*s),a=Math.floor(e.position.z*s);this.getGridKey(r,a),this.prevGridKey}setHelperActiveFace(e,t=Os.FLOOR,i=-1){this.roomColliderData[e][t].helper.material.uniforms.visibleFaceId.value=i}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];let t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Animation:class{constructor(t=null,i=null){this.pxlEnv=null,this.assetPath=t,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=i,this.clock=new e.Clock}setDependencies(e){this.pxlEnv=e}log(e){this.verbose&&console.log(e)}initObject(t,i){let s=null,r=null,a=i.children.length,n=0,o=[...i.children],l=0,h=0,c=0,d=0;for(;n<a;){let e=o[n];switch(e.type){case"Bone":++h,s=e;break;case"Mesh":++l,e.visible=!1;break;case"SkinnedMesh":++c,r=e;break;case"Group":++d,o=o.concat(e.children),a=o.length}++n}let u=!1;if(s||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),u=!0),r||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),u=!0),u)return console.log("Unable to prepare '"+t+"' for animation"),console.log("Group Count: "+d),console.log("Bone Root Found : "+(h>0)),console.log("Bone Count : "+h),console.log("Mesh Count: "+l),void console.log("SkinnedMesh Count: "+c);if(!this.objNames.includes(t)){this.objNames.push(t);let i=Object.assign({},this.animInitEntry);i.rig=s,i.mesh=r,this.animMixer[t]=new e.AnimationMixer(s),i.mixer=this.animMixer[t],this.objects[t]=i;let a=new e.MeshStandardMaterial;a.map=r.material.map,r.material=a}}addClips(e,t,i){if(!this.objNames.includes(e))return void this.log("Error, '"+e+"' not found in Animation Manager");Object.keys(this.objects[e].clips).includes(t)&&this.log("Warning, '"+t+"' already exists in '"+e+"'");let s=this.animMixer[e].clipAction(i.animations[0]);this.objects[e].clips[t]=s}hasClip(e,t){return!!this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)}getMixer(e){return this.objNames.includes(e)?this.animMixer[e]:null}getRig(e){return this.objNames.includes(e)?this.objects[e].rig:null}getMesh(e){return this.objNames.includes(e)?this.objects[e].mesh:null}getFallbackCycle(e){if(this.objNames.includes(e)){let t=Object.keys(this.objects[e].clips);if(t.length>0)return t[0]}return null}playClip(e,t){if(this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)){let i=this.objects[e].clips[t];this.objects[e].state=t,this.objects[e].prevTime=-1,this.objects[e].hasConnection=this.objects[e].connected.includes(t),this.setWeight(e,t,1,!0),i.reset(),i.play()}}setWeight(e,t,i,s=!1){if(this.objNames.includes(e)){let r=Object.keys(this.objects[e].clips);if(r.includes(t)){let a=this.objects[e].clips[t];a.enabled=!0,a.setEffectiveTimeScale(1),a.setEffectiveWeight(i),s&&r.forEach((i=>{if(i!==t){let t=this.objects[e].clips[i];t.enabled=!1,t.setEffectiveTimeScale(1),t.setEffectiveWeight(0)}}))}}}setStateConnections(e,t){if(this.objNames.includes(e)){let i=Object.keys(t);this.objects[e].connected=i,this.objects[e].connections=t}}step(e){if(this.objNames.includes(e)){if(!this.objects[e].hasConnection)return void this.animMixer[e].update(this.clock.getDelta());let t=this.objects[e].state;if(t){let i=this.objects[e].clips[t].time;if(this.objects[e].prevTime>i){let i=this.objects[e].connections[t],s=i[Math.floor(Math.random()*i.length)];this.playClip(e,s)}else this.animMixer[e].update(this.clock.getDelta()),this.objects[e].prevTime=i}else this.animMixer[e].update(this.clock.getDelta())}}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];let t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Rendering:class{constructor(e){this.pxlOptions=e,this.pxlEnv=null,this.pxlUser=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlQuality=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlShaders=null,this.engine=null,this.scene=null,this.shaderPasses={},this.stepShaderFuncArr=[],this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.mapMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerGlow=null,this.chromaticAberrationPass=null,this.lizardKingPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null}init(){}setDependencies(e){this.scene=e.scene,this.pxlEnv=e.pxlEnv,this.pxlUser=e.pxlUser,this.pxlUtils=e.pxlUtils,this.pxlTimer=e.pxlTimer,this.pxlQuality=e.pxlQuality,this.pxlDevice=e.pxlDevice,this.pxlCamera=e.pxlCamera,this.pxlShaders=e.pxlShaders}buildComposers(){var t,i;let s=(null==(t=this.pxlCamera.camera)?void 0:t.near)||.1,r=(null==(i=this.pxlCamera.camera)?void 0:i.far)||1e3;this.mapWorldPosMaterial=new e.ShaderMaterial({uniforms:{camNear:{type:"f",value:s},camFar:{type:"f",value:r}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=e.FrontSide,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.pxlOptions.postProcessPasses.roomGlowPass&&(this.blurComposer=new K(this.engine),this.shaderPasses.blurXShaderPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new V(U),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.pxlOptions.antiAliasing===Ls.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.pxlOptions.antiAliasing===Ls.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.pxlOptions.antiAliasing===Ls.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0)),this.mapComposerMotionBlur=new K(this.engine),this.mapMotionBlurPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new K(this.engine);let a=new q(this.pxlEnv.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(a),this.blurScreenMerge=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},mtDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.material.uniforms.mtDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);let n=new V(U);n.name="glowCopyPassBlur",this.mapComposerGlow.addPass(n),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new V(new e.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayHeavyPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayHeavyPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayHeavyPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new V(new e.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new V(new e.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlaySlimPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlaySlimPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.mapGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new K(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new e.Vector2(...this.pxlUser.lKingInactive),this.lizardKingPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lizardKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lizardKingPass.name="lizardKingPass",this.pxlUser.starFieldPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg",null,{encoding:e.LinearSRGBColorSpace})}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.starFieldPass.enabled=!1,this.pxlUser.starFieldPass.name="starFieldPass",this.pxlUser.crystallinePass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.crystallinePass.enabled=!1,this.pxlUser.crystallinePass.name="crystallinePass",this.pxlOptions.postProcessPasses.chromaticAberrationPass&&(this.chromaticAberrationPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},chroAberUVAlpha:{value:this.chroAberUVAlpha},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chromaticAberrationPass.enabled=!1,this.chromaticAberrationPass.name="chromaticAberrationPass",this.mapComposer.addPass(this.chromaticAberrationPass)),this.pxlOptions.postProcessPasses.lizardKingPass&&this.mapComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.mapComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.mapComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&(this.mapComposerWarpPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.pxlEnv.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},animTexture:{value:this.pxlEnv.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass)),this.mapBoxAAPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;let o=this.pxlEnv.roomSceneList[this.pxlEnv.bootRoom].scene;this.roomComposer=new K(this.engine),this.roomRenderPass=new q(o,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.pxlEnv.roomNameList.forEach((e=>{if(e!==this.mainRoom){let t=this.pxlEnv.roomSceneList[e].applyRoomPass(this.roomComposer);t&&(t.enabled=!1,this.roomComposer.addPass(t))}})),this.pxlOptions.postProcessPasses.roomGlowPass&&(this.roomBloomPass=new J(new e.Vector2(.5*this.pxlDevice.mapW,.5*this.pxlDevice.mapH),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.roomGlowPass=new V(new e.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.material.uniforms.gDiffuse=this.blurComposer.writeBuffer.texture,this.roomGlowPass.material.uniforms.rDiffuse=this.blurComposer.renderTarget2.texture,this.roomGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass)),this.pxlOptions.postProcessPasses.chromaticAberrationPass&&this.roomComposer.addPass(this.chromaticAberrationPass),this.pxlOptions.postProcessPasses.lizardKingPass&&this.roomComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.roomComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.roomComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new K(this.engine),this.delayPass=new V(new e.ShaderMaterial({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:null},tDiffusePrevRoom:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.material.uniforms.tDiffusePrev=this.mapComposer.renderTarget1.texture,this.delayPass.material.uniforms.tDiffusePrevRoom=this.roomComposer.renderTarget1.texture,this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.crystallinePass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}resize(e,t){this.pxlEnv.mapComposer&&this.pxlEnv.mapComposer.setSize(e,t),this.pxlEnv.mapComposerGlow&&this.pxlEnv.mapComposerGlow.setSize(e,t),this.pxlEnv.roomComposer&&this.pxlEnv.roomComposer.setSize(e,t),this.pxlEnv.roomGlowPass&&this.pxlEnv.roomGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer&&this.pxlEnv.delayComposer.setSize(e,t),this.pxlEnv.mapGlowPass&&this.pxlEnv.mapGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass&&this.pxlEnv.mapMotionBlurPass.setSize(e*this.pxlQuality.mBlurPercMult,t*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass&&(this.pxlEnv.mapOverlayHeavyPass.setSize(e,t),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlayPass&&(this.pxlEnv.mapOverlayPass.setSize(e,t),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlaySlimPass&&(this.pxlEnv.mapOverlaySlimPass.setSize(e,t),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,e/t))}updateCompUniforms(e=null){e&&(this.pxlRenderSettings.exposure=e*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}stepShaderValues(){this.stepShaderFuncArr.forEach((e=>{"object"==typeof e&&e.step()}))}},Environment:class{constructor(t,i="Default",s){this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[i]=[],this.parentNameList=[],this.pxlOptions=t,this.pxlRendering=null,this.prevRenderMS=0,this.prevRuntimeMS=0,this.nextRenderMS=0,this.fps=30,this.pxlOptions.fps.hasOwnProperty("mobile")?this.fps=s?this.pxlOptions.fps.mobile:this.pxlOptions.fps.pc:this.pxlOptions.fps.hasOwnProperty("Mobile")&&(this.fps=s?this.pxlOptions.fps.Mobile:this.pxlOptions.fps.PC),this.renderInterval=1/this.fps;let r="Default";r=this.pxlOptions.hasOwnProperty("pxlRoomName")?this.pxlOptions.pxlRoomName:i||"Default",this.pxlRoomAbsRoot=r;let a=r.split("/");a.splice(0,1),a=a.join("/"),r=r.startsWith("./")?r.slice(1):r,this.pxlOptions.hasOwnProperty("pxlRoomRoot")?this.pxlRoomLclRoot=this.pxlOptions.pxlRoomRoot:this.pxlRoomLclRoot="./"+r.split("/").pop().join("/"),this.mainRoom=i,this.bootRoom=i,this.bootLocation=null,this.currentRoom=i,this.roomNameList=[i],this.roomSubList={},this.roomSceneList={},this.roomSceneList[i]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.chroAberUVAlpha=null,this.blockAnimTexture=null,this.userScreenIntensity=new e.Vector2(0,.8),this.portaluserScreenIntensity=new e.Vector2(1,0),this.portalMtlRate=.7,this.mobile=s,this.camNear=.1,this.camFar=5e3,this.fogMult=new e.Vector2(0,0),this.fogColor=new e.Color(.07,.07,.1),this.fogColorSky=new e.Color(.1,.1,.12),this.fogExp=3e-4,this.fog=new e.FogExp2(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new e.Vector3(0,15,0),this.camInitLookAt=new e.Vector3(0,15,0),this.camThumbPos=new e.Vector3(0,0,0),this.camThumbLookAt=new e.Vector3(0,20,0),this.camReturnPos=new e.Vector3(0,0,0),this.camReturnLookAt=new e.Vector3(0,0,0),this.camLobbyPos=new e.Vector3(0,15,0),this.camLobbyLookAt=new e.Vector3(0,15,-100),this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new e.Group,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new e.Vector2(0,1),this.warpVisualCmd=null,this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new e.Vector2(1,0),this.blurDirCur=new e.Vector2(0,0),this.blurDirPrev=new e.Vector2(0,0),this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new e.Vector2(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(e,t)=>{}}setDependencies(e){this.scene=e.scene,this.pxlUtils=e.pxlUtils,this.pxlEnums=e.pxlEnums,this.pxlTimer=e.pxlTimer,this.pxlAnim=e.pxlAnim,this.pxlRendering=e.pxlRendering,this.pxlColliders=e.pxlColliders,this.pxlAutoCam=e.pxlAutoCam,this.pxlAudio=e.pxlAudio,this.pxlFile=e.pxlFile,this.pxlVideo=e.pxlVideo,this.pxlQuality=e.pxlQuality,this.pxlUser=e.pxlUser,this.pxlShaders=e.pxlShaders,this.pxlDevice=e.pxlDevice,this.pxlCamera=e.pxlCamera,this.pxlGuiDraws=e.pxlGuiDraws,this.emit=e.emit.bind(e)}log(...e){this.pxlOptions.verbose>Ms.INFO&&console.log(e)}debug(...e){this.pxlOptions.verbose>Ms.DEBUG&&console.log(e)}warn(...e){this.pxlOptions.verbose>Ms.WARN&&console.warn(e)}error(...e){this.pxlOptions.verbose>Ms.ERROR&&console.error(e)}init(){let e=Object.keys(this.pxlOptions);Object.keys(zs).forEach((t=>{e.includes(t)||(this.pxlOptions[t]=zs[t])})),Object.keys(this.roomSubList).forEach((e=>{this.roomSubList[e].init()}))}boot(){}setBootRoom(e,t){this.bootRoom=e,this.bootLocation=t}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0,this.pxlOptions.showOnboarding&&(this.pxlDevice.mobile||this.pxlAutoCam.enabled?this.pxlGuiDraws.toggleMobileWelcome(!0):this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help"))}postHelpIntro(){this.pxlDevice.mobile||this.pxlAutoCam.enabled?(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout((()=>{this.pxlAudio.initPlay()}),100))):this.pxlCamera.jogServerMemory(),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlDevice.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;let e=document.createElement("canvas"),t=!1;try{t=!!e.getContext("webgl")}catch(e){this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}t||console.warn("WebGL Context lost, reloading pxlNav")}this.emit("step",{time:this.pxlTimer.curMS,delta:this.pxlTimer.msRunner.y})}async stop(){this.setExposure(0),Object.keys(this.roomSubList).forEach((e=>{this.roomSubList[e].stop()}))}loadRoomByName(e){if(Object.keys(this.roomSceneList).includes(e)){let t=this.roomSceneList[e];this.loadRoom(t)}else this.warn("Room '"+e+"' not found, cannot load.")}loadRoom(t){return new Promise((async(i,s)=>{let r=t.roomName;this.log("Loading Room - ",r);try{t.setDependencies(this),t.camera=this.pxlCamera.camera,t.scene=new e.Scene,t.userAvatarGroup||(t.userAvatarGroup=new e.Group),t.scene.add(t.userAvatarGroup);var a={format:e.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?e.HalfFloatType:e.FloatType};t.scene.renderTarget=new e.WebGLRenderTarget(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc,a),t.scene.renderTarget.texture.format=e.RGBAFormat,t.scene.renderTarget.texture.minFilter=e.LinearFilter,t.scene.renderTarget.texture.magFilter=e.LinearFilter,t.scene.renderTarget.texture.generateMipmaps=!1,t.scene.renderTarget.depthBuffer=!0,t.scene.renderTarget.depthTexture=new e.DepthTexture(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc),t.scene.renderTarget.depthTexture.format=e.DepthFormat,t.scene.renderTarget.depthTexture.type=e.UnsignedShortType,this.roomNameList.includes(r)||this.roomNameList.push(r),this.roomSceneList[r]=t,this.debug(this.roomSceneList[r]),i(!0)}catch(e){console.error("Error Loading Room - ",r),console.error("Error details:",e.message),this.pxlOptions.verbose>=Ms.ERROR&&console.error("Full error:",e),s(e)}}))}startAllRooms(){this.roomNameList.forEach((e=>{this.startRoom(this.roomSceneList[e])}))}startRoom(e){e.active=!1,e.startTime=this.pxlTimer.msRunner.x}newSubRoom(e){this.roomSubList[e.getName()]=e}addToRooms(e){let t={};return this.roomNameList.forEach((i=>{let s=e.clone();this.roomSceneList[i].scene.add(s),t[i]=s})),t}addToRoomLayers(e,t=1){let i={};return this.roomNameList.forEach((s=>{let r=e.clone();this.roomSceneList[s].scene.add(r),i[s]=r,r.layers.set(t)})),i}addToRoomParents(t,i){let s={};return this.parentNameList.includes(i)||this.parentNameList.push(i),this.roomNameList.forEach((r=>{let a=t.clone();if(this.parentGroupList[r]||(this.parentGroupList[r]={}),!this.parentGroupList[r][i]){let t=new e.Group;this.parentGroupList[r][i]=t,this.roomSceneList[r].scene.add(t)}this.parentGroupList[r][i].add(a),s[r]=a})),s}buildRoomEnvironments(){this.debug("Building Room Environments - "),this.debug(this.roomNameList),this.roomNameList.forEach((e=>{this.roomSceneList[e].init&&this.roomSceneList[e].init(),this.roomSceneList[e].build&&this.roomSceneList[e].build()}))}getArtistInfo(){return null}setFogHue(e=[0,0],t=[1,1]){let i=[t[0]-e[0],t[1]-e[1]],s=Math.abs(.3183098861837907*Math.atan2(i[0],i[1])),r=(i[0]**2+i[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(s,.5*r+.3,.5*r),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(e=""){if("script_fog"===e){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,!0===this.pxlRendering.mapOverlayHeavyPass.enabled)return this.pxlRendering.mapOverlayHeavyPass.material;if(!0===this.pxlRendering.mapOverlayPass.enabled)return this.pxlRendering.mapOverlayPass.material;if(!0===this.pxlRendering.mapOverlaySlimPass.enabled)return this.pxlRendering.mapOverlaySlimPass.material}else{if("script_dArrows"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList.dArrows[0].material;if("script_userScreens"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.camScreenData.screenGeoList[0].material;if("script_warpZonePortals"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.returnPortalGlowList[0].material;if("script_lizardking"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.lizardKingPass.material;if("script_majorTom"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.starFieldPass.material;if("script_fractalSubstrate"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.crystallinePass.material;if("script_fractalEcho"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.delayPass.material;{let t=e.split("_");if(t.shift(),t=t.join("_"),this.geoList[t])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList[t].material}}}setShader(e,t,i){let s,r=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if("script_fog"===r)!0===this.pxlRendering.mapOverlayHeavyPass.enabled?s=this.pxlRendering.mapOverlayHeavyPass.material:!0===this.pxlRendering.mapOverlayPass.enabled?s=this.pxlRendering.mapOverlayPass.material:!0===this.pxlRendering.mapOverlaySlimPass.enabled&&(s=this.pxlRendering.mapOverlaySlimPass.material);else{if("script_dArrows"===r)return void this.geoList.dArrows.forEach((e=>{s=e.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_userScreens"===r)return void this.camScreenData.screenGeoList.forEach((e=>{s=e.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_warpZonePortals"===r)return void this.returnPortalGlowList.forEach((e=>{s=e.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_lizardking"===r)s=this.pxlRendering.lizardKingPass.material;else if("script_majorTom"===r)s=this.pxlUser.starFieldPass.material;else if("script_fractalSubstrate"===r)s=this.pxlUser.crystallinePass.material;else if("script_fractalEcho"===r)s=this.pxlRendering.delayPass.material;else{let e=r.split("_");e.shift(),e=e.join("_"),this.geoList[e]&&(s=this.geoList[e].material)}}s&&(s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0)}getAssetTexture(t,i=null,s=null){this.log("Get Internal Texture - ",t);let r=this.pxlUtils.assetRoot+t;if(!i){let e=t.split(".").pop().toLowerCase();"jpg"===e||"jpeg"===e?i=3:"png"===e&&(i=4)}return s||(s={encoding:e.LinearSRGBColorSpace,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.pxlUtils.loadTexture(r,i,s)}buildBackgroundObject(t={},i=null,s=null){let r=new e.PlaneGeometry,a={};Object.assign(a,t),(null===i||"string"!=typeof i)&&(i=this.pxlShaders.scene.bgScreenVert()),(null===s||"string"!=typeof s)&&(s=this.pxlShaders.scene.bgScreenFrag());let n=this.pxlFile.pxlShaderBuilder(a,i,s);n.side=e.DoubleSide,n.depthTest=!0,n.depthWrite=!1;let o=new e.Mesh(r,n);return o.frustumCulled=!1,o}clickUserDetect(){let e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(null!=e&&e.hasColliderType&&e.hasColliderType(Os.CLICKABLE)){let s=e.getColliders(Os.CLICKABLE);i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){let e=i.order[0];this.clickableActions(e.name)}else if(i={},i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t),i.hasOwnProperty("order")&&i.order.length>0){let e=i.order[0];this.promoActions(e)}}clickableActions(e=null){"CallToAction"===e&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(e=null){let t=e.userData.video;this.promoClickableLinks.hasOwnProperty(t)&&window.open(this.promoClickableLinks[t],"_blank").focus()}hoverUserDetect(){let e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(null!=e&&e.hasColliderType&&(e.hasColliderType(Os.CLICKABLE)||e.hasColliderType(Os.HOVERABLE))){let s=[...e.getColliders(Os.CLICKABLE),...e.getColliders(Os.HOVERABLE)];i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){let e=i.order[0];return this.pxlDevice.setCursor("help"),void(this.objectClickableObjectList[e.name]&&(null===this.clickablePrevActiveObject&&(this.clickablePrevActiveObject=e.name),this.objectClickableObjectList[e.name].Inactive.visible=!1,this.objectClickableObjectList[e.name].Hover.visible=!0))}if(this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab"),i={},i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t),i.hasOwnProperty("order")&&i.order.length>0){let e=i.order[0];this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[e.name]&&(null===this.promoPrevActiveObject&&(this.promoPrevActiveObject=e.name),this.promoClickableObjectList[e.name].x=1)}else this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab")}sendRoomMessage(e,t,i){this.roomSceneList[e]&&this.roomSceneList[e].onMessage(t,i)}buildComposers(){this.pxlRendering.buildComposers(),this.mapOverlayHeavyPass=this.pxlRendering.mapOverlayHeavyPass,this.mapOverlayPass=this.pxlRendering.mapOverlayPass,this.mapOverlaySlimPass=this.pxlRendering.mapOverlaySlimPass,this.mapBoxAAPass=this.pxlRendering.mapBoxAAPass,this.mapCrossAAPass=this.pxlRendering.mapCrossAAPass,this.mapWorldPosMaterial=this.pxlRendering.mapWorldPosMaterial,this.mapGlowPass=this.pxlRendering.mapGlowPass,this.mapComposer=this.pxlRendering.mapComposer,this.mapComposerMotionBlur=this.pxlRendering.mapComposerMotionBlur,this.mapComposerGlow=this.pxlRendering.mapComposerGlow,this.chromaticAberrationPass=this.pxlRendering.chromaticAberrationPass,this.lizardKingPass=this.pxlRendering.lizardKingPass,this.mapComposerWarpPass=this.pxlRendering.mapComposerWarpPass,this.blurScreenMerge=this.pxlRendering.blurScreenMerge}setExposure(e){e*=1,this.pxlCamera.uniformScalars.exposureUniformBase=e,this.pxlRendering.updateCompUniforms(e)}stepWarpPass(){if(this.warpVisualActive){let e=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],t=Math.min(1,3*e),i=Math.min(1,3-3*e);1===t&&1===i&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=t,this.warpVisualFader.y=i,i<=0&&this.stopWarpVisual()}}checkUserVideoStatus(e){}remoteUserUpdateMedia(e,t=!1,i=null){}userRemoveRemoteData(e){}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach((e=>{this.pxlUser.itemList[e].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate}))}initWarpVisual(e){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!0)}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom)}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(e,t){this.roomWarpVisuals[t].material.map=e}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(e){let t=this.roomSceneList[e];this.pxlRendering.engine.setRenderTarget(t.warpZoneRenderTarget),t.prepPortalRender(),this.pxlRendering.engine.render(t.scene||t.scene,this.pxlCamera.camera),t.cleanupPortalRender(),this.pxlRendering.engine.setRenderTarget(null)}mapRender(e=!0){if(this.pxlTimer.active&&this.step(),this.pxlTimer.runtime>this.nextRenderMS||!1===e){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.runtime+this.renderInterval,this.pxlRendering.stepShaderValues(),this.stepAnimatedObjects(),this.emit("render-prep",{time:this.pxlTimer.runtime});let e=this.roomSceneList[this.currentRoom];e&&e.booted&&(e.step(),e.camera.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(e.scene.renderTarget),this.pxlRendering.engine.clear(),this.pxlRendering.engine.render(e.scene,e.camera),this.pxlRendering.engine.setRenderTarget(null),e.camera.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(e,e.camera,e.scene,this.scene.renderGlowTarget),this.pxlRendering.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}else if(this.pxlOptions.subFrameCalculations){let e=this.roomSceneList[this.currentRoom];e&&e.booted&&e.step()}this.emit("render-post",{time:this.pxlTimer.runtime}),this.pxlTimer.active&&e&&requestAnimationFrame((()=>{this.mapRender()}))}mapRenderBlurStack(e,t,i,s){if(this.blurComposer){e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{if(e.userData.hasOwnProperty("GlowPerc")){let t=e.userData.GlowPerc;e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=t)}})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=0)}))),t.layers.disable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.disable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(s);let r=0,a=i.background.clone();i.background.set(r),this.pxlRendering.engine.setClearColor(r,0),this.pxlRendering.engine.render(i,t),i.background.r=a.r,i.background.g=a.g,i.background.b=a.b,t.layers.enable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.enable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(null),e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{e.userData.hasOwnProperty("GlowPerc")&&e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=1)})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=1)}))),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}},GUI:class extends qs{constructor(e,t="Metal-Asylum",i="images/assets/",s="images/GUI/"){super(e,t,i,s),this.verbose=e,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(e){super.setDependencies(e),this.ShaderEditor=new Ys(e,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(e){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(e)}},HUD:class{constructor(){this.pxlOptions=null,this.pxlEnums=null,this.pxlGuiDraws=null,this.pxlDevice=null,this.hudParent=null,this.huds={},this.mobileHUD={}}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlEnums=e.pxlEnums,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlDevice=e.pxlDevice}init(){let e=document.createElement("div");e.classList.add("pxlNav-hud-parent"),this.pxlGuiDraws.addToContainer(e),this.hudParent=e,this.pxlOptions.mobile&&!this.pxlOptions.staticCamera&&(e.classList.add("pxlNav-hud-parent-mobile"),this.createMobileHUD())}addToHUD(e){e.hasOwnProperty("block")&&null!==e.block?this.hudParent.appendChild(e.block):null!==(null==e?void 0:e.object)?this.hudParent.appendChild(e.object):this.hudParent.appendChild(e)}addItem(e="default",t,i,s=null,r=null){this.huds.hasOwnProperty(e)||(this.huds[e]=[]);let a=null;switch(t){case Us.REGION:a=this.createRegion(e,i,s,r),this.huds[e].push(a);break;case Us.DRAG_REGION:a=this.createDragRegion(e,i,s,r),this.huds[e].push(a);break;case Us.BUTTON:a=this.createButton(e,i,s,r),this.huds[e].push(a);break;case Us.THUMBSTICK:a=this.createThumbstick(e,i,s,r),this.huds[e].push(a);break;case Us.SLIDER:a=this.createSlider(e,i,s,r),this.huds[e].push(a);break;case Us.IMAGE:a=this.createImage(e,i,s,r),this.huds[e].push(a);break;case Us.TEXT:a=this.createText(e,i,s,r),this.huds[e].push(a)}return null!==a&&(null!==r?r.appendChild(a.object):this.addToHUD(a),null!==s&&a.subscribe(s)),a}createRegion(e,t,i=null,s=null){let r=new Js(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createDragRegion(e,t,i=null,s=null){let r=new Xs(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createButton(e,t,i=null,s=null){let r=new Js(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createThumbstick(e,t,i=null){let s=new Zs(e,t);return s.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),s.build(),null!==i&&s.subscribe(i),s}createSlider(e,t,i=null,s=null){let r=new Js(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createImage(e,t,i=null,s=null){let r=new Js(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createText(e,t,i=null,s=null){let r=new Js(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),null!==i&&r.subscribe(i),null!==s&&s.appendChild(r.object),r}createMobileHUD(){let e="",t="",i={},s=document.createElement("div");s.classList.add("pxlNav-hudMobile-parent"),s.classList.add(),this.hudParent.appendChild(s);let r=this.pxlEnums.HUD_ACTION.NONE,a=this.pxlEnums.HUD_ACTION.HOVER,n=this.pxlEnums.HUD_ACTION.ACTIVE;e="thumbstick_left",i={style:["pxlNav-hudMobile-joystick-left"],objectStyles:[{object:"block"},{object:"parent"},{object:"inner"}]},i.objectStyles[0][r]=["pxlNav-hudElement-thumbstick-block-default"],i.objectStyles[0][a]=["pxlNav-hudElement-thumbstick-block-hover"],i.objectStyles[0][n]=["pxlNav-hudElement-thumbstick-block-active"],i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][n]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-left"],i.objectStyles[2][r]=["pxlNav-hudElement-thumbstick-inner-default"],i.objectStyles[2][a]=["pxlNav-hudElement-thumbstick-inner-hover"],i.objectStyles[2][n]=["pxlNav-hudElement-thumbstick-inner-active"],t=this.addItem(e,Us.THUMBSTICK,Object.assign({},i)),t.subscribe((e=>{this.mobileDeligate(Gs.MOVE,e)})),this.mobileHUD[e]=t,e="thumbstick_right",i=Object.assign({},i),i.style=["pxlNav-hudMobile-joystick-right"],i.objectStyles[1]={object:"parent"},i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][n]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-right"],t=this.addItem(e,Us.THUMBSTICK,i),t.subscribe((e=>{this.mobileDeligate(Gs.LOOK,e)})),this.mobileHUD[e]=t,e="mobile_jump",i={style:["pxlNav-hudMobile-region-jump"]},t=this.addItem(e,Us.REGION,i,(e=>{this.mobileDeligate(Gs.JUMP,{},e)})),this.mobileHUD.jump=t,e="mobile_ACTION",i={style:["pxlNav-hudMobile-region-action"]},t=this.addItem(e,Us.REGION,i),t.subscribe((e=>{this.mobileDeligate(Gs.ACTION,e)})),this.mobileHUD.item=t}mobileDeligate(e,t={},i=!0){this.pxlDevice.deviceAction(e,t,i)}subscribe(e,t){this.huds.hasOwnProperty(e)&&(this.huds[e].hasOwnProperty("callbacks")||(this.huds[e].callbacks=[]),this.huds[e].callbacks.push(t))}emit(e,t){this.huds.hasOwnProperty(e)&&this.huds[e].hasOwnProperty("callbacks")&&this.huds[e].callbacks.forEach((e=>{e(t)}))}},Camera:class{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.hasMovementLimit=!0,this.movementMax=100,this.jumpScalar=1,this.userScale=1,this.maxStepHeight=5,this.cameraEasing=[.55,.45],this.touchMaxSensitivity=800,this.cameraJumpImpulse=[.75,1.5],this.cameraMaxJumpHold=[2.85,2],this.gravityCount=0,this.gravityRate=0,this.gravityMax=15.5,this.gravityUPS=[.3,.15],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlRendering=null,this.pxlEnv=null,this.pxlColliders=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.camUpdated=!0,this.cameraBooted=!1,this.hasMoved=!1,this.hasRotated=!1,this.hasJumped=!1,this.hasJumpLock=!1,this.hasGravity=!1,this.userInputMoveScalar={x:1,y:1},this.userInputLookScalar=1,this.roomStandingHeight={default:this.standingHeight},this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.walkBounceSeed=230,this.walkBounceHeight=.3,this.walkBounce=0,this.walkBouncePerc=0,this.walkBounceRate=.025,this.walkBounceEaseIn=.03,this.walkBounceEaseOut=.95,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new e.Vector3(0,0,0),this.camRotPitch=new e.Vector2(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.9,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new e.Vector3(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new e.Vector3(0,0,0),this.nearestFloorObjNamePrev=null,this.gravitySourceActive=!1,this.gravityDirection=new e.Vector3(0,-1,0),this.gravityEaseOutRate=.5,this.jump=0,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.08,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:.1,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"position",lookAt:"lookat"},mobile:{pos:"positionmobile",lookAt:"lookatmobile"},vr:{pos:"positionvr",lookAt:"lookatvr"}},this.cameraPos=new e.Vector3(0,0,0),this.cameraPrevPos=new e.Vector3(0,0,0),this.cameraPrevLookAt=new e.Vector3(0,0,0),this.cameraAim=new e.Vector3(0,0,1),this.cameraAimTarget=new e.Vector3(0,0,0),this.cameraCross=new e.Vector3(1,0,0),this.lookAtTargetActive=new e.Vector3(0,0,0),this.lookAtPerc=new e.Vector2(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new e.Quaternion,this.pi=3.141592653589793,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi,this.callbacks={},this.init()}setDependencies(e){this.pxlAudio=e.pxlAudio,this.pxlTimer=e.pxlTimer,this.pxlAutoCam=e.pxlAutoCam,this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv,this.pxlColliders=e.pxlColliders,this.pxlUser=e.pxlUser,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality,this.pxlOptions=e.pxlOptions,this.socket=e.socket}log(e){this.verbose>=Ms.INFO&&console.log(e)}warn(e){this.verbose>=Ms.WARN&&console.warn(e)}error(e){this.verbose>=Ms.ERROR&&console.error(e)}init(){}updateMainValues(e){let{gravityRate:t,standingHeightGravInfluence:i,cameraJumpImpulse:s}=e;null!=t&&(this.gravityRate=t),null!=i&&(this.standingHeightGravInfluence=i),null!=s&&(this.cameraJumpVelocity+=s),this.camUpdated=!0}setUserHeight(e,t="default"){e=Math.max(e,.01),this.roomStandingHeight.hasOwnProperty(t)||(this.roomStandingHeight[t]=this.standingHeight),"default"===t&&(this.standingHeight=e),this.roomStandingHeight[t]=e}setMaxStepHeight(e){e=Math.max(e,.01),this.maxStepHeight=e}setUserScale(e){e=Math.max(e,.01),this.userScale=e}setMovementScalar(e){e=Math.max(e,.01),this.movementScalar=e}setMovementMax(e){e=Math.max(e,.01),this.movementMax=e}setMovementEase(e){e=Math.min(1,Math.max(e,.01)),this.cameraMovementEase=e}setPositionBlend(e){e=Math.min(1,Math.max(e,.01)),this.camPosBlend=e}setInputMovementMult(e){e=Math.max(e,.01),this.cameraMoveLengthMult=e}setJumpScalar(e){e=Math.max(e,.01),this.jumpScalar=e}setJumpImpulse(e){e=Math.max(e,.01),this.cameraJumpImpulse[0]=e}setJumpHoldMax(e){e=Math.max(e,.01),this.cameraMaxJumpHold[0]=e}setJumpRepeatDelay(e){e=Math.max(e,.01),this.releaseJumpLockDelay=e}setCameraRotateEasing(e){Array.isArray(e)||("number"==typeof e?(e=[e,e],this.warn("Warning : Camera.setCameraEasing() expects an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")):this.error("Error : Camera.setCameraEasing() unexpected values type; expecting an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")),this.cameraEasing=e}setTouchSensitivity(e){e<=0&&(e=1),this.touchMaxSensitivity=e,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi}setGravityRate(e){e<=0&&(e=1),this.gravityRate=e}setGravityMax(e){e<=0&&(e=1),this.gravityMax=e}setWalkBounceHeight(e){e<=0&&(e=0),this.walkBounceHeight=e}setWalkBounceRate(e){e<=0&&(e=1e-4),this.walkBounceRate=e}setWalkBounceEaseIn(e){e=Math.min(1,Math.max(e,1e-4)),this.walkBounceEaseIn=e}setWalkBounceEaseOut(e){e=Math.min(1,Math.max(e,.01)),this.walkBounceEaseOut=e}setUserSettings(e){e.hasOwnProperty("height")&&(e.height.hasOwnProperty("standing")&&this.setUserHeight(e.height.standing),e.height.hasOwnProperty("stepSize")&&this.setMaxStepHeight(e.height.stepSize)),e.hasOwnProperty("movement")&&(e.movement.hasOwnProperty("scalar")&&this.setMovementScalar(e.movement.scalar),e.movement.hasOwnProperty("max")&&this.setMovementMax(e.movement.max),e.movement.hasOwnProperty("easing")&&this.setMovementEase(e.movement.easing)),e.hasOwnProperty("headBounce")&&(e.headBounce.hasOwnProperty("height")&&this.setWalkBounceHeight(e.headBounce.height),e.headBounce.hasOwnProperty("rate")&&this.setWalkBounceRate(e.headBounce.rate),e.headBounce.hasOwnProperty("easeIn")&&this.setWalkBounceEaseIn(e.headBounce.easeIn),e.headBounce.hasOwnProperty("easeOut")&&this.setWalkBounceEaseOut(e.headBounce.easeOut)),e.hasOwnProperty("jump")&&(e.jump.hasOwnProperty("impulse")&&this.setJumpScalar(e.jump.impulse),e.jump.hasOwnProperty("holdMax")&&this.setJumpHoldMax(e.jump.holdMax),e.jump.hasOwnProperty("repeatDelay")&&this.setJumpRepeatDelay(e.jump.repeatDelay)),e.hasOwnProperty("gravity")&&(e.gravity.hasOwnProperty("ups")&&this.setGravityRate(e.gravity.ups),e.gravity.hasOwnProperty("max")&&this.setGravityMax(e.gravity.max))}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.hasGravity=!1,this.cameraAllowJump=!0,this.camInitJump()),this.hasGravity&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse()),this.camUpdated=this.camUpdated||this.hasMoved||this.hasRotated||this.hasGravity||0!==this.cameraMovement[0]||0!==this.cameraMovement[1],this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(e){if(!this.pxlQuality.settings.leftRight){let e=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=e),this.pxlDevice.touchMouseData.netDistance.x+=4*e}if(null!=this.pxlDevice.touchMouseData.velocity&&!this.pxlDevice.mobile){if(e<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{let e=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(e)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(e){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),null===e&&(e=this.camera.position.clone()),this.camera.position.copy(e),this.updateCameraMatrices(),this.cameraPos.copy(e),this.cameraPrevPos.copy(e),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0,this.hasMoved=!0}setFOV(e){this.camera.fov=e,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(e,t,i,s){this.camera.near=i,this.camera.far=s,this.setFOV(e)}setAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setTransform(e,t=null){this.resetCameraCalculations(e),t&&(this.cameraAimTarget.position.copy(t),this.camera.lookAt(t),this.cameraPrevLookAt.copy(t),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(e,t=null){if(this.resetCameraCalculations(e.position),t){let e=t.position.clone();this.cameraAimTarget.position.copy(e),this.camera.lookAt(e),this.cameraPrevLookAt.copy(e),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=e.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.hasMoved=!0,this.hasRotated=!0,this.colliderCheck(e.position),this.nearestFloorObjName=null}warpToRoom(e,t=!1,i=null){let s=Object.keys(this.pxlEnv.roomSceneList),r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];i=(i=i||r.defaultCamLocation||"").toLowerCase(),"object"==typeof e&&(e=e.roomName||this.pxlEnv.currentRoom);let a=(e||"").toLowerCase(),n=this.pxlEnv.roomSceneList.hasOwnProperty(this.pxlEnv.currentRoom);r&&!s.includes(e)&&r.camLocation.hasOwnProperty(a)?(i=a,e=this.pxlEnv.currentRoom):(n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop(),r=this.pxlEnv.roomSceneList[e]);let o=this.pxlEnv.currentRoom,l=!1;n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasOwnProperty("camHoldWarpPos")&&(l=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos),this.pxlEnv.currentRoom=e,this.pxlAutoCam.curRoom=e;let h=e===this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){let t=h?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,i=h?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=t.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=i.renderTarget1.texture,setTimeout((()=>{o!==e&&(h?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1}),500)}),100)}if(t){if(!r)return void this.warn("pxlCamera.warpToRoom(); pxlRoom not found - "+this.pxlEnv.currentRoom);e!==o&&r.start(),this.pxlRendering.roomRenderPass.scene=r.scene;let t=i.toLowerCase();if(r.camLocation.hasOwnProperty(t)){let e=this.cameraPosLookAtNames.default.pos,i=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(r.camLocation[t].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(e=this.cameraPosLookAtNames.mobile.pos),r.camLocation[t].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(i=this.cameraPosLookAtNames.mobile.lookAt));let s=r.camLocation[t][e],a=r.camLocation[t][i];this.setTransform(s,a)}else r.camInitPos&&r.camInitLookAt&&(!l||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(this.setTransform(r.camInitPos,r.camInitLookAt),this.hotKeyTriggered=!1)}else(!l||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(null!=i?this.setToObj(i):this.setTransform(r.camReturnPos,r.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(r.getArtistInfo()),this.camUpdated=!0;let c=r.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=c,this.camera.zoom=r.pxlCamZoom,this.camera.aspect=r.pxlCamAspect,this.camera.near=r.pxlCamNearClipping,this.camera.far=r.pxlCamFarClipping,this.camera.updateProjectionMatrix();let d=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),d,!0),this.canMove&&(this.colliderValid=!1,this.hasGravity=!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(e){this.pxlEnv.currentRoom=e;let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],i=t.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=i,this.camera.zoom=t.pxlCamZoom,this.camera.aspect=t.pxlCamAspect,this.camera.near=t.pxlCamNearClipping,this.camera.far=t.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(t.camThumbPos,t.camThumbLookAt);let s=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),s,!0)}fastTravel(e=0){this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,0===e&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(e=!1){e?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.hasGravity&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.hasGravity=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.hasJumpLock&&(this.hasJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(e){let t=e-this.pxlDevice.keyDownCount[2],i=Math.min(1,t/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){let e=i;1===e?this.cameraJumpActive=!1:(e=(1-e)*(1-e),e*=.5*e+.5),this.cameraJumpVelocity+=Math.max(0,e)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar*this.pxlTimer.deltaTime}this.cameraJumpVelocity*=1-i,1===i&&(this.cameraJumpActive=!1)}killJumpImpulse(e=1){let t=this.cameraJumpVelocity*e*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=t>.1?t:0,this.workerFunc("killJumpImpulse")}updateGravity(e){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-this.cameraJumpVelocity);let t=this.gravityUPS[this.pxlUser.lowGrav];this.hasGravity&&(this.gravityCount+=2.5*t*e,this.gravityRate=Math.min(1,this.gravityRate+this.gravityMax)*this.gravityCount),0!==this.gravityRate&&(this.hasGravity||(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*t*e:0),this.standingHeightGravInfluence=Math.min(1,this.gravityRate/this.gravityMax)*this.standingMaxGravityOffset)}}resetGravity(){this.gravityCount=0,this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(e=!0){this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityCount=0,this.hasGravity=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,e&&this.workerFunc("jumpLanding")}colliderCheck(t){if(!this.canMove)return t;let i=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||null===this.colliderPrevObjHit||null===this.nearestFloorObjName)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;let n=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],o=new e.Vector3(0,-1,0),l=t.clone(),h=150*this.maxStepHeight;l.y+=h+this.maxStepHeight;var s=[];if(n.hasColliderType(Os.WALL)&&(s=this.pxlColliders.castRay(this.pxlEnv.currentRoom,l,o,Os.WALL)),s.length>0)if(n.hitColliders(s,Os.WALL),n.hasColliderType(Os.WALL_TOP)){let e=this.pxlColliders.castRay(this.pxlEnv.currentRoom,l,o,Os.WALL_TOP);e.length>0&&n.hitColliders(e,Os.WALL_TOP);let s,h,c=-99999,d=this.nearestFloorHit,u=!1;for(var r=0;r<e.length;++r){var a=e[r];s=a.object.name;let t=a.pos,n=a.dist,o=t.y<this.maxStepHeight;u=u||o,(n<c&&o||null===i)&&(i=s,c=n,d=t)}(!u||t.y<d.y&&this.nearestFloorHitPrev.y-d.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity&&t.y+this.maxStepHeight+this.getStandingHeight()<d.y&&this.hasGravity)&&((0!==this.cameraMovement[0]||0!==this.cameraMovement[1])&&(u=!0,this.hasGravity=!1,this.hasJumpLock=!0),h=this.cameraPos.clone(),h.y=Math.min(t.y,h.y),d=t=h,this.hasGravity?d.y=this.nearestFloorHitPrev.y:d.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),u&&(null===i?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(t.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.hasGravity=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=d,this.nearestFloorObjName=i))}else this.colliderFail=!0,this.movementBlocked=!0;else{let e=this.maxStepHeight;if(l=t.clone(),l.y+=h+this.maxStepHeight,!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasColliders())return t;if((s=this.pxlColliders.castRay(this.pxlEnv.currentRoom,l,o,Os.FLOOR)).length>0){if(s.length>1){let i=Math.abs(s[0].pos.y-t.y);if(i<e)s=[s[0]];else if(i>e&&s[0].pos.y>s[1].pos.y&&s[1].pos.y>t.y-this.maxStepHeight)return t}this.floorColliderInitialHit=!0;let r,a=-99999,n=this.nearestFloorHit;for(let e=0;e<s.length;++e){let o=s[e],l=o.pos,h=!1;r=o.object.name;let c=l.distanceTo(t);if(h=c<this.maxStepHeight,(this.portalList[r]||this.roomWarpZone.includes(r))&&h){i=r,n=l;break}this.itemCheck(r,h)||(c<a||null===i)&&(i=r,a=c,n=l)}null===this.nearestFloorObjName&&null!=i&&(this.nearestFloorHitPrev=n,this.nearestFloorObjNamePrev=i,this.nearestFloorHit=n,this.nearestFloorObjName=i),this.nearestFloorHitPrev.y-n.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,t=i?this.cameraPos.clone():this.cameraPrevPos.clone(),i=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=n,this.nearestFloorObjName=i,null===i&&(this.colliderValid=!1,this.hasGravity=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,t=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,t}checkColliderValid(e){this.colliderValidityChecked=!0;let t=this.maxStepHeight+this.gravityRate,i=e.distanceTo(this.nearestFloorHit),s=i<t;return this.colliderValid=s,i}eventTrigger(e=null){if(!this.canMove||!e)return!1;if(this.portalList[e])return this.warpEventTriggered(0,this.portalList[e]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(e))return this.warpEventTriggered(1,e),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!==e||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=e,this.colliderShiftActive=this.colliderShiftActive||!(1===this.colliderAdjustPerc||0===this.colliderAdjustPerc),this.colliderShiftActive&&this.colliderCurObjHit){let e=1;this.colliderCurObjHit.includes("AudioTrigger")&&(e=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*e));let t=1-this.colliderAdjustPerc,i=1;if("AudioTrigger_1"===this.colliderCurObjHit?(this.pxlEnv.currentAudioZone=1,i-=t*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=i):"AudioTrigger_2"===this.colliderCurObjHit?(this.pxlEnv.currentAudioZone=2,i=this.uniformScalars.curExp+t*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=i,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)):(this.pxlEnv.currentAudioZone=0,i=i*(1-t)+this.uniformScalars.exposureUniformBase*t),this.colliderShiftActive=!(1===this.colliderAdjustPerc||0===this.colliderAdjustPerc),"AudioTrigger_2"===this.colliderPrevObjHit&&this.colliderCurObjHit!==this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(i=this.colliderAdjustPerc),this.pxlRendering.updateCompUniforms(i),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){let e=this.colliderAdjustPerc;e=1-(1-e)*(1-e),this.pxlEnv.fogMult.x=e,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(e,t){if(!t)return!1;let i=e.split("_").shift();return!(!this.pxlUser.itemListNames.includes(e)||!this.pxlUser.checkItemPickUp(i))&&this.itemActive(i,e)}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{0===this.pxlUser.mPick.length&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));let e=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(e),this.itemActive(e)}}itemActive(e=null,t=null){if(null===e)return!1;let i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,s="",r="";if("LowGravity"===e)r="Low Gravity",s="this.lowGrav=0;this.itemGroupList['"+t+"'].visible=true;",i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("LizardKing"===e)r="I am the Lizard King",s="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lizardKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("StarField"===e)r="Major Tom",s="this.sField=0;this.starFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else{if("InfinityZoom"!==e)return!1;r="Fractal Substrate",s="this.iZoom=0;this.crystallinePass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout((()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0}),500)}),500)}return this.pxlGuiDraws.buildItemHud(e,r),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[t].visible=!1),this.pxlUser.itemInactiveCmd.push(s),this.pxlUser.itemActiveTimer.push(i),this.pxlUser.itemActiveList.push(r),!0}toggleMovement(e=null){null===e&&(e=!this.canMove),this.canMove=e,this.hasGravity=e}updateMovement(e){if(!this.canMove||this.pxlDevice.mobile)return;let t=[0,0],i=[...this.pxlDevice.directionKeysPressed],s=0,r=0,a=[e-this.pxlDevice.keyDownCount[0],e-this.pxlDevice.keyDownCount[1]],n=this.mobile?1:0;if(i[0]+i[2]===1){s=i[2]-i[0];let e=this.pxlQuality.settings.leftRight?this.cameraEasing[n]:.5*(1-Math.min(1,Math.abs(.3*this.cameraMovement[1])));t[0]=((this.pxlQuality.settings.leftRight?1:6)+a[0]*a[0]*.1)*e,t[0]=Math.min(this.pxlUser.moveSpeed,t[0])*this.movementScalar*this.userInputMoveScalar.x}else this.pxlDevice.keyDownCount[0]=e;if(i[1]+i[3]===1){r=i[3]-i[1];let e=(1-Math.min(1,Math.abs(.07*this.cameraMovement[0])))*this.cameraEasing[n];t[1]=a[1]*(3*a[1]+2+this.pxlUser.moveSpeed)*.5*e,t[1]=Math.min(this.pxlUser.moveSpeed,t[1])*this.movementScalar*this.userInputMoveScalar.y}else this.pxlDevice.keyDownCount[1]=e;this.hasMovementLimit=!0,this.movementMax=10,this.cameraMovement[0]+=s*t[0],this.cameraMovement[1]+=r*t[1]}initFrameCamPosition(){let t=this.cameraPos.clone();if(this.cameraBooted){let i;i=new e.Vector3(this.pxlQuality.settings.leftRight?.5*this.cameraMovement[0]:0,0,this.cameraMovement[1]),this.cameraMoveLength=i.length(),i.applyQuaternion(this.camera.quaternion);let s=this.cameraMoveLength*this.cameraMoveLengthMult;if(0!==s){let r=.1;s=s>0?Math.max(r,s):Math.min(-r,s),i.normalize().multiply(new e.Vector3(1,0,1)).multiplyScalar(s),t.add(i),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,0===this.cameraMovement[0]&&(this.userInputMoveScalar.x=1),0===this.cameraMovement[1]&&(this.userInputMoveScalar.y=1),this.hasMoved=!0}t.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}else this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new e.Vector3(t.clone()),this.cameraPrevLookAt=new e.Vector3(0,0,1),this.hasMoved=!0,this.hasRotated=!0;return this.cameraCross=new e.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),t}applyGravity(e){if(this.canMove&&this.hasGravity)if(e.y<this.nearestFloorHit.y){let t=this.nearestFloorHitPrev;e.y=Math.max(t.y,e.y),e.y<0&&(e.x=t.x,e.z=t.z)}else e.y=Math.max(this.nearestFloorHit.y,e.y-this.gravityRate),e.y===this.nearestFloorHit.y&&e.y<this.cameraPrevPos.y&&this.jumpLanding();else if(e.distanceTo(this.nearestFloorHit)<this.maxStepHeight)e.y=this.nearestFloorHit.y;else{let t=(e=this.cameraPos.clone()).y>this.nearestFloorHit.y;this.hasGravity=t,this.hasMoved=this.hasMoved||t,this.colliderFail=!t,this.workerFunc("jumpLanding")}return e}getStandingHeight(){let e=this.standingHeight;return this.roomStandingHeight.hasOwnProperty(this.pxlEnv.currentRoom)&&(e=this.roomStandingHeight[this.pxlEnv.currentRoom]),e*this.userScale}getUserHeight(){let e=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+this.walkBounceEaseIn*e,this.walkBounce+=e*this.walkBounceRate,this.walkBouncePerc=this.walkBouncePerc*this.walkBounceEaseOut+e,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=2351.3256*Math.random());let t=Math.sin(this.walkBounce+this.walkBounceSeed)*this.walkBouncePerc*this.walkBounceHeight;return this.getStandingHeight()-this.standingHeightGravInfluence+t}camApplyMobileRotation(){if(null!=this.cameraPose.alpha){let t=.017453292519943278,i=2.23606797749979,s=new e.Quaternion,r=this.cameraPose.alpha*t+this.cameraPose.alphaOffset+2.1,a=this.cameraPose.beta*t,n=this.cameraPose.gamma*t,o=new e.Vector3(0,0,1),l=new e.Quaternion,h=new e.Quaternion(-i,0,0,i),c=new e.Euler;c.set(a,r,-n,"YXZ"),s.setFromEuler(c),s.multiply(h),s.multiply(l.setFromAxisAngle(o,-this.cameraPose.orientation)),s.normalize();let d=new e.Quaternion;e.Quaternion.slerp(this.camera.quaternion,s,d,.35);let u=(new e.Euler).setFromQuaternion(d);u.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,u.x)),d.setFromEuler(u),this.camera.setRotationFromQuaternion(d),this.hasRotated=!0}}updateRoamRotation(){if(null===this.cameraPose.alpha){let t=this.pxlDevice.gyroGravity[2];this.pxlDevice.touchMouseData.velocity.y=Math.min(this.touchSensitivityLimits,Math.max(-this.touchSensitivityLimits,this.pxlDevice.touchMouseData.velocity.y));let i,s=new e.Euler;if(this.pxlDevice.mobile){let r=this.pxlOptions.userSettings.look.mobile.invert?-1:1;s.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*4*r,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*7*r+t,0,"YXZ"),i=new e.Quaternion,i.setFromEuler(s),i=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(i)}else{let r=this.pxlOptions.userSettings.look.pc.invert?-1:1;s.set(.005*this.pxlDevice.touchMouseData.velocity.y*r,.008*this.pxlDevice.touchMouseData.velocity.x*r+t,0,"YXZ"),i=new e.Quaternion,i.setFromEuler(s),i=this.camera.quaternion.clone().multiply(i)}i.normalize();let r=new e.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(r),this.camera.up.set(0,1,0),this.hasRotated=!0}}updateStaticRotation(){let t=1;this.touchBlender?(t=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),t*=t,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-t),this.touchBlender=t<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let i=new e.Euler;i.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let s=(new e.Quaternion).clone(this.camera.quaternion);s.setFromEuler(i),s=this.camera.quaternion.clone().multiply(s),s.normalize(),this.touchBlender&&s.slerp(this.camera.quaternion.clone(),t).normalize();let r=new e.Vector3(0,0,-10).applyQuaternion(s).add(this.camera.position);this.camera.setRotationFromQuaternion(s),this.camera.lookAt(r),this.camera.up.set(0,1,0),this.hasRotated=!0}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(0!==this.lookAtLockFader&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,.001*this.pxlDevice.touchMouseData.velocity.length()))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){let e=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);let t=this.camera.quaternion.clone();1===this.lookAtLockPerc?this.camera.setRotationFromQuaternion(t):this.camera.setRotationFromQuaternion(t.slerp(e,.5*Math.cos(this.lookAtLockPerc*this.pi)+.5)),this.hasRotated=!0}}warpEventTriggered(e=0,t=null,i="init"){this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=e,this.warpObj=t,this.warpTarget=i,this.warpActive=!0,this.pxlEnv.initWarpVisual(e))}warpCamRun(){if(0===this.warpType)this.setToObj(this.warpObj);else if(1===this.warpType){let e="init"===this.warpTarget;this.warpToRoom(this.warpObj,e,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){let t=new e.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),i=t.clone().multiply(new e.Vector3(1,0,1)).normalize();this.camRotPitch.set(.1591549430918955*-Math.atan2(i.x,i.z),.5*t.y)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){let t,i=new e.Vector3(0,0,0);if(i.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(i.multiplyScalar(.2)),this.pxlDevice.mobile){let i=.5*this.pxlDevice.sW,s=.5*this.pxlDevice.sH,r=new e.Vector3(0,0,10),a=new e.Vector3(0,0,10);r.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),a.applyQuaternion(this.prevQuaternion).project(this.camera),r.x=(r.x+1)*i,r.y=-(r.y-1)*s,a.x=(a.x+1)*i,a.y=-(a.y-1)*s,t=a.clone().sub(r.clone()).multiplyScalar(.6).multiply(new e.Vector3(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0));let n=.1;t.length>n&&t.normalize().multiplyScalar(n)}else t=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));let s=new e.Vector2(t.x,-t.y),r=new e.Vector2(0,0).lerpVectors(this.pxlEnv.blurDirPrev,s,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(r)}}emitCameraTransforms(e,t,i=!1){this.emit("cameraTransforms",{cameraPos:e,standingHeight:t,force:i})}jogServerMemory(){let e=this.cameraPos.clone(),t=this.getUserHeight();this.emitCameraTransforms(e,t,!0)}updateCamera(){let e=this.pxlDevice.touchMouseData.velocity.length();if(this.hasRotated=this.hasRotated||e>0,this.camUpdated=this.camUpdated||this.hasRotated,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated){this.camUpdated=!1;let t=!1;this.updateDeviceValues(e),this.prevQuaternion.copy(this.camera.quaternion);let i=this.initFrameCamPosition(),s=this.getUserHeight();if(this.pxlOptions.staticCamera)return this.hasGravity=!1,this.hasMoved=!1,this.pxlOptions.allowStaticRotation&&this.hasRotated&&(this.updateStaticRotation(),this.camera.updateMatrixWorld()),void(this.hasRotated=!1);(this.hasMoved||this.hasGravity)&&(i=this.colliderCheck(i),this.updateGravity(this.pxlTimer.deltaTime),this.colliderValid||this.colliderValidityChecked?this.jump=0:this.jump=this.checkColliderValid(i),this.eventCheckStatus=!0,i=this.applyGravity(i),this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=i.clone(),t=this.cameraPos.distanceTo(this.cameraPrevPos)>0,i.y+=s+this.cameraJumpHeight,this.camera.position.copy(i)),this.hasRotated&&this.canMove?(this.updateRoamRotation(),t=t||this.hasRotated):this.hasRotated&&(this.updateStaticRotation(),t=t||this.hasRotated),t&&(this.camera.updateMatrixWorld(),this.emitCameraTransforms(i,s)),this.hasMoved=!1,this.hasRotated=!1,this.cameraBooted=!0}}subscribe(e,t){this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){let i=!1;return this.callbacks.hasOwnProperty(e)&&(i=this.callbacks[e].includes(t),i&&(this.callbacks[e]=this.callbacks[e].filter((e=>e!==t)))),i}emit(e,t){this.callbacks.hasOwnProperty(e)&&this.callbacks[e].forEach((e=>{e(t)}))}},AutoCamera:class{constructor(t=!1){this.enabled=t,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new e.Vector2,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlAudio=e.pxlAudio,this.pxlCamera=e.pxlCamera,this.pxlEnv=e.pxlEnv,this.camera=e.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;let{roomList:e,pathCounts:t}=this.getAutoCamData();this.roomList=e,this.curRoom=this.roomList[0],this.pathCounts=t,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(e=!1){if(null===this.autoCamActive||null===this.active)return this.autoCamActive=!1,this.active=!1,!0;if(!1===this.active){if(!this.autoCamActive)return!0;this.updateAutoCamera()}if((this.pxlTimer.curMS>=this.nextCamChange||e)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!e||!this.enabled){let e=this.checkCamMode();this.setNextTrigger(e)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),1===this.camMode||2===this.camMode?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){let e=this.camMode;return this.camMode=0,!this.enabled||!this.active||this.camMode!==e&&0===this.camMode&&(this.forceNewRoom=!0),1}setCamMode(e){let t=1;return 1===e.type||2===e.type?t=1:(this.camMode=0,this.forceNewRoom=!0),this.step(!0),t}stepDroneCam(){let e=!0,t=Math.random(this.nextCamChange),i=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=2*i&&(this.forceNewRoom=!0),(t<.3||this.forceNewRoom)&&(this.setRoom(),e=!1),this.curRoomCount+=1,this.getNextPath(e)}setRoom(e=!1,t=!1){if(this.active||this.autoCamActive){let i=this.curRoomIndex,s=this.roomList.length;this.pxlEnv.postIntro?t||(e?i=(i+1)%s:(i=Math.floor(Math.random()*s),i===this.curRoomIndex&&(i=(i+1)%s))):i=0,this.curRoomIndex=i,this.curRoom!==this.roomList[i]&&(this.curRoom=this.roomList[i],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(e=1){let t=Math.random(this.nextCamChange);t=(this.delayRange[1]-this.delayRange[0])*t+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+t*e}getNextPath(e=!0,t=1){if(this.enabled&&this.active&&this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){let i=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+t)%i,e&&0===t){let e=Math.random(this.nextCamChange);e=Math.floor(e*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath===e&&(e=(e+1)%i),this.curPath=e}else this.curPath=this.curPath<0?i-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||"AudioTrigger_2"===this.pxlCamera.colliderCurObjHit&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(e=0){this.autoCamMode=e,1===e&&(this.resetAutoCam=!0)}setPosQuat(e,t){this.camera.quaternion.copy(t),this.camera.position.copy(e),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(t=null,i=1){if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;let s=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=s-1);let r=this.autoCamActive;if(this.autoCamActive=null===t&&s>0?!this.autoCamActive:t,this.autoCamActive=this.mobile||this.autoCamActive,!r&&this.autoCamActive&&(this.netDistance=(new e.Vector2).copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+i)%s,this.autoCamId=this.autoCamId<0?s-1:this.autoCamId;let e=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=e.position.userData.duration;try{this.autoCamPositions=e.position.geometry.attributes.position,this.autoCamLookAt=e.lookAt.geometry.attributes.position,e.up?this.autoCamUp=e.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch(e){}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(e=1,t=!1){this.autoCamActive&&(this.enabled&&this.active&&!t?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,e))}setAutoCamPath(e=0){this.autoCamActive&&(this.autoCamId=e,this.toggleAutoCam(!0,0))}getAutoCamData(){let e=Object.keys(this.autoCamPaths),t={};return e.forEach((e=>{t[e]=this.autoCamPaths[e].length})),{roomList:e,pathCounts:t}}getAutoCamValueFromCurve(t,i,s,r=!1){let a=t[3*i],n=t[3*i+1],o=t[3*i+2],l=(i+1)%this.numControlPoints,h=t[3*l],c=t[3*l+1],d=t[3*l+2],u=new e.Vector3(a,n,o),A=new e.Vector3(h,c,d);return u.lerp(A,s),u}updateAutoCamera(){if(!this.autoCamPositions||!this.autoCamPositions.array)return;let e=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;e*=this.numControlPoints-1;let t=Math.floor(e),i=e-t,s=this.getAutoCamValueFromCurve(this.autoCamPositions.array,t,i,!1);this.camera.position.copy(s);let r=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,t,i);if(this.camera.lookAt(r),this.autoCamUp){let e=this.getAutoCamValueFromCurve(this.autoCamUp.array,t,i);e=e.sub(s).normalize(),this.camera.up.copy(e)}}applyTouchRotate(){let t=1;this.touchBlender?(t=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),t*=t,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-t),this.touchBlender=t<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let i=new e.Euler;i.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let s=(new e.Quaternion).clone(this.camera.quaternion);s.setFromEuler(i),s=this.camera.quaternion.clone().multiply(s),s.normalize(),this.touchBlender&&s.slerp(this.camera.quaternion.clone(),t).normalize();let r=new e.Vector3(0,0,-10).applyQuaternion(s).add(this.camera.position);this.camera.setRotationFromQuaternion(s),this.camera.lookAt(r),this.camera.up.set(0,1,0)}},Extensions:O,MusicUtils:class{constructor(){this.audioObject=null}},Audio:class{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new e.Vector3(0,0,0),this.audioEq=new e.Vector4(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.audioCtx=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlVideo=e.pxlVideo,this.pxlDevice=e.pxlDevice,this.pxlEnv=e.pxlEnv,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlSocket=e.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){let t=function(a){setTimeout((()=>{i.djAudioVolume=0,i.djAudioVolumeMax=s,i.djAudioVolumeMin=0,i.djAudioObj.byScript=!0,i.djAudioObj.volume=0,e.play().then((()=>{i.djPlayerMuteToggle(!1),i.setFadeActive(.5)})),r.removeEventListener("click",t),r.removeEventListener("touchstart",t)}),500)},i=this,s=this.djAudioVolumeMax,r=document.getElementById("guiMobileWelcomeButton");r.addEventListener("click",t),r.addEventListener("touchstart",t)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();let e=this.djAudioObj;e.setAttribute("autoplay",!0);let t=this;this.djAudioObj.addEventListener("volumechange",(e=>{t.djPlayerSetSliderGui()}),!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch((e=>{})),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){let e=!0;return this.djAudioObj&&(e=this.djAudioObj.paused),e}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;let e=this.djAudioObj;e.children[0].setAttribute("src",this.djUrlSource),setTimeout((()=>{e.load(),setTimeout((()=>{e.volume=this.djAudioVolume,e.muted=this.djMuted||!this.roomAudioStopped,e.paused&&e.play()}),20)}),20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{let e=this.djAudioObj;e.children[0].setAttribute("src",""),e.pause(),setTimeout((()=>{e.load()}),20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";let e=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=t=>{e.djPlayerAdjustVolume(t)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",(t=>{e.djVolumeParentObj.down=!0,e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mousemove",(t=>{e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mouseup",(t=>{e.djVolumeParentObj.down=!1})),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",(t=>{e.djVolumeParentObj.down=!0}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",(t=>{e.djPlayerAdjustVolume(t)}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",(t=>{e.djVolumeParentObj.down=!1}),{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(e){}buildRemoteAudioMixer(e,t){return!1}loadStreamPromise(){let e=this.djAudioObj;return new Promise(((t,i)=>{this.djAudioObj.byScript=!0,e.children[0].setAttribute("src",this.djUrlSource),e.load(),e.muted=this.djMuted||!this.roomAudioStopped})).then((()=>{})).catch((e=>{console.log("error source")}))}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=100*this.djAudioVolume*~~!this.djMuted+"%"}djPlayerAdjustVolume(e){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&e.touches){let t=this.djVolumeParentObj.offsetWidth,i=0;i=e.touches?this.pxlDevice.objectPerc.percX:e.offsetX/t;let s=Math.max(0,Math.min(1,i));this.djAudioVolume=s,this.djAudioVolumeMax=s,this.djAudioVolumeMin=.1*s,s*=s,this.djAudioObj&&(this.djAudioObj.volume=s),e.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(e=null){this.djMuted=null===e?!this.djMuted:e,null!=e&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!e,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(e=1){this.fadeDir!==e&&(this.fadeDir=e,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1)return this.fadePerc=1===this.fadeDir?1:0,void(this.fadeActive=!1);let e=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=e,e*=e,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=e),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}},Video:class{constructor(e=null,t=null,i=null,s=null,r=null){this.pxlUtils=t,this.pxlAudio=i,this.pxlFile=s,this.pxlGuiDraws=r,this.pxlEnv=null,this.videojs=null,this.Hls=null,this.IVSPlayer=null,this.posted=!1,this.djStreamUrl="",this.performerStreamUrl="",this.screenVideoBlock=null,this.screenVideos={},this.videoStreams={},this.videoStreamFailCount=0,this.videoStreamFailMax=5,this.videoAudioEvent={dj:!1,performer:!1},this.checkForDjStream=!1,this.checkForPerformerStream=!1,this.videoStills={dj:{texture:null,url:e+"SoftNoise_512.jpg"},performer:{texture:null,url:e+"SoftNoise_512.jpg"}}}init(){this.buildVideoBlock(),this.buildPromoVideos()}buildVideoBlock(){if(null===this.screenVideoBlock){let e=document.createElement("div");e.classList.add("videoScreenBlockStyle"),document.body.appendChild(e),this.screenVideoBlock=e}}buildPromoVideos(){[].forEach((e=>{let t=e.name,i=e.type,s=e.intensity,r=e.boost,a=e.file,n=e.landscape,o=this.pxlFile.vidRoot+a,l=document.createElement("video");l.id="screenVideo_"+t+"_"+(n?"port":"land"),l.src=o,l.classList.add("bgMediaAssets"),l.controls=!1,l.muted=!0,l.preload="true",l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.setAttribute("playsinline",""),l.setAttribute("loop",""),this.screenVideoBlock.appendChild(l),this.screenVideos[t]||(this.screenVideos[t]={}),this.screenVideos[t].name=t,this.screenVideos[t].type=i,s&&(this.screenVideos[t].intensity=s),r&&(this.screenVideos[t].boost=r);let h=this.screenVideos[t].file||[];this.screenVideos[t].file?h[~~n]=o:h=[o,o],this.screenVideos[t].file=h;let c=this.pxlUtils.getVideoTexture(l),d=this.screenVideos[t].texture||[];this.screenVideos[t].texture?d[~~n]=c:d=[c,c],this.screenVideos[t].texture=d;let u=[];this.screenVideos[t].videoObjs?u[~~n]=l:u=[l,l],this.screenVideos[t].videoObjs=u}))}async boot(){this.videoAudioEvent.dj?this.buildVideoPlayer("dj"):this.videoStills.dj.texture=this.pxlUtils.loadTexture(this.videoStills.dj.url)}buildVideoPlayer(e){let t=this,i=document.createElement("video");i.id="antibodyDjStream",i.classList.add("bgMediaAssets"),i.controls=!1,i.volume=0,i.muted=!0,i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.addEventListener("volumechange",(e=>{i.volume=Math.min(i.volume,t.pxlAudio.djAudioVolume)}),!0),this.screenVideoBlock.appendChild(i),this.videoStreams[e]={},this.videoStreams[e].mode=0,this.videoStreams[e].active=!1,this.videoStreams[e].loading=!1,this.videoStreams[e].checkResolve=!1,this.videoStreams[e].prevCheck=this.pxlUtils.curMS+5,this.videoStreams[e].delayCheck=5,this.videoStreams[e].obj=i,this.videoStreams[e].url=this.djStreamUrl,this.videoStreams[e].urlStatus=!1,this.videoStreams[e].player=null,this.videoStreams[e].checkScreens=!1,this.videoStreams[e].activeLevel=-1,this.videoStreams[e].prevFrame=0,this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].canvasObj=null,this.videoStreams[e].videoTexture=this.getTexture(e),this.pxlFile.urlExists(this.djStreamUrl).then((t=>{this.videoStreams[e].urlStatus=t})),this.buildVideoStream(e,!1)}postBoot(e){this.videoStreams[e]&&this.videoStreams[e].urlStatus&&this.load(e,this.videoStreams[e].url),this.posted=!0,this.checkForDjStream=this.videoAudioEvent.dj}step(){let e=!1,t="dj";if(this.videoAudioEvent[t]){let i=this.videoStreams[t];i&&(i.active||this.checkVideoStreamStatus(t),this.pxlUtils.mobile?i.active&&i.videoTexture&&i.checkScreens&&(i.checkScreens=!1,this.setScreensToStreams(1,i.videoTexture)):(e=i.checkScreens,i.checkScreens=!1))}else this.videoStills[t].texture&&this.pxlUtils.mobile&&this.setScreensToStreams(1,this.videoStills[t].texture);return e}setScreensToStreams(e=0,t="dj"){let i=t;"string"==typeof i&&(i=this.getTexture(t),i||(e=0,this.videoStreams[t].active=!1,this.videoStreams[t].checkScreens=!0)),this.pxlEnv.camScreenData.screenGeoList.forEach(((t,s)=>{t.material.uniforms.camExists.value=e,t.material.uniforms.videoFeed.value=i}))}isActive(e){let t=!1;return this.videoStreams.hasOwnProperty(e)?this.videoStreams[e].active&&this.videoStreams[e].videoTexture&&(t=!0):t=null!=this.videoStills[e].texture,t}getTexture(e){let t=null;return this.videoAudioEvent[e]?(this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.buildVideoTexture(e)),t=this.videoStreams[e].videoTexture):this.videoStills[e].texture&&(t=this.videoStills[e].texture),t}buildVideoTexture(e){return this.disposeVideoTexture(e),this.videoStreams[e].obj&&this.videoStreams[e].player?this.pxlUtils.getVideoTexture(this.videoStreams[e].obj):null}disposeVideoTexture(e,t=null){this.videoStreams[e].videoTexture&&(this.videoStreams[e].videoTexture.dispose(),this.videoStreams[e].videoTexture=null,this.videoStreams[e].checkScreens=null===t||t)}resetvideoTexture(e){this.setScreensToStreams(0,e),this.disposeVideoTexture(e,!1);let t=this.getTexture(e);this.videoStreams[e].videoTexture=t,this.videoStreams[e].checkScreens=!0}resetEnvSettings(e){this.resetvideoTexture(e),this.videoStreams[e].checkScreens=!1}hlsPreflight(){let e=window.MediaSource||window.WebKitMediaSource;e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');let t=window.SourceBuffer||window.WebKitSourceBuffer;return t=(!t||t.prototype)&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,e&&t}buildVideoStream(e,t=!1){let i=this;this.videoStreams[e].obj,void 0!==this.IVSPlayer?this.buildIvsPlayer(e):this.pxlFile.loadScript("https://player.live-video.net/1.1.2/amazon-ivs-player.min.js").then((()=>{i.buildIvsPlayer(e)}))}buildVhsPlayer(e){if(this.videojs){this.videoStreams[e].mode=1;let t=this.videoStreams[e].obj,i=this.videojs(t,{controls:!1,autoplay:!0,preload:"auto"});this.videojs.log.level("off"),this.videojs.log.level("error"),this.videoStreams[e].player=i;let s=this;i.ready((function(){let e=i.play();e&&e.catch((function(e){document.addEventListener("click",(function e(t){let s=i.networkState();(1===s||2===s)&&(i.play(),document.removeEventListener("click",e))}))}))})),i.on("play",(t=>{s.ready(e)})),i.on("loadedmetadata",(t=>{s.start(e)})),i.on("waiting",(t=>{let r=i.currentTime(),a=i.duration();a>0&&setTimeout((()=>{let t=i.currentTime(),n=i.duration();r===t&&a===n&&this.pxlFile.urlExists(i.src()).then((t=>{t||s.ended(e)})).catch((()=>{s.ended(e)}))}),500)})),i.on("ended",(t=>{s.ended(e)})),i.on("error",(t=>{s.ended(e)}))}else this.buildFallbackPlayer(e)}buildHlsPlayer(e){if(this.Hls&&this.Hls.isSupported()){this.videoStreams[e].mode=4;let i=this.videoStreams[e].obj;var t=new this.Hls({enableWorker:!0,liveBackBufferLength:900,startLevel:2,stretchShortVideoTrack:!0,nudgeOffset:.5,fragLoadingTimeOut:2e3});t.attachMedia(i),this.videoStreams[e].player=t;let s=this;t.on(this.Hls.Events.MEDIA_ATTACHED,(function(t){s.ready(e)})),t.on(this.Hls.Events.BUFFER_CREATED,(function(e){})),t.on(this.Hls.Events.MANIFEST_PARSED,(function(t){s.start(e)})),t.streamController.onMediaEnded=function(t){s.ended(e)},t.on(this.Hls.Events.ERROR,(function(i,r){r.fatal?s.ended(e):("bufferFullError"===r.details||"bufferAppendingError"===r.details)&&t.recoverMediaError()})),t.on(this.Hls.Events.STREAM_STATE_TRANSITION,(function(i,r){"PARSED"===r.previousState&&"IDLE"===r.nextState&&(s.videoStreams[e].activeLevel=t.currentLevel,-1===t.currentLevel&&setTimeout((()=>{-1===t.currentLevel&&t.recoverMediaError()}),1e3))}))}else this.buildFallbackPlayer(e)}sendModMessage(e,t,i){let s={msg:e,init:t,data:i};this.pxlEnv.pxlSocket.sendErrorMsg(s)}buildFallbackPlayer(e){let t=this.videoStreams[e].obj;this.videoStreams[e].mode=2,t.setAttribute("src",this.videoStreams[e].urlStatus?this.videoStreams[e].url:"");let i=this;t.addEventListener("error",(function(e,t){})),t.addEventListener("loadedmetadata",(function(t){i.ready(e)})),t.addEventListener("canplay",(function(s){t.play(),i.start(e)})),t.addEventListener("suspend",(function(t){i.ended(e)})),t.addEventListener("ended",(function(t){i.ended(e)}))}buildIvsPlayer(e){if(this.IVSPlayer.isPlayerSupported){this.videoStreams[e].mode=3;let t=this.videoStreams[e].obj,i=this.IVSPlayer.create();i.attachHTMLVideoElement(t),i.setAutoplay(!0),i.setLogLevel("Error"),this.videoStreams[e].loading=!0,this.videoStreams[e].player=i,this.videoStreams[e].checkScreens=!1;let s=this,r=this.IVSPlayer.PlayerState;i.addEventListener(r.READY,(t=>{s.ready(e)})),i.addEventListener(r.PLAYING,(t=>{s.start(e)})),i.addEventListener(r.ENDED,(t=>{s.ended(e)}));let a=this.IVSPlayer.PlayerEventType;i.addEventListener(a.ERROR,((t,i,r,a)=>{s.ended(e,t)}))}else this.buildFallbackPlayer(e)}unload(e){}load(e,t){let i=this.videoStreams[e];if(i)switch(i.mode){case 1:this.videoStreams[e].url=t,i.player.src({type:"application/x-mpegURL",src:t}),i.player.load();break;case 2:i.obj.setAttribute("src",t),i.obj.load();break;case 3:i.player.load(t);break;case 4:i.player&&this.destroyPlayer(e,!0),i.player.attachMedia(this.videoStreams[e].obj);var s=decodeURIComponent(t);i.player.loadSource(s)}}newStream(e){}canUnmute(e){let t=!0;return this.videoStreams[e]&&(t=this.videoStreams[e].active),t}setMuted(e,t=!1){let i=this.videoStreams[e];i&&(i.obj.muted=t)}setVolume(e,t){let i=this.videoStreams[e];i&&(i.obj.volume=t)}getStreamState(e){let t=!1,i=this.videoStreams[e];switch(i.mode){case 1:case 2:t=!i.obj.paused;break;case 3:let e=i.player;t=e.core.isLoaded&&!e.core.paused;break;case 4:t=null!=i.player.streamController.lastCurrentTime}return t}checkVideoError(e){let t=this.videoStreams[e];t.active&&4===t.mode&&(0===t.obj.videoWidth?!t.obj.paused&&t.player.streamController.lastCurrentTime>10&&(this.destroyPlayer(e),this.videoStreams[e].active=!1,this.checkForDjStream=!0,this.buildHlsPlayer(e),this.videoStreams[e].player.recoverMediaError()):t.obj.webkitDecodedFrameCount===t.prevFrame?(this.videoStreams[e].prevFrameCount+=1,this.videoStreams[e].prevFrameCount>50&&(this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].player.recoverMediaError(),this.videoStreams[e].player.nextLoadLevel=Math.max(0,this.videoStreams[e].player.currentLevel-1),this.videoStreams[e].player.recoverMediaError())):(this.videoStreams[e].prevFrame=t.obj.webkitDecodedFrameCount,-1!==this.videoStreams[e].player.nextLevel&&(this.videoStreams[e].player.nextLevel=-1),this.videoStreams[e].prevFrameCount=0))}ready(e){this.videoStreams[e].loading=!1,this.videoStreams[e].obj.volume=0,this.videoStreams[e].activeLevel=1}start(e){let t=this.videoStreams[e];if(t.active)return;let i=this.getStreamState(e);this.videoStreams[e].active=i,this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.getTexture(e)),this.pxlAudio.isVideoObject=!0,this.videoStreamFailCount=0,this.checkForDjStream=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.djAudioObj.byScript=!0;let s=this.pxlAudio.djAudioObj;s.children[0].setAttribute("src",""),s.pause(),s.muted=!0,setTimeout((()=>{s.load(),setTimeout((()=>{this.pxlAudio.roomAudioStopped&&(t.obj.volume=this.pxlAudio.djAudioVolume),t.obj.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,t.obj.click()}),20)}),20)}restart(e){let t=!1,i=this.videoStreams[e].player,s=this.videoStreams[e].obj;switch(this.videoStreams[e].mode){case 1:case 2:t=!s.paused;break;case 3:t=i.core.isLoaded&&!i.core.paused;break;case 4:t=i.currentLevel>-1}this.videoStreams[e].active=t,this.videoStreams[e].checkScreens=t}ended(e){let t=this.videoStreams[e];if(!t.active)return;this.destroyPlayer(e);let i=4===t.mode?!t.player.liveTracker.atLiveEdge():!t.obj.paused;this.videoStreams[e].active=i,this.checkForDjStream=this.videoAudioEvent.dj,this.pxlAudio.isVideoObject=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.roomAudioStopped&&(t.obj.volume=0),t.obj.pause(),t.obj.muted=!0,this.pxlAudio.djAudioObj.byScript=!0;let s=this.pxlAudio.djAudioObj,r=s.children[0];""===r.getAttribute("src")&&(r.setAttribute("src",this.pxlAudio.djUrlSource),s.load(),s.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,s.play()),this.videoStreams[e].prevCheck=this.pxlUtils.curMS+15,this.videoStreams[e].activeLevel=-1}error(e,t){let i;i="object"==typeof t?t.type:t,["ErrorNetworkIO","networkError","mediaError","internalException"].includes(i)&&(this.videoStreams[e].active=!1)}destroyPlayer(e,t=!1){4===this.videoStreams[e].mode&&(this.videoStreams[e].active||t)&&this.videoStreams[e].player&&this.videoStreams[e].player.detachMedia()}async streamState(e){let t=!0,i=!0;this.videoStreams.dj&&(t=!this.videoStreams.dj.active),this.videoStreams.performer&&(i=!this.videoStreams.performer.active),!0===e.hasOwnProperty("dj")&&t&&(this.checkForDjStream=e.dj&&this.videoAudioEvent.dj),!0===e.hasOwnProperty("performer")&&i&&(this.checkForPerformerStream=e.performer&&this.videoAudioEvent.performer)}async checkVideoStreamStatus(e){let t=this.videoStreams[e];t&&this.checkForDjStream&&this.posted&&!t.active&&t.prevCheck+t.delayCheck<this.pxlUtils.curMS&&(this.checkForDjStream=!1,this.pxlFile.urlExists(this.videoStreams[e].url).then((t=>{this.videoStreams[e].urlStatus=t,this.checkForDjStream=!t,this.videoStreams[e].prevCheck=this.pxlUtils.curMS,this.videoStreams[e].checkResolve=this.pxlUtils.curMS,t?this.load(e,this.videoStreams[e].url):this.videoStreamFailCount+=1})).catch((t=>{console.log(t),this.videoStreamFailCount+=1,this.checkForDjStream=!0,this.videoStreams[e].prevCheck=this.pxlUtils.curMS})))}}},er={};function tr(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        "}function ir(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}"}function sr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvoid main(){\n  vUv=uv;\n      vUvShift=uv-.5;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvoid main(){\n  vUv=uv;\n      vUvShift=uv-.5;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}"}function rr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvarying vec3 camPos;\nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n  camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvarying vec3 camPos;\nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n  camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;\n}"}function ar(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvoid main(){\n  discard;\n  gl_FragColor=vec4(.0,.0,.0,0.0);\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvoid main(){\n  discard;\n  gl_FragColor=vec4(.0,.0,.0,0.0);\n}"}c(er,{camPosVert:()=>rr,defaultShiftVert:()=>sr,defaultVert:()=>ir,discardFrag:()=>ar,shaderHeader:()=>tr});var nr={};function or(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvarying vec2 vUv;\nvoid main(){\n  vUv=uv;\n  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n}"}function lr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nuniform float rate;\nuniform float freq;\nuniform float intensity;\nuniform vec3 glowColor;\nuniform sampler2D glowTexture;\nvarying vec2 vUv;\nfloat pi=3.14159265358979;\n\nvoid main(){\n  vec4 glowCd=texture2D(glowTexture, vUv);\n  vec4 Cd=vec4(glowColor,1.0);\n  Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;\n  Cd.rgb*=glowCd.r*glowCd.a;\n  gl_FragColor=Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nuniform float rate;\nuniform float freq;\nuniform float intensity;\nuniform vec3 glowColor;\nuniform sampler2D glowTexture;\nvarying vec2 vUv;\nfloat pi=3.14159265358979;\n\nvoid main(){\n  vec4 glowCd=texture2D(glowTexture, vUv);\n  vec4 Cd=vec4(glowColor,1.0);\n  Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;\n  Cd.rgb*=glowCd.r*glowCd.a;\n  gl_FragColor=Cd;\n}"}function hr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main(){\n  vUv=uv+vec2(rate*time.x, 0.0);\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main(){\n  vUv=uv+vec2(rate*time.x, 0.0);\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}"}function cr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 time;\nuniform vec2 intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=vec4( 1.0 );\n  Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);\n\n  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec4 noiseCd=texture2D(cloudNoise,nUV);\n  noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n  nUV=vUv+noiseCd.xy*.05;\n\n  float alpha=texture2D(alphaMap,nUV).r;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n  alpha=1.0-(1.0-alpha)*(1.0-alpha);\n  alpha*=alpha;\n  Cd.a=alpha+alpha;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 time;\nuniform vec2 intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=vec4( 1.0 );\n  Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);\n\n  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec4 noiseCd=texture2D(cloudNoise,nUV);\n  noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n  nUV=vUv+noiseCd.xy*.05;\n\n  float alpha=texture2D(alphaMap,nUV).r;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n  alpha=1.0-(1.0-alpha)*(1.0-alpha);\n  alpha*=alpha;\n  Cd.a=alpha+alpha;\n  gl_FragColor = Cd;\n}"}function dr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nuniform float rate;\nvarying vec2 shiftUv;\nvarying vec2 wUv;\n\nvoid main(){\n    shiftUv=(uv-.5);\n\n    float t=time.x*rate;\n    vec2 rot=vec2( sin(t), cos(t) );\n    vec2 rotUV=vec2(0.0);\n    rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);\n    rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);\n    wUv=rotUV+.5;\n\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nuniform float rate;\nvarying vec2 shiftUv;\nvarying vec2 wUv;\n\nvoid main(){\n    shiftUv=(uv-.5);\n\n    float t=time.x*rate;\n    vec2 rot=vec2( sin(t), cos(t) );\n    vec2 rotUV=vec2(0.0);\n    rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);\n    rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);\n    wUv=rotUV+.5;\n\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n\n}"}function ur(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 intensity;\nvarying vec2 shiftUv;\nvarying vec2 wUv;\n\n#define TAU 6.28318530717958\nvoid main() {\n    float suvLength=length(shiftUv)+.1;\n    vec2 suvSign=sign(shiftUv);\n\n    vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );\n    rUv *= suvLength ;\n\n    vec4 noiseCd=texture2D(cloudNoise,rUv);\n    vec2 aUv=wUv*(noiseCd.xy*.5+wUv);\n\n    float alpha=texture2D(alphaMap,aUv).r;\n\n    vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);\n    alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );\n    Cd.a=min(1.0, alpha);\n\n    gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 intensity;\nvarying vec2 shiftUv;\nvarying vec2 wUv;\n\n#define TAU 6.28318530717958\nvoid main() {\n    float suvLength=length(shiftUv)+.1;\n    vec2 suvSign=sign(shiftUv);\n\n    vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );\n    rUv *= suvLength ;\n\n    vec4 noiseCd=texture2D(cloudNoise,rUv);\n    vec2 aUv=wUv*(noiseCd.xy*.5+wUv);\n\n    float alpha=texture2D(alphaMap,aUv).r;\n\n    vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);\n    alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );\n    Cd.a=min(1.0, alpha);\n\n    gl_FragColor = Cd;\n}"}c(nr,{animTextureFrag:()=>lr,animTextureVert:()=>or,clickableBevelFrag:()=>cr,clickableBevelVert:()=>hr,portalBaseFrag:()=>ur,portalBaseVert:()=>dr});var Ar={};function pr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D rgbMap;\nuniform sampler2D alphaMap;\n\nvarying vec2 vUv;\n\nmain(){\n  vec3 rgb=texture2D( rgbMap, vUv ).rgb;\n  float alpha=texture2D( alphaMap, vUv ).r;\n\n  vec4 outCd = vec4( rgb, alpha );\n  gl_FragColor=outCd;\n}\n","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D rgbMap;\nuniform sampler2D alphaMap;\n\nvarying vec2 vUv;\n\nmain(){\n  vec3 rgb=texture2D( rgbMap, vUv ).rgb;\n  float alpha=texture2D( alphaMap, vUv ).r;\n\n  vec4 outCd = vec4( rgb, alpha );\n  gl_FragColor=outCd;\n}\n"}function mr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main(){\n  vUv=uv+vec2(rate*time.x, 0.0);\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main(){\n  vUv=uv+vec2(rate*time.x, 0.0);\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}"}function gr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=vec4( color, 1.0);\n\n  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec4 noiseCd=texture2D(cloudNoise,nUV);\n  noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n  nUV=vUv+noiseCd.xy*.05;\n\n  float alpha=texture2D(alphaMap,nUV).r;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n  alpha=1.0-(1.0-alpha)*(1.0-alpha);\n  alpha*=alpha;\n  Cd.a=alpha+alpha;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform sampler2D cloudNoise;\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=vec4( color, 1.0);\n\n  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec4 noiseCd=texture2D(cloudNoise,nUV);\n  noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n  nUV=vUv+noiseCd.xy*.05;\n\n  float alpha=texture2D(alphaMap,nUV).r;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n  alpha=1.0-(1.0-alpha)*(1.0-alpha);\n  alpha*=alpha;\n  Cd.a=alpha+alpha;\n  gl_FragColor = Cd;\n}"}function fr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\nvarying vec2 nUv;\n\nvoid main(){\n  vUv=uv;\n  nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);\n  nUv.x=sin(nUv.x)*.5+.5;\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec3 pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\nvarying vec2 nUv;\n\nvoid main(){\n  vUv=uv;\n  nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);\n  nUv.x=sin(nUv.x)*.5+.5;\n  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n  nDot=dot( normal, camDir );\n\n  vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n  vec3 pos=position;\n  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n  gl_Position = projectionMatrix*modelViewPosition;\n\n}"}function vr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nuniform sampler2D cloudNoise;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\nvarying vec2 nUv;\n\nvoid main() {\n  vec4 Cd=vec4( color, 1.0);\n  float alpha=texture2D(alphaMap,vUv).r;\n  float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=color*blender;\n  Cd.rgb*=intensity*alpha;\n  Cd.a=blender*alpha+noise*alpha;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec3 color;\nuniform sampler2D alphaMap;\nuniform vec2 time;\nuniform float intensity;\nuniform float rate;\nuniform sampler2D cloudNoise;\nvarying vec3 pos;\nvarying float nDot;\nvarying vec2 vUv;\nvarying vec2 nUv;\n\nvoid main() {\n  vec4 Cd=vec4( color, 1.0);\n  float alpha=texture2D(alphaMap,vUv).r;\n  float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;\n  float blender=(nDot*.5+.5);\n  Cd.rgb=color*blender;\n  Cd.rgb*=intensity*alpha;\n  Cd.a=blender*alpha+noise*alpha;\n  gl_FragColor = Cd;\n}"}function br(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D color;\nuniform vec2 time;\nuniform float intensity;\nuniform sampler2D cloudNoise;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=texture2D(color,vUv);\n  Cd.a=Cd.b;\n  Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );\n  Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D color;\nuniform vec2 time;\nuniform float intensity;\nuniform sampler2D cloudNoise;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=texture2D(color,vUv);\n  Cd.a=Cd.b;\n  Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );\n  Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);\n  gl_FragColor = Cd;\n}"}function xr(t=!1){let i="\n    attribute vec3 color;\n    attribute vec3 shading;\n\n    varying float vFlicker;\n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    ";return t&&(i+=`\n        ${e.ShaderChunk.common}\n        ${e.ShaderChunk.shadowmap_pars_vertex}\n      `),i+="\nvoid main(){\n    vUv=uv;\n\n    vShading=shading;\n\n    vCd=color;\n\n    vec3 transformed = vec3( position );\n    vec3 objectNormal = vec3( normal );\n    vec3 transformedNormal = objectNormal;\n\n    vLocalPos = position;\n    vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;\n    vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;\n    vec4 mvPos=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n    vPos = mvPos.xyz;\n    ",t&&(i+=`\n            ${e.ShaderChunk.worldpos_vertex}\n            ${e.ShaderChunk.shadowmap_vertex}\n          `),i+="\n    }",i}function Cr(t,i,s,r,a,n){let o=!1,l=1;t.hasOwnProperty("Specular")&&t.Specular>0&&(o=!0,l=t.Specular);let h=!1;t.PointColor&&(h=!0);let c=!0,d="1.0";t.hasOwnProperty("SurfaceNoise")&&(t.SurfaceNoise%1==0&&(d=t.SurfaceNoise+".0"),"0.0"===d&&(c=!1));let u="\n        ";if(i||(u+="uniform sampler2D dTexture;"),u+="\nuniform sampler2D noiseTexture;\nuniform sampler2D detailTexture;\n\nuniform vec2 time;\nuniform float cdMult;\nuniform vec3 fogColor;\n\nvarying vec2 vUv;\nvarying vec3 vCd;\nvarying vec3 vPos;\nvarying vec3 vLocalPos;\nvarying vec3 vN;\nvarying vec3 vLocalN;\nvarying vec3 vShading;\n\nvarying float vFlicker;\n\n#define PI 3.14159265358979\n\nstruct PointLight {\n  vec3 color;\n  float decay;\n  float distance;\n  vec3 position;\n};\nstruct DirLight {\n  vec3 color;\n  vec3 direction;\n};\n",r&&(u+="\n#if NUM_POINT_LIGHTS > 0\n  uniform PointLight pointLights[NUM_POINT_LIGHTS];\n#endif\n#if NUM_DIR_LIGHTS > 0\n  uniform DirLight directionalLights[NUM_DIR_LIGHTS];\n#endif\n  "),a&&(u+=`\n${e.ShaderChunk.packing}\n\n#if NUM_POINT_LIGHT_SHADOWS > 0\n    uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n    varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n    struct PointLightShadow {\n        float shadowBias;\n        float shadowNormalBias;\n        float shadowRadius;\n        vec2 shadowMapSize;\n        float shadowCameraNear;\n        float shadowCameraFar;\n    };\n    uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n#endif\nfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n    return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n}\nvec2 cubeToUV( vec3 v, float texelSizeY ) {\n    vec3 absV = abs( v );\n    float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n    absV *= scaleToCube;\n    v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n    vec2 planar = v.xy;\n    float almostATexel = 1.5 * texelSizeY;\n    float almostOne = 1.0 - almostATexel;\n    if ( absV.z >= almostOne ) {\n        if ( v.z > 0.0 )\n            planar.x = 4.0 - v.x;\n    } else if ( absV.x >= almostOne ) {\n        float signX = sign( v.x );\n        planar.x = v.z * signX + 2.0 * signX;\n    } else if ( absV.y >= almostOne ) {\n        float signY = sign( v.y );\n        planar.x = v.x + 2.0 * signY + 2.0;\n        planar.y = v.z * signY - 2.0;\n    }\n    return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n}\nfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n    vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n    vec3 lightToPosition = shadowCoord.xyz;\n    float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n     dp += shadowBias;\n    vec3 bd3D = normalize( lightToPosition );\n    #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n        vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n        return (\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n        ) * ( .11111111111 ) * (1.0-dp);\n    #else\n        return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);\n    #endif\n}\n\nvec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){\n    vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n    vec3 lightToPosition = shadowCoord.xyz;\n    float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n    dp += shadowBias;\n    vec3 bd3D = normalize( lightToPosition );\n    vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n    return texture2D( pointShadowMap[0], cubeToUV( bd3D, texelSize.y )).rgb;\n}\n`),u+="\nvoid main(){\n  ",h)u+="vec3 vertCd = vCd;";else if(i){let e=e=>e%1==0?e+".0":e+"";u+=`vec3 vertCd = vec3( ${e(i.r)}, ${e(i.g)}, ${e(i.b)} ) ;`}else u+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";u+="\n\n        vec4 Cd=vec4( vertCd, 1.0 );\n        float specular = 0.0;\n        ",s&&(u+="\n          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;\n          Cd.rgb=  mix( Cd.rgb, fogColor, depth );\n          ");let A="",p="",m="";if(c&&("1.0"!==d&&(A="*"+d),u+="\n            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;\n            ",p=`+detailMult * (shadowInf*.5+.5) ${A}`,m=`(detailMult+.5) ${A}`),r&&(u+="\n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);\n          #endif\n\n          #if NUM_POINT_LIGHTS > 0\n            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\n                vec3 lightVector = normalize(vPos - pointLights[i].position);\n                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;\n                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);\n                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );\n                lightInf *=  distFalloff;\n                lights.rgb += lightInf;\n                ",o&&(u+="\n                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;\n                  specular += distFalloff;\n                  "),u+="\n            }\n          #endif\n\n          #if NUM_DIR_LIGHTS > 0\n            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {\n                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;\n                lights.rgb += lightInf;\n            }\n          #endif\n\n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            Cd.rgb *= lights.rgb;\n          #endif\n          ",o&&(u+=`\n            Cd.rgb += vertCd * specular * ${l};\n            `)),a){u+="\n          #if NUM_POINT_LIGHT_SHADOWS > 0\n\n            float shadowInf = 0.0;\n            float detailInf = 0.0;\n            float lShadow = 0.0;\n            int i = 0;\n            ";for(let e=0;e<n;++e)u+=`\n                i=${e};\n                lShadow = getPointShadow( pointShadowMap[${e}], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.75, pointLightShadows[i].shadowRadius*1.65, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );\n                shadowInf = max( lShadow, shadowInf);\n                `;u+=`\n            shadowInf = shadowInf;\n            Cd.rgb*=shadowInf ${p} ;\n            `,c&&(u+=`\n              #else\n                Cd.rgb*=${m};\n              `),u+="\n          #endif\n          "}else c&&(u+=`\n            Cd.rgb*=${m};\n            `);return u+="\n        Cd*=cdMult;\n\n        // Convert to sRGB\n        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );\n\n        gl_FragColor=Cd;\n    }",u}c(Ar,{itemBaseFrag:()=>gr,itemBaseVert:()=>mr,itemFrag:()=>vr,itemVert:()=>fr,itemZoomFrag:()=>br,pxlPrincipledFrag:()=>Cr,pxlPrincipledVert:()=>xr,rgbaMapFrag:()=>pr});var yr={};c(yr,{dustFrag:()=>Dr,dustSettings:()=>wr,dustVert:()=>Sr,emberWispsFrag:()=>Br,emberWispsSettings:()=>Er,emberWispsVert:()=>Ir,heightMapFrag:()=>Rr,heightMapSettings:()=>Pr,heightMapVert:()=>Tr,smokeFrag:()=>kr,smokeSettings:()=>Mr,smokeVert:()=>Lr,snowFallFrag:()=>Fr,snowFallVert:()=>Or,snowSettings:()=>Qr});var Er={BaseSpeed:.77,EmberSpread:10,EmberFadeDistance:.04,ShiftFromZero:.6,MultPosXZ:1.313};function Ir(e={}){let t=e=>(e+"").includes(".")?e:e+".0",i=`\n// Ember Settings\n  const vec3 EmberEarlyCd = vec3( 0.8, 0.5, .1 );\n  const vec3 EmberOldCd = vec3( 0.634, 0.20, 0.20 );\n  const float BaseSpeed = ${t((e=Object.assign({},Er,e)).BaseSpeed)};\n  const float EmberSpread = ${t(e.EmberSpread)};\n  const float EmberFadeDistance = ${t(e.EmberFadeDistance)};\n  const float ShiftFromZero = ${t(e.ShiftFromZero)};\n  const float MultPosXZ = ${t(e.MultPosXZ)};\n\n// -- -- --\n  `;return i+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",i+="\n// -- -- --\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec3 windDir;\nuniform vec3 offsetPos;\nuniform float rate;\nuniform float pointScale;\n\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n\n    return ret;\n}\n\nvoid main(){\n    vAtlas=atlas;\n\n    float rot=seeds.z+time.x*seeds.z*3.;\n    vRot=vec2( sin(rot), cos(rot) );\n\n    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n\n    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n\n    float rateShift = (BaseSpeed*(seeds.x*.4+.6));\n    float t=time.x*rate*rateShift;\n\n    // Random shift to a cycle y movement\n    //float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);\n\n    float shiftY = (t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0) * 0.1;\n    float lifePerc = fract( shiftY );\n    float loopSeed = floor( shiftY ) * seeds.w * 20.0;\n    shiftY = lifePerc * 10.0;\n\n    // Change up ages of embers\n    float fadeDrop = min(1.0, lifePerc*lifePerc*4. );\n    //\n    float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );\n    life = 1.0-((shiftY*.001-seeds.x*.2) );\n\n    pOff.y=shiftY*seeds.y;\n\n    pOff.y=(pOff.y)+shiftY;\n    vec3 pos= pOff ;\n\n    float spreadPerc = min(1.0, life*2.) * EmberSpread;\n    pos.xz=fract(noiseCd.rg*noiseCd.r + loopSeed)*(seeds.x)*(life*seeds.zy*fract(seeds.w*30.0 )) * spreadPerc ;\n\n    // Add gap from (0,0) and scale to spread after shift\n    pos.x = ( pos.x + (step( 0.0, pos.x )-.5) * ShiftFromZero ) * MultPosXZ;\n    pos.z = ( pos.z + (step( 0.0, pos.z )-.5) * ShiftFromZero ) * MultPosXZ;\n\n    // Directional push\n    float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.03) * 4.2;\n    pos.xz += windDir.xz * yPush * max(0.0,pos.y-.5)*(.5+life*.5);\n    pos.y += yPush;\n\n    float pToCamLen = length(pos-cameraPosition);\n    float pScalar = max( 0., (1.-pToCamLen *  0.0806 )); // 0.0385\n    pScalar += max(0.0,pToCamLen - 0.4) * 0.005;\n\n    vAlpha = min(1.0, (seeds.x*.15+.7) * pScalar*3.0 );\n\n    vAlpha=max(0.0, life*life-seeds.z-seeds.z);\n    float distMult = ( length( pos )*EmberFadeDistance );\n    distMult = 1.0 - ( distMult * distMult );\n    vAlpha *= distMult;\n\n    float pScale = pointScale * seeds.w * pScalar + 2.0;\n\n    gl_PointSize =  pScale*fadeDrop ;\n\n    float tightenBase = min( 1.0, pos.y* 0.12 + .32 );\n    pos.xz *= tightenBase*tightenBase;\n\n    // Apply Offset Position and move to camera space\n    vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n\n    float cdAge = clamp( 1.0 - life, 0.0, 1.0);\n\n    vCd = mix( EmberEarlyCd, EmberOldCd, cdAge )  ;\n\n    vBrightness = 1.045 + fadeDrop*2.;\n}",i}function Br(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D atlasTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\n// -- -- --\n\n// Human Eye Adjusted Luminance\n//   https://en.wikipedia.org/wiki/Grayscale\nfloat luma(vec3 color) {\n  return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n}\n\n// -- -- --\n\nvoid main(){\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = (uv-.5)*.85;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n\n    vec4 dustCd=texture2D(atlasTexture,rotUV);\n    float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n\n    dustCd.rgb *= vBrightness;\n\n    float dirtLuma = luma( dustCd.rgb );\n    vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n\n    gl_FragColor=Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D atlasTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\n// -- -- --\n\n// Human Eye Adjusted Luminance\n//   https://en.wikipedia.org/wiki/Grayscale\nfloat luma(vec3 color) {\n  return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n}\n\n// -- -- --\n\nvoid main(){\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = (uv-.5)*.85;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n\n    vec4 dustCd=texture2D(atlasTexture,rotUV);\n    float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n\n    dustCd.rgb *= vBrightness;\n\n    float dirtLuma = luma( dustCd.rgb );\n    vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n\n    gl_FragColor=Cd;\n}"}var wr={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85};function Sr(e={}){let t=e=>(e+"").includes(".")?e:e+".0",i=`\n    // Fade-Out Influence multiplier\n        const float ParticleOpacity = ${t((e=Object.assign({},wr,e)).pOpacity)};\n        const float FadeOutScalar = ${t(e.fadeOutScalar)};\n        const float WanderInf = ${t(e.wanderInf)};\n        const float WanderRate = ${t(e.wanderRate)};\n        const float WanderFrequency = ${t(e.wanderFrequency)};\n\n        #define PROX ${e.proxDist.toFixed(3)}\n        #define PROX_INV 1.0/${(.8*e.proxDist).toFixed(3)}\n\n    // -- -- --\n  `;return i+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",i+="\n// -- -- --\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform float rate;\nuniform vec2 pointScale;\nuniform vec3 positionOffset;\nuniform vec3 windDir;\n",e.hasLights&&(i+="\n#if NUM_POINT_LIGHTS > 0\n  struct PointLight {\n    vec3 color;\n    float decay;\n    float distance;\n    vec3 position;\n  };\n  uniform PointLight pointLights[NUM_POINT_LIGHTS];\n#endif\n  "),i+="\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vScalar;\nvarying float vAlpha;\n\n// -- -- --\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n\n    return ret;\n}\n\nvec3 randomVec( vec3 seed ) {\n  return vec3(\n    fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),\n    fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),\n    fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )\n  );\n}\n\n// -- -- --\n\nvoid main(){\n    vAtlas=atlas;\n\n    float rot=seeds.z+time.x*(seeds.z*2.);\n    vRot=vec2( sin(rot), cos(rot) );\n\n    float t=time.x*rate*0.;\n\n    vec3 pOff=seeds.xyz * vec3(PROX);\n\n    // Loop point positions based on camera location\n    float yFract=fract(t+seeds.x);\n    pOff.xyz += time.x * windDir.xyz;\n    vec3 pos= pOff ;\n\n    vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*2.1) ).rgb-.5;\n    vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;\n\n    // -- -- --\n\n    // Meandering points\n\n    vec3 randDirA = randomVec( seeds.xyz );\n    vec3 randDirB = randomVec( seeds.wyz );\n    vec3 randDirC = randomVec( seeds.zxy );\n    vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * time.x * WanderFrequency ) ) * WanderInf;\n\n    // -- -- --\n\n    pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );\n\n    pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);\n\n    pos = mod( pos-cameraPosition, PROX) + cameraPosition - PROX*.5;\n    pos+=positionOffset;\n\n    float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );\n    float aMult = min(1.0, pScalar*3.0);\n    vAlpha = (seeds.x*.5+.7) * aMult;\n",e.hasLights&&(i+="\n      #if NUM_POINT_LIGHTS > 0\n        float lightInf = 1.0;\n        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){\n            vec3 lightVector = normalize(pos - pointLights[x].position);\n            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );\n        }\n        vAlpha*=(1.0-lightInf)*.8+.2;\n      #endif\n    "),i+="\n        vScalar = pScalar * ParticleOpacity ;\n        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;\n        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );\n        pScale *= step( .5, atlas.x )*.5+1.;\n\n        gl_PointSize = pScale;\n\n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }",i}function Dr(e=!1){let t="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return t+="\nuniform sampler2D atlasTexture;\nuniform sampler2D atlasAlphaTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vScalar;\nvarying float vAlpha;\n\nvoid main(){\n\n    if( vAlpha < .01 ){\n      discard;\n    }\n\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = (uv-.5)*.85;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n",t+=e?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      );\n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",t+="\n        float alpha = clamp( dustCd.a * vAlpha * vScalar, 0.0, 1.0 );\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }",t}var Pr={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85,jumpHeightMult:15};function Tr(e={}){let t=e=>(e+"").includes(".")?e:e+".0",i=`\n    // Fade-Out Influence multiplier\n        const float ParticleOpacity = ${t((e=Object.assign({},Pr,e)).pOpacity)};\n        const float FadeOutScalar = ${t(e.fadeOutScalar)};\n        const float WanderInf = ${t(e.wanderInf)};\n        const float WanderRate = ${t(e.wanderRate)};\n        const float WanderFrequency = ${t(e.wanderFrequency)};\n        const float JumpHeightMult = ${t(e.jumpHeightMult)};\n\n        #define PROX ${e.proxDist.toFixed(3)}\n        #define PROX_INV 1.0/${(.98*e.proxDist).toFixed(3)}\n\n    // -- -- --\n  `;return i+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",i+="\n// -- -- --\n\nuniform sampler2D heightMap;\nuniform sampler2D spawnMap;\nuniform vec3 tankSize;\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform float rate;\nuniform vec2 pointScale;\nuniform vec3 positionOffset;\nuniform vec3 windDir;\n",e.hasLights&&(i+="\n#if NUM_POINT_LIGHTS > 0\n  struct PointLight {\n    vec3 color;\n    float decay;\n    float distance;\n    vec3 position;\n  };\n  uniform PointLight pointLights[NUM_POINT_LIGHTS];\n#endif\n  "),i+="\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\n\n// -- -- --\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n\n    return ret;\n}\n\nvec3 randomVec( vec3 seed ) {\n  return vec3(\n    fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),\n    fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),\n    fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )\n  );\n}\n\n// -- -- --\n\n#define oneThird 0.3333333333333333\n#define srgbLow 1.0 / 12.92\n#define srgbHigh 1.0 / 1.055\n\nvec3 sRGBToLinear(vec3 srgb) {\n  return vec3(\n    mix( srgb.r * srgbLow,  pow((srgb.r + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.r) ),\n    mix( srgb.g * srgbLow,  pow((srgb.g + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.g) ),\n    mix( srgb.b * srgbLow,  pow((srgb.b + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.b) )\n  );\n}\n\nvoid main(){\n  vAtlas=atlas;\n\n  float rot=seeds.z+time.x*(seeds.z*2.);\n  vRot=vec2( sin(rot), cos(rot) );\n\n  float t=time.x*rate;\n  vec2 sizeXZ = tankSize.xz;\n  vec2 scaleXZ = 1.0 / (sizeXZ);\n\n  vec3 pOff= (seeds.xyz - vec3(0.5,0.0,0.5)) * vec3(PROX);\n\n  // Loop point positions based on camera location\n  float yFract=fract(t+seeds.x);\n  pOff.xyz += time.x * windDir.xyz;\n  vec3 pos= pOff ;\n\n  vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+(time.x + seeds.y)*2.1) ).rgb-.5;\n  vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;\n\n  // -- -- --\n\n  // Meandering points\n\n  vec3 randDirA = randomVec( seeds.xyz );\n  vec3 randDirB = randomVec( seeds.wyz );\n  vec3 randDirC = randomVec( seeds.zxy );\n  vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * (time.x + seeds.w) * WanderFrequency ) ) * WanderInf;\n\n  float jumpHeight = randDirBlend.y * abs(max(noiseCd.x,noiseCd.y));\n\n  // -- -- --\n\n  pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );\n  pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);\n\n  vec3 mPos = modelMatrix[3].xyz;\n  pos.xz = mod( pos.xz - cameraPosition.xz , PROX) + cameraPosition.xz - PROX*.5 + positionOffset.xz;\n\n  vec2 fitPos = clamp( ( pos.xz - mPos.xz  ) * scaleXZ + .5, vec2(0.0), vec2(1.0));\n\n  vec3 heightCd=texture2D(heightMap, fitPos ).rgb;\n  vec2 spawnOffset = vec2( 0.0161 );\n  float spawnInf= min(1.0, texture2D(spawnMap, fitPos ).r +\n                  texture2D(spawnMap, fitPos + spawnOffset ).r +\n                  texture2D(spawnMap, fitPos - spawnOffset ).r );\n  heightCd = sRGBToLinear( heightCd );\n  float heightVal = heightCd[0] * oneThird + heightCd[1] * oneThird + heightCd[2] * oneThird;\n\n  pos.y = tankSize.y * heightVal + mPos.y;\n\n  float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );\n  float aMult = min(1.0, pScalar*pScalar*4.0);\n  vAlpha = min( 1.0, (seeds.x*.5+.75) * aMult * spawnInf * 2.5 * ParticleOpacity );\n\n  pos.y += max(1.0, (jumpHeight*pScalar + positionOffset.y) * JumpHeightMult * WanderInf);\n",e.hasLights&&(i+="\n      #if NUM_POINT_LIGHTS > 0\n        float lightInf = 1.0;\n        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){\n            vec3 lightVector = normalize(pos - pointLights[x].position);\n            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );\n        }\n        vAlpha*=(1.0-lightInf)*.8+.2;\n      #endif\n\n    "),i+="\n        float pScale = pointScale.x * (seeds.w*.25+1.0) * pScalar * 2.;\n        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );\n\n        gl_PointSize = pScale;\n\n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }",i}function Rr(e=!1){let t="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return t+="\nuniform sampler2D atlasTexture;\nuniform sampler2D atlasAlphaTexture;\nuniform vec3 tint;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\n\nvoid main(){\n\n    if( vAlpha < .01 ){\n      discard;\n    }\n\n    vec2 uv=gl_PointCoord;\n\n    /*vec2 pos = uv*.25-.125;\n    float vis = max(0.0, 1.0-max(0.0,length(pos)-.09)*20.);\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.125) + vAtlas;*/\n\n    vec2 pos = (uv-.5)*.85;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n    ",t+=e?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      );\n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",t+="\n        float alpha = min(1.0, dustCd.a*1.75) * vAlpha ;\n        vec4 Cd=vec4( dustCd.rgb * tint, alpha );\n\n        gl_FragColor=Cd;\n    }",t}var Mr={BaseSpread:200,SmokeBrightness:.65,InnerBulster:-.05,SmokeDensity:.12,WindInfluenceBoost:.45,TightenBaseSpread:1,TightenMidSpread:.08,TightenTipSpread:.2};function Lr(e={}){let t=e=>(e+"").includes(".")?e:e+".0",i=`\n// Billowy goodness!\n  const float BaseSpread = ${t((e=Object.assign({},Mr,e)).BaseSpread)};\n  const float SmokeBrightness = ${t(e.SmokeBrightness)};\n  const float InnerBulster = ${t(e.InnerBulster)};\n  const float SmokeDensity = ${t(e.SmokeDensity)};\n  const float WindInfluenceBoost = ${t(e.WindInfluenceBoost)};\n\n  const float TightenBaseSpread = ${t(e.TightenBaseSpread)};\n  const float TightenMidSpread = ${t(e.TightenMidSpread)};\n  const float TightenTipSpread = ${t(e.TightenTipSpread)};\n\n  // -- -- --\n  `;return i+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",i+="\n// -- -- --\n\n  uniform sampler2D noiseTexture;\n  uniform vec2 time;\n  uniform float rate;\n  uniform vec3 windDir;\n  uniform vec3 offsetPos;\n  uniform vec2 pointScale;\n  uniform vec3 sliders;\n\n  attribute vec4 seeds;\n  attribute vec2 atlas;\n\n  varying vec2 vAtlas;\n  varying vec2 vRot;\n  varying float vAlpha;\n  varying float vBrightness;\n\n  #define PROX 6.0\n\n  float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n\n    return ret;\n  }\n\n  void main(){\n    vAtlas=atlas;\n\n    float rot=seeds.z+time.x*(seeds.z*2.);\n    vRot=vec2( sin(rot), cos(rot) );\n\n    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n\n    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n\n    float t=time.x*rate;\n    float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);\n    float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;\n    float alphaMult = (1.0-(1.0-life)*(1.0-life))*SmokeDensity;\n\n    pOff.y=shiftY*seeds.y*life - (1.0-life);\n\n    pOff.y=(pOff.y)+shiftY;\n    vec3 pos= pOff ;\n\n    // Magic numbers!  Boo!!\n    float tightenTip = max(0.0,life-.73);\n    tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);\n    //tightenTip *= tightenTip;\n    float tightenBase = max(0.0, (1.0-life)*InnerBulster);\n    float tightenMid = max(0.0, TightenBaseSpread - tightenTip - tightenBase - seeds.x*.2);\n\n    float curBaseSpread = BaseSpread * tightenBase +\n                          BaseSpread * tightenMid * TightenMidSpread +\n                          BaseSpread * tightenTip * TightenTipSpread ;\n\n    //pos.xz=clamp((noiseCd.rg*noiseCd.b)*seeds.w, vec2(0.0), vec2(1.0))*curBaseSpread*(life*(seeds.zy*.6));\n    pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*curBaseSpread*life;\n\n    // Wind -- Forces\n    //   Magic numbers, yarb!\n    float windInf = life * life * (life*.5+.5);\n    vec2 curWindDir = windInf * windDir.xz ;\n\n    float yPush = ( life * (life*.5+.5))* min(1.0,pos.y*.12) * .08;\n    pos.xz += curWindDir*life + curWindDir * WindInfluenceBoost ;\n\n    // Alpha with cam distance inf\n    float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );\n    pScalar=1.0-(pScalar*pScalar);\n    float aMult = min(1.0, pScalar*2.0);\n    vAlpha = (seeds.x*.5+.7) * aMult;\n\n    // Alpha from gettin' old\n    vAlpha=(1.0-life)*min(1.0,alphaMult);\n    vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;\n    pos.xz=(pos.xz*(0.9+seeds.xy*.2)+doubleCd.rb*10.0)*min(1.0,life+seeds.y);\n\n    // Draw size, particle scale\n    pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);\n    float pScale = pointScale.x * seeds.w * 0.6 * pScalar + (175.0+125.0*life*pScalar)*(1.0-pScalar);\n    pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));\n\n    gl_PointSize = pScale;\n\n    // Brightness multiplier\n    vBrightness = 1.0-tightenMid*.1 - tightenTip + tightenBase;\n    float originDelta = length(pos)*(-InnerBulster);\n    vBrightness *= max(0.0, 1.0-originDelta * life * 0.807) * SmokeBrightness;\n\n    // Apply Offset Position and move to camera space\n    vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n  }",i}function kr(e=!1){let t="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return t+="\n// -- -- --\n\nuniform sampler2D atlasTexture;\nuniform sampler2D atlasAlphaTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\n// -- -- --\n\n// Human Eye Adjusted Luminance\n//   https://en.wikipedia.org/wiki/Grayscale\nfloat luma(vec3 color) {\n  return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n}\n\n// -- -- --\n\nvoid main(){\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = (uv-.5)*.85;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n    ",t+=e?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      );\n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",t+="\n        float alpha=dustCd.a*vAlpha;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        float lumaCd = luma( Cd.rgb );\n\n        Cd.rgb = mix( vec3( lumaCd ), Cd.rgb, vBrightness*.2 );\n\n        Cd.rgb *= vec3(vBrightness);\n        //Cd.rgb *= Cd.rgb*.5+.5;\n\n        gl_FragColor=Cd;\n    }",t}var Qr={ProxDist:1e3,CalculateCollisions:!0,LandHeight:50};function Or(e={}){let t=e=>(e+"").includes(".")?e:e+".0",i="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return i+=`\nuniform vec2 time;\nuniform float rate;\nuniform float pointScale;\n\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vScalar;\n\n#define PROX ${t((e=Object.assign({},Qr,e)).ProxDist)}\n#define LAND ${t(e.LandHeight)}\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n\n    return ret;\n}\n\nvoid main(){\n    vAtlas=atlas;\n\n    float rot=seeds.z+time.x*(seeds.z*2.);\n    vRot=vec2( sin(rot), cos(rot) );\n\n    float t=time.x*rate;\n\n    vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);\n\n    // Loop point positions based on camera location\n    float yFract=fract(t+seeds.z);\n    pOff.y=PROX-yFract*(PROX+LAND);\n    vec3 pos= pOff ;\n    vec2 camXZ=cameraPosition.xz;\n    pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;\n\n    // Get some roof tops working\n    //   Using opposing points and 2 normals in xz space to determin y floor position\n    // Find rooves from xz pos + dot products\n    float floor=0.0;\n`,e.CalculateCollisions&&(i+="\n        // -- --\n        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1\n        vec2 l1n1=vec2(-.1,1.); // Normal 1\n        vec2 l1n2=vec2(1.,-.1); // Normal 2\n        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2\n        vec2 l2n1=vec2(.1,-1.1);\n        vec2 l2n2=vec2(-1.,.1);\n        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof\n\n        lp1=vec2( -217.0, 786.0 ); // Point 1\n        l1n1=vec2(.2,-1.); // Normal 1\n        l1n2=vec2(1.,.1); // Normal 2\n        lp2=vec2( -940.0, 1293.0 ); // Point 2\n        l2n1=vec2(-.2,1.);\n        l2n2=vec2(-1.,-.1);\n        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n\n        lp1=vec2( 204.028, 56.7629 ); // Point 1\n        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1\n        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2\n        lp2=vec2( 755.264, 754.843 ); // Point 2\n        l2n1=vec2( -0.160366, 0.987058 );\n        l2n2=vec2( 0.999849, 0.0173488 );\n        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n        "),i+="\n        // Prevent snow drifting after hitting the ground\n        float yLimit=max( floor, pos.y ) * .08 * seeds.z;\n        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky\n\n        // Shift Y position per camera height\n        pos.y+=cameraPosition.y-yFract*(cameraPosition.y);\n        pos.y=max( floor+1.5, pos.y );\n\n        float melt=min(1.0, (pOff.y+LAND-floor)*.02);\n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );\n\n        vScalar = pScalar;\n        float pScale = pointScale * seeds.w * pScalar ;\n        gl_PointSize = pScale;\n\n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }",i}function Fr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D snowTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vScalar;\n\nvoid main(){\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = uv-.5;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n\n    float alpha=texture2D(snowTexture,rotUV).r * vScalar;\n    vec4 Cd=vec4( vec3(1.), alpha );\n\n    gl_FragColor=Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D snowTexture;\nuniform vec2 time;\nuniform float rate;\n\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vScalar;\n\nvoid main(){\n    vec2 uv=gl_PointCoord;\n\n    vec2 pos = uv-.5;\n\n    vec2 rotUV;\n    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n    rotUV=(rotUV+.5)*.25+vAtlas;\n\n    float alpha=texture2D(snowTexture,rotUV).r * vScalar;\n    vec4 Cd=vec4( vec3(1.), alpha );\n\n    gl_FragColor=Cd;\n}"}var Gr={};function Ur(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nvarying vec3 pos;\n\nvoid main(){\n  vec3 transformed = vec3( position );\n    vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );\n  pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;\n\n  gl_Position = projectionMatrix * mvPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nvarying vec3 pos;\n\nvoid main(){\n  vec3 transformed = vec3( position );\n    vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );\n  pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;\n\n  gl_Position = projectionMatrix * mvPosition;\n}"}function _r(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e="#include <packing>\n  "+e,e+="\nuniform sampler2D diffuse;\nuniform sampler2D depth;\nuniform float camNear;\nuniform float camFar;\nvarying vec3 pos;\n\nvoid main() {\n\n  vec4 Cd=vec4( pos, 1.0 );\n  gl_FragColor = Cd;\n}",e}function Nr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D gDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D sceneDepth;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n  vec4 gCd=texture2D( gDiffuse, vUv );\n  vec4 rCd=texture2D( rDiffuse, vUv );\n\n  Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;\n\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D gDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D sceneDepth;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n  vec4 gCd=texture2D( gDiffuse, vUv );\n  vec4 rCd=texture2D( rDiffuse, vUv );\n\n  Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;\n\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}"}function jr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D tDiffusePrev;\nuniform sampler2D tDiffusePrevRoom;\nuniform float roomComposer;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd = texture2D( tDiffusePrev, vUv );\n  vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;\n  Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);\n  //Cd.rgb=Cd.rgb + prevRoomCd;\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D tDiffusePrev;\nuniform sampler2D tDiffusePrevRoom;\nuniform float roomComposer;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd = texture2D( tDiffusePrev, vUv );\n  vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;\n  Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);\n  //Cd.rgb=Cd.rgb + prevRoomCd;\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}"}function Hr(){let e="";return e+="\n  uniform sampler2D tDiffuse;\n  uniform sampler2D mtDiffuse;\n  uniform sampler2D sceneDepth;\n  uniform sampler2D noiseTexture;\n  uniform float exposure;\n  uniform vec2 camRotPitch;\n  uniform vec2 time;\n  varying vec2 vUv;\n\n  void main() {\n    vec4 Cd=texture2D(tDiffuse,vUv)*exposure;\n    vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;\n    vec4 depth=texture2D(sceneDepth,vUv);\n\n////////////////////////\n/*\n    vec2 uv=vUv;\n    float pi=3.14159265358979;\n    float t=-time.x*.007;\n    float pitch=camRotPitch.y;//depth.w*2.0-1.0;\n    float yaw=camRotPitch.x;\n\n    float distMult=depth.x*2.0;\n    vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));\n    vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;\n    noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));\n    noiseCd.g=texture2D(noiseTexture,noiseUV).g;\n    noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));\n    noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n    mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);\n\n    float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;\n    float bval=length(bloomCd.rgb);\n    mult= mult*(bg+bval) ;//*(1.0-depth.z);\n    Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );\n    */\n\n    Cd.rgb+=mBlurCd.rgb;\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n  }","\n  uniform sampler2D tDiffuse;\n  uniform sampler2D mtDiffuse;\n  uniform sampler2D sceneDepth;\n  uniform sampler2D noiseTexture;\n  uniform float exposure;\n  uniform vec2 camRotPitch;\n  uniform vec2 time;\n  varying vec2 vUv;\n\n  void main() {\n    vec4 Cd=texture2D(tDiffuse,vUv)*exposure;\n    vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;\n    vec4 depth=texture2D(sceneDepth,vUv);\n\n////////////////////////\n/*\n    vec2 uv=vUv;\n    float pi=3.14159265358979;\n    float t=-time.x*.007;\n    float pitch=camRotPitch.y;//depth.w*2.0-1.0;\n    float yaw=camRotPitch.x;\n\n    float distMult=depth.x*2.0;\n    vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));\n    vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;\n    noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));\n    noiseCd.g=texture2D(noiseTexture,noiseUV).g;\n    noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));\n    noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n    mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);\n\n    float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;\n    float bval=length(bloomCd.rgb);\n    mult= mult*(bg+bval) ;//*(1.0-depth.z);\n    Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );\n    */\n\n    Cd.rgb+=mBlurCd.rgb;\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n  }"}function Vr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform vec2 resUV;\nuniform float ratio;\nuniform vec3 gamma;\nvarying vec2 vUv;\n\n// 1/4 ==  0.25\n//  + 2 center samples, 1/6 ==  0.166...\n#define AADIV 0.1666666666666666\nconst int runCount = 4;\nconst vec2 runDir[4] = vec2[4](\n                          vec2( -1.0, -1.0 ),\n                          vec2( -1.0, 1.0 ),\n                          vec2( 1.0, -1.0 ),\n                          vec2( 1.0, 1.0 )\n                        );\n\nvoid main() {\n  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n\n  float dist = 1.0;\n  vec2 baseUV=vUv;\n  vec2 curUV;\n  vec3 curCd;\n  for(int s=0; s<runCount; ++s){\n    curUV = baseUV+runDir[s]*(resUV);//*dist);\n    curCd = texture2D(tDiffuse,curUV).rgb;\n    Cd.rgb+=curCd;\n  }\n  Cd.rgb=Cd.rgb*AADIV;\n  Cd.a=1.0;\n\n  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform vec2 resUV;\nuniform float ratio;\nuniform vec3 gamma;\nvarying vec2 vUv;\n\n// 1/4 ==  0.25\n//  + 2 center samples, 1/6 ==  0.166...\n#define AADIV 0.1666666666666666\nconst int runCount = 4;\nconst vec2 runDir[4] = vec2[4](\n                          vec2( -1.0, -1.0 ),\n                          vec2( -1.0, 1.0 ),\n                          vec2( 1.0, -1.0 ),\n                          vec2( 1.0, 1.0 )\n                        );\n\nvoid main() {\n  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n\n  float dist = 1.0;\n  vec2 baseUV=vUv;\n  vec2 curUV;\n  vec3 curCd;\n  for(int s=0; s<runCount; ++s){\n    curUV = baseUV+runDir[s]*(resUV);//*dist);\n    curCd = texture2D(tDiffuse,curUV).rgb;\n    Cd.rgb+=curCd;\n  }\n  Cd.rgb=Cd.rgb*AADIV;\n  Cd.a=1.0;\n\n  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n  gl_FragColor = Cd;\n}"}function Wr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform vec2 resUV;\nuniform float ratio;\nuniform vec3 gamma;\nvarying vec2 vUv;\n\n// 1/8 ==  0.125\n//  + 2 center samples, 1/10 ==  0.1\n#define AADIV 0.1\nconst int runCount = 8;\nconst vec2 runDir[8] = vec2[8](\n                          vec2( -1.0, -1.0 ),\n                          vec2( -1.0, 1.0 ),\n                          vec2( 1.0, -1.0 ),\n                          vec2( 1.0, 1.0 ),\n\n                          vec2( -1.0, 0.0 ),\n                          vec2( 0.0, -1.0 ),\n                          vec2( 0.0, 1.0 ),\n                          vec2( 1.0, 0.0 )\n                        );\n\nvoid main() {\n  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n\n  float dist = 1.0;\n  vec2 baseUV=vUv;\n  vec2 curUV;\n  vec3 curCd;\n  for(int s=0; s<runCount; ++s){\n    curUV = baseUV+runDir[s]*(resUV);//*dist);\n    curCd = texture2D(tDiffuse,curUV).rgb;\n            Cd.rgb+=curCd;\n  }\n  Cd.rgb=Cd.rgb*AADIV;\n  Cd.a=1.0;\n\n  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform vec2 resUV;\nuniform float ratio;\nuniform vec3 gamma;\nvarying vec2 vUv;\n\n// 1/8 ==  0.125\n//  + 2 center samples, 1/10 ==  0.1\n#define AADIV 0.1\nconst int runCount = 8;\nconst vec2 runDir[8] = vec2[8](\n                          vec2( -1.0, -1.0 ),\n                          vec2( -1.0, 1.0 ),\n                          vec2( 1.0, -1.0 ),\n                          vec2( 1.0, 1.0 ),\n\n                          vec2( -1.0, 0.0 ),\n                          vec2( 0.0, -1.0 ),\n                          vec2( 0.0, 1.0 ),\n                          vec2( 1.0, 0.0 )\n                        );\n\nvoid main() {\n  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n\n  float dist = 1.0;\n  vec2 baseUV=vUv;\n  vec2 curUV;\n  vec3 curCd;\n  for(int s=0; s<runCount; ++s){\n    curUV = baseUV+runDir[s]*(resUV);//*dist);\n    curCd = texture2D(tDiffuse,curUV).rgb;\n            Cd.rgb+=curCd;\n  }\n  Cd.rgb=Cd.rgb*AADIV;\n  Cd.a=1.0;\n\n  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n  gl_FragColor = Cd;\n}"}function zr(e,t,i,s){let r="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return r+=`\nuniform sampler2D tDiffuse;\nuniform sampler2D pDiffuse;\nuniform vec2 resUV;\nvarying vec2 vUv;\n\n#define PI 3.14159265358979\n\nvoid main() {\n\n  float dist = 2.0;\n  float fade = 1.0;\n  vec2 baseUV=vUv;\n\n  const int blurCount=${i};\n  const int runCount=2;\n  vec2 runDir[runCount];\n  runDir[0]=vec2(${t[0]}.0, ${t[1]}.0);\n  runDir[1]=vec2(-${t[0]}.0, -${t[1]}.0);\n  vec2 curUV;\n  vec4 curCd;\n  vec4 blurCd=vec4(.0);\n  for(int b=0; b<blurCount; ++b){\n    dist = 1.0 + float(b)*${s};\n    fade = (1.0-float(b+1)/float(blurCount+2));\n    //fade = 1.- (1.-fade)*(1.-fade);\n    for(int s=0; s<runCount; ++s){\n      curUV = baseUV+runDir[s]*(resUV*dist);\n      curUV = min( vec2(1.), max( vec2(0.), curUV ));\n      curCd = texture2D(${e},curUV);\n      curCd.a *= fade*(length(curCd.rgb)*.6);\n      blurCd.r = max( blurCd.r, curCd.r );\n      blurCd.g = max( blurCd.g, curCd.g );\n      blurCd.b = max( blurCd.b, curCd.b );\n      //blurCd.rgb += curCd.rgb;\n      blurCd.a = max( blurCd.a, curCd.a );\n    }\n  }\n  vec4 Cd=blurCd;\n  //Cd.a=.01;\n  gl_FragColor = Cd;\n}`,r}function Kr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D pDiffuse;\nuniform vec2 resUV;\nvarying vec2 vUv;\n\n#define PI 3.14159265358979\n\nvoid main() {\n\n  float dist = 3.0;\n  float fade = 1.0;\n  vec2 baseUV=vUv;\n  const int blurCount=3;\n  const int runCount=8;\n  vec2 runDir[runCount];\n  runDir[0]=vec2(1.0, 0.0);\n  runDir[1]=vec2(1.0, 1.0);\n  runDir[2]=vec2(0.0, 1.0);\n  runDir[3]=vec2(-1.0, 1.0);\n  runDir[4]=vec2(-1.0, 0.0);\n  runDir[5]=vec2(-1.0, -1.0);\n  runDir[6]=vec2(0.0, -1.0);\n  runDir[7]=vec2(1.0, -1.0);\n  vec2 curUV;\n  vec4 curCd;\n  vec4 scatterCd=vec4(.0);\n  for(int b=0; b<blurCount; ++b){\n    dist = 1.5*(1.0+float(b));\n    fade = .1*(1.0-float(b)/float(blurCount));\n    for(int s=0; s<runCount; ++s){\n      curUV = baseUV+runDir[s]*(resUV*dist);\n      curCd = texture2D(pDiffuse,curUV);\n      curCd.a *= fade;\n      scatterCd.rgb += curCd.rgb;\n      scatterCd.a = max( scatterCd.a, curCd.a );\n    }\n  }\n  vec4 Cd=scatterCd;\n\n  vec4 blurCd=texture2D(tDiffuse,vUv);\n  blurCd.rgb = normalize( blurCd.rgb );\n\n  Cd = mix( blurCd, Cd, Cd.a);\n  Cd = texture2D(tDiffuse,vUv);\n  //Cd.a=.01;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D pDiffuse;\nuniform vec2 resUV;\nvarying vec2 vUv;\n\n#define PI 3.14159265358979\n\nvoid main() {\n\n  float dist = 3.0;\n  float fade = 1.0;\n  vec2 baseUV=vUv;\n  const int blurCount=3;\n  const int runCount=8;\n  vec2 runDir[runCount];\n  runDir[0]=vec2(1.0, 0.0);\n  runDir[1]=vec2(1.0, 1.0);\n  runDir[2]=vec2(0.0, 1.0);\n  runDir[3]=vec2(-1.0, 1.0);\n  runDir[4]=vec2(-1.0, 0.0);\n  runDir[5]=vec2(-1.0, -1.0);\n  runDir[6]=vec2(0.0, -1.0);\n  runDir[7]=vec2(1.0, -1.0);\n  vec2 curUV;\n  vec4 curCd;\n  vec4 scatterCd=vec4(.0);\n  for(int b=0; b<blurCount; ++b){\n    dist = 1.5*(1.0+float(b));\n    fade = .1*(1.0-float(b)/float(blurCount));\n    for(int s=0; s<runCount; ++s){\n      curUV = baseUV+runDir[s]*(resUV*dist);\n      curCd = texture2D(pDiffuse,curUV);\n      curCd.a *= fade;\n      scatterCd.rgb += curCd.rgb;\n      scatterCd.a = max( scatterCd.a, curCd.a );\n    }\n  }\n  vec4 Cd=scatterCd;\n\n  vec4 blurCd=texture2D(tDiffuse,vUv);\n  blurCd.rgb = normalize( blurCd.rgb );\n\n  Cd = mix( blurCd, Cd, Cd.a);\n  Cd = texture2D(tDiffuse,vUv);\n  //Cd.a=.01;\n  gl_FragColor = Cd;\n}"}function qr(e,t){let i="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return i+="\nuniform sampler2D tDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D noiseTexture;\n\nuniform float exposure;\nuniform vec2 time;\nuniform vec3 camRotXYZ;\nuniform vec2 blurDirCur;\nuniform vec2 blurDirPrev;\nvarying vec2 vUv;\n\nvec4 getTexture( sampler2D texelToLinearTexture ) {\n  return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n}\n\nvec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){\n  float perc;\n  float curPerc=1.0;\n  vec2 curUV;\n  float origLength=length(origCd.rgb);\n  vec3 curCd;\n  vec3 retCd=origCd;\n  float delta;\n  float threshTrigger=1.0;\n  float dropoff;\n  float percCurve;\n  float d=dot(dir,deltaDir)*.5+.5;\n  for(int r=0; r<10; ++r){\n    perc=(float(r)/10.0);\n    percCurve=perc*.5;\n    dropoff=(dist*float(r))*perc*d;\n    curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;\n    //curUV=uv+dir*dropoff;\n    curCd=texture2D(tex,curUV).rgb;\n    delta=length(curCd.rgb);\n    delta=origLength<delta?1.0-perc*perc:0.0;\n    //delta=1.0-perc*perc;\n    retCd+=curCd.rgb*delta;\n    curPerc+=delta;\n\n    percCurve*=percCurve;\n    curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;\n    //curUV=uv-dir*dropoff*.4;\n    curCd=texture2D(tex,curUV).rgb;\n    delta=length(curCd.rgb);\n    delta=origLength<delta?1.0-perc*perc:0.0;\n    //delta=1.0-perc*perc;\n    retCd+=curCd.rgb*delta;\n    curPerc+=delta;\n\n  }\n  return retCd /curPerc;\n}\n\nvoid main() {\n\n  vec4 bloomCd=getTexture( rDiffuse );\n  float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;\n  noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));\n  vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);\n  vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n  float blurDist=length(blurDirCur);\n  blurDist=min(1.0,blurDist*15.0);\n  //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));\n  vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);",t||(i+="\n        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );\n      "),i+="\n      vec2 deltaDir=normalize(blurDirPrev);\n      deltaDir.x+=sin((blurDir.x-deltaDir.x));\n      deltaDir.y+=sin((blurDir.y-deltaDir.y));\n\n      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, "+e.y+"*"+(t?"3.0":"5.0")+"*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);\n      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;\n      //Cd.a=bloomAdd.a-bloomCd.a;\n\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n\n    }",i}function Yr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D chroAberUVTexture;\nuniform sampler2D chroAberUVAlpha;\nuniform vec2 ratio;\n\nuniform vec2 warpMult;\nuniform vec2 lKing;\n\nvarying vec2 vUv;\n\nvoid main() {\n  // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame\n  vec4 caCd= vec4(\n    texture2D( chroAberUVTexture, vUv ).rgb - 0.7294118,\n    texture2D( chroAberUVAlpha, vUv ).r - 0.5019608\n  );\n  //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );\n  caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;\n\n  vec2 bUv=vUv+caCd.rg;\n  vec2 rUv=vUv+caCd.ba;\n  vec2 gUv=vUv+(caCd.rg+caCd.ba);\n  vec4 rCd=texture2D( tDiffuse, rUv );\n  vec4 Cd=texture2D( tDiffuse, gUv );\n  vec4 bCd=texture2D( tDiffuse, bUv );\n\n  Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D chroAberUVTexture;\nuniform sampler2D chroAberUVAlpha;\nuniform vec2 ratio;\n\nuniform vec2 warpMult;\nuniform vec2 lKing;\n\nvarying vec2 vUv;\n\nvoid main() {\n  // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame\n  vec4 caCd= vec4(\n    texture2D( chroAberUVTexture, vUv ).rgb - 0.7294118,\n    texture2D( chroAberUVAlpha, vUv ).r - 0.5019608\n  );\n  //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );\n  caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;\n\n  vec2 bUv=vUv+caCd.rg;\n  vec2 rUv=vUv+caCd.ba;\n  vec2 gUv=vUv+(caCd.rg+caCd.ba);\n  vec4 rCd=texture2D( tDiffuse, rUv );\n  vec4 Cd=texture2D( tDiffuse, gUv );\n  vec4 bCd=texture2D( tDiffuse, bUv );\n\n  Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}"}function Jr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv )*.2;\n  vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;\n\n  vec2 bUv=vUv+noiseCd.rg;\n  vec2 rUv=vUv+noiseCd.gb;\n  vec2 gUv=vUv+noiseCd.br;\n  vec4 rCd=texture2D( tDiffuse, rUv );\n  vec4 gCd=texture2D( tDiffuse, gUv );\n  vec4 bCd=texture2D( tDiffuse, bUv );\n\n  Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv )*.2;\n  vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;\n\n  vec2 bUv=vUv+noiseCd.rg;\n  vec2 rUv=vUv+noiseCd.gb;\n  vec2 gUv=vUv+noiseCd.br;\n  vec4 rCd=texture2D( tDiffuse, rUv );\n  vec4 gCd=texture2D( tDiffuse, gUv );\n  vec4 bCd=texture2D( tDiffuse, bUv );\n\n  Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );\n  Cd.a=1.0;\n  gl_FragColor = Cd;\n}"}function Xr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D tDiffusePrev;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n        vec4 pCd=texture2D( tDiffusePrev, vUv );\n        vec3 dCd=Cd.rgb-pCd.rgb;\n        vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;\n        vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;\n        b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );\n\n        vec4 outCd=vec4(1.0);\n        outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );\n\n  vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;\n\n        outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );\n        outCd.rgb+= dCd.gbr;\n\n  outCd.a=1.0;\n  gl_FragColor = outCd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D tDiffusePrev;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 ratio;\nvarying vec2 vUv;\n\n    #define PI 3.14159265358979\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n        vec4 pCd=texture2D( tDiffusePrev, vUv );\n        vec3 dCd=Cd.rgb-pCd.rgb;\n        vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;\n        vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;\n        b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );\n\n        vec4 outCd=vec4(1.0);\n        outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );\n\n  vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;\n\n        outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );\n        outCd.rgb+= dCd.gbr;\n\n  outCd.a=1.0;\n  gl_FragColor = outCd;\n}"}function Zr(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvarying vec2 starUv;\nvarying float vTimer;\n\nvoid main(){\n    vUv=uv;\n    vUvShift=uv-.5;\n\n    vec2 rUv=vUvShift*0.7071067811865476;\n    vec2 tmpUv=rUv;\n    float rot=time.x*.1;\n    vec2 sinCos=vec2( sin(rot), cos(rot) );\n    rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;\n    rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;\n    rUv=(rUv+.5);\n\n    float starTimer=sin(time.x*.2)*.1+.1;\n    starUv=mix( vUv, rUv, starTimer);\n\n    vTimer=time.x*.5;\n\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvarying vec2 starUv;\nvarying float vTimer;\n\nvoid main(){\n    vUv=uv;\n    vUvShift=uv-.5;\n\n    vec2 rUv=vUvShift*0.7071067811865476;\n    vec2 tmpUv=rUv;\n    float rot=time.x*.1;\n    vec2 sinCos=vec2( sin(rot), cos(rot) );\n    rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;\n    rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;\n    rUv=(rUv+.5);\n\n    float starTimer=sin(time.x*.2)*.1+.1;\n    starUv=mix( vUv, rUv, starTimer);\n\n    vTimer=time.x*.5;\n\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n}"}function $r(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D starTexture;\nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvarying vec2 starUv;\nvarying float vTimer;\n\n#define PI 3.14159265358979\n\nvoid main() {\n    float uvDist=length(vUvShift);\n\n    vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;\n\n    float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;\n    vec2 starBlendUV=starCd.rg*blender;\n\n    vec2 cdUv = vUv+starBlendUV;\n    vec4 Cd=texture2D( tDiffuse, cdUv );\n\n    vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );\n    float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;\n    Cd.rgb= mix( Cd.rgb, negCd, cdBlender );\n\n    gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D starTexture;\nvarying vec2 vUv;\nvarying vec2 vUvShift;\nvarying vec2 starUv;\nvarying float vTimer;\n\n#define PI 3.14159265358979\n\nvoid main() {\n    float uvDist=length(vUvShift);\n\n    vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;\n\n    float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;\n    vec2 starBlendUV=starCd.rg*blender;\n\n    vec2 cdUv = vUv+starBlendUV;\n    vec4 Cd=texture2D( tDiffuse, cdUv );\n\n    vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );\n    float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;\n    Cd.rgb= mix( Cd.rgb, negCd, cdBlender );\n\n    gl_FragColor = Cd;\n}"}function ea(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D noiseTexture;\nuniform sampler2D animTexture;\nuniform vec2 time;\nuniform vec2 fader;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n  vec4 animCd=texture2D( animTexture, vUv );\n  float timer=time.x*.2;\n  vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );\n  animCd=texture2D( animTexture, animUV );\n\n  vec2 noiseUV=animUV+animCd.rg;\n  vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n  noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );\n\n  float blend=fader.x*fader.y;\n  Cd=mix( Cd, noiseCd, blend);\n\n  Cd.a=1.0;\n  Cd.r=1.0;\n  gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D noiseTexture;\nuniform sampler2D animTexture;\nuniform vec2 time;\nuniform vec2 fader;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 Cd=texture2D( tDiffuse, vUv );\n  vec4 animCd=texture2D( animTexture, vUv );\n  float timer=time.x*.2;\n  vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );\n  animCd=texture2D( animTexture, animUV );\n\n  vec2 noiseUV=animUV+animCd.rg;\n  vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n  noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );\n\n  float blend=fader.x*fader.y;\n  Cd=mix( Cd, noiseCd, blend);\n\n  Cd.a=1.0;\n  Cd.r=1.0;\n  gl_FragColor = Cd;\n}"}function ta(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    uniform sampler2D tDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D bloomTexture;\n    uniform sampler2D sceneDepth;\n    uniform sampler2D scenePos;\n    uniform sampler2D noiseTexture;\n    uniform vec3 camPos;\n    uniform vec2 time;\n    uniform vec2 fogMult;\n    uniform vec2 proximityMult;\n    uniform float ratio;\n    uniform float exposure;\n    varying vec2 vUv;\n\n    vec3 fogValue( vec3 worldPos, float time ){\n        float wpDist = worldPos.x+worldPos.z*2.0;\n        vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));\n        vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n        noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));\n        noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;\n        noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));\n        noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n\n        return noiseCd;\n    }\n\n    #define PROX_WARP 3.14159265358979*.45\n\n    void main() {\n        vec4 Cd=texture2D(rDiffuse,vUv);\n        float depth=texture2D(sceneDepth,vUv).r;\n\n        vec3 worldPos = texture2D(scenePos,vUv).rgb;\n        float t = -time.x*.003;\n        vec3 baseNoiseCd=fogValue( worldPos, t );\n\n        float mult=0.0;\n        vec3 noiseCd;\n        vec3 curNoiseCd;\n        vec3 samplePos;\n        float samples=4.3;//+sin(time.x*.001);\n        float blender;\n        float blenderMax=0.0;\n        for( int x=0; x<=3; ++x){\n            blender=( float(x+1) / samples );\n            samplePos=worldPos*blender;\n            curNoiseCd=fogValue( samplePos, t );\n            noiseCd=max(noiseCd, curNoiseCd * blender );\n            blenderMax+=blender;\n        }\n        noiseCd += baseNoiseCd*.2;\n        mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;\n        //mult*=mult;\n\n        // Distance Mapping\n        float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n        float mDepth= pow( depth, 28.*proxWarp );\n\n        float fogDap= max(0.0, 1.0-mDepth);\n        fogDap=1.0-fogDap*fogDap;\n        mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;\n\n        Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;\n\n        vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n        Cd.rgb+= bloomCd;\n        Cd.rgb*=exposure;\n\n        // Proximity Draw Over\n        float dProx=  ((mDepth-.5)*-10.);\n        dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n        float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n        dProx*= dProx* yProxMult * proximityMult.x;\n        vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n        Cd.rgb+=proxCd*mult;\n\n        Cd.a=1.0;\n        gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D bloomTexture;\n    uniform sampler2D sceneDepth;\n    uniform sampler2D scenePos;\n    uniform sampler2D noiseTexture;\n    uniform vec3 camPos;\n    uniform vec2 time;\n    uniform vec2 fogMult;\n    uniform vec2 proximityMult;\n    uniform float ratio;\n    uniform float exposure;\n    varying vec2 vUv;\n\n    vec3 fogValue( vec3 worldPos, float time ){\n        float wpDist = worldPos.x+worldPos.z*2.0;\n        vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));\n        vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n        noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));\n        noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;\n        noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));\n        noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n\n        return noiseCd;\n    }\n\n    #define PROX_WARP 3.14159265358979*.45\n\n    void main() {\n        vec4 Cd=texture2D(rDiffuse,vUv);\n        float depth=texture2D(sceneDepth,vUv).r;\n\n        vec3 worldPos = texture2D(scenePos,vUv).rgb;\n        float t = -time.x*.003;\n        vec3 baseNoiseCd=fogValue( worldPos, t );\n\n        float mult=0.0;\n        vec3 noiseCd;\n        vec3 curNoiseCd;\n        vec3 samplePos;\n        float samples=4.3;//+sin(time.x*.001);\n        float blender;\n        float blenderMax=0.0;\n        for( int x=0; x<=3; ++x){\n            blender=( float(x+1) / samples );\n            samplePos=worldPos*blender;\n            curNoiseCd=fogValue( samplePos, t );\n            noiseCd=max(noiseCd, curNoiseCd * blender );\n            blenderMax+=blender;\n        }\n        noiseCd += baseNoiseCd*.2;\n        mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;\n        //mult*=mult;\n\n        // Distance Mapping\n        float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n        float mDepth= pow( depth, 28.*proxWarp );\n\n        float fogDap= max(0.0, 1.0-mDepth);\n        fogDap=1.0-fogDap*fogDap;\n        mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;\n\n        Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;\n\n        vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n        Cd.rgb+= bloomCd;\n        Cd.rgb*=exposure;\n\n        // Proximity Draw Over\n        float dProx=  ((mDepth-.5)*-10.);\n        dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n        float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n        dProx*= dProx* yProxMult * proximityMult.x;\n        vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n        Cd.rgb+=proxCd*mult;\n\n        Cd.a=1.0;\n        gl_FragColor = Cd;\n}"}function ia(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D bloomTexture;\nuniform sampler2D sceneDepth;\nuniform sampler2D scenePos;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 fogMult;\nuniform vec2 proximityMult;\nuniform vec2 lookAtPerc;\nuniform vec2 resUV;\nuniform float ratio;\nuniform float exposure;\nvarying vec2 vUv;\n\n#define PROX_WARP 3.14159265358979*.45\n\nvoid main() {\n    vec4 Cd=texture2D(rDiffuse,vUv);\n    float depth=texture2D(sceneDepth,vUv).r;\n\n    vec3 worldPos = texture2D(scenePos,vUv).rgb;\n    float wpDist = worldPos.x+worldPos.z*2.0;\n    float t = -time.x*.003;\n\n    vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));\n    vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n    noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));\n    noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;\n    noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));\n    noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n\n    // Distance Mapping\n    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n    float mDepth= pow( depth, 28.*proxWarp );\n\n    float fogDap= max(0.0, 1.0-mDepth);\n    fogDap=1.0-fogDap*fogDap;\n    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n    mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;\n\n    Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;\n\n    vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n    Cd.rgb+= bloomCd;\n    Cd.rgb*=exposure;\n\n    // Proximity Draw Over\n    float dProx=  ((mDepth-.5)*-10.);\n    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n    float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n    dProx*= dProx* yProxMult * proximityMult.x;\n    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n    Cd.rgb+=proxCd*mult;\n\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D bloomTexture;\nuniform sampler2D sceneDepth;\nuniform sampler2D scenePos;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec2 fogMult;\nuniform vec2 proximityMult;\nuniform vec2 lookAtPerc;\nuniform vec2 resUV;\nuniform float ratio;\nuniform float exposure;\nvarying vec2 vUv;\n\n#define PROX_WARP 3.14159265358979*.45\n\nvoid main() {\n    vec4 Cd=texture2D(rDiffuse,vUv);\n    float depth=texture2D(sceneDepth,vUv).r;\n\n    vec3 worldPos = texture2D(scenePos,vUv).rgb;\n    float wpDist = worldPos.x+worldPos.z*2.0;\n    float t = -time.x*.003;\n\n    vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));\n    vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n    noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));\n    noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;\n    noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));\n    noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n\n    // Distance Mapping\n    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n    float mDepth= pow( depth, 28.*proxWarp );\n\n    float fogDap= max(0.0, 1.0-mDepth);\n    fogDap=1.0-fogDap*fogDap;\n    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n    mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;\n\n    Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;\n\n    vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n    Cd.rgb+= bloomCd;\n    Cd.rgb*=exposure;\n\n    // Proximity Draw Over\n    float dProx=  ((mDepth-.5)*-10.);\n    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n    float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n    dProx*= dProx* yProxMult * proximityMult.x;\n    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n    Cd.rgb+=proxCd*mult;\n\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n}"}function sa(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D tDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D bloomTexture;\nuniform sampler2D sceneDepth;\nuniform vec2 time;\nuniform vec2 proximityMult;\nuniform vec2 lookAtPerc;\nuniform vec2 resUV;\nuniform float ratio;\nuniform float exposure;\nvarying vec2 vUv;\n\n#define PROX_WARP 3.14159265358979*.4\n#define PI 3.14159265358979\n\nvec3 boostHighs( vec3 Cd ){\n    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n    sat=(1.0-sat);\n    sat=1.0-sat*sat;\n    Cd+=Cd*sat;\n    return Cd;\n}\n\nvec3 boostMids( vec3 Cd ){\n    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n    sat=sin( sat*PI );\n    Cd+=Cd*sat;\n    return Cd;\n}\n\nvoid main() {\n    vec4 Cd=texture2D(rDiffuse,vUv);\n    vec2 uv=vUv;\n\n    vec3 bloomCd=texture2D(bloomTexture,uv).rgb;\n    bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );\n\n    Cd.rgb+= bloomCd;\n\n    // Proximity Draw Over\n    float depth=texture2D(sceneDepth,vUv).r;\n\n    // Distance Mapping\n    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n    float mDepth= pow( depth, 28.*proxWarp );\n\n    // Proximity Draw Over\n    float dProx=  ((mDepth-.5)*-10.);\n    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n    dProx*= dProx * proximityMult.x;\n    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n    Cd.rgb+=proxCd;\n    Cd.r=1.0;\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D tDiffuse;\nuniform sampler2D rDiffuse;\nuniform sampler2D bloomTexture;\nuniform sampler2D sceneDepth;\nuniform vec2 time;\nuniform vec2 proximityMult;\nuniform vec2 lookAtPerc;\nuniform vec2 resUV;\nuniform float ratio;\nuniform float exposure;\nvarying vec2 vUv;\n\n#define PROX_WARP 3.14159265358979*.4\n#define PI 3.14159265358979\n\nvec3 boostHighs( vec3 Cd ){\n    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n    sat=(1.0-sat);\n    sat=1.0-sat*sat;\n    Cd+=Cd*sat;\n    return Cd;\n}\n\nvec3 boostMids( vec3 Cd ){\n    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n    sat=sin( sat*PI );\n    Cd+=Cd*sat;\n    return Cd;\n}\n\nvoid main() {\n    vec4 Cd=texture2D(rDiffuse,vUv);\n    vec2 uv=vUv;\n\n    vec3 bloomCd=texture2D(bloomTexture,uv).rgb;\n    bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );\n\n    Cd.rgb+= bloomCd;\n\n    // Proximity Draw Over\n    float depth=texture2D(sceneDepth,vUv).r;\n\n    // Distance Mapping\n    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n    float mDepth= pow( depth, 28.*proxWarp );\n\n    // Proximity Draw Over\n    float dProx=  ((mDepth-.5)*-10.);\n    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n    dProx*= dProx * proximityMult.x;\n    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n    Cd.rgb+=proxCd;\n    Cd.r=1.0;\n    Cd.a=1.0;\n    gl_FragColor = Cd;\n}"}c(Gr,{boxAntiAliasPass:()=>Wr,chroAberPostProcess:()=>Yr,compLayersPostProcess:()=>Hr,crossAntiAliasPass:()=>Vr,directionalBlurPass:()=>zr,finalOverlayHeavyShader:()=>ta,finalOverlayShader:()=>ia,finalOverlaySlimShader:()=>sa,glowPassPostProcess:()=>Nr,iZoomPostProcess:()=>Xr,lKingPostProcess:()=>Jr,mixBlurShaderPass:()=>Kr,motionBlurPostProcess:()=>qr,sFieldPostProcessFrag:()=>$r,sFieldPostProcessVert:()=>Zr,textureStorePass:()=>jr,warpPostProcess:()=>ea,worldPositionFrag:()=>_r,worldPositionVert:()=>Ur});var ra={};function aa(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform vec2 time;\n\nvarying vec2 vUv;\nvarying vec3 vCamNormal;\nvarying vec3 vWorldNormal;\nvarying vec3 vWorldCross;\nvarying vec3 vSunPos;\n\nvoid main(){\n    vUv=uv;\n\n    mat4 pvMat=projectionMatrix * viewMatrix;\n    pvMat[3] = vec4(.0, .0, .0, 1.0);\n    mat3 pvRot = inverse( mat3( pvMat ) );\n    vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));\n    vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));\n    vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));\n\n    float timeRate = time.x * .1;\n    vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );\n    vec3 sunRef = sunPos;\n    sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;\n    sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;\n    sunPos.x = sin( timeRate ) * .1;\n\n    vSunPos = normalize( sunPos );\n\n    vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);\n    gl_Position = modelViewPosition;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform vec2 time;\n\nvarying vec2 vUv;\nvarying vec3 vCamNormal;\nvarying vec3 vWorldNormal;\nvarying vec3 vWorldCross;\nvarying vec3 vSunPos;\n\nvoid main(){\n    vUv=uv;\n\n    mat4 pvMat=projectionMatrix * viewMatrix;\n    pvMat[3] = vec4(.0, .0, .0, 1.0);\n    mat3 pvRot = inverse( mat3( pvMat ) );\n    vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));\n    vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));\n    vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));\n\n    float timeRate = time.x * .1;\n    vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );\n    vec3 sunRef = sunPos;\n    sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;\n    sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;\n    sunPos.x = sin( timeRate ) * .1;\n\n    vSunPos = normalize( sunPos );\n\n    vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);\n    gl_Position = modelViewPosition;\n}"}function na(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform sampler2D noiseTexture;\nvarying vec2 vUv;\nvarying vec3 vCamNormal;\nvarying vec3 vWorldNormal;\nvarying vec3 vWorldCross;\nvarying vec3 vSunPos;\n\nvoid main(){\n    vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);\n\n    float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;\n    sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );\n\n    vec2 xOffset = vec2( .0, .0);\n    vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;\n    nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;\n    sunDot *= nCd.x*nCd.y*nCd.z;\n    nCd= vec3( length( nCd ) );\n\n    float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));\n    Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);\n    Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );\n    Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));\n    Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));\n    gl_FragColor=Cd;\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform sampler2D noiseTexture;\nvarying vec2 vUv;\nvarying vec3 vCamNormal;\nvarying vec3 vWorldNormal;\nvarying vec3 vWorldCross;\nvarying vec3 vSunPos;\n\nvoid main(){\n    vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);\n\n    float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;\n    sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );\n\n    vec2 xOffset = vec2( .0, .0);\n    vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;\n    nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;\n    sunDot *= nCd.x*nCd.y*nCd.z;\n    nCd= vec3( length( nCd ) );\n\n    float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));\n    Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);\n    Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );\n    Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));\n    Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));\n    gl_FragColor=Cd;\n}"}function oa(){let e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\nuniform float camFar;\nuniform vec2 resUV;\n\nvarying vec2 vUv;\nvarying vec3 vN;\nvarying vec3 vLocalPos;\nvarying vec4 vWorldPos;\n\nvoid main(){\n    vUv=uv;\n    vLocalPos=position;\n    vN = normal;\n\n    vec3 pos = position;\n    vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);\n    gl_Position = modelViewPosition;\n\n    vWorldPos = modelViewPosition;\n\n}","\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \nuniform float camFar;\nuniform vec2 resUV;\n\nvarying vec2 vUv;\nvarying vec3 vN;\nvarying vec3 vLocalPos;\nvarying vec4 vWorldPos;\n\nvoid main(){\n    vUv=uv;\n    vLocalPos=position;\n    vN = normal;\n\n    vec3 pos = position;\n    vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);\n    gl_Position = modelViewPosition;\n\n    vWorldPos = modelViewPosition;\n\n}"}function la(e=Qs.OFF){let t="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return t+="\nuniform sampler2D diffuse;\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform float camNear;\nuniform float camFar;\nuniform vec2 resUV;\n\nuniform float rate;\nuniform vec3 fogColor;\n\nvarying vec2 vUv;\nvarying vec3 vN;\nvarying vec3 vLocalPos;\nvarying vec4 vWorldPos;\n\n#define PI 3.14159265358979323\n\nvoid main(){\n    vec2 uv=vUv;\n    vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;\n    vec4 Cd=texture2D(diffuse,uv);\n",e===Qs.VAPOR&&(t+="\n\n        // -- -- -- -- -- -- -- -- --\n        // -- Horizon Vapor Code - -- --\n        // -- -- -- -- -- -- -- -- -- -- --\n\n        vec3 lPos = vLocalPos;\n        lPos.y = abs(lPos.y)*0.05;\n\n        float t = time.x*.6;\n\n        // Duel noise texture sampling\n        //   Creates a flowing vapor effect flowing through the noise texture\n        vec2 nUv =  vec2(vUv.x*0.40, vUv.y*.5 - t*.0065  - vN.y );\n        vec3 noiseBaseCd = texture2D( noiseTexture, nUv ).rgb;\n        nUv = ( nUv*vec2(1.0,.5)+noiseBaseCd.rg*(noiseBaseCd.b) + t*.02);\n        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;\n        noiseCd.rg = noiseCd.rg*2.0-1.0;\n\n        float reachDepth = 0.0 ;\n\n        // Calculate mask based on the local position\n        //   Assuming for a sky-box / sky-sphere object\n        vec3 normPos = normalize(vLocalPos);\n        normPos.y = 1.0-min(1.0,(normPos.y)*3.0);\n        normPos.y = normPos.y*normPos.y*normPos.y;\n\n        // Noise-influence of the normal vector to drive the vapoe mask\n        reachDepth =  min(1.0, (vN.y * 1. * noiseCd.x  * max(noiseCd.y, noiseCd.z))) ;\n\n        float vaporMask = clamp(reachDepth+normPos.y * max(.95, noiseBaseCd.x*noiseBaseCd.z+vN.y*.5), 0.0, 1.0)*.1;\n\n        float fogMixer = (Cd.r+Cd.g+Cd.b) - (fogColor.r+fogColor.g+fogColor.b) ;\n        vec3 toFogColor = mix(  Cd.rgb, fogColor,  fogMixer );\n        float blender = (sin(noiseCd.r*PI+t+uv.x))*max(0.0,1.0-(vaporMask+fogMixer))*.1 ;\n        vec3 baseColor = (toFogColor-min(1.0,blender+ vaporMask*10.0)) ;\n\n        Cd.rgb = mix(Cd.rgb, baseColor, vaporMask * step( -0.10, vN.y ));\n\n        // -- -- -- -- -- -- -- -- -- -- --\n        // -- End of Horizon Vapor -- --\n        // -- -- -- -- -- -- -- -- --\n\n    "),t+="\n\n        gl_FragColor=Cd;\n    }",t}c(ra,{bgScreenFrag:()=>na,bgScreenVert:()=>aa,skyObjectFrag:()=>la,skyObjectVert:()=>oa});var ha={animated:nr,core:er,objects:Ar,particles:yr,rendering:Gr,scene:ra},ca=class{constructor(t=null,i="particles"){this.type="particleSystem",this.name=i,this.room=t,this.geometry=null,this.material=null,this.points=null,this.count=-1,this.pscale=new e.Vector2(0,0),this.position=new e.Vector3(0,0,0),this.atlasPath="sprite_dustAtlas_rgb.jpg",this.atlasAlphaPath="sprite_dustAtlas_alpha.jpg",this.hasAlphaMap=!0,this.shaderSettings={vertCount:1e3,pScale:7,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,hasLights:!1},this.knownKeys=Object.keys(this.shaderSettings)}build(t={},i={},s=null,r=null){if(!s||!r)return void console.error("No Shader Found; Cannot Build Particle System");if(t&&typeof t===Object){let e=Object.keys(t);this.knownKeys.forEach((i=>{e.includes(i)?this.shaderSettings[i]=t[i]:t[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=this.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));let a=this.room.pxlFile.pxlShaderBuilder(i,s,r);this.material=a,this.material.transparent=!0,this.material.depthTest=!0,this.material.depthWrite=!1,this.shaderSettings.hasOwnProperty("additiveBlend")&&this.shaderSettings.additiveBlend&&(this.material.blending=e.AdditiveBlending),this.addToScene()}setPosition(...t){1===t.length?this.position=t[0]:this.position=new e.Vector3(...t),this.points&&this.points.position.copy(this.position)}setMaterial(e){e||e.isMaterial?(this.material=e,this.points&&(this.points.material=e)):console.error("No Material Found; Cannot Set Particle System Material")}setGeometry(e){e||e.isBufferGeometry?(this.shaderSettings.vertCount=e.attributes.position.count,this.geometry=e,this.points&&(this.points.geometry=e)):console.error("No Geometry Found; Cannot Set Particle System Geometry")}getSettings(){return this.shaderSettings}setSettings(t={}){if(!t||"object"!=typeof t)return void console.error("No Settings Found; Cannot Set Particle System Settings");let i=Object.keys(t);this.knownKeys.forEach((e=>{i.includes(e)?this.shaderSettings[e]=t[e]:t[e]=this.shaderSettings[e]})),this.points&&(this.points.material.uniforms.pointScale.value=new e.Vector2(this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc,this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc))}addToScene(){if(!this.shaderSettings)return void console.error("No Shader Settings Found; Somehow deleted?");let t=this.shaderSettings.vertCount,i=this.shaderSettings.pScale,s=this.material,r=this.shaderSettings.atlasRes,a=this.shaderSettings.atlasPicks,n=this.shaderSettings.randomAtlas,o=this.shaderSettings.additiveBlend;this.geometry&&this.geometry.attributes.position.count>0&&(t=this.geometry.attributes.position.count,this.shaderSettings.vertCount=t),this.room.materialList[this.name]=s,this.count=t,this.pscale.x=i*this.room.pxlEnv.pxlQuality.screenResPerc;let l=null;n?(l=this.atlasRandomGen,a=r):l=this.atlasArrayPicker,s||(s=this.newMaterial());let h=[],c=[],d=[],u=null;if(this.geometry){u=this.geometry;let i=!1,s=!1;if(t=u.attributes.position.count,this.count=t,u.attributes.hasOwnProperty("atlas")||(s=!0),u.attributes.hasOwnProperty("seeds")||(i=!0),s||i)for(let e=0;e<t;++e)i&&c.push(Math.random(),2*Math.random()-1,Math.random(),2*Math.random()-1),s&&d.push(...l(a));if(i){let t=new e.Float32BufferAttribute(c,4);u.setAttribute("seeds",t)}if(s){let t=new e.Float32BufferAttribute(d,2);u.setAttribute("atlas",t)}}else{for(let e=0;e<t;++e)h.push(0,0,0),c.push(Math.random(),2*Math.random()-1,Math.random(),2*Math.random()-1),d.push(...l(a));let i=new e.Float32BufferAttribute(h,3),s=new e.Float32BufferAttribute(c,4),r=new e.Float32BufferAttribute(d,2);u=new e.BufferGeometry,u.setAttribute("position",i),u.setAttribute("seeds",s),u.setAttribute("atlas",r)}s.depthTest=!0,s.depthWrite=!1;let A=new e.Points(u,s);return A.sortParticles=!1,A.frustumCulled=!1,this.room.scene.add(A),A.layers.set(1),A.renderOrder=ks.PARTICLES,A.pBaseScale=i,this.room.geoList[this.name]=A,this.geometry=u,this.material=s,this.points=A,o&&(A.material.blending=e.AdditiveBlending),A}atlasRandomGen(e=4,t=2){let i=1/e;return Array.from({length:t}).map((()=>Math.floor(648405.71*Math.random()%e)*i))}atlasRandomList(e=4,t=4,i=2){return Array.from({length:e}).map((e=>this.atlasRandomGen(t,i)))}atlasArrayPicker(e){return e[Math.floor(92314.75*Math.random()%e.length)]}dupeArray(e,t){return Array.from({length:t}).fill(e)}elementDuplicator(e,t=4){return e.map((e=>this.dupeArray(e,t))).flat(1)}findLightPositions(){let e=[];return this.room.lightList.hasOwnProperty("PointLight")&&this.room.lightList.PointLight.forEach((t=>{e.push(t.position.clone())})),e}hasPointLights(){return this.room.lightList.hasOwnProperty("PointLight")}setAtlasPath(e,t=null){this.atlasPath=e,t?(this.atlasAlphaPath=t,this.hasAlphaMap=!0):this.hasAlphaMap=!1}newMaterial(t=!0){let i=this.hasPointLights(),s={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},lightPos:{value:i}};this.hasAlphaMap&&(s.atlasAlphaTexture={type:"t",value:null});let r=this.room.pxlFile.pxlShaderBuilder(s,Sr(this.shaderSettings),Dr(this.hasAlphaMap));return r.transparent=!0,this.hasAlphaMap?(r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(r.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}))):r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),r.uniforms.noiseTexture.value=this.room.smoothNoiseTexture,r.depthTest=!0,r.depthWrite=!1,t&&(this.room.materialList[this.name]=r),r}},da={pxlParticles:{ParticleBase:ca,BillowSmoke:class extends ca{constructor(t=null,i="billowSmoke"){super(t,i),this.name=i,this.room=t,this.shaderSettings={vertCount:600,pScale:56,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new e.Vector3(0,0,1),offsetPos:new e.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(t={}){if(t&&typeof t===Object){let e=Object.keys(t);this.knownKeys.forEach((i=>{e.includes(i)?this.shaderSettings[i]=t[i]:t[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||0===this.shaderSettings.atlasPicks.length)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);let i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"f",value:t.windDir},offsetPos:{type:"f",value:t.offsetPos},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:.8},rate:{type:"f",value:2.85}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});let s=this.room.pxlFile.pxlShaderBuilder(i,Lr(),kr(this.hasAlphaMap));s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=e.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},EmberWisps:class extends ca{constructor(t=null,i="emberWisps"){super(t,i),this.name=i,this.room=t,this.shaderSettings={vertCount:600,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new e.Vector3(0,0,1),offsetPos:new e.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(t={}){if(t&&typeof t===Object){let e=Object.keys(t);this.knownKeys.forEach((i=>{e.includes(i)?this.shaderSettings[i]=t[i]:t[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||0===this.shaderSettings.atlasPicks.length)&&(this.shaderSettings.atlasPicks=super.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));let i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"v",value:this.shaderSettings.windDir},offsetPos:{type:"v",value:this.shaderSettings.offsetPos},pointScale:{type:"f",value:this.shaderSettings.pScale},intensity:{type:"f",value:1},rate:{type:"f",value:5.5}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});let s=this.room.pxlFile.pxlShaderBuilder(i,Ir(),Br(this.hasAlphaMap));s.side=e.DoubleSide,s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=e.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},FloatingDust:class extends ca{constructor(t=null,i="floatingDust"){super(t,i),this.name=i,this.room=t,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,windDir:new e.Vector3(0,0,1),offsetPos:new e.Vector3(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}build(t={}){if(t&&typeof t===Object){let e=Object.keys(t);this.knownKeys.forEach((i=>{e.includes(i)?this.shaderSettings[i]=t[i]:t[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();let i=t.windDir;i&&typeof i===Object&&typeof i!==e.Vector3&&3===i.length&&this.shaderSettings.windDir.set(i[0],i[1],i[2]);let s=t.offsetPos;s&&typeof s===Object&&typeof s!==e.Vector3&&3===s.length&&this.shaderSettings.offsetPos.set(s[0],s[1],s[2]);let r={atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},a=this.room.pxlFile.pxlShaderBuilder(r,Sr(this.shaderSettings),Dr(this.hasAlphaMap));a.transparent=!0,this.hasAlphaMap?(a.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(a.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}))):a.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.shaderSettings.additiveBlend&&(a.blending=e.AdditiveBlending),a.uniforms.noiseTexture.value=this.room.softNoiseTexture,a.depthTest=!0,a.depthWrite=!1,this.room.materialList[this.name]=a,this.material=a,super.addToScene()}},HeightMap:class extends ca{constructor(t=null,i="heightMap"){super(t,i),this.name=i,this.room=t,this.heightMapPath=null,this.spawnMapPath=null,this.spawnMapMode=1,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,tint:new e.Vector3(1,1,1),jumpHeightMult:0,offsetPos:new e.Vector3(0,0,0),windDir:new e.Vector3(0,0,0),size:new e.Vector3(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}setHeightMapPath(e){this.heightMapPath=e}setSpawnMapPath(e,t=1){this.spawnMapPath=e,3===t&&(t=4),this.spawnMapMode=t}build(t={},i=null){if(t&&typeof t===Object){let e=Object.keys(t);this.knownKeys.forEach((i=>{e.includes(i)?this.shaderSettings[i]=t[i]:t[i]=this.shaderSettings[i]}))}t.hasOwnProperty("atlasPicks")?this.shaderSettings.atlasPicks=t.atlasPicks:(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();let s=t.offsetPos;s&&typeof s===Object&&typeof s!==e.Vector3&&3===s.length&&this.shaderSettings.offsetPos.set(s[0],s[1],s[2]);let r=100,a=100,n=100;t.hasOwnProperty("size")&&(t.size.x>0&&(r=t.size.x),t.size.y>0&&(a=t.size.y),t.size.z>0&&(n=t.size.z)),this.shaderSettings.pScale>=0&&(this.pscale.x=this.shaderSettings.pScale),i&&(r=i.hasOwnProperty("userData")&&i.userData.hasOwnProperty("SizeX")?i.userData.SizeX:i.scale.x,a=i.hasOwnProperty("userData")&&i.userData.hasOwnProperty("SizeY")?i.userData.SizeY:i.scale.y,n=i.hasOwnProperty("userData")&&i.userData.hasOwnProperty("SizeZ")?i.userData.SizeZ:i.scale.z,this.pscale.x=i.pScale);let o=new e.Vector3(r,a,n),l={heightMap:{type:"t",value:null},spawnMap:{type:"t",value:null},tankSize:{type:"v",value:o},atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},tint:{type:"v",value:this.shaderSettings.tint},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},h=this.room.pxlFile.pxlShaderBuilder(l,Tr(this.shaderSettings),Rr(this.hasAlphaMap));h.transparent=!0,this.hasAlphaMap?(h.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(h.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}))):h.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter}),this.heightMapPath&&(h.uniforms.heightMap.value=this.room.pxlUtils.loadTexture(this.heightMapPath,4,{magFilter:e.LinearFilter,minFilter:e.LinearMipmapLinearFilter})),this.spawnMapPath&&(h.uniforms.spawnMap.value=this.room.pxlUtils.loadTexture(this.spawnMapPath,this.spawnMapMode,{magFilter:e.NearestFilter,minFilter:e.NearestMipmapNearestFilter})),this.shaderSettings.additiveBlend&&(h.blending=e.AdditiveBlending),h.uniforms.noiseTexture.value=this.room.softNoiseTexture,h.depthTest=!0,h.depthWrite=!1,this.room.materialList[this.name]=h,this.material=h;let c=super.addToScene();return i&&c.position.set(i.position.x,i.position.y,i.position.z),c.userData.tankRes=o,c}}}},ua=class{constructor(t="pxlRoomEnvironment",i=""){this.roomName=t,this.pxlOptions=null,this.pxlEnums=null,this.pxlFile=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlDevice=null,this.pxlHUD=null,this.pxlRendering=null,this.pxlEnv=null,this.booted=!1,this.initScene=!0,this.active=!0,""===i&&(i="./pxlRooms/"+t+"/"),this.assetPath=i+"Assets/",this.mobile=!1,this.sceneFile=null,this.animFile=null,this.animClips={},this.animMixer=null,this.spiralizerUniforms={},this.materialList={},this.revertColorSpaceList=[],this.particleList={},this.camInitPos=null,this.camInitLookAt=null,this.camThumbPos=new e.Vector3(0,0,-30),this.camThumbLookAt=new e.Vector3(0,35,-1e3),this.cameraBooted=!1,this.cameraPrevPos=new e.Vector3(0,0,0),this.cameraAimTarget=new e.Object3D(0,0,0),this.camHoldWarpPos=!0,this.defaultCamLocation="default",this.camLocation={},this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=5,this.pxlCamFarClipping=1e4,this.fogColor=new e.Color(.01,.02,.05),this.fogExp=7e-4,this.fog=new e.FogExp2(this.fogColor,this.fogExp),this.userAvatarGroup=new e.Group,this.packedTextureMaterial=null,this.coreTextureMaterial=null,this.projectedMaterial=null,this.voidMaterial=null,this.holoMaterial=null,this.aspectRatio=null,this.flag=null,this.initPos=[],this.finalPos=[],this.midPos=new e.Vector3(0,30,-50),this.perspectiveInstances=160,this.startTime=0,this.runTime=new e.Vector2(0,0),this.msRunner=null,this.camera=null,this.autoCamPaths={},this.scene=null,this.lightList={},this.geoList={},this.glassGroup=null,this.glassList=[],this.particleList={},this.lodList=[],this.enableRaycast=!1,this.hasHoverables=!1,this.hoverableList=[],this.hoverableObj=null,this.hasClickables=!1,this.clickableList=[],this.clickableObj=null,this.collidersExist=!1,this.colliderActive=!1,this.colliderHashMap={},this.colliderList=[],this.antiColliderActive=!1,this.antiColliderList=[],this.antiColliderTopActive=!1,this.antiColliderTopList=[],this.hasPortalExit=!1,this.portalList={},this.hasRoomWarp=!1,this.roomWarp=[],this.warpPortalTexture=null,this.warpZoneRenderTarget=null,this.worldPosMaterial=null,this.worldPosRenderTarget=null,this.spiralizerPass=null,this.bloomPreState=!1,this.cloud3dTexture=null,this.smoothNoiseTexture=null,this.hasHelpers=!1,this.helperObjects={},this.currentShader=null}setDependencies(t){this.pxlOptions=t.pxlOptions,this.pxlEnums=t.pxlEnums,this.pxlRendering=t.pxlRendering,this.pxlEnv=t,this.pxlFile=t.pxlFile,this.pxlAnim=t.pxlAnim,this.pxlTimer=t.pxlTimer,this.pxlUtils=t.pxlUtils,this.pxlDevice=t.pxlDevice,this.pxlHUD=t.pxlHUD,this.pxlColliders=t.pxlColliders,this.mobile=t.mobile,this.msRunner=this.pxlTimer.msRunner,this.cloud3dTexture=this.pxlEnv.cloud3dTexture,this.cloud3dTexture&&(this.cloud3dTexture.wrapS=e.RepeatWrapping,this.cloud3dTexture.wrapT=e.RepeatWrapping),this.smoothNoiseTexture=this.pxlEnv.softNoiseTexture,this.smoothNoiseTexture&&(this.smoothNoiseTexture.wrapS=e.RepeatWrapping,this.smoothNoiseTexture.wrapT=e.RepeatWrapping)}get deltaTime(){return this.pxlTimer.deltaTime}get avgDeltaTime(){return this.pxlTimer.avgDeltaTime}getLerpRate(e){return this.pxlTimer.getLerpRate(e)}getLerpAvgRate(e){return this.pxlTimer.getLerpAvgRate(e)}init(){this.scene.fog=this.fog,this.scene.background=this.fogColor}start(){this.booted,this.pxlRendering.engine.setClearColor(this.fogColor,0)}step(){this.runTime.x=this.msRunner.x}stop(){}resize(e,t){}setUserHeight(e=1){this.pxlEnv.pxlCamera.setUserHeight(e,this.roomName)}resetCamera(){(null===this.camInitPos||null===this.camInitLookAt)&&this.pxlOptions.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN&&console.warn("pxlRoomEnvironment: Room Initial Camera Positions not initialized, \n Ensure `this.booted=true` is ran in `build()` or `fbxPostLoad()` \n -&-\n That there is a `Camera` group with `position` & `lookAt` child nulls in your scene file."),this.pxlEnv.pxlCamera.setTransform(this.camInitPos,this.camInitLookAt)}prepPortalRender(){this.geoList.intro.visible=!1,this.geoList.MainRoomWarp.visible=!1}cleanupPortalRender(){this.geoList.intro.visible=!0,this.geoList.MainRoomWarp.visible=!0}setPortalTexture(e,t=null){this.geoList.MainRoomWarp.material.map=e}applyRoomPass(e=null){}getName(){return this.roomName}getArtistInfo(){return null}setFog(e){}getShaderList(){let e={};return Object.keys(this.materialList).forEach((t=>{e[t]=t})),e}getCurrentShader(){return this.currentShader||Object.keys(this.materialList)[0]}readShader(t="",i=null){return null!=this.currentShader&&this.materialList[this.currentShader].hasOwnProperty("uniforms")&&(i||(i=new e.Vector3),this.materialList[this.currentShader].uniforms.sliders.value=i,this.materialList[this.currentShader].needsUpdate=!0),this.currentShader=t,this.materialList[this.currentShader]}setShader(e,t,i){this.emitterList&&this.emitterList[this.currentShader]&&this.emitterList[this.currentShader].Particles.length>0&&this.emitterList[this.currentShader].Particles.forEach((e=>{let s=e.material;s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0})),this.materialList[this.currentShader].vertexShader=t,this.materialList[this.currentShader].fragmentShader=i,this.materialList[this.currentShader].needsUpdate=!0}castRay(t,i){if(!this.enableRaycast)return;if(!t&&!this.hasHoverables||t&&!this.hasClickables)return void(this.mouseRayHits=[]);let s=[];!t&&this.hasHoverables?s=this.hoverableList:t&&this.hasClickables&&(s=this.clickableList);var r=[];if(s.length>0){let t=new e.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlEnv.pxlCamera.objRaycast.setFromCamera(t,this.pxlEnv.pxlCamera.camera),r=this.pxlEnv.pxlCamera.objRaycast.intersectObjects(s)}this.mouseRayHits=r}hitColliders(e=[],t=Os.FLOOR){e.length}hasColliders(){return this.collidersExist}hasColliderType(e=Os.FLOOR){let t=!1;if(!this.hasColliders())return t;switch(e){case Os.FLOOR:t=this.colliderActive;break;case Os.WALL:t=this.antiColliderActive;break;case Os.WALL_TOP:t=this.antiColliderTopActive;break;case Os.CEILING:break;case Os.PORTAL_WARP:t=this.hasPortalExit;break;case Os.ROOM_WARP:t=this.hasRoomWarp;break;case Os.ITEM:case Os.SCRIPTED:break;case Os.HOVERABLE:t=this.hasHoverables;break;case Os.CLICKABLE:t=this.hasClickables;break;default:t=!1}return t}getColliders(e=Os.FLOOR){let t=[];if(!this.hasColliders())return t;if(e===Os.WALL&&!this.antiColliderActive)return t=this.antiColliderList,t;if(e===Os.WALL_TOP&&!this.antiColliderTopActive)return t=this.antiColliderTopList,t;if(e===Os.PORTAL_WARP&&!this.hasPortalExit)return t=this.portalList,t;if(e===Os.ROOM_WARP&&!this.hasRoomWarp)return t=this.roomWarp,t;if(e===Os.HOVERABLE&&!this.hasHoverables)return t=this.hoverableList,t;if(e===Os.CLICKABLE&&!this.hasClickables)return t=this.clickableList,t;switch(e){case Os.FLOOR:case Os.WALL:t=[...this.colliderList];break;case Os.WALL_TOP:t=[...this.antiColliderTopList];break;case Os.CEILING:break;case Os.PORTAL_WARP:t=this.portalList;break;case Os.ROOM_WARP:t=this.roomWarp}return t}addColliderHelper(e=Os.FLOOR){this.hasColliders()&&(this.helperObjects.hasOwnProperty("colliders")?this.helperObjects.colliders.hasOwnProperty(e)||(this.helperObjects.colliders[e]=null):(this.helperObjects.colliders={},this.helperObjects.colliders[e]=null),this.helperObjects.colliders[e]=this.pxlColliders.buildHelper(this,e),this.helperObjects.colliders[e]&&(this.scene.add(this.helperObjects.colliders[e]),this.hasHelpers=!0))}stepColliderHelper(e=Os.FLOOR){!this.hasHelpers||!this.hasColliders()||!this.helperObjects.hasOwnProperty("colliders")||!this.helperObjects.colliders.hasOwnProperty(e)||this.helperObjects.colliders[e].stepHelper(this,e)}toCameraPos(t=null){if(null===t&&(t=this.defaultCamLocation),t=t.toLowerCase(),this.cameraBooted&&this.camLocation.hasOwnProperty(t)){let i=this.mobile?"positionmobile":"position",s=this.mobile?"lookatmobile":"lookat",r=this.camLocation[t][i],a=this.camLocation[t][s];a||(a=new e.Vector3(0,0,1),a.addVectors(r,a)),this.pxlEnv.pxlCamera.setTransform(this.camLocation[t][i],this.camLocation[t][s]),this.setUserHeight(this.camInitPos.y)}}fbxPostLoad(){this.booted=!0,this.toCameraPos(this.defaultCamLocation);let t=0;this.lightList.hasOwnProperty("PointLight")&&(t=this.lightList.PointLight.length);let i=Object.keys(this.lightList);if(i.length>0&&i.forEach((e=>{this.lightList[e].forEach((t=>{"DirectionalLight"===e?t.castShadow=!1:"PointLight"===e&&t.castShadow&&(t.shadow.radius=5,t.shadow.receiveShadow=!0,t.shadow.mapSize.width=512,t.shadow.mapSize.height=512,t.shadow.camera.near=.5,t.shadow.camera.far=35,t.shadow.bias=.025,t.shadow.radius=5)}))})),this.shaderGeoList)for(let i in this.shaderGeoList){let r=this.shaderGeoList[i];if(r.userData&&"pxlPrincipled"===r.userData.Shader){let i=e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.lights,e.UniformsLib.shadowmap,{dTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},detailTexture:{type:"t",value:null},cdMult:{type:"f",value:1},fogColor:{type:"c",value:this.scene.fog.color}}]);var s={USE_MAP:""};let a={},n=!0,o=!0===r.userData.castShadow||!0===r.userData.receiveShadow,l=!0,h=!1;r.material.map||(h=r.material.color.clone()),r.userData.ShaderParms&&""!==r.userData.ShaderParms&&(a=JSON.parse(r.userData.ShaderParms));let c=this.pxlFile.pxlShaderBuilder(i,xr(o),Cr(a,h,l,n,o,t),s);c.transparent=!1,c.lights=!0,h||(c.uniforms.dTexture.value=r.material.map),c.uniforms.noiseTexture.value=this.cloud3dTexture,c.uniforms.detailTexture.value=this.pxlEnv.detailNoiseTexture,r.material=c,this.materialList[r.name]=c}}}animPostLoad(e,t){if(this.pxlAnim.hasClip(e,this.animInitCycle)){let t=this.pxlAnim.getMixer(e);this.animMixer=t,this.pxlAnim.playClip(e,this.animInitCycle)}else{let t=this.pxlAnim.getFallbackCycle(e);this.animInitCycle=t,this.log("No animation cycle '"+this.animInitCycle+"' found; Using '"+t+"' instead")}}build(){this.sceneFile}onMessage(e,t){if("roomwarp"===(console.log("Room : "+this.roomName+" - Message Received: "+e),console.log("Message : "+t),e=e.toLowerCase()))this.roomWarp=t;else console.log("-- Message Type Not Recognized -- "),console.log("Room : "+this.roomName),console.log("Message Received: "+e),console.log("Message : "+t)}},Aa="pxlNav-coreCanvas",pa=window.innerWidth,ma=window.innerHeight,ga=class{constructor(e,t,i,s){this._active=!1,this.loaderStepTotalCount=9,this.pxlEnums=js,this.assetsToLoadDict={Cloud3d:!0,SoftNoise:!0,SmoothNoise:!0,ChromaticAberration:!1,WarpAnimTexture:!1,MathFuncs:!1},this.knownPostProcessPasses={mapComposerWarpPass:["cloud3dTexture"],chromaticAberrationPass:["ChromaticAberration"],lizardKingPass:["cloud3dTexture"],starFieldPass:["cloud3dTexture"],crystallinePass:["cloud3dTexture"]},this.pxlOptions=Object.assign({},e);let r=Object.keys(this.pxlOptions);Object.keys(zs).forEach((e=>{r.includes(e)||(this.pxlOptions[e]=zs[e])})),this.pxlOptions.hasOwnProperty("userSettings")||(this.pxlOptions.userSettings=Object.assign({},Ws)),this.verbose=this.pxlOptions.verbose,this.projectTitle=t,this.startingRoom=i,this.startingRoomName=i.roomName;let a=[];s.forEach((e=>{a.push(e.roomName)})),this.roomBootList=s,s.includes(i)||s.push(i),this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.pxlOptions.mobile=this.mobile,this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:this.pxlOptions.pxlAssetRoot+"/",guiRoot:this.pxlOptions.pxlAssetRoot+"/GUI/",roomRoot:this.pxlOptions.pxlAssetRoot+"/rooms/",vidRoot:this.pxlOptions.pxlAssetRoot+"/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",step:"Emitted when frame update occurs, pre render.","render-prep":"Emitted when the pxlNav engine starting to prepare for scene rendering.","render-post":"Emitted when the pxlNav engine has finished rendering the scene.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.","camera-move":"Returns a {'pos':vec3(),'dist':float}; Emitted when the camera moves.","camera-rotate":"Returns a [quaternion]; Emitted when the camera rotates.","camera-jump":"Returns a [bool]; Emitted when the camera jumps to a new position.","camera-fall":"Returns a [bool]; Emitted when the camera starts to free-fall / gravity.","camera-landed":"Returns a [bool]; Emitted when the camera lands from a jump / fall.","camera-collision":"Returns a [bool]; Emitted when the camera collides with an object.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.",".":"** NOTE : callbacks get an event object shaped - **","..":"**  callbackFn( eventType, eventValue ) **","...":"**  eventValue = { 'type' : *eventName*, 'value' : *data* } **","....":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=this.pxlOptions.loadEnvAssetFile||!1,this.loadEnvAssetFile=!0,this.pxlTimer=new $s.Timer,this.pxlShaders=ha,this.pxlCookie=new $s.CookieManager(this.verbose,t,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=this.pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new $s.QualityController(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new $s.Utils(this.folderDict.assetRoot,this.mobile),this.pxlFile=new $s.FileIO(this.folderDict),this.pxlExtensions=null,this.pxlAudio=new $s.Audio(this.pxlTimer),this.pxlAutoCam=new $s.AutoCamera(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new $s.User,this.pxlRendering=new $s.Rendering(this.pxlOptions),this.pxlEnv=new $s.Environment(this.pxlOptions,this.startingRoomName,this.mobile),this.pxlDevice=new $s.Device(t,Aa,this.mobile,this.autoCam),this.pxlColliders=new $s.Colliders(this.verbose,this.pxlOptions.collisionScale.gridSize,this.pxlOptions.collisionScale.gridReference),this.pxlCamera=new $s.Camera,this.pxlOptions.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlCamera.setUserSettings(this.pxlOptions.userSettings),this.pxlAnim=new $s.Animation(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new $s.GUI(this.verbose,t,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlGuiDraws.pxlLoaderTotal=this.loaderStepTotalCount,this.pxlHUD=new $s.HUD,this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlUser.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlColliders.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlHUD.setDependencies(this),this.pxlRendering.setDependencies(this),this.pxlDevice.init(),this.pxlGuiDraws.prepLoader(),this.pxlOptions.hasOwnProperty("loaderPhrases")||(this.pxlOptions.loaderPhrases=["...loading the pixels..."]),this.pxlGuiDraws.setLoaderPhrases(this.pxlOptions.loaderPhrases),this.verbose>=js.VERBOSE_LEVEL.INFO&&(console.log("pxlNav v1.0.0-dev set to Verbose Info Mode"),console.log("  With Three.js v171"),console.log("Booting pxlNav...")),this.pxlQuality.init()}set active(e=null){null==e&&(e=!this.pxlTimer.active),!0===e?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}log(...e){this.verbose>=js.VERBOSE_LEVEL.INFO&&console.log(...e)}warn(...e){this.verbose>=js.VERBOSE_LEVEL.WARN&&console.warn(...e)}error(...e){this.verbose>=js.VERBOSE_LEVEL.ERROR&&console.error(...e)}debug(...e){this.verbose>=js.VERBOSE_LEVEL.DEBUG&&console.debug(...e)}init(){this.pxlTimer.active||this.bootTimer(),this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.checkPxlOptions(),this.buildGui().then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Engine"),this.bootEnvironment()})).then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Boot Engine"),this.bootEngine()})).then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Composers"),this.pxlEnv.buildComposers(),this.pxlHUD.init()})).then((()=>{this.tickLoader(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(!1),this.pxlDevice.setCursor("grab")})).catch((e=>{this.verbose>js.VERBOSE_LEVEL.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",e),console.error(e))})).finally((()=>{this.verbose>=js.VERBOSE_LEVEL.DEBUG&&(console.log("'pxlNavCore' Room Build Promise-Chain Completed; ",this.loadPercent),console.log("-- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()}))}checkPxlOptions(){if(this.pxlOptions.hasOwnProperty("postProcessPasses")){let e=Object.keys(this.pxlOptions.postProcessPasses),t=Object.keys(this.knownPostProcessPasses);e.forEach((e=>{t.includes(e)&&this.pxlOptions.postProcessPasses[e]&&this.knownPostProcessPasses[e].forEach((e=>{this.assetsToLoadDict[e]=!0}))}))}}buildGui(){return new Promise(((e,t)=>{if(this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(Aa),this.pxlGuiDraws.guiWindows.container.gui.appendChild(this.pxlGuiDraws.pxlNavCanvas),!this.pxlGuiDraws.pxlNavCanvas)return console.error("pxlNav: Canvas element with ID '"+Aa+"' not found in DOM"),void t(new Error("Canvas element not found: "+Aa));this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),e(!0)}))}isMobile(){var e=!1;return e=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),e=this.getHashParm("m",e)}findHashParms(){var e={},t=window.location.hash;if(t.length>1)for(var i=(t=t.substring(1)).split("&"),s=0;s<i.length;s++){var r=i[s].split("=");e[r[0]]=r[1]}return e}getHashParm(e,t){return Object.keys(this.uriHashParms).includes(e)?this.uriHashParms[e]:t}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise(((e,t)=>{let i=[];for(let e=0;e<this.roomBootList.length;++e)i.push(this.pxlEnv.loadRoom(this.roomBootList[e]));Promise.all(i).then((()=>{e(!0)})).catch((e=>{this.verbose>=js.VERBOSE_LEVEL.ERROR&&console.error("Error loading rooms:",e),t(e)}))}))}bootEnvironment(){return new Promise(((e,t)=>{if(!this.pxlGuiDraws.pxlNavCanvas)return console.error("pxlNav: Canvas not available for WebGLRenderer"),void t(new Error("Canvas not available for WebGLRenderer"));try{this.pxlRendering.engine=new G.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,powerPreference:"low-power",alpha:!0,antialias:!1,sortObjects:!0,depth:!0})}catch(e){return console.error("pxlNav: Failed to create WebGLRenderer:",e),void t(new Error("Failed to create WebGLRenderer: "+e.message))}var i={format:G.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?G.HalfFloatType:G.FloatType};this.pxlEnv.engine=this.pxlRendering.engine,this.pxlRendering.engine.autoClear=!0,G.ColorManagement.enabled=!0,this.pxlRendering.engine.outputColorSpace=G.LinearSRGBColorSpace,this.pxlRendering.engine.debug.checkShaderErrors=!1,this.pxlRendering.engine.debug.checkShaderErrors=!0;this.pxlRendering.engine.setClearColor(this.pxlRendering.fogColor,0),this.pxlRendering.engine.setSize(undefined/this.pxlQuality.screenResPerc,undefined/this.pxlQuality.screenResPerc),this.pxlRendering.engine.setSize(window.innerWidth,window.innerHeight),this.pxlRendering.engine.setPixelRatio(1),this.pxlOptions.shadowMapBiasing===js.SHADOW_MAP.OFF?this.pxlRendering.engine.shadowMap.enabled=!1:(this.pxlRendering.engine.shadowMap.enabled=!0,this.pxlRendering.engine.shadowMap.type=G.BasicShadowMap),this.pxlEnv.scene=new G.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new G.Color("#000000"),this.pxlEnv.scene.renderTarget=new G.WebGLRenderTarget(pa*this.pxlQuality.screenResPerc,ma*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderTarget.texture.format=G.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=G.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=G.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new G.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=G.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=G.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new G.WebGLRenderTarget(pa*this.pxlQuality.screenResPerc,ma*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderWorldPos.texture.format=G.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=G.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=G.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,i.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new G.WebGLRenderTarget(parseInt(pa*this.pxlQuality.screenResPerc),parseInt(ma*this.pxlQuality.screenResPerc),i),this.pxlEnv.scene.renderGlowTarget.texture.format=G.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;let s=this.pxlEnv.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];if(this.pxlCamera.camera=new G.PerspectiveCamera(s,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new G.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.assetsToLoadDict.Cloud3d&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg",null,{encoding:G.LinearSRGBColorSpace}),this.pxlEnv.cloud3dTexture&&(this.pxlEnv.cloud3dTexture.wrapS=G.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=G.RepeatWrapping)),this.assetsToLoadDict.SoftNoise&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture&&(this.pxlEnv.softNoiseTexture.wrapS=G.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=G.RepeatWrapping)),this.assetsToLoadDict.SmoothNoise&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture&&(this.pxlEnv.detailNoiseTexture.wrapS=G.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=G.RepeatWrapping)),this.assetsToLoadDict.ChromaticAberration){let e=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_rgb.jpg");e.minFilter=G.LinearFilter,e.magFilter=G.LinearFilter,this.pxlEnv.chroAberUVTexture=e;let t=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_alpha.jpg");t.minFilter=G.LinearFilter,t.magFilter=G.LinearFilter,this.pxlEnv.chroAberUVAlpha=t}this.assetsToLoadDict.WarpAnimTexture&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=G.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=G.LinearFilter);var r;if(r=((e=null)=>{var t={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return null!=e&&(t[e[0]]=e[1]),t})(),this.loadEnvAssetFile){let e=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(e,undefined,r,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.pxlOptions.shadowMapBiasing===js.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlOptions.shadowMapBiasing===js.SHADOW_MAP.BASIC||this.mobile?this.pxlEnv.engine.shadowMap.type=G.BasicShadowMap:this.pxlOptions.shadowMapBiasing===js.SHADOW_MAP.SOFT&&(this.pxlEnv.engine.shadowMap.type=G.PCFSoftShadowMap));var a=new G.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(a),this.pxlEnv.scene.add(a);var n=new G.DirectionalLight(16777215,.1);n.position.set(1e3,550,1200),this.pxlEnv.lightList.push(n),this.pxlEnv.scene.add(n),e(!0)}))}cameraRunAnimatorMobile(e){var t;let i=!1,s=Object.keys(e.pxlEnv.geoLoadList);for(let r=0;r<s.length&&(i=0===e.pxlEnv.geoLoadList[s[r]],i=i&&!(null!=(t=e.pxlEnv.roomSceneList[r])&&t.booted),!i);++r);i?setTimeout((()=>{e.cameraRunAnimatorMobile(e)}),300):e.initRoomList(e)}initRoomList(e){e.pxlGuiDraws.stepLoader("camAnim"),e.pxlCamera.setTransform(e.pxlEnv.camInitPos,e.pxlEnv.camInitLookAt),e.pxlCamera.updateCamera(),e.pxlEnv.buildRoomEnvironments(),e.monitorRoomLoad(e)}monitorRoomLoad(e,t=0,i=25){var s;let r=!1,a=Object.keys(e.pxlEnv.geoLoadList),n=!zs.fullLoadPreBoot;for(let t=0;t<a.length&&(r=0===e.pxlEnv.geoLoadList[a[t]],r=r&&!(null!=(s=e.pxlEnv.roomSceneList[t])&&s.booted),!n||a[t]!==this.startingRoomName||!r);++t);t>i&&(this.warn("pxlNav: Room Load Monitor timed out, continuing with boot"),r=!1),r?setTimeout((()=>{e.monitorRoomLoad(e,t+1,i)}),300):(e.pxlQuality.mapAutoQualityUpdate(1,!0),e.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(e=0,t=!0,i=[]){if(0===e&&this.pxlGuiDraws.stepLoader("Room Prep"),e++,i.length>0){if(t){t=!1;let e=i[i.length-1];this.pxlCamera.warpToRoom(e)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),e%10==0){let e=i.pop();t=!0,this.pxlGuiDraws.stepLoader(e)}requestAnimationFrame((()=>{this.runPrepDrawScenes(e,t,i)}))}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();let e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];e.active=!0,e.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach((e=>{e.postGuiEvent()})),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");let t=this;setTimeout((()=>{t.pxlEnv.postBoot(),t.pxlGuiDraws.mapPrompt&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPrompt,!1,null,!0),t.pxlGuiDraws.mapPromptBG&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPromptBG,!1,null,!1),this.pxlDevice.hideAddressBar(),t.emit("booted",!0)}),200)}step(e=!1){this.pxlTimer.active&&(this.pxlTimer.step(),e&&requestAnimationFrame((()=>{this.step()})))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(e,t=!1){let i=e;"string"==typeof i&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){var r;"string"==typeof e&&(e=document.getElementById(e)),e&&((null==(r=e.classList)?void 0:r.value.indexOf("fader"))<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!=i&&e.setAttribute("fadeOut",1e3*i))}),50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{let t=e.parentNode;t&&t.removeChild(e)}))})):setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)))}addRooms(e){for(let t=0;t<e.length;++t)this.pxlEnv.roomNameList.includes(e[t])||(this.booted?this.warn("pxlNav: Cannot add rooms after boot, room '"+e[t]+"' not added."):this.roomBootList.push(e[t]))}setBootRoom(e,t){this.pxlEnv.bootRoom=e,this.pxlEnv.bootLocation=t}setLoaderPhrases(e){this.pxlGuiDraws.setLoaderPhrases(e)}initExtension(e,t,i){this.pxlExtensions.init(e,t,i)}startExtension(e,t,i){this.pxlExtensions.start(e,t,i)}stopExtension(e,t,i){this.pxlExtensions.stop(e,t,i)}extensionStatus(e){return this.pxlExtensions.status(e)}trigger(e,t=null,i=null){switch(e=e.toLowerCase()){case"warptoroom":this.pxlCamera.warpToRoom(t,!0,i);break;case"camera":let e=t.toLowerCase();"roam"===e?this.pxlCamera.toggleMovement(!0):"static"===e&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":let s=i.type,r=i.value;null===t&&(t=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(t,s,r)}}subscribe(e,t){if(this.validEventsKeys.includes(e))if("test"===e)console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if("pxlNavEventNameHere"===e||"help"===e)"pxlNavEventNameHere"===e?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):"help"===e&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach((e=>{console.log("  - ",e," : ",this.validEvents[e])}));else{let i=e.split("-");if("device"===i[0])this.pxlDevice.subscribe(i[1],t);else if("camera"===i[0]){let e=js.CAMERA_EVENT.MOVE;switch(i[1]){case"move":e=js.CAMERA_EVENT.MOVE;break;case"rotate":e=js.CAMERA_EVENT.ROTATE;break;case"jump":e=js.CAMERA_EVENT.JUMP;break;case"fall":e=js.CAMERA_EVENT.FALL;break;case"landed":e=js.CAMERA_EVENT.LANDED;break;case"collision":e=js.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+i[1]+"', ... )` was used; use 'help' for a list of valid events.")}this.pxlCamera.subscribe(e,t)}else this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}else console.warn("Warning : `pxlNav.subscribe( '"+e+"', ... )` was used; use 'help' for a list of valid events.")}unsubscribe(e,t){let i=!1,s=e.split("-");if("device"===s[0])i=this.pxlDevice.unsubscribe(s[1],t);else if("camera"===s[0]){let e=js.CAMERA_EVENT.MOVE;switch(s[1]){case"move":e=js.CAMERA_EVENT.MOVE;break;case"rotate":e=js.CAMERA_EVENT.ROTATE;break;case"jump":e=js.CAMERA_EVENT.JUMP;break;case"fall":e=js.CAMERA_EVENT.FALL;break;case"landed":e=js.CAMERA_EVENT.LANDED;break;case"collision":e=js.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+s[1]+"', ... )` was used; use 'help' for a list of valid events.")}i=this.pxlCamera.unsubscribe(e,t)}else this.callbacks.hasOwnProperty(e)&&(this.callbacks.hasOwnProperty(e)&&this.callbacks[e]instanceof Array?(i=this.callbacks[e].includes(t),this.callbacks[e]=this.callbacks[e].filter((e=>e!==t))):console.warn("Warning : `pxlNav.unsubscribe( '"+e+"', ... )` was used; but the callback function does not match the one used in `pxlNav.subscribe()`."));return i}emit(e,t,i=null){if(this.callbacks.hasOwnProperty(e)){let s={type:e,value:t};null!==i&&(s.status=i);for(let t of this.callbacks[e])t(s)}}},fa="1.0.0",va={pxlNav:ga,pxlNavVersion:fa,pxlEnums:js,pxlUserSettings:Ws,pxlOptions:zs,RoomEnvironment:ua,pxlEffects:da,pxlShaders:ha,pxlBase:$s};exports.RoomEnvironment=ua,exports.default=va,exports.pxlBase=$s,exports.pxlEffects=da,exports.pxlEnums=js,exports.pxlNav=ga,exports.pxlNavVersion=fa,exports.pxlOptions=zs,exports.pxlShaders=ha,exports.pxlUserSettings=Ws;
