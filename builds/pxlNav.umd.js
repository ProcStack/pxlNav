!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):"object"==typeof exports?exports.pxlNav=t(require("three")):e.pxlNav=t(e.THREE)}("undefined"!=typeof self?self:this,(e=>(()=>{var t,i,s={124:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ExtensionBase:()=>ExtensionBase});class ExtensionBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.extType=e||"ExtensionBase",this.active=!1,this.verbose=!1,this.callbacks={}}init(){}start(){this.active=!0}pause(){this.stop()}stop(){this.active=!1}subscribe(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter((e=>e!==t)))}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach((e=>e(t)))}destroy(){this.disable()}}},312:(e,t,i)=>{"use strict";function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}i.r(t),i.d(t,{Extensions:()=>Extensions});var s=["PoseEngine"];class Extensions{constructor(){this.plugins={},this.verbose=!1}init(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!this.plugins[e]||s?this.load(e,((e,s)=>{e?i?i(e):this.verbose&&console.error(e):t&&t(s)})):(this.verbose&&console.log("Extension ".concat(e," already booted, skipping...")),t&&t(this.plugins[e]))}load(e,t){var a=this;return function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){if(s.includes(e))try{var r=new((yield i(50)("./".concat(e,".js"))).default);try{a.boot(e,r)}catch(t){console.error("Error (2) Booting extension '".concat(e,"':"),t)}t&&t(null,r)}catch(i){console.error("Error (1) Importing / Parsing extension '".concat(e,"':"),i),t&&t(i,null)}else{var n=new Error("Extension ".concat(e," not found"));console.error(n),t&&t(n,null)}}))()}start(e){var t=this.get(e);t&&t.start()}pause(e){var t=this.get(e);t&&t.pause()}stop(e){var t=this.get(e);t&&t.stop()}status(e){var t=this.get(e);return!!t&&t.active}boot(e,t){this.plugins[e]=t,t.init()}get(e){return this.plugins[e]?this.plugins[e]:(console.warn("Extension ".concat(e," not found")),null)}unload(e){var t=this.get(e);t&&(t.destroy(),delete this.plugins[e])}}},944:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Networking});var s=i(124);class io{constructor(e,t){this.url=e,this.options=t}on(e,t){}emit(e,t){}}class Networking extends s.ExtensionBase{constructor(e){super("Networking"),this.status=!1,this.accessToken="",this.jwtToken="",this.socket=io("https://www.www.com",{transports:["websocket"]})}init(){this.socket.on("event",(e=>{console.log(e)})),this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("authenticated",this.onAuthenticated),this.socket.on("unauthorized",console.error)}onConnect(){console.log("Successfully connected to the websocket"),this.socket.emit("authenticate",{method:"jwt",token:this.jwtToken})}onDisconnect(){console.log("Disconnected from websocket"),this.status=!1,this.onConnect()}onAuthenticated(e){var{channelId:t}=e;console.log("Successfully connected to channel ".concat(t)),this.status=!0}}},153:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PoseEngine,pxlPoseEngineList:()=>r});var s=i(124),a=i(26);function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}var r=["MediaPipe"];class PoseEngine extends s.ExtensionBase{constructor(e){if(super(),this.active=!1,this.verbose=!1,"MediaPipe"!==e)throw new Error("Unknown pose estimation '"+e+"' model");this.model=new a.MediaPipePoseEngine}estimatePose(e){var t=this;return function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){return yield t.model.estimate(e)}))()}}},26:(e,t,i)=>{"use strict";function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}i.r(t),i.d(t,{MediaPipePoseEngine:()=>MediaPipePoseEngine});class MediaPipePoseEngine{constructor(){this.workerScriptUrl="./PoseEngine_worker.js",this.worker=null,this.booted=!1}static loadScriptWithProgress(e,t){return _asyncToGenerator((function*(){return new Promise(((i,s)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="text",a.onprogress=e=>{if(e.lengthComputable&&"function"==typeof t){var i=Math.round(e.loaded/e.total*100);t(i)}},a.onload=()=>{if(200===a.status){var t=document.createElement("script");t.textContent=a.responseText,document.head.appendChild(t),i()}else s(new Error("Failed to load script: ".concat(e)))},a.onerror=()=>s(new Error("Network error while loading: ".concat(e))),a.send()}))}))()}init(e){var t=this;return _asyncToGenerator((function*(){try{console.log("Loading MediaPipe..."),yield MediaPipePoseEngine.loadScriptWithProgress("https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js",e),t.worker=new Worker(t.workerScriptUrl),t.booted=!0,console.log("MediaPipe Pose Engine Initialized")}catch(e){console.error("Error initializing MediaPipePoseEngine:",e)}}))()}sendMessage(e){this.booted?this.worker.postMessage(e):console.warn("MediaPipePoseEngine is not initialized.")}onMessage(e){this.worker?this.worker.onmessage=t=>e(t.data):console.warn("WebWorker not initialized.")}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,console.log("WebWorker terminated."))}}},852:()=>{function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}var e=function(){var e=_asyncToGenerator((function*(){try{console.log("Pose model initialization placeholder")}catch(e){console.error("Failed to initialize pose model:",e)}}));return function initializePoseModel(){return e.apply(this,arguments)}}();self.onmessage=function(){var t=_asyncToGenerator((function*(t){var{type:i,data:s}=t.data;switch(i){case"init":yield e(),self.postMessage({type:"initialized"});break;case"processFrame":return void self.postMessage({type:"error",error:"Pose model not initialized"});default:console.warn("Unknown message type:",i)}}));return function(e){return t.apply(this,arguments)}}()},703:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebCamera:()=>WebCamera});var s=i(124);class WebCamera extends s.ExtensionBase{constructor(){super("WebCamera"),this.video=document.createElement("video"),this.stream=null,this.isInitialized=!1,this.active=!1}init(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((t=>{this.stream=t,this.video.srcObject=this.stream,this.video.play(),this.isInitialized=!0,console.log("WebCamera Initialized"),e&&e(null)})).catch((t=>{console.error("Error initializing WebCamera:",t),e&&e(t)}))}start(e){this.isInitialized?(this.active=!0,console.log("WebCamera Started"),e&&e(null)):(console.error("WebCamera is not initialized"),e&&e(new Error("WebCamera is not initialized")))}pause(e){this.stop(e)}stop(e){this.stream?(this.stream.getTracks().forEach((e=>e.stop())),this.video.srcObject=null,this.isInitialized=!1,console.log("WebCamera Stopped"),this.active=!1,e&&e(null)):e&&e(new Error("WebCamera is not initialized"))}}},50:(e,t,i)=>{var s={"./ExtensionBase.js":[124,9,226],"./Extensions.js":[312,9],"./Networking.js":[944,9,226],"./PoseEngine.js":[153,9,226],"./PoseEngine/MediaPipe.js":[26,9,226],"./PoseEngine/PoseEngine_worker.js":[852,7,226],"./WebCam.js":[703,9,226]};function webpackAsyncContext(e){if(!i.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],a=t[0];return Promise.all(t.slice(2).map(i.e)).then((()=>i.t(a,16|t[1])))}webpackAsyncContext.keys=()=>Object.keys(s),webpackAsyncContext.id=50,e.exports=webpackAsyncContext},186:t=>{"use strict";t.exports=e}},a={};function __webpack_require__(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={exports:{}};return s[e](i,i.exports,__webpack_require__),i.exports}i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var a=Object.create(null);__webpack_require__.r(a);var r={};t=t||[null,i({}),i([]),i(i)];for(var n=2&s&&e;"object"==typeof n&&!~t.indexOf(n);n=i(n))Object.getOwnPropertyNames(n).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,__webpack_require__.d(a,r),a},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";__webpack_require__.d(r,{default:()=>At});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{camPosVert:()=>camPosVert,defaultShiftVert:()=>defaultShiftVert,defaultVert:()=>defaultVert,discardFrag:()=>discardFrag,shaderHeader:()=>ShaderHeader_shaderHeader});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{animTextureFrag:()=>animTextureFrag,animTextureVert:()=>animTextureVert,clickableBevelFrag:()=>clickableBevelFrag,clickableBevelVert:()=>clickableBevelVert,portalBaseFrag:()=>portalBaseFrag,portalBaseVert:()=>portalBaseVert});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{itemBaseFrag:()=>itemBaseFrag,itemBaseVert:()=>itemBaseVert,itemFrag:()=>itemFrag,itemVert:()=>itemVert,itemZoomFrag:()=>itemZoomFrag,pxlPrincipledFrag:()=>pxlPrincipledFrag,pxlPrincipledVert:()=>pxlPrincipledVert,rgbaMapFrag:()=>rgbaMapFrag});var s={};__webpack_require__.r(s),__webpack_require__.d(s,{dustFrag:()=>dustFrag,dustSettings:()=>it,dustVert:()=>dustVert,emberWispsFrag:()=>emberWispsFrag,emberWispsSettings:()=>tt,emberWispsVert:()=>emberWispsVert,heightMapFrag:()=>heightMapFrag,heightMapSettings:()=>st,heightMapVert:()=>heightMapVert,smokeFrag:()=>smokeFrag,smokeSettings:()=>at,smokeVert:()=>smokeVert,snowFallFrag:()=>snowFallFrag,snowFallVert:()=>snowFallVert,snowSettings:()=>rt});var a={};__webpack_require__.r(a),__webpack_require__.d(a,{boxAntiAliasPass:()=>boxAntiAliasPass,chroAberPostProcess:()=>chroAberPostProcess,compLayersPostProcess:()=>compLayersPostProcess,crossAntiAliasPass:()=>crossAntiAliasPass,directionalBlurPass:()=>directionalBlurPass,finalOverlayHeavyShader:()=>finalOverlayHeavyShader,finalOverlayShader:()=>finalOverlayShader,finalOverlaySlimShader:()=>finalOverlaySlimShader,glowPassPostProcess:()=>glowPassPostProcess,iZoomPostProcess:()=>iZoomPostProcess,lKingPostProcess:()=>lKingPostProcess,mixBlurShaderPass:()=>mixBlurShaderPass,motionBlurPostProcess:()=>motionBlurPostProcess,sFieldPostProcessFrag:()=>sFieldPostProcessFrag,sFieldPostProcessVert:()=>sFieldPostProcessVert,textureStorePass:()=>textureStorePass,warpPostProcess:()=>warpPostProcess,worldPositionFrag:()=>worldPositionFrag,worldPositionVert:()=>worldPositionVert});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{bgScreenFrag:()=>bgScreenFrag,bgScreenVert:()=>bgScreenVert,skyObjectFrag:()=>skyObjectFrag,skyObjectVert:()=>skyObjectVert});var o=__webpack_require__(186);const l={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const h=new o.OrthographicCamera(-1,1,1,-1,0,1);class FullscreenTriangleGeometry extends o.BufferGeometry{constructor(){super(),this.setAttribute("position",new o.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new o.Float32BufferAttribute([0,2,0,0,2,0],2))}}const c=new FullscreenTriangleGeometry;class FullScreenQuad{constructor(e){this._mesh=new o.Mesh(c,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,h)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ShaderPass extends Pass{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof o.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=o.UniformsUtils.clone(e.uniforms),this.material=new o.ShaderMaterial({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class MaskPass extends Pass{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),a=e.state;let r,n;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,n=1):(r=1,n=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),a.buffers.stencil.setClear(n),a.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(s.EQUAL,1,4294967295),a.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const i=e.getSize(new o.Vector2);this._width=i.width,this._height=i.height,(t=new o.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:o.HalfFloatType})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass(l),this.copyPass.material.blending=o.NoBlending,this.clock=new o.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,s=this.passes.length;t<s;t++){const s=this.passes[t];if(!1!==s.enabled){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),s.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==MaskPass&&(s instanceof MaskPass?i=!0:s instanceof ClearMaskPass&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new o.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class RenderPass extends Pass{constructor(e,t,i=null,s=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new o.Color}render(e,t,i){const s=e.autoClear;let a,r;e.autoClear=!1,null!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(a),null!==this.overrideMaterial&&(this.scene.overrideMaterial=r),e.autoClear=s}}const d={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new o.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class UnrealBloomPass extends Pass{constructor(e,t,i,s){super(),this.strength=void 0!==t?t:1,this.radius=i,this.threshold=s,this.resolution=void 0!==e?new o.Vector2(e.x,e.y):new o.Vector2(256,256),this.clearColor=new o.Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new o.WebGLRenderTarget(a,r,{type:o.HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){const t=new o.WebGLRenderTarget(a,r,{type:o.HalfFloatType});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);const i=new o.WebGLRenderTarget(a,r,{type:o.HalfFloatType});i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.renderTargetsVertical.push(i),a=Math.round(a/2),r=Math.round(r/2)}const n=d;this.highPassUniforms=o.UniformsUtils.clone(n.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new o.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.separableBlurMaterials=[];const h=[3,5,7,9,11];a=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[e])),this.separableBlurMaterials[e].uniforms.invSize.value=new o.Vector2(1/a,1/r),a=Math.round(a/2),r=Math.round(r/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new o.Vector3(1,1,1),new o.Vector3(1,1,1),new o.Vector3(1,1,1),new o.Vector3(1,1,1),new o.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=l;this.copyUniforms=o.UniformsUtils.clone(c.uniforms),this.blendMaterial=new o.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:o.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new o.Color,this.oldClearAlpha=1,this.basic=new o.MeshBasicMaterial,this.fsQuad=new FullScreenQuad(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(i,s);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(i,s),this.renderTargetsVertical[e].setSize(i,s),this.separableBlurMaterials[e].uniforms.invSize.value=new o.Vector2(1/i,1/s),i=Math.round(i/2),s=Math.round(s/2)}render(e,t,i,s,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const r=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let n=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=n.texture,this.separableBlurMaterials[t].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),n=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=r}getSeperableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new o.ShaderMaterial({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new o.Vector2(.5,.5)},direction:{value:new o.Vector2(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new o.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}function toTrianglesDrawMode(e,t){if(t===o.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===o.TriangleFanDrawMode||t===o.TriangleStripDrawMode){let i=e.getIndex();if(null===i){const t=[],s=e.getAttribute("position");if(void 0===s)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<s.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const s=i.count-2,a=[];if(t===o.TriangleFanDrawMode)for(let e=1;e<=s;e++)a.push(i.getX(0)),a.push(i.getX(e)),a.push(i.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(a.push(i.getX(e)),a.push(i.getX(e+1)),a.push(i.getX(e+2))):(a.push(i.getX(e+2)),a.push(i.getX(e+1)),a.push(i.getX(e)));a.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}UnrealBloomPass.BlurDirectionX=new o.Vector2(1,0),UnrealBloomPass.BlurDirectionY=new o.Vector2(0,1);class GLTFLoader extends o.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new GLTFMaterialsClearcoatExtension(e)})),this.register((function(e){return new GLTFMaterialsDispersionExtension(e)})),this.register((function(e){return new GLTFTextureBasisUExtension(e)})),this.register((function(e){return new GLTFTextureWebPExtension(e)})),this.register((function(e){return new GLTFTextureAVIFExtension(e)})),this.register((function(e){return new GLTFMaterialsSheenExtension(e)})),this.register((function(e){return new GLTFMaterialsTransmissionExtension(e)})),this.register((function(e){return new GLTFMaterialsVolumeExtension(e)})),this.register((function(e){return new GLTFMaterialsIorExtension(e)})),this.register((function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)})),this.register((function(e){return new GLTFMaterialsSpecularExtension(e)})),this.register((function(e){return new GLTFMaterialsIridescenceExtension(e)})),this.register((function(e){return new GLTFMaterialsAnisotropyExtension(e)})),this.register((function(e){return new GLTFMaterialsBumpExtension(e)})),this.register((function(e){return new GLTFLightsExtension(e)})),this.register((function(e){return new GLTFMeshoptCompression(e)})),this.register((function(e){return new GLTFMeshGpuInstancing(e)}))}load(e,t,i,s){const a=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const t=o.LoaderUtils.extractUrlBase(e);r=o.LoaderUtils.resolveURL(t,this.path)}else r=o.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const _onError=function(t){s?s(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},n=new o.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(function(i){try{a.parse(i,r,(function(i){t(i),a.manager.itemEnd(e)}),_onError)}catch(e){_onError(e)}}),i,_onError)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let a;const r={},n={},o=new TextDecoder;if("string"==typeof e)a=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===u){try{r[A.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){return void(s&&s(e))}a=JSON.parse(r[A.KHR_BINARY_GLTF].content)}else a=JSON.parse(o.decode(e))}else a=e;if(void 0===a.asset||a.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new GLTFParser(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),n[t.name]=t,r[t.name]=!0}if(a.extensionsUsed)for(let e=0;e<a.extensionsUsed.length;++e){const t=a.extensionsUsed[e],i=a.extensionsRequired||[];switch(t){case A.KHR_MATERIALS_UNLIT:r[t]=new GLTFMaterialsUnlitExtension;break;case A.KHR_DRACO_MESH_COMPRESSION:r[t]=new GLTFDracoMeshCompressionExtension(a,this.dracoLoader);break;case A.KHR_TEXTURE_TRANSFORM:r[t]=new GLTFTextureTransformExtension;break;case A.KHR_MESH_QUANTIZATION:r[t]=new GLTFMeshQuantizationExtension;break;default:i.indexOf(t)>=0&&void 0===n[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(r),l.setPlugins(n),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise((function(s,a){i.parse(e,t,s,a)}))}}function GLTFRegistry(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const A={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=A.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const a=t.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let n;const l=new o.Color(16777215);void 0!==r.color&&l.setRGB(r.color[0],r.color[1],r.color[2],o.LinearSRGBColorSpace);const h=void 0!==r.range?r.range:0;switch(r.type){case"directional":n=new o.DirectionalLight(l),n.target.position.set(0,0,-1),n.add(n.target);break;case"point":n=new o.PointLight(l),n.distance=h;break;case"spot":n=new o.SpotLight(l),n.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,n.angle=r.spot.outerConeAngle,n.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,n.target.position.set(0,0,-1),n.add(n.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return n.position.set(0,0,0),n.decay=2,assignExtrasToUserData(n,r),void 0!==r.intensity&&(n.intensity=r.intensity),n.name=t.createUniqueName(r.name||"light_"+e),s=Promise.resolve(n),t.cache.add(i,s),s}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return i._getNodeRef(t.cache,a,e)}))}}class GLTFMaterialsUnlitExtension{constructor(){this.name=A.KHR_MATERIALS_UNLIT}getMaterialType(){return o.MeshBasicMaterial}extendParams(e,t,i){const s=[];e.color=new o.Color(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],o.LinearSRGBColorSpace),e.opacity=t[3]}void 0!==a.baseColorTexture&&s.push(i.assignTexture(e,"map",a.baseColorTexture,o.SRGBColorSpace))}return Promise.all(s)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new o.Vector2(e,e)}return Promise.all(a)}}class GLTFMaterialsDispersionExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=void 0!==s.dispersion?s.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&a.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&a.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(a)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new o.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],o.LinearSRGBColorSpace)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&a.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,o.SRGBColorSpace)),void 0!==r.sheenRoughnessTexture&&a.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&a.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&a.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const n=r.attenuationColor||[1,1,1];return t.attenuationColor=(new o.Color).setRGB(n[0],n[1],n[2],o.LinearSRGBColorSpace),Promise.all(a)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&a.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const n=r.specularColorFactor||[1,1,1];return t.specularColor=(new o.Color).setRGB(n[0],n[1],n[2],o.LinearSRGBColorSpace),void 0!==r.specularColorTexture&&a.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,o.SRGBColorSpace)),Promise.all(a)}}class GLTFMaterialsBumpExtension{constructor(e){this.parser=e,this.name=A.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];return t.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&a.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(a)}}class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],r=s.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&a.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(a)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=A.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,r)}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=A.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],n=s.images[r.source];let o=i.textureLoader;if(n.uri){const e=i.options.manager.getHandler(n.uri);null!==e&&(o=e)}return this.detectSupport().then((function(a){if(a)return i.loadTextureImage(e,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=A.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],n=s.images[r.source];let o=i.textureLoader;if(n.uri){const e=i.options.manager.getHandler(n.uri);null!==e&&(o=e)}return this.detectSupport().then((function(a){if(a)return i.loadTextureImage(e,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=A.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){const i=e.byteOffset||0,s=e.byteLength||0,r=e.count,n=e.byteStride,o=new Uint8Array(t,i,s);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(r,n,o,e.mode,e.filter).then((function(e){return e.buffer})):a.ready.then((function(){const t=new ArrayBuffer(r*n);return a.decodeGltfBuffer(new Uint8Array(t),r,n,o,e.mode,e.filter),t}))}))}return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=A.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const s=t.meshes[i.mesh];for(const e of s.primitives)if(e.mode!==v.TRIANGLES&&e.mode!==v.TRIANGLE_STRIP&&e.mode!==v.TRIANGLE_FAN&&void 0!==e.mode)return null;const a=i.extensions[this.name].attributes,r=[],n={};for(const e in a)r.push(this.parser.getDependency("accessor",a[e]).then((t=>(n[e]=t,n[e]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],s=e[0].count,a=[];for(const e of i){const t=new o.Matrix4,i=new o.Vector3,r=new o.Quaternion,l=new o.Vector3(1,1,1),h=new o.InstancedMesh(e.geometry,e.material,s);for(let e=0;e<s;e++)n.TRANSLATION&&i.fromBufferAttribute(n.TRANSLATION,e),n.ROTATION&&r.fromBufferAttribute(n.ROTATION,e),n.SCALE&&l.fromBufferAttribute(n.SCALE,e),h.setMatrixAt(e,t.compose(i,r,l));for(const t in n)if("_COLOR_0"===t){const e=n[t];h.instanceColor=new o.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,n[t]);o.Object3D.prototype.copy.call(h,e),this.parser.assignFinalMaterial(h),a.push(h)}return t.isGroup?(t.clear(),t.add(...a),t):a[0]})))}}const u="glTF",p=1313821514,m=5130562;class GLTFBinaryExtension{constructor(e){this.name=A.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==u)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let r=0;for(;r<s;){const t=a.getUint32(r,!0);r+=4;const s=a.getUint32(r,!0);if(r+=4,s===p){const s=new Uint8Array(e,12+r,t);this.content=i.decode(s)}else if(s===m){const i=12+r;this.body=e.slice(i,i+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=A.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,n={},l={},h={};for(const e in r){const t=E[e]||e.toLowerCase();n[t]=r[e]}for(const t in e.attributes){const s=E[t]||t.toLowerCase();if(void 0!==r[t]){const a=i.accessors[e.attributes[t]],r=f[a.componentType];h[s]=r.name,l[s]=!0===a.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t,i){s.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],s=l[t];void 0!==s&&(i.normalized=s)}t(e)}),n,h,o.LinearSRGBColorSpace,i)}))}))}}class GLTFTextureTransformExtension{constructor(){this.name=A.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class GLTFMeshQuantizationExtension{constructor(){this.name=A.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends o.Interpolant{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let e=0;e!==s;e++)t[e]=i[a+e];return t}interpolate_(e,t,i,s){const a=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=2*n,l=3*n,h=s-t,c=(i-t)/h,d=c*c,A=d*c,u=e*l,p=u-l,m=-2*A+3*d,g=A-d,v=1-m,f=g-d+c;for(let e=0;e!==n;e++){const t=r[p+e+n],i=r[p+e+o]*h,s=r[u+e+n],l=r[u+e]*h;a[e]=v*t+f*i+m*s+g*l}return a}}const g=new o.Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,i,s){const a=super.interpolate_(e,t,i,s);return g.fromArray(a).normalize().toArray(a),a}}const v={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},f={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},b={9728:o.NearestFilter,9729:o.LinearFilter,9984:o.NearestMipmapNearestFilter,9985:o.LinearMipmapNearestFilter,9986:o.NearestMipmapLinearFilter,9987:o.LinearMipmapLinearFilter},x={33071:o.ClampToEdgeWrapping,33648:o.MirroredRepeatWrapping,10497:o.RepeatWrapping},C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:o.InterpolateLinear,STEP:o.InterpolateDiscrete},B="OPAQUE",w="MASK",S="BLEND";function addUnknownExtensionsToUserData(e,t,i){for(const s in i.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=i.extensions[s])}function assignExtrasToUserData(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function updateMorphTargets(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,s=t.weights.length;i<s;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,s=i.length;t<s;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(e){let t;const i=e.extensions&&e.extensions[A.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+createAttributesKey(i.attributes):e.indices+":"+createAttributesKey(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+createAttributesKey(e.targets[i]);return t}function createAttributesKey(e){let t="";const i=Object.keys(e).sort();for(let s=0,a=i.length;s<a;s++)t+=i[s]+":"+e[i[s]]+";";return t}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const D=new o.Matrix4;class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,a=!1,r=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;i=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);s=i&&t?parseInt(t[1],10):-1,a=e.indexOf("Firefox")>-1,r=a?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||i&&s<17||a&&r<98?this.textureLoader=new o.TextureLoader(this.options.manager):this.textureLoader=new o.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new o.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const r={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:i,userData:{}};return addUnknownExtensionsToUserData(a,r,s),assignExtrasToUserData(r,s),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){for(const e of r.scenes)e.updateMatrixWorld();e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),updateMappings=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,s]of e.children.entries())updateMappings(s,t.children[i])};return updateMappings(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const a=e(t[s]);a&&i.push(a)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return i.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[A.KHR_BINARY_GLTF].body);const s=this.options;return new Promise((function(e,a){i.load(o.LoaderUtils.resolveURL(t.uri,s.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+i)}))}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse){const e=C[s.type],t=f[s.componentType],i=!0===s.normalized,a=new t(s.count*e);return Promise.resolve(new o.BufferAttribute(a,e,i))}const a=[];return void 0!==s.bufferView?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),void 0!==s.sparse&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=C[s.type],n=f[s.componentType],l=n.BYTES_PER_ELEMENT,h=l*r,c=s.byteOffset||0,d=void 0!==s.bufferView?i.bufferViews[s.bufferView].byteStride:void 0,A=!0===s.normalized;let u,p;if(d&&d!==h){const e=Math.floor(c/d),i="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count;let h=t.cache.get(i);h||(u=new n(a,e*d,s.count*d/l),h=new o.InterleavedBuffer(u,d/l),t.cache.add(i,h)),p=new o.InterleavedBufferAttribute(h,r,c%d/l,A)}else u=null===a?new n(s.count*r):new n(a,c,s.count*r),p=new o.BufferAttribute(u,r,A);if(void 0!==s.sparse){const t=C.SCALAR,i=f[s.sparse.indices.componentType],l=s.sparse.indices.byteOffset||0,h=s.sparse.values.byteOffset||0,c=new i(e[1],l,s.sparse.count*t),d=new n(e[2],h,s.sparse.count*r);null!==a&&(p=new o.BufferAttribute(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,d[e*r]),r>=2&&p.setY(t,d[e*r+1]),r>=3&&p.setZ(t,d[e*r+2]),r>=4&&p.setW(t,d[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=A}return p}))}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,a=t.images[s];let r=this.textureLoader;if(a.uri){const e=i.manager.getHandler(a.uri);null!==e&&(r=e)}return this.loadTextureImage(e,s,r)}loadTextureImage(e,t,i){const s=this,a=this.json,r=a.textures[e],n=a.images[t],l=(n.uri||n.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=r.name||n.name||"",""===t.name&&"string"==typeof n.uri&&!1===n.uri.startsWith("data:image/")&&(t.name=n.uri);const i=(a.samplers||{})[r.sampler]||{};return t.magFilter=b[i.magFilter]||o.LinearFilter,t.minFilter=b[i.minFilter]||o.LinearMipmapLinearFilter,t.wrapS=x[i.wrapS]||o.RepeatWrapping,t.wrapT=x[i.wrapT]||o.RepeatWrapping,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==o.NearestFilter&&t.minFilter!==o.LinearFilter,s.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=h,h}loadImageSource(e,t){const i=this,s=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=s.images[e],n=self.URL||self.webkitURL;let l=r.uri||"",h=!1;if(void 0!==r.bufferView)l=i.getDependency("bufferView",r.bufferView).then((function(e){h=!0;const t=new Blob([e],{type:r.mimeType});return l=n.createObjectURL(t),l}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then((function(e){return new Promise((function(i,s){let r=i;!0===t.isImageBitmapLoader&&(r=function(e){const t=new o.Texture(e);t.needsUpdate=!0,i(t)}),t.load(o.LoaderUtils.resolveURL(e,a.path),r,void 0,s)}))})).then((function(e){return!0===h&&n.revokeObjectURL(l),assignExtrasToUserData(e,r),e.userData.mimeType=r.mimeType||function getImageURIMimeType(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":e.search(/\.ktx2($|\?)/i)>0||0===e.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"}(r.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,i,s){const a=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),a.extensions[A.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[A.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(r);r=a.extensions[A.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),a.associations.set(r,t)}}return void 0!==s&&(r.colorSpace=s),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new o.PointsMaterial,o.Material.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new o.LineBasicMaterial,o.Material.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(s||a||r){let e="ClonedMaterial:"+i.uuid+":";s&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),s&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return o.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,s=this.extensions,a=i.materials[e];let r;const n={},l=[];if((a.extensions||{})[A.KHR_MATERIALS_UNLIT]){const e=s[A.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),l.push(e.extendParams(n,a,t))}else{const i=a.pbrMetallicRoughness||{};if(n.color=new o.Color(1,1,1),n.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;n.color.setRGB(e[0],e[1],e[2],o.LinearSRGBColorSpace),n.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(t.assignTexture(n,"map",i.baseColorTexture,o.SRGBColorSpace)),n.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,n.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(t.assignTexture(n,"metalnessMap",i.metallicRoughnessTexture)),l.push(t.assignTexture(n,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,n)}))))}!0===a.doubleSided&&(n.side=o.DoubleSide);const h=a.alphaMode||B;if(h===S?(n.transparent=!0,n.depthWrite=!1):(n.transparent=!1,h===w&&(n.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==o.MeshBasicMaterial&&(l.push(t.assignTexture(n,"normalMap",a.normalTexture)),n.normalScale=new o.Vector2(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;n.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&r!==o.MeshBasicMaterial&&(l.push(t.assignTexture(n,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(n.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==o.MeshBasicMaterial){const e=a.emissiveFactor;n.emissive=(new o.Color).setRGB(e[0],e[1],e[2],o.LinearSRGBColorSpace)}return void 0!==a.emissiveTexture&&r!==o.MeshBasicMaterial&&l.push(t.assignTexture(n,"emissiveMap",a.emissiveTexture,o.SRGBColorSpace)),Promise.all(l).then((function(){const i=new r(n);return a.name&&(i.name=a.name),assignExtrasToUserData(i,a),t.associations.set(i,{materials:e}),a.extensions&&addUnknownExtensionsToUserData(s,i,a),i}))}createUniqueName(e){const t=o.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function createDracoPrimitive(e){return i[A.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return addPrimitiveAttributes(i,e,t)}))}const a=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],n=createPrimitiveKey(r),l=s[n];if(l)a.push(l.promise);else{let e;e=r.extensions&&r.extensions[A.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(r):addPrimitiveAttributes(new o.BufferGeometry,r,t),s[n]={primitive:r,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,s=this.extensions,a=i.meshes[e],r=a.primitives,n=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new o.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:o.FrontSide})),l.DefaultMaterial):this.getDependency("material",r[e].material);n.push(t)}var l;return n.push(t.loadGeometries(r)),Promise.all(n).then((function(i){const n=i.slice(0,i.length-1),l=i[i.length-1],h=[];for(let i=0,c=l.length;i<c;i++){const c=l[i],d=r[i];let A;const u=n[i];if(d.mode===v.TRIANGLES||d.mode===v.TRIANGLE_STRIP||d.mode===v.TRIANGLE_FAN||void 0===d.mode)A=!0===a.isSkinnedMesh?new o.SkinnedMesh(c,u):new o.Mesh(c,u),!0===A.isSkinnedMesh&&A.normalizeSkinWeights(),d.mode===v.TRIANGLE_STRIP?A.geometry=toTrianglesDrawMode(A.geometry,o.TriangleStripDrawMode):d.mode===v.TRIANGLE_FAN&&(A.geometry=toTrianglesDrawMode(A.geometry,o.TriangleFanDrawMode));else if(d.mode===v.LINES)A=new o.LineSegments(c,u);else if(d.mode===v.LINE_STRIP)A=new o.Line(c,u);else if(d.mode===v.LINE_LOOP)A=new o.LineLoop(c,u);else{if(d.mode!==v.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);A=new o.Points(c,u)}Object.keys(A.geometry.morphAttributes).length>0&&updateMorphTargets(A,a),A.name=t.createUniqueName(a.name||"mesh_"+e),assignExtrasToUserData(A,a),d.extensions&&addUnknownExtensionsToUserData(s,A,d),t.assignFinalMaterial(A),h.push(A)}for(let i=0,s=h.length;i<s;i++)t.associations.set(h[i],{meshes:e,primitives:i});if(1===h.length)return a.extensions&&addUnknownExtensionsToUserData(s,h[0],a),h[0];const c=new o.Group;a.extensions&&addUnknownExtensionsToUserData(s,c,a),t.associations.set(c,{meshes:e});for(let e=0,t=h.length;e<t;e++)c.add(h[e]);return c}))}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(s)return"perspective"===i.type?t=new o.PerspectiveCamera(o.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===i.type&&(t=new o.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),assignExtrasToUserData(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let e=0,s=t.joints.length;e<s;e++)i.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),s=e,a=[],r=[];for(let e=0,n=s.length;e<n;e++){const n=s[e];if(n){a.push(n);const t=new o.Matrix4;null!==i&&t.fromArray(i.array,16*e),r.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new o.Skeleton(a,r)}))}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],a=s.name?s.name:"animation_"+e,r=[],n=[],l=[],h=[],c=[];for(let e=0,t=s.channels.length;e<t;e++){const t=s.channels[e],i=s.samplers[t.sampler],a=t.target,o=a.node,d=void 0!==s.parameters?s.parameters[i.input]:i.input,A=void 0!==s.parameters?s.parameters[i.output]:i.output;void 0!==a.node&&(r.push(this.getDependency("node",o)),n.push(this.getDependency("accessor",d)),l.push(this.getDependency("accessor",A)),h.push(i),c.push(a))}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(l),Promise.all(h),Promise.all(c)]).then((function(e){const t=e[0],s=e[1],r=e[2],n=e[3],l=e[4],h=[];for(let e=0,a=t.length;e<a;e++){const a=t[e],o=s[e],c=r[e],d=n[e],A=l[e];if(void 0===a)continue;a.updateMatrix&&a.updateMatrix();const u=i._createAnimationTracks(a,o,c,d,A);if(u)for(let e=0;e<u.length;e++)h.push(u[e])}return new o.AnimationClip(a,void 0,h)}))}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),a=[],r=i.children||[];for(let e=0,i=r.length;e<i;e++)a.push(t.getDependency("node",r[e]));const n=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),n]).then((function(e){const t=e[0],i=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,D)}));for(let e=0,s=i.length;e<s;e++)t.add(i[e]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const a=t.nodes[e],r=a.name?s.createUniqueName(a.name):"",n=[],l=s._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&n.push(l),void 0!==a.camera&&n.push(s.getDependency("camera",a.camera).then((function(e){return s._getNodeRef(s.cameraCache,a.camera,e)}))),s._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){n.push(e)})),this.nodeCache[e]=Promise.all(n).then((function(t){let n;if(n=!0===a.isBone?new o.Bone:t.length>1?new o.Group:1===t.length?t[0]:new o.Object3D,n!==t[0])for(let e=0,i=t.length;e<i;e++)n.add(t[e]);if(a.name&&(n.userData.name=a.name,n.name=r),assignExtrasToUserData(n,a),a.extensions&&addUnknownExtensionsToUserData(i,n,a),void 0!==a.matrix){const e=new o.Matrix4;e.fromArray(a.matrix),n.applyMatrix4(e)}else void 0!==a.translation&&n.position.fromArray(a.translation),void 0!==a.rotation&&n.quaternion.fromArray(a.rotation),void 0!==a.scale&&n.scale.fromArray(a.scale);return s.associations.has(n)||s.associations.set(n,{}),s.associations.get(n).nodes=e,n})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,a=new o.Group;i.name&&(a.name=s.createUniqueName(i.name)),assignExtrasToUserData(a,i),i.extensions&&addUnknownExtensionsToUserData(t,a,i);const r=i.nodes||[],n=[];for(let e=0,t=r.length;e<t;e++)n.push(s.getDependency("node",r[e]));return Promise.all(n).then((function(e){for(let t=0,i=e.length;t<i;t++)a.add(e[t]);return s.associations=(e=>{const t=new Map;for(const[e,i]of s.associations)(e instanceof o.Material||e instanceof o.Texture)&&t.set(e,i);return e.traverse((e=>{const i=s.associations.get(e);null!=i&&t.set(e,i)})),t})(a),a}))}_createAnimationTracks(e,t,i,s,a){const r=[],n=e.name?e.name:e.uuid,l=[];let h;switch(y[a.path]===y.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(n),y[a.path]){case y.weights:h=o.NumberKeyframeTrack;break;case y.rotation:h=o.QuaternionKeyframeTrack;break;case y.position:case y.scale:h=o.VectorKeyframeTrack;break;default:if(1===i.itemSize)h=o.NumberKeyframeTrack;else h=o.VectorKeyframeTrack}const c=void 0!==s.interpolation?I[s.interpolation]:o.InterpolateLinear,d=this._getArrayFromAccessor(i);for(let e=0,i=l.length;e<i;e++){const i=new h(l[e]+"."+y[a.path],t.array,d,c);"CUBICSPLINE"===s.interpolation&&this._createCubicSplineTrackInterpolant(i),r.push(i)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=getNormalizedComponentScale(t.constructor),i=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)i[s]=t[s]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function InterpolantFactoryMethodGLTFCubicSpline(e){return new(this instanceof o.QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function addPrimitiveAttributes(e,t,i){const s=t.attributes,a=[];function assignAttributeAccessor(t,s){return i.getDependency("accessor",t).then((function(t){e.setAttribute(s,t)}))}for(const t in s){const i=E[t]||t.toLowerCase();i in e.attributes||a.push(assignAttributeAccessor(s[t],i))}if(void 0!==t.indices&&!e.index){const s=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(s)}return o.ColorManagement.workingColorSpace!==o.LinearSRGBColorSpace&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${o.ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(e,t),function computeBounds(e,t,i){const s=t.attributes,a=new o.Box3;if(void 0===s.POSITION)return;{const e=i.json.accessors[s.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new o.Vector3(t[0],t[1],t[2]),new o.Vector3(r[0],r[1],r[2])),e.normalized){const t=getNormalizedComponentScale(f[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new o.Vector3,t=new o.Vector3;for(let s=0,a=r.length;s<a;s++){const a=r[s];if(void 0!==a.POSITION){const s=i.json.accessors[a.POSITION],r=s.min,n=s.max;if(void 0!==r&&void 0!==n){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(n[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(n[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(n[2]))),s.normalized){const e=getNormalizedComponentScale(f[s.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const n=new o.Sphere;a.getCenter(n.center),n.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=n}(e,t,i),Promise.all(a).then((function(){return void 0!==t.targets?function addMorphTargets(e,t,i){let s=!1,a=!1,r=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(a=!0),void 0!==i.COLOR_0&&(r=!0),s&&a&&r)break}if(!s&&!a&&!r)return Promise.resolve(e);const n=[],o=[],l=[];for(let h=0,c=t.length;h<c;h++){const c=t[h];if(s){const t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;n.push(t)}if(a){const t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(r){const t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l)]).then((function(t){const i=t[0],n=t[1],o=t[2];return s&&(e.morphAttributes.position=i),a&&(e.morphAttributes.normal=n),r&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}const P=new WeakMap;class DRACOLoader extends o.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const a=new o.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(e=>{this.parse(e,t,s)}),i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,o.SRGBColorSpace,i).catch(i)}decodeDracoFile(e,t,i,s,a=o.LinearSRGBColorSpace,r=()=>{}){const n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:a};return this.decodeGeometry(e,n).then(t).catch(r)}decodeGeometry(e,t){const i=JSON.stringify(t);if(P.has(e)){const t=P.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++,r=e.byteLength,n=this._getWorker(a,r).then((i=>(s=i,new Promise(((i,r)=>{s._callbacks[a]={resolve:i,reject:r},s.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return n.catch((()=>!0)).then((()=>{s&&a&&this._releaseTask(s,a)})),P.set(e,{key:i,promise:n}),n}_createGeometry(e){const t=new o.BufferGeometry;e.index&&t.setIndex(new o.BufferAttribute(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],a=s.name,r=s.array,n=s.itemSize,l=new o.BufferAttribute(r,n);"color"===a&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=r instanceof Float32Array==!1),t.setAttribute(a,l)}return t}_assignVertexColorSpace(e,t){if(t!==o.SRGBColorSpace)return;const i=new o.Color;for(let t=0,s=e.count;t<s;t++)i.fromBufferAttribute(e,t),o.ColorManagement.toWorkingColorSpace(i,o.SRGBColorSpace),e.setXYZ(t,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new o.FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,s)=>{i.load(e,t,void 0,s)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const s=DRACOWorker.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let e,t;function decodeAttribute(e,t,i,s,a,r){const n=r.num_components(),o=i.num_points()*n,l=o*a.BYTES_PER_ELEMENT,h=function getDracoDataType(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,a),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,r,h,l,c);const d=new a(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:s,array:d,itemSize:n}}onmessage=function(i){const s=i.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=s.buffer,a=s.taskConfig;t.then((e=>{const t=e.draco,r=new t.Decoder;try{const e=function decodeGeometry(e,t,i,s){const a=s.attributeIDs,r=s.attributeTypes;let n,o;const l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)n=new e.Mesh,o=t.DecodeArrayToMesh(i,i.byteLength,n);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");n=new e.PointCloud,o=t.DecodeArrayToPointCloud(i,i.byteLength,n)}if(!o.ok()||0===n.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());const h={index:null,attributes:[]};for(const i in a){const o=self[r[i]];let l,c;if(s.useUniqueIDs)c=a[i],l=t.GetAttributeByUniqueId(n,c);else{if(c=t.GetAttributeId(n,e[a[i]]),-1===c)continue;l=t.GetAttribute(n,c)}const d=decodeAttribute(e,t,n,i,o,l);"color"===i&&(d.vertexColorSpace=s.vertexColorSpace),h.attributes.push(d)}l===e.TRIANGULAR_MESH&&(h.index=function decodeIndex(e,t,i){const s=i.num_faces(),a=3*s,r=4*a,n=e._malloc(r);t.GetTrianglesUInt32Array(i,r,n);const o=new Uint32Array(e.HEAPF32.buffer,n,a).slice();return e._free(n),{array:o,itemSize:1}}(e,t,n));return e.destroy(n),h}(t,r,new Int8Array(i),a),n=e.attributes.map((e=>e.array.buffer));e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},n)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(r)}}))}}}class WorkerPool{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:t,msg:i,transfer:s}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,s)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{const s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const T=9,R=15,Q=16,k=22,L=37,M=43,F=76,O=83,G=97,_=100,U=103,N=109,j=165,H=166,V=1000066e3;class Ii{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Si{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}new Uint8Array([0]);const W=[171,75,84,88,32,50,48,187,13,10,26,10];function Ti(e){return(new TextDecoder).decode(e)}let K,z,q;const Y={env:{emscripten_notify_memory_growth:function(e){q=new Uint8Array(z.exports.memory.buffer)}}};class zstddec_module_Q{init(){return K||(K="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+J).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Y))).then(this._init):WebAssembly.instantiate(Buffer.from(J,"base64"),Y).then(this._init),K)}_init(e){z=e.instance,Y.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!z)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=z.exports.malloc(i);q.set(e,s),t=t||Number(z.exports.ZSTD_findDecompressedSize(s,i));const a=z.exports.malloc(t),r=z.exports.ZSTD_decompress(a,t,s,i),n=q.slice(a,a+r);return z.exports.free(s),z.exports.free(a),n}}const J="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",X="display-p3",Z=(o.SRGBTransfer,o.LinearTransfer,o.LinearTransfer,new WeakMap);let $,ee=0;class KTX2Loader extends o.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new o.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new o.FileLoader(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then((([e,t])=>{const i=KTX2Loader.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _EngineType = "+JSON.stringify(KTX2Loader.EngineType),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),ee>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),ee++}return this.transcoderPending}load(e,t,i,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const a=new o.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,(e=>{this.parse(e,t,s)}),i,s)}parse(e,t,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Z.has(e)){return Z.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}_createTextureFrom(e,t){const{type:i,error:s,data:{faces:a,width:r,height:n,format:l,type:h,dfdFlags:c}}=e;if("error"===i)return Promise.reject(s);let d;if(6===t.faceCount)d=new o.CompressedCubeTexture(a,l,h);else{const e=a[0].mipmaps;d=t.layerCount>1?new o.CompressedArrayTexture(e,r,n,t.layerCount,l,h):new o.CompressedTexture(e,r,n,l,h)}return d.minFilter=1===a[0].mipmaps.length?o.LinearFilter:o.LinearMipmapLinearFilter,d.magFilter=o.LinearFilter,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=parseColorSpace(t),d.premultiplyAlpha=!!(1&c),d}async _createTexture(e,t={}){const i=function Pi(e){const t=new Uint8Array(e.buffer,e.byteOffset,W.length);if(t[0]!==W[0]||t[1]!==W[1]||t[2]!==W[2]||t[3]!==W[3]||t[4]!==W[4]||t[5]!==W[5]||t[6]!==W[6]||t[7]!==W[7]||t[8]!==W[8]||t[9]!==W[9]||t[10]!==W[10]||t[11]!==W[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Ii,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new Si(e,W.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const r=a._nextUint32();i.supercompressionScheme=a._nextUint32();const n=a._nextUint32(),o=a._nextUint32(),l=a._nextUint32(),h=a._nextUint32(),c=a._nextUint64(),d=a._nextUint64(),A=new Si(e,W.length+s,3*r*8,!0);for(let t=0;t<r;t++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+A._nextUint64(),A._nextUint64()),uncompressedByteLength:A._nextUint64()});const u=new Si(e,n,o,!0),p={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},m=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){const t={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelType:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=u._nextInt32(),t.sampleUpper=u._nextInt32()):(t.sampleLower=u._nextUint32(),t.sampleUpper=u._nextUint32()),p.samples[e]=t}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);const g=new Si(e,l,h,!0);for(;g._offset<h;){const e=g._nextUint32(),t=g._scan(e),s=Ti(t);if(i.keyValue[s]=g._nextUint8Array(e-t.byteLength-1),s.match(/^ktx/i)){const e=Ti(i.keyValue[s]);i.keyValue[s]=e.substring(0,e.lastIndexOf("\0"))}g._skip(e%4?4-e%4:0)}if(d<=0)return i;const v=new Si(e,c,d,!0),f=v._nextUint16(),b=v._nextUint16(),x=v._nextUint32(),C=v._nextUint32(),E=v._nextUint32(),y=v._nextUint32(),I=[];for(let e=0;e<r;e++)I.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const B=c+v._offset,w=B+x,S=w+C,D=S+E,P=new Uint8Array(e.buffer,e.byteOffset+B,x),T=new Uint8Array(e.buffer,e.byteOffset+w,C),R=new Uint8Array(e.buffer,e.byteOffset+S,E),Q=new Uint8Array(e.buffer,e.byteOffset+D,y);return i.globalData={endpointCount:f,selectorCount:b,imageDescs:I,endpointsData:P,selectorsData:T,tablesData:R,extendedData:Q},i}(new Uint8Array(e)),s=i.vkFormat===V&&167===i.dataFormatDescriptor[0].colorModel;if(!(0===i.vkFormat||s&&!this.workerConfig.astcHDRSupported))return async function createRawTexture(e){const{vkFormat:t}=e;if(void 0===ie[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;2===e.supercompressionScheme&&($||($=new Promise((async e=>{const t=new zstddec_module_Q;await t.init(),e(t)}))),i=await $);const s=[];for(let a=0;a<e.levels.length;a++){const r=Math.max(1,e.pixelWidth>>a),n=Math.max(1,e.pixelHeight>>a),l=e.pixelDepth?Math.max(1,e.pixelDepth>>a):0,h=e.levels[a];let c,d;if(0===e.supercompressionScheme)c=h.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=i.decode(h.levelData,h.uncompressedByteLength)}d=se[t]===o.FloatType?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):se[t]===o.HalfFloatType?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,s.push({data:d,width:r,height:n,depth:l})}let a;if(te.has(ie[t]))a=0===e.pixelDepth?new o.DataTexture(s[0].data,e.pixelWidth,e.pixelHeight):new o.Data3DTexture(s[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");a=new o.CompressedTexture(s,e.pixelWidth,e.pixelHeight),a.minFilter=1===s.length?o.LinearFilter:o.LinearMipmapLinearFilter,a.magFilter=o.LinearFilter}return a.mipmaps=s,a.type=se[t],a.format=ie[t],a.colorSpace=parseColorSpace(e),a.needsUpdate=!0,Promise.resolve(a)}(i);const a=t,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e]))).then((e=>this._createTextureFrom(e.data,i)));return Z.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),ee--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},KTX2Loader.EngineFormat={RGBAFormat:o.RGBAFormat,RGBA_ASTC_4x4_Format:o.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:o.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:o.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:o.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:o.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:o.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:o.RGB_ETC1_Format,RGB_ETC2_Format:o.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:o.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:o.RGBA_S3TC_DXT1_Format},KTX2Loader.EngineType={UnsignedByteType:o.UnsignedByteType,HalfFloatType:o.HalfFloatType,FloatType:o.FloatType},KTX2Loader.BasisWorker=function(){let e,t,i;const s=_EngineFormat,a=_EngineType,r=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",(function(s){const r=s.data;switch(r.type){case"init":e=r.config,function init(e){t=new Promise((t=>{i={wasmBinary:e,onRuntimeInitialized:t},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}))}(r.transcoderBinary);break;case"transcode":t.then((()=>{try{const{faces:t,buffers:s,width:o,height:h,hasAlpha:c,format:d,type:A,dfdFlags:u}=function transcode(t){const s=new i.KTX2File(new Uint8Array(t));function cleanup(){s.close(),s.delete()}if(!s.isValid())throw cleanup(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let r;if(s.isUASTC())r=n.UASTC;else if(s.isETC1S())r=n.ETC1S;else{if(!s.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");r=n.UASTC_HDR}const o=s.getWidth(),h=s.getHeight(),c=s.getLayers()||1,d=s.getLevels(),A=s.getFaces(),u=s.getHasAlpha(),p=s.getDFDFlags(),{transcoderFormat:m,engineFormat:g,engineType:v}=function getTranscoderFormat(t,i,s,a){const r=l[t];for(let n=0;n<r.length;n++){const o=r[n];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(a&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!isPowerOfTwo(i)||!isPowerOfTwo(s)))continue;return{transcoderFormat:o.transcoderFormat[a?1:0],engineFormat:o.engineFormat[a?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(r,o,h,u);if(!o||!h||!d)throw cleanup(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!s.startTranscoding())throw cleanup(),new Error("THREE.KTX2Loader: .startTranscoding failed");const f=[],b=[];for(let e=0;e<A;e++){const t=[];for(let i=0;i<d;i++){const r=[];let n,o;for(let t=0;t<c;t++){const l=s.getImageLevelInfo(i,t,e);0!==e||0!==i||0!==t||l.origWidth%4==0&&l.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),d>1?(n=l.origWidth,o=l.origHeight):(n=l.width,o=l.height);let h=new Uint8Array(s.getImageTranscodedSizeInBytes(i,t,0,m));const c=s.transcodeImage(h,i,t,e,m,0,-1,-1);if(v===a.HalfFloatType&&(h=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!c)throw cleanup(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(h)}const l=concat(r);t.push({data:l,width:n,height:o}),b.push(l.buffer)}f.push({mipmaps:t,width:o,height:h,format:g,type:v})}return cleanup(),{faces:f,buffers:b,width:o,height:h,hasAlpha:u,dfdFlags:p,format:g,type:v}}(r.buffer);self.postMessage({type:"transcode",id:r.id,data:{faces:t,width:o,height:h,hasAlpha:c,format:d,type:A,dfdFlags:u}},s)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}}))}}));const o=[{if:"astcSupported",basisFormat:[n.UASTC],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[a.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[a.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[a.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[a.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[a.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[a.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[n.UASTC_HDR],transcoderFormat:[r.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[a.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[n.ETC1S,n.UASTC],transcoderFormat:[r.RGBA32,r.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[a.UnsignedByteType,a.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[n.UASTC_HDR],transcoderFormat:[r.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[a.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[n.ETC1S]:o.filter((e=>e.basisFormat.includes(n.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[n.UASTC]:o.filter((e=>e.basisFormat.includes(n.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[n.UASTC_HDR]:o.filter((e=>e.basisFormat.includes(n.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function isPowerOfTwo(e){return e<=2||!(e&e-1)&&0!==e}function concat(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}const i=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){const a=e[t];i.set(a,s),s+=a.byteLength}return i}};const te=new Set([o.RGBAFormat,o.RGFormat,o.RedFormat]),ie={[N]:o.RGBAFormat,[G]:o.RGBAFormat,[L]:o.RGBAFormat,[M]:o.RGBAFormat,[U]:o.RGFormat,[O]:o.RGFormat,[Q]:o.RGFormat,[k]:o.RGFormat,[_]:o.RedFormat,[F]:o.RedFormat,[R]:o.RedFormat,[T]:o.RedFormat,[V]:o.RGBA_ASTC_4x4_Format,[H]:o.RGBA_ASTC_6x6_Format,[j]:o.RGBA_ASTC_6x6_Format},se={[N]:o.FloatType,[G]:o.HalfFloatType,[L]:o.UnsignedByteType,[M]:o.UnsignedByteType,[U]:o.FloatType,[O]:o.HalfFloatType,[Q]:o.UnsignedByteType,[k]:o.UnsignedByteType,[_]:o.FloatType,[F]:o.HalfFloatType,[R]:o.UnsignedByteType,[T]:o.UnsignedByteType,[V]:o.HalfFloatType,[H]:o.UnsignedByteType,[j]:o.UnsignedByteType};function parseColorSpace(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?o.SRGBColorSpace:o.LinearSRGBColorSpace:10===t.colorPrimaries?2===t.transferFunction?X:"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),o.NoColorSpace)}var ae=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,s=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",a=WebAssembly.instantiate(unpack(s),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function unpack(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;++s){var a=e.charCodeAt(s);i[s]=a>96?a-97:a>64?a-39:a+4}var r=0;for(s=0;s<e.length;++s)i[r++]=i[s]<60?t[i[s]]:64*(i[s]-60)+i[++s];return i.buffer.slice(0,r)}function decode(e,t,s,a,r,n){var o=i.exports.sbrk,l=s+3&-4,h=o(l*a),c=o(r.length),d=new Uint8Array(i.exports.memory.buffer);d.set(r,c);var A=e(h,s,a,c,r.length);if(0==A&&n&&n(h,l,a),t.set(d.subarray(h,h+s*a)),o(h-o(0)),0!=A)throw new Error("Malformed buffer data: "+A)}var r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},o=[],l=0;function createWorker(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function initWorkers(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(unpack(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+decode.toString()+workerProcess.toString(),i=new Blob([t],{type:"text/javascript"}),a=URL.createObjectURL(i),r=0;r<e;++r)o[r]=createWorker(a);URL.revokeObjectURL(a)}function workerProcess(e){a.then((function(){var t=e.data;try{var s=new Uint8Array(t.count*t.size);decode(i.exports[t.mode],s,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:s},[s.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:a,supported:!0,useWorkers:function(e){initWorkers(e)},decodeVertexBuffer:function(e,t,s,a,n){decode(i.exports.meshopt_decodeVertexBuffer,e,t,s,a,i.exports[r[n]])},decodeIndexBuffer:function(e,t,s,a){decode(i.exports.meshopt_decodeIndexBuffer,e,t,s,a)},decodeIndexSequence:function(e,t,s,a){decode(i.exports.meshopt_decodeIndexSequence,e,t,s,a)},decodeGltfBuffer:function(e,t,s,a,o,l){decode(i.exports[n[o]],e,t,s,a,i.exports[r[l]])},decodeGltfBufferAsync:function(e,t,s,h,c){return o.length>0?function decodeWorker(e,t,i,s,a){for(var r=o[0],n=1;n<o.length;++n)o[n].pending<r.pending&&(r=o[n]);return new Promise((function(n,o){var h=new Uint8Array(i),c=l++;r.pending+=e,r.requests[c]={resolve:n,reject:o},r.object.postMessage({id:c,count:e,size:t,source:h,mode:s,filter:a},[h.buffer])}))}(e,t,s,n[h],r[c]):a.then((function(){var a=new Uint8Array(e*t);return decode(i.exports[n[h]],a,e,t,s,i.exports[r[c]]),a}))}}}();var re=Uint8Array,ne=Uint16Array,oe=Int32Array,le=new re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),he=new re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ce=new re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=function freb(e,t){for(var i=new ne(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var a=new oe(i[30]);for(s=1;s<30;++s)for(var r=i[s];r<i[s+1];++r)a[r]=r-i[s]<<5|s;return{b:i,r:a}},Ae=de(le,2),ue=Ae.b,pe=Ae.r;ue[28]=258,pe[258]=28;for(var me=de(he,0),ge=me.b,ve=(me.r,new ne(32768)),fe=0;fe<32768;++fe){var be=(43690&fe)>>1|(21845&fe)<<1;be=(61680&(be=(52428&be)>>2|(13107&be)<<2))>>4|(3855&be)<<4,ve[fe]=((65280&be)>>8|(255&be)<<8)>>1}var xe=function hMap(e,t,i){for(var s=e.length,a=0,r=new ne(t);a<s;++a)e[a]&&++r[e[a]-1];var n,o=new ne(t);for(a=1;a<t;++a)o[a]=o[a-1]+r[a-1]<<1;if(i){n=new ne(1<<t);var l=15-t;for(a=0;a<s;++a)if(e[a])for(var h=a<<4|e[a],c=t-e[a],d=o[e[a]-1]++<<c,A=d|(1<<c)-1;d<=A;++d)n[ve[d]>>l]=h}else for(n=new ne(s),a=0;a<s;++a)e[a]&&(n[a]=ve[o[e[a]-1]++]>>15-e[a]);return n},Ce=new re(288);for(fe=0;fe<144;++fe)Ce[fe]=8;for(fe=144;fe<256;++fe)Ce[fe]=9;for(fe=256;fe<280;++fe)Ce[fe]=7;for(fe=280;fe<288;++fe)Ce[fe]=8;var Ee=new re(32);for(fe=0;fe<32;++fe)Ee[fe]=5;var ye=xe(Ce,9,1),Ie=xe(Ee,5,1),Be=function max(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},we=function bits(e,t,i){var s=t/8|0;return(e[s]|e[s+1]<<8)>>(7&t)&i},Se=function bits16(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},De=function shft(e){return(e+7)/8|0},Pe=function slc(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new re(e.subarray(t,i))},Te=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Re=function err(e,t,i){var s=new Error(t||Te[e]);if(s.code=e,Error.captureStackTrace&&Error.captureStackTrace(s,Re),!i)throw s;return s},Qe=function inflt(e,t,i,s){var a=e.length,r=s?s.length:0;if(!a||t.f&&!t.l)return i||new re(0);var n=!i,o=n||2!=t.i,l=t.i;n&&(i=new re(3*a));var h=function cbuf(e){var t=i.length;if(e>t){var s=new re(Math.max(2*t,e));s.set(i),i=s}},c=t.f||0,d=t.p||0,A=t.b||0,u=t.l,p=t.d,m=t.m,g=t.n,v=8*a;do{if(!u){c=we(e,d,1);var f=we(e,d+1,3);if(d+=3,!f){var b=e[(T=De(d)+4)-4]|e[T-3]<<8,x=T+b;if(x>a){l&&Re(0);break}o&&h(A+b),i.set(e.subarray(T,x),A),t.b=A+=b,t.p=d=8*x,t.f=c;continue}if(1==f)u=ye,p=Ie,m=9,g=5;else if(2==f){var C=we(e,d,31)+257,E=we(e,d+10,15)+4,y=C+we(e,d+5,31)+1;d+=14;for(var I=new re(y),B=new re(19),w=0;w<E;++w)B[ce[w]]=we(e,d+3*w,7);d+=3*E;var S=Be(B),D=(1<<S)-1,P=xe(B,S,1);for(w=0;w<y;){var T,R=P[we(e,d,D)];if(d+=15&R,(T=R>>4)<16)I[w++]=T;else{var Q=0,k=0;for(16==T?(k=3+we(e,d,3),d+=2,Q=I[w-1]):17==T?(k=3+we(e,d,7),d+=3):18==T&&(k=11+we(e,d,127),d+=7);k--;)I[w++]=Q}}var L=I.subarray(0,C),M=I.subarray(C);m=Be(L),g=Be(M),u=xe(L,m,1),p=xe(M,g,1)}else Re(1);if(d>v){l&&Re(0);break}}o&&h(A+131072);for(var F=(1<<m)-1,O=(1<<g)-1,G=d;;G=d){var _=(Q=u[Se(e,d)&F])>>4;if((d+=15&Q)>v){l&&Re(0);break}if(Q||Re(2),_<256)i[A++]=_;else{if(256==_){G=d,u=null;break}var U=_-254;if(_>264){var N=le[w=_-257];U=we(e,d,(1<<N)-1)+ue[w],d+=N}var j=p[Se(e,d)&O],H=j>>4;j||Re(3),d+=15&j;M=ge[H];if(H>3){N=he[H];M+=Se(e,d)&(1<<N)-1,d+=N}if(d>v){l&&Re(0);break}o&&h(A+131072);var V=A+U;if(A<M){var W=r-M,K=Math.min(M,V);for(W+A<0&&Re(3);A<K;++A)i[A]=s[W+A]}for(;A<V;++A)i[A]=i[A-M]}}t.l=u,t.p=G,t.b=A,t.f=c,u&&(c=1,t.m=m,t.d=p,t.n=g)}while(!c);return A!=i.length&&n?Pe(i,0,A):i.subarray(0,A)},ke=new re(0),Le=function zls(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&Re(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&Re(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function unzlibSync(e,t){return Qe(e.subarray(Le(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var Me="undefined"!=typeof TextDecoder&&new TextDecoder;try{Me.decode(ke,{stream:!0})}catch(e){}var Fe,Oe,Ge;"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function findSpan(e,t,i){var s=i.length-e-1;if(t>=i[s])return s-1;if(t<=i[e])return e;for(var a=e,r=s,n=Math.floor((a+r)/2);t<i[n]||t>=i[n+1];)t<i[n]?r=n:a=n,n=Math.floor((a+r)/2);return n}function calcBasisFunctions(e,t,i,s){var a=[],r=[],n=[];a[0]=1;for(var o=1;o<=i;++o){r[o]=t-s[e+1-o],n[o]=s[e+o]-t;for(var l=0,h=0;h<o;++h){var c=n[h+1],d=r[o-h],A=a[h]/(c+d);a[h]=l+c*A,l=d*A}a[o]=l}return a}function calcKoverI(e,t){for(var i=1,s=2;s<=e;++s)i*=s;for(var a=1,r=2;r<=t;++r)a*=r;for(var n=2;n<=e-t;++n)a*=n;return i/a}function calcNURBSDerivatives(e,t,i,s,a){var r=function calcBSplineDerivatives(e,t,i,s,a){for(var r=a<e?a:e,n=[],l=findSpan(e,s,t),h=function calcBasisFunctionDerivatives(e,t,i,s,a){for(var r=[],n=0;n<=i;++n)r[n]=0;for(var o=[],l=0;l<=s;++l)o[l]=r.slice(0);for(var h=[],c=0;c<=i;++c)h[c]=r.slice(0);h[0][0]=1;for(var d=r.slice(0),A=r.slice(0),u=1;u<=i;++u){d[u]=t-a[e+1-u],A[u]=a[e+u]-t;for(var p=0,m=0;m<u;++m){var g=A[m+1],v=d[u-m];h[u][m]=g+v;var f=h[m][u-1]/h[u][m];h[m][u]=p+g*f,p=v*f}h[u][u]=p}for(var b=0;b<=i;++b)o[0][b]=h[b][i];for(var x=0;x<=i;++x){for(var C=0,E=1,y=[],I=0;I<=i;++I)y[I]=r.slice(0);y[0][0]=1;for(var B=1;B<=s;++B){var w=0,S=x-B,D=i-B;x>=B&&(y[E][0]=y[C][0]/h[D+1][S],w=y[E][0]*h[S][D]);for(var P=x-1<=D?B-1:i-x,T=S>=-1?1:-S;T<=P;++T)y[E][T]=(y[C][T]-y[C][T-1])/h[D+1][S+T],w+=y[E][T]*h[S+T][D];x<=D&&(y[E][B]=-y[C][B-1]/h[D+1][x],w+=y[E][B]*h[x][D]),o[B][x]=w;var R=C;C=E,E=R}}for(var Q=i,k=1;k<=s;++k){for(var L=0;L<=i;++L)o[k][L]*=Q;Q*=i-k}return o}(l,s,e,r,t),c=[],d=0;d<i.length;++d){var A=i[d].clone(),u=A.w;A.x*=u,A.y*=u,A.z*=u,c[d]=A}for(var p=0;p<=r;++p){for(var m=c[l-e].clone().multiplyScalar(h[p][0]),g=1;g<=e;++g)m.add(c[l-e+g].clone().multiplyScalar(h[p][g]));n[p]=m}for(var v=r+1;v<=a+1;++v)n[v]=new o.Vector4(0,0,0);return n}(e,t,i,s,a);return function calcRationalCurveDerivatives(e){for(var t=e.length,i=[],s=[],a=0;a<t;++a){var r=e[a];i[a]=new o.Vector3(r.x,r.y,r.z),s[a]=r.w}for(var n=[],l=0;l<t;++l){for(var h=i[l].clone(),c=1;c<=l;++c)h.sub(n[l-c].clone().multiplyScalar(calcKoverI(l,c)*s[c]));n[l]=h.divideScalar(s[0])}return n}(r)}class NURBSCurve extends o.Curve{constructor(e,t,i,s,a){super();var r=t?t.length-1:0,n=i?i.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=a||r;for(var l=0;l<n;++l){var h=i[l];this.controlPoints[l]=new o.Vector4(h.x,h.y,h.z,h.w)}}getPoint(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.Vector3,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function calcBSplinePoint(e,t,i,s){for(var a=findSpan(e,s,t),r=calcBasisFunctions(a,s,e,t),n=new o.Vector4(0,0,0,0),l=0;l<=e;++l){var h=i[a-e+l],c=r[l],d=h.w*c;n.x+=h.x*d,n.y+=h.y*d,n.z+=h.z*d,n.w+=h.w*c}return n}(this.degree,this.knots,this.controlPoints,i);return 1!==s.w&&s.divideScalar(s.w),t.set(s.x,s.y,s.z)}getTangent(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.Vector3,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return t.copy(s[1]).normalize(),t}toJSON(){var e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map((e=>e.toArray())),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map((e=>new o.Vector4(e[0],e[1],e[2],e[3]))),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}}class FBXLoader extends o.Loader{constructor(e){super(e)}load(e,t,i,s){var a=this,r=""===a.path?o.LoaderUtils.extractUrlBase(e):a.path,n=new o.FileLoader(this.manager);n.setPath(a.path),n.setResponseType("arraybuffer"),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,(function(i){try{t(a.parse(i,r))}catch(t){s?s(t):console.error(t),a.manager.itemError(e)}}),i,s)}parse(e,t){if(function isFbxFormatBinary(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===convertArrayBufferToString(e,0,t.length)}(e))Fe=(new BinaryParser).parse(e);else{var i=convertArrayBufferToString(e);if(!function isFbxFormatASCII(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function read(t){var s=e[t-1];return e=e.slice(i+t),i++,s}for(var s=0;s<t.length;++s){if(read(1)===t[s])return!1}return!0}(i))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(i));Fe=(new TextParser).parse(i)}var s=new o.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new FBXTreeParser(s,this.manager).parse(Fe)}}class FBXTreeParser{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Oe=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),a=(new GeometryParser).parse(s);return this.parseScene(s,a,i),Ge}parseConnections(){var e=new Map;"Connections"in Fe&&Fe.Connections.connections.forEach((function(t){var i=t[0],s=t[1],a=t[2];e.has(i)||e.set(i,{parents:[],children:[]});var r={ID:s,relationship:a};e.get(i).parents.push(r),e.has(s)||e.set(s,{parents:[],children:[]});var n={ID:i,relationship:a};e.get(s).children.push(n)}));return e}parseImages(){var e={},t={};if("Video"in Fe.Objects){var i=Fe.Objects.Video;for(var s in i){var a=i[s];if(e[parseInt(s)]=a.RelativeFilename||a.Filename,"Content"in a){var r=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,n="string"==typeof a.Content&&""!==a.Content;if(r||n){var o=this.parseImage(i[s]);t[a.RelativeFilename||a.Filename]=o}}}}for(var l in e){var h=e[l];void 0!==t[h]?e[l]=t[h]:e[l]=e[l].split("\\").pop()}return e}parseImage(e){var t,i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",s),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var r=new Uint8Array(i);return window.URL.createObjectURL(new Blob([r],{type:t}))}parseTextures(e){var t=new Map;if("Texture"in Fe.Objects){var i=Fe.Objects.Texture;for(var s in i){var a=this.parseTexture(i[s],e);t.set(parseInt(s),a)}}return t}parseTexture(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var s=e.WrapModeU,a=e.WrapModeV,r=void 0!==s?s.value:0,n=void 0!==a?a.value:0;if(i.wrapS=0===r?o.RepeatWrapping:o.ClampToEdgeWrapping,i.wrapT=0===n?o.RepeatWrapping:o.ClampToEdgeWrapping,"Scaling"in e){var l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){var h=e.Translation.value;i.offset.x=h[0],i.offset.y=h[1]}return i}loadTexture(e,t){var i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),s=e.FileName.split(".").pop().toLowerCase(),a=i.has(s)?this.manager.getHandler(".".concat(s)):this.textureLoader;if(!a)return console.warn("FBXLoader: ".concat(s.toUpperCase()," loader not found, creating placeholder texture for"),e.RelativeFilename),new o.Texture;var r=a.path;r||a.setPath(this.textureLoader.path);var n,l=Oe.get(e.id).children;void 0!==l&&l.length>0&&void 0!==t[l[0].ID]&&(0!==(n=t[l[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||a.setPath(void 0));var h=a.load(n);return a.setPath(r),h}parseMaterials(e){var t=new Map;if("Material"in Fe.Objects){var i=Fe.Objects.Material;for(var s in i){var a=this.parseMaterial(i[s],e);null!==a&&t.set(parseInt(s),a)}}return t}parseMaterial(e,t){var i=e.id,s=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!Oe.has(i))return null;var r,n=this.parseParameters(e,t,i);switch(a.toLowerCase()){case"phong":r=new o.MeshPhongMaterial;break;case"lambert":r=new o.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),r=new o.MeshPhongMaterial}return r.setValues(n),r.name=s,r}parseParameters(e,t,i){var s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=(new o.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(s.color=(new o.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=(new o.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(s.emissive=(new o.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),s.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),1!==s.opacity&&0!==s.opacity||(s.opacity=e.Opacity?parseFloat(e.Opacity.value):null,null===s.opacity&&(s.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=(new o.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(s.specular=(new o.Color).fromArray(e.SpecularColor.value));var a=this;return Oe.get(i).children.forEach((function(e){var i=e.relationship;switch(i){case"Bump":s.bumpMap=a.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":s.aoMap=a.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=a.getTexture(t,e.ID);break;case"DisplacementColor":s.displacementMap=a.getTexture(t,e.ID);break;case"EmissiveColor":s.emissiveMap=a.getTexture(t,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=a.getTexture(t,e.ID);break;case"ReflectionColor":s.envMap=a.getTexture(t,e.ID),void 0!==s.envMap&&(s.envMap.mapping=o.EquirectangularReflectionMapping);break;case"SpecularColor":s.specularMap=a.getTexture(t,e.ID),s.specularMap;break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=a.getTexture(t,e.ID),s.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",i)}})),s}getTexture(e,t){return"LayeredTexture"in Fe.Objects&&t in Fe.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Oe.get(t).children[0].ID),e.get(t)}parseDeformers(){var e={},t={};if("Deformer"in Fe.Objects){var i=Fe.Objects.Deformer;for(var s in i){var a=i[s],r=Oe.get(parseInt(s));if("Skin"===a.attrType){var n=this.parseSkeleton(r,i);n.ID=s,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),n.geometryID=r.parents[0].ID,e[s]=n}else if("BlendShape"===a.attrType){var o={id:s};o.rawTargets=this.parseMorphTargets(r,i),o.id=s,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){var i=[];return e.children.forEach((function(e){var s=t[e.ID];if("Cluster"===s.attrType){var a={ID:e.ID,indices:[],weights:[],transformLink:(new o.Matrix4).fromArray(s.TransformLink.a)};"Indexes"in s&&(a.indices=s.Indexes.a,a.weights=s.Weights.a),i.push(a)}})),{rawBones:i,bones:[]}}parseMorphTargets(e,t){for(var i=[],s=0;s<e.children.length;s++){var a=e.children[s],r=t[a.ID],n={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if("BlendShapeChannel"!==r.attrType)return;n.geoID=Oe.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,i.push(n)}return i}parseScene(e,t,i){Ge=new o.Group;var s=this.parseModels(e.skeletons,t,i),a=Fe.Objects.Model,r=this;s.forEach((function(e){var t=a[e.ID];r.setLookAtProperties(e,t),Oe.get(e.ID).parents.forEach((function(t){var i=s.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&Ge.add(e)})),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ge.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=generateTransform(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var n=(new AnimationParser).parse();1===Ge.children.length&&Ge.children[0].isGroup&&(Ge.children[0].animations=n,Ge=Ge.children[0]),Ge.animations=n}parseModels(e,t,i){var s=this,a=new Map,r=Fe.Objects.Model,n=["Culling","DefaultAttributeIndex","InheritType","Lcl_Translation","Lcl_Rotation","Lcl_Scaling","RotationPivot","ScalingPivot","RotationActive","ScalingMax","RotationOffset","fbx_node_path","Shading","Version","attrName","attrType","currentUVSet","id","name","propertyList","singleProperty"],l=function _loop(){var l=parseInt(h),c=r[h],d=Oe.get(l),A=s.buildSkeleton(d,e,l,c.attrName);if(!A){switch(c.attrType){case"Camera":A=s.createCamera(d);break;case"Light":A=s.createLight(d);break;case"Mesh":A=s.createMesh(d,t,i);break;case"NurbsCurve":A=s.createCurve(d,t);break;case"LimbNode":case"Root":A=new o.Bone;break;default:A=new o.Group}A.name=c.attrName?o.PropertyBinding.sanitizeNodeName(c.attrName):"",A.userData.originalName=c.attrName,A.ID=l}Object.keys(c).forEach((e=>{n.includes(e)||(A.userData[e]=c[e].value)})),s.getTransformData(A,c),a.set(l,A)};for(var h in r)l();return a}buildSkeleton(e,t,i,s){var a=null;return e.parents.forEach((function(e){var r=function _loop2(){var r=t[n];r.rawBones.forEach((function(t,n){if(t.ID===e.ID){var l=a;(a=new o.Bone).matrixWorld.copy(t.transformLink),a.name=s?o.PropertyBinding.sanitizeNodeName(s):"",a.userData.originalName=s,a.ID=i,r.bones[n]=a,null!==l&&a.add(l)}}))};for(var n in t)r()})),a}createCamera(e){var t,i;if(e.children.forEach((function(e){var t=Fe.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)})),void 0===i)t=new o.Object3D;else{var s=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(s=1);var a=1;void 0!==i.NearPlane&&(a=i.NearPlane.value/1e3);var r=1e3;void 0!==i.FarPlane&&(r=i.FarPlane.value/1e3);var n=window.innerWidth,l=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(n=i.AspectWidth.value,l=i.AspectHeight.value);var h=n/l,c=45;void 0!==i.FieldOfView&&(c=i.FieldOfView.value);var d=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new o.PerspectiveCamera(c,h,a,r),null!==d&&t.setFocalLength(d);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new o.Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new o.Object3D}}return t}createLight(e){var t,i;if(e.children.forEach((function(e){var t=Fe.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)})),void 0===i)t=new o.Object3D;else{var s;s=void 0===i.LightType?0:i.LightType.value;var a=16777215;void 0!==i.Color&&(a=(new o.Color).fromArray(i.Color.value));var r=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(r=0);var n=0;void 0!==i.FarAttenuationEnd&&(n=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);switch(s){case 0:t=new o.PointLight(a,r,n,1);break;case 1:t=new o.DirectionalLight(a,r);break;case 2:var l=Math.PI/3;void 0!==i.InnerAngle&&(l=o.MathUtils.degToRad(i.InnerAngle.value));var h=0;void 0!==i.OuterAngle&&(h=o.MathUtils.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new o.SpotLight(a,r,n,l,h,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new o.PointLight(a,r)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,i){var s,a=null,r=null,n=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),i.has(e.ID)&&n.push(i.get(e.ID))})),n.length>1?r=n:n.length>0?r=n[0]:(r=new o.MeshPhongMaterial({name:o.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),n.push(r)),"color"in a.attributes&&n.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(s=new o.SkinnedMesh(a,r)).normalizeSkinWeights():s=new o.Mesh(a,r),s}createCurve(e,t){var i=e.children.reduce((function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e}),null),s=new o.LineBasicMaterial({name:o.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new o.Line(i,s)}getTransformData(e,t){var i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder=getEulerOrder("RotationOrder"in t?t.RotationOrder.value:0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&Oe.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=Fe.Objects.Model[t.ID];if("Lcl_Translation"in i){var s=i.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(s),Ge.add(e.target)):e.lookAt((new o.Vector3).fromArray(s))}}}))}bindSkeleton(e,t,i){var s=this.parsePoseNodes(),a=function _loop3(){var a=e[r];Oe.get(parseInt(a.ID)).parents.forEach((function(e){if(t.has(e.ID)){var r=e.ID;Oe.get(r).parents.forEach((function(e){i.has(e.ID)&&i.get(e.ID).bind(new o.Skeleton(a.bones),s[e.ID])}))}}))};for(var r in e)a()}parsePoseNodes(){var e={};if("Pose"in Fe.Objects){var t=Fe.Objects.Pose;for(var i in t)if("BindPose"===t[i].attrType&&t[i].NbPoseNodes>0){var s=t[i].PoseNode;Array.isArray(s)?s.forEach((function(t){e[t.Node]=(new o.Matrix4).fromArray(t.Matrix.a)})):e[s.Node]=(new o.Matrix4).fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Fe){if("AmbientColor"in Fe.GlobalSettings){var e=Fe.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(0!==t||0!==i||0!==s){var a=(new o.Color).setRGB(t,i,s);Ge.add(new o.AmbientLight(a,1))}}"UnitScaleFactor"in Fe.GlobalSettings&&(Ge.userData.unitScaleFactor=Fe.GlobalSettings.UnitScaleFactor.value)}}}class GeometryParser{constructor(){this.negativeMaterialIndices=!1}parse(e){var t=new Map;if("Geometry"in Fe.Objects){var i=Fe.Objects.Geometry;for(var s in i){var a=Oe.get(parseInt(s)),r=this.parseGeometry(a,i[s],e);t.set(parseInt(s),r)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){var s=i.skeletons,a=[],r=e.parents.map((function(e){return Fe.Objects.Model[e.ID]}));if(0!==r.length){var n=e.children.reduce((function(e,t){return void 0!==s[t.ID]&&(e=s[t.ID]),e}),null);e.children.forEach((function(e){void 0!==i.morphTargets[e.ID]&&a.push(i.morphTargets[e.ID])}));var o=r[0],l={};"RotationOrder"in o&&(l.eulerOrder=getEulerOrder(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);var h=generateTransform(l);return this.genGeometry(t,n,a,h)}}genGeometry(e,t,i,s){var a=new o.BufferGeometry;e.attrName&&(a.name=e.attrName);var r=this.parseGeoNode(e,t),n=this.genBuffers(r),l=new o.Float32BufferAttribute(n.vertex,3);if(l.applyMatrix4(s),a.setAttribute("position",l),n.colors.length>0&&a.setAttribute("color",new o.Float32BufferAttribute(n.colors,3)),t&&(a.setAttribute("skinIndex",new o.Uint16BufferAttribute(n.weightsIndices,4)),a.setAttribute("skinWeight",new o.Float32BufferAttribute(n.vertexWeights,4)),a.FBX_Deformer=t),n.normal.length>0){var h=(new o.Matrix3).getNormalMatrix(s),c=new o.Float32BufferAttribute(n.normal,3);c.applyNormalMatrix(h),a.setAttribute("normal",c)}if(n.uvs.forEach((function(e,t){var i=0===t?"uv":"uv".concat(t);a.setAttribute(i,new o.Float32BufferAttribute(n.uvs[t],2))})),r.material&&"AllSame"!==r.material.mappingType){var d=n.materialIndex[0],A=0;if(n.materialIndex.forEach((function(e,t){e!==d&&(a.addGroup(A,t-A,d),d=e,A=t)})),a.groups.length>0){var u=a.groups[a.groups.length-1],p=u.start+u.count;p!==n.materialIndex.length&&a.addGroup(p,n.materialIndex.length-p,d)}0===a.groups.length&&a.addGroup(0,n.materialIndex.length,n.materialIndex[0])}return this.addMorphTargets(a,e,i,s),a}parseGeoNode(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var s=0;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(s,a){void 0===i.weightTable[s]&&(i.weightTable[s]=[]),i.weightTable[s].push({id:t,weight:e.weights[a]})}))}))),i}genBuffers(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,s=0,a=!1,r=[],n=[],o=[],l=[],h=[],c=[],d=this;return e.vertexIndices.forEach((function(A,u){var p,m=!1;A<0&&(A=~A,m=!0);var g=[],v=[];if(r.push(3*A,3*A+1,3*A+2),e.color){var f=getData(u,i,A,e.color);o.push(f[0],f[1],f[2])}if(e.skeleton){if(void 0!==e.weightTable[A]&&e.weightTable[A].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);var b=[0,0,0,0],x=[0,0,0,0];v.forEach((function(e,t){var i=e,s=g[t];x.forEach((function(e,t,a){if(i>e){a[t]=i,i=e;var r=b[t];b[t]=s,s=r}}))})),g=b,v=x}for(;v.length<4;)v.push(0),g.push(0);for(var C=0;C<4;++C)h.push(v[C]),c.push(g[C])}if(e.normal){var E=getData(u,i,A,e.normal);n.push(E[0],E[1],E[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=getData(u,i,A,e.material)[0])<0&&(d.negativeMaterialIndices=!0,p=0),e.uv&&e.uv.forEach((function(e,t){var s=getData(u,i,A,e);void 0===l[t]&&(l[t]=[]),l[t].push(s[0]),l[t].push(s[1])})),s++,m&&(d.genFace(t,e,r,p,n,o,l,h,c,s),i++,s=0,r=[],n=[],o=[],l=[],h=[],c=[])})),t}getNormalNewell(e){for(var t=new o.Vector3(0,0,0),i=0;i<e.length;i++){var s=e[i],a=e[(i+1)%e.length];t.x+=(s.y-a.y)*(s.z+a.z),t.y+=(s.z-a.z)*(s.x+a.x),t.z+=(s.x-a.x)*(s.y+a.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){var t=this.getNormalNewell(e),i=(Math.abs(t.z)>.5?new o.Vector3(0,1,0):new o.Vector3(0,0,1)).cross(t).normalize(),s=t.clone().cross(i).normalize();return{normal:t,tangent:i,bitangent:s}}flattenVertex(e,t,i){return new o.Vector2(e.dot(t),e.dot(i))}genFace(e,t,i,s,a,r,n,l,h,c){var d;if(c>3){for(var A=[],u=t.baseVertexPositions||t.vertexPositions,p=0;p<i.length;p+=3)A.push(new o.Vector3(u[i[p]],u[i[p+1]],u[i[p+2]]));var{tangent:m,bitangent:g}=this.getNormalTangentAndBitangent(A),v=[];for(var f of A)v.push(this.flattenVertex(f,m,g));d=o.ShapeUtils.triangulateShape(v,[])}else d=[[0,1,2]];var b=function _loop4(o,c,d){e.vertex.push(t.vertexPositions[i[3*o]]),e.vertex.push(t.vertexPositions[i[3*o+1]]),e.vertex.push(t.vertexPositions[i[3*o+2]]),e.vertex.push(t.vertexPositions[i[3*c]]),e.vertex.push(t.vertexPositions[i[3*c+1]]),e.vertex.push(t.vertexPositions[i[3*c+2]]),e.vertex.push(t.vertexPositions[i[3*d]]),e.vertex.push(t.vertexPositions[i[3*d+1]]),e.vertex.push(t.vertexPositions[i[3*d+2]]),t.skeleton&&(e.vertexWeights.push(l[4*o]),e.vertexWeights.push(l[4*o+1]),e.vertexWeights.push(l[4*o+2]),e.vertexWeights.push(l[4*o+3]),e.vertexWeights.push(l[4*c]),e.vertexWeights.push(l[4*c+1]),e.vertexWeights.push(l[4*c+2]),e.vertexWeights.push(l[4*c+3]),e.vertexWeights.push(l[4*d]),e.vertexWeights.push(l[4*d+1]),e.vertexWeights.push(l[4*d+2]),e.vertexWeights.push(l[4*d+3]),e.weightsIndices.push(h[4*o]),e.weightsIndices.push(h[4*o+1]),e.weightsIndices.push(h[4*o+2]),e.weightsIndices.push(h[4*o+3]),e.weightsIndices.push(h[4*c]),e.weightsIndices.push(h[4*c+1]),e.weightsIndices.push(h[4*c+2]),e.weightsIndices.push(h[4*c+3]),e.weightsIndices.push(h[4*d]),e.weightsIndices.push(h[4*d+1]),e.weightsIndices.push(h[4*d+2]),e.weightsIndices.push(h[4*d+3])),t.color&&(e.colors.push(r[3*o]),e.colors.push(r[3*o+1]),e.colors.push(r[3*o+2]),e.colors.push(r[3*c]),e.colors.push(r[3*c+1]),e.colors.push(r[3*c+2]),e.colors.push(r[3*d]),e.colors.push(r[3*d+1]),e.colors.push(r[3*d+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(a[3*o]),e.normal.push(a[3*o+1]),e.normal.push(a[3*o+2]),e.normal.push(a[3*c]),e.normal.push(a[3*c+1]),e.normal.push(a[3*c+2]),e.normal.push(a[3*d]),e.normal.push(a[3*d+1]),e.normal.push(a[3*d+2])),t.uv&&t.uv.forEach((function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(n[i][2*o]),e.uvs[i].push(n[i][2*o+1]),e.uvs[i].push(n[i][2*c]),e.uvs[i].push(n[i][2*c+1]),e.uvs[i].push(n[i][2*d]),e.uvs[i].push(n[i][2*d+1])}))};for(var[x,C,E]of d)b(x,C,E)}addMorphTargets(e,t,i,s){if(0!==i.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var a=this;i.forEach((function(i){i.rawTargets.forEach((function(i){var r=Fe.Objects.Geometry[i.geoID];void 0!==r&&a.genMorphGeometry(e,t,r,s,i.name)}))}))}}genMorphGeometry(e,t,i,s,a){for(var r=void 0!==t.Vertices?t.Vertices.a:[],n=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],l=void 0!==i.Vertices?i.Vertices.a:[],h=void 0!==i.Indexes?i.Indexes.a:[],c=3*e.attributes.position.count,d=new Float32Array(c),A=0;A<h.length;A++){var u=3*h[A];d[u]=l[3*A],d[u+1]=l[3*A+1],d[u+2]=l[3*A+2]}var p={vertexIndices:n,vertexPositions:d,baseVertexPositions:r},m=this.genBuffers(p),g=new o.Float32BufferAttribute(m.vertex,3);g.name=a||i.attrName,g.applyMatrix4(s),e.morphAttributes.position.push(g)}parseNormals(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a,a=[];return"IndexToDirect"===i&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:a,mappingType:t,referenceType:i}}parseUVs(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a,a=[];return"IndexToDirect"===i&&(a=e.UVIndex.a),{dataSize:2,buffer:s,indices:a,mappingType:t,referenceType:i}}parseVertexColors(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a,a=[];"IndexToDirect"===i&&(a=e.ColorIndex.a);for(var r=0,n=new o.Color;r<s.length;r+=4)n.fromArray(s,r),o.ColorManagement.toWorkingColorSpace(n,o.SRGBColorSpace),n.toArray(s,r);return{dataSize:4,buffer:s,indices:a,mappingType:t,referenceType:i}}parseMaterialIndices(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var s=e.Materials.a,a=[],r=0;r<s.length;++r)a.push(r);return{dataSize:1,buffer:s,indices:a,mappingType:t,referenceType:i}}parseNurbsGeometry(e){var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new o.BufferGeometry;for(var i,s,a=t-1,r=e.KnotVector.a,n=[],l=e.Points.a,h=0,c=l.length;h<c;h+=4)n.push((new o.Vector4).fromArray(l,h));if("Closed"===e.Form)n.push(n[0]);else if("Periodic"===e.Form){i=a,s=r.length-1-i;for(var d=0;d<a;++d)n.push(n[d])}var A=new NURBSCurve(a,r,n,i,s).getPoints(12*n.length);return(new o.BufferGeometry).setFromPoints(A)}}class AnimationParser{parse(){var e=[],t=this.parseClips();if(void 0!==t)for(var i in t){var s=t[i],a=this.addClip(s);e.push(a)}return e}parseClips(){if(void 0!==Fe.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}}parseAnimationCurveNodes(){var e=Fe.Objects.AnimationCurveNode,t=new Map;for(var i in e){var s=e[i];if(null!==s.attrName.match(/S|R|T|DeformPercent/)){var a={id:s.id,attr:s.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){var t=Fe.Objects.AnimationCurve;for(var i in t){var s={id:t[i].id,times:t[i].KeyTime.a.map(convertFBXTimeToSeconds),values:t[i].KeyValueFloat.a},a=Oe.get(s.id);if(void 0!==a){var r=a.parents[0].ID,n=a.parents[0].relationship;n.match(/X/)?e.get(r).curves.x=s:n.match(/Y/)?e.get(r).curves.y=s:n.match(/Z/)?e.get(r).curves.z=s:n.match(/DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=s)}}}parseAnimationLayers(e){var t=Fe.Objects.AnimationLayer,i=new Map,s=function _loop5(){var t=[],s=Oe.get(parseInt(a));void 0!==s&&(s.children.forEach((function(i,s){if(e.has(i.ID)){var a=e.get(i.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===t[s]){var r=Oe.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==r){var n=Fe.Objects.Model[r.toString()];if(void 0===n)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",i);var l={modelName:n.attrName?o.PropertyBinding.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ge.traverse((function(e){e.ID===n.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new o.Matrix4),"PreRotation"in n&&(l.preRotation=n.PreRotation.value),"PostRotation"in n&&(l.postRotation=n.PostRotation.value),t[s]=l}}t[s]&&(t[s][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===t[s]){var h=Oe.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,c=Oe.get(h).parents[0].ID,d=Oe.get(c).parents[0].ID,A=Oe.get(d).parents[0].ID,u=Fe.Objects.Model[A],p={modelName:u.attrName?o.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:Fe.Objects.Deformer[h].attrName};t[s]=p}t[s][a.attr]=a}}})),i.set(parseInt(a),t))};for(var a in t)s();return i}parseAnimStacks(e){var t=Fe.Objects.AnimationStack,i={};for(var s in t){var a=Oe.get(parseInt(s)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var r=e.get(a[0].ID);i[s]={name:t[s].attrName,layer:r}}return i}addClip(e){var t=[],i=this;return e.layer.forEach((function(e){t=t.concat(i.generateTracks(e))})),new o.AnimationClip(e.name,-1,t)}generateTracks(e){var t=[],i=new o.Vector3,s=new o.Vector3;if(e.transform&&e.transform.decompose(i,new o.Quaternion,s),i=i.toArray(),s=s.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var n=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t}generateVectorTrack(e,t,i,s){var a=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(a,t,i);return new o.VectorKeyframeTrack(e+"."+s,a,r)}generateRotationTrack(e,t,i,s,a){var r,n;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){var l=this.interpolateRotations(t.x,t.y,t.z,a);r=l[0],n=l[1]}var h=getEulerOrder(0);void 0!==i&&((i=i.map(o.MathUtils.degToRad)).push(h),i=(new o.Euler).fromArray(i),i=(new o.Quaternion).setFromEuler(i)),void 0!==s&&((s=s.map(o.MathUtils.degToRad)).push(h),s=(new o.Euler).fromArray(s),s=(new o.Quaternion).setFromEuler(s).invert());var c=new o.Quaternion,d=new o.Euler,A=[];if(!n||!r)return new o.QuaternionKeyframeTrack(e+".quaternion",[0],[0]);for(var u=0;u<n.length;u+=3){if(d.set(n[u],n[u+1],n[u+2],a),c.setFromEuler(d),void 0!==i&&c.premultiply(i),void 0!==s&&c.multiply(s),u>2)(new o.Quaternion).fromArray(A,(u-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w);c.toArray(A,u/3*4)}return new o.QuaternionKeyframeTrack(e+".quaternion",r,A)}generateMorphTrack(e){var t=e.DeformPercent.curves.morph,i=t.values.map((function(e){return e/100})),s=Ge.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new o.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){for(var i=1,s=t[0],a=1;a<t.length;a++){var r=t[a];r!==s&&(t[i]=r,s=r,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){var s=i,a=[],r=-1,n=-1,o=-1;return e.forEach((function(e){if(t.x&&(r=t.x.times.indexOf(e)),t.y&&(n=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==r){var i=t.x.values[r];a.push(i),s[0]=i}else a.push(s[0]);if(-1!==n){var l=t.y.values[n];a.push(l),s[1]=l}else a.push(s[1]);if(-1!==o){var h=t.z.values[o];a.push(h),s[2]=h}else a.push(s[2])})),a}interpolateRotations(e,t,i,s){var a=[],r=[];a.push(e.times[0]),r.push(o.MathUtils.degToRad(e.values[0])),r.push(o.MathUtils.degToRad(t.values[0])),r.push(o.MathUtils.degToRad(i.values[0]));for(var n=1;n<e.values.length;n++){var l=[e.values[n-1],t.values[n-1],i.values[n-1]];if(!(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))){var h=l.map(o.MathUtils.degToRad),c=[e.values[n],t.values[n],i.values[n]];if(!(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))){var d=c.map(o.MathUtils.degToRad),A=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],u=[Math.abs(A[0]),Math.abs(A[1]),Math.abs(A[2])];if(u[0]>=180||u[1]>=180||u[2]>=180){var p=Math.max(...u)/180,m=new o.Euler(...h,s),g=new o.Euler(...d,s),v=(new o.Quaternion).setFromEuler(m),f=(new o.Quaternion).setFromEuler(g);v.dot(f)&&f.set(-f.x,-f.y,-f.z,-f.w);for(var b=e.times[n-1],x=e.times[n]-b,C=new o.Quaternion,E=new o.Euler,y=0;y<1;y+=1/p)C.copy(v.clone().slerp(f.clone(),y)),a.push(b+y*x),E.setFromQuaternion(C,s),r.push(E.x),r.push(E.y),r.push(E.z)}else a.push(e.times[n]),r.push(o.MathUtils.degToRad(e.values[n])),r.push(o.MathUtils.degToRad(t.values[n])),r.push(o.MathUtils.degToRad(i.values[n]))}}}return[a,r]}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,s){var a=e.match(/^[\s\t]*;/),r=e.match(/^[\s\t]*$/);if(!a&&!r){var n=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(e,n):o?t.parseNodeProperty(e,o,i[++s]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes}parseNodeBegin(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:i},r=this.parseNodeAttr(s),n=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,a):i in n?("PoseNode"===i?n.PoseNode.push(a):void 0!==n[i].id&&(n[i]={},n[i][n[i].id]=n[i]),""!==r.id&&(n[i][r.id]=a)):"number"==typeof r.id?(n[i]={},n[i][r.id]=a):"Properties70"!==i&&(n[i]="PoseNode"===i?[a]:a),"number"==typeof r.id&&(a.id=r.id),""!==r.name&&(a.attrName=r.name),""!==r.type&&(a.attrType=r.type),this.pushStack(a)}parseNodeAttr(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){var s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===s&&","===a&&(a=i.replace(/"/g,"").replace(/,$/,"").trim());var r=this.getCurrentNode();if("Properties70"!==r.name){if("C"===s){var n=a.split(",").slice(1),o=parseInt(n[0]),l=parseInt(n[1]),h=a.split(",").slice(3);s="connections",function append(e,t){for(var i=0,s=e.length,a=t.length;i<a;i++,s++)e[s]=t[i]}(a=[o,l],h=h.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===r[s]&&(r[s]=[])}"Node"===s&&(r.id=a),s in r&&Array.isArray(r[s])?r[s].push(a):"a"!==s?r[s]=a:r.a=a,this.setCurrentProp(r,s),"a"===s&&","!==a.slice(-1)&&(r.a=parseNumberArray(a))}else this.parseNodeSpecialProperty(e,s,a)}parseNodePropertyContinued(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=parseNumberArray(t.a))}parseNodeSpecialProperty(e,t,i){var s=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=s[0],r=s[1],n=s[2],o=s[3],l=s[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=parseNumberArray(l)}this.getPrevNode()[a]={type:r,type2:n,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),a)}}class BinaryParser{parse(e){var t=new BinaryReader(e);t.skip(23);var i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);for(var s=new FBXTree;!this.endOfContent(t);){var a=this.parseNode(t,i);null!==a&&s.add(a.name,a)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){var i={},s=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var r=e.getUint8(),n=e.getString(r);if(0===s)return null;for(var o=[],l=0;l<a;l++)o.push(this.parseProperty(e));var h=o.length>0?o[0]:"",c=o.length>1?o[1]:"",d=o.length>2?o[2]:"";for(i.singleProperty=1===a&&e.getOffset()===s;s>e.getOffset();){var A=this.parseNode(e,t);null!==A&&this.parseSubNode(n,i,A)}return i.propertyList=o,"number"==typeof h&&(i.id=h),""!==c&&(i.attrName=c),""!==d&&(i.attrType=d),""!==n&&(i.name=n),i}parseSubNode(e,t,i){if(!0===i.singleProperty){var s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if("Connections"===e&&"C"===i.name){var a=[];i.propertyList.forEach((function(e,t){0!==t&&a.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(a)}else if("Properties70"===i.name){Object.keys(i).forEach((function(e){t[e]=i[e]}))}else if("Properties70"===e&&"P"===i.name){var r,n=i.propertyList[0],o=i.propertyList[1],l=i.propertyList[2],h=i.propertyList[3];0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),r="Color"===o||"ColorRGB"===o||"Vector"===o||"Vector3D"===o||0===o.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[n]={type:o,type2:l,flag:h,value:r}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)}parseProperty(e){var t,i=e.getString(1);switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var s=e.getUint32(),a=e.getUint32(),r=e.getUint32();if(0===a)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}var n=unzlibSync(new Uint8Array(e.getArrayBuffer(r))),o=new BinaryReader(n.buffer);switch(i){case"b":case"c":return o.getBooleanArray(s);case"d":return o.getFloat64Array(s);case"f":return o.getFloat32Array(s);case"i":return o.getInt32Array(s);case"l":return o.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class BinaryReader{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){var t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);var s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}}class FBXTree{add(e,t){this[e]=t}}function getFbxVersion(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(e){return e/46186158e3}var _e=[];function getData(e,t,i,s){var a;switch(s.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}"IndexToDirect"===s.referenceType&&(a=s.indices[a]);var r=a*s.dataSize,n=r+s.dataSize;return function slice(e,t,i,s){for(var a=i,r=0;a<s;a++,r++)e[r]=t[a];return e}(_e,s.buffer,r,n)}var Ue=new o.Euler,Ne=new o.Vector3;function generateTransform(e){var t=new o.Matrix4,i=new o.Matrix4,s=new o.Matrix4,a=new o.Matrix4,r=new o.Matrix4,n=new o.Matrix4,l=new o.Matrix4,h=new o.Matrix4,c=new o.Matrix4,d=new o.Matrix4,A=new o.Matrix4,u=new o.Matrix4,p=e.inheritType?e.inheritType:0;e.translation&&t.setPosition(Ne.fromArray(e.translation));var m=getEulerOrder(0);if(e.preRotation){var g=e.preRotation.map(o.MathUtils.degToRad);g.push(m),i.makeRotationFromEuler(Ue.fromArray(g))}if(e.rotation){var v=e.rotation.map(o.MathUtils.degToRad);v.push(e.eulerOrder||m),s.makeRotationFromEuler(Ue.fromArray(v))}if(e.postRotation){var f=e.postRotation.map(o.MathUtils.degToRad);f.push(m),a.makeRotationFromEuler(Ue.fromArray(f)),a.invert()}e.scale&&r.scale(Ne.fromArray(e.scale)),e.scalingOffset&&l.setPosition(Ne.fromArray(e.scalingOffset)),e.scalingPivot&&n.setPosition(Ne.fromArray(e.scalingPivot)),e.rotationOffset&&h.setPosition(Ne.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Ne.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(A.copy(e.parentMatrix),d.copy(e.parentMatrixWorld));var b=i.clone().multiply(s).multiply(a),x=new o.Matrix4;x.extractRotation(d);var C=new o.Matrix4;C.copyPosition(d);var E=C.clone().invert().multiply(d),y=x.clone().invert().multiply(E),I=r,B=new o.Matrix4;if(0===p)B.copy(x).multiply(b).multiply(y).multiply(I);else if(1===p)B.copy(x).multiply(y).multiply(b).multiply(I);else{var w=(new o.Matrix4).scale((new o.Vector3).setFromMatrixScale(A)).clone().invert(),S=y.clone().multiply(w);B.copy(x).multiply(b).multiply(S).multiply(I)}var D=c.clone().invert(),P=n.clone().invert(),T=t.clone().multiply(h).multiply(c).multiply(i).multiply(s).multiply(a).multiply(D).multiply(l).multiply(n).multiply(r).multiply(P),R=(new o.Matrix4).copyPosition(T),Q=d.clone().multiply(R);return u.copyPosition(Q),(T=u.clone().multiply(B)).premultiply(d.invert()),T}function getEulerOrder(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function parseNumberArray(e){return e.split(",").map((function(e){return parseFloat(e)}))}function convertArrayBufferToString(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,i))}var je={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},He={OFF:0,LOW:1,MEDIUM:2,HIGH:3},Ve={SKY:0,SCENE:1,PARTICLES:5,GLOW:6,GLOW_MASK:7},We={OFF:0,VAPOR:1},Ke={FLOOR:0,WALL:1,WALL_TOP:2,CEILING:3,PORTAL_WARP:4,ROOM_WARP:5,ITEM:6,SCRIPTED:7,HOVERABLE:8,CLICKABLE:9},ze={FRONT:0,BACK:1,DOUBLE:2},qe={MOVE:0,MOVE_X:1,MOVE_Y:2,LOOK:3,LOOK_X:4,LOOK_Y:5,JUMP:6,RUN:7,ACTION:8,ACTION_ALT:9,ITEM:10,MENU:11,PAUSE:12,MAP:13},Ye={REGION:0,DRAG_REGION:1,BUTTON:2,THUMBSTICK:3,SLIDER:4,IMAGE:5,TEXT:6},Je={NONE:0,CLICK:1,HOVER:2,ACTIVE:3,DRAG:4,DROP:5},Xe={DEFAULT:0,BLENDED:1},pxlEnums={VERBOSE_LEVEL:je,FRAMEWORK:{REACT:0,NEXT:1,NATIVE:2},FILE_TYPE:{AUTO:-1,JPG:0,JPEG:0,PNG:1,WEBP:2,FBX:3,GLTF:4,GLB:5},ANTI_ALIASING:He,RENDER_LAYER:Ve,SKY_HAZE:We,SHADOW_MAP:{OFF:0,BASIC:1,SOFT:2},CAMERA_EVENT:{MOVE:0,ROTATE:1,JUMP:2,FALL:3,LANDED:4,COLLISION:5},COLLIDER_TYPE:Ke,GEOMETRY_SIDE:ze,COLOR_SHIFT:{KEEP:0,sRGB_TO_LINEAR:1,LINEAR_TO_sRGB:2,WINDOWS_TO_UNIX:3,UNIX_TO_WINDOWS:4,LINEAR_TO_WINDOWS:5,WINDOWS_TO_LINEAR:6,LINEAR_TO_UNIX:7,UNIX_TO_LINEAR:8},USER_SPEED:{STOP:0,SLOW:1,BASE:2,BOOST:3},DEVICE_TYPE:{KEYBOARD:0,MOBILE:1,GAMEPAD:2,XR:3,VR:3,AR:3,HMD:3,OTHER:4},DEVICE_EVENT:{CONNECT:0,DISCONNECT:1,BUTTON_PRESS:2,AXIS_MOVE:3,AXIS_LOOK:4},DEVICE_BUTTON:{B_L:0,B_U:1,B_R:2,B_D:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,START:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},DEVICE_ACTION:qe,HUD_ELEMENT:Ye,HUD_ACTION:Je,HUD_DRAW:Xe};function createFBXLoader(e){return new FBXLoader(e)}class FileIO{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlEnums=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.pxlColliders=null,this.verbose=!1,this.pxlOptions={},this.runDebugger=!1,this.assetRoot=this.findInDict(e,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(e,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(e,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(e,"vidRoot","images/screenContent/"),this.workerList=[],this.oneTwoPFour=1/2.4,this.twelvePNineTwoDiv=1/12.92,this.onePOFiveFiveDiv=1/1.055}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlQuality=pxlNav.pxlQuality,this.pxlEnums=pxlNav.pxlEnums,this.pxlVideo=pxlNav.pxlVideo,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlUser=pxlNav.pxlUser,this.pxlEnv=pxlNav.pxlEnv,this.pxlAnim=pxlNav.pxlAnim,this.pxlDevice=pxlNav.pxlDevice,this.pxlShaders=pxlNav.pxlShaders,this.pxlColliders=pxlNav.pxlColliders,this.pxlOptions=pxlNav.pxlOptions,this.verbose=this.pxlOptions.verbose}setLogging(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.runDebugger=e}log(){if(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG){console.log("---");for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.log(e)}))}}warn(){if(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.warn(e)}))}}debug(){if(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.log(e)}))}}toggleDebugger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=!this.runDebugger),this.runDebugger=e}findInDict(e,t,i){return e.hasOwnProperty(t)?e[t]:(e[t]=i,i)}convertVertColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pxlEnums.COLOR_SHIFT.KEEP;if(e.geometry&&e.geometry.attributes&&e.geometry.attributes.color){for(var i=e.geometry.attributes.color,s=0;s<i.count;++s){var a=(new o.Color).fromBufferAttribute(i,s);this.pxlUtils.convertColor(a,t),i.setXYZ(s,a.r,a.g,a.b)}i.needsUpdate=!0}}checkForUserData(e,t,i){if(i.hasOwnProperty("userData")){if(i.hasOwnProperty("material")&&(i.userData.hasOwnProperty("doubleSided")&&i.userData.doubleSided?i.material.side=o.DoubleSide:i.material.side=o.FrontSide),i.userData.hasOwnProperty("pSystem")&&i.userData.pSystem){var s=this.pSystemBuild(i,e);s&&(e.pSystemList||(e.pSystemList={}),e.pSystemList[i.name]=s,t.add(s),i.parent.remove(i),i=s)}if(i.userData.hasOwnProperty("GlowPass")&&i.userData.GlowPass&&(e.geoList.GlowPass||(e.geoList.GlowPass=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW),e.geoList.GlowPass.push(i)),i.userData.hasOwnProperty("GlowPassMask")&&i.userData.GlowPass&&(e.geoList.GlowPassMask||(e.geoList.GlowPassMask=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW_MASK),e.geoList.GlowPassMask.push(i)),i.userData.hasOwnProperty("castShadow")&&i.userData.castShadow&&(i.castShadow=!0),i.userData.hasOwnProperty("receiveShadow")&&i.userData.receiveShadow&&(i.receiveShadow=!0),i.userData.hasOwnProperty("Shader")&&""!==i.userData.Shader&&(e.shaderGeoList||(e.shaderGeoList={}),e.shaderGeoList[i.name]=i),i.userData.hasOwnProperty("Emitter")&&""!==i.userData.Emitter&&(e.emitterList||(e.emitterList={}),e.emitterList[i.userData.Emitter]||(e.emitterList[i.userData.Emitter]={},e.emitterList[i.userData.Emitter].Emitter=[],e.emitterList[i.userData.Emitter].Particles=[]),e.emitterList[i.userData.Emitter].Emitter.push(i)),i.userData.hasOwnProperty("Hover")&&i.userData.Hover&&(e.hasHoverables=!0,e.hoverableList.push(i)),i.userData.hasOwnProperty("Click")&&i.userData.Click&&(e.hasClickables=!0,e.clickableList.push(i)),this.checkObjectInstancing(e,t,i),i.userData.hasOwnProperty("Scripted"))e.geoList.hasOwnProperty("Scripted")||(e.geoList.Scripted={}),e.geoList.Scripted[i.name]=i,i.children.forEach((s=>{if(s.name.includes("Geo")){var a=i.position,r=i.rotation,n=i.scale;s.position.set(a.x,a.y,a.z),s.rotation.set(r.x,r.y,r.z),s.scale.set(n.x,n.y,n.z),s.updateMatrix(),s.children.forEach((i=>{this.checkForColorSpace(e,i),this.checkForUserData(e,t,i),"Group"===i.type&&(i.position.set(a.x+i.position.x,a.y+i.position.y,a.z+i.position.z),i.rotation.set(r.x,r.y,r.z),i.scale.set(n.x,n.y,n.z)),i.updateMatrix()}))}else if(s.name.includes("Colliders")){var o=i.position,l=i.rotation,h=i.scale;s.position.set(o.x,o.y,o.z),s.rotation.set(l.x,l.y,l.z),s.scale.set(h.x,h.y,h.z),s.updateMatrix(),s.visible=!1}}))}}checkForColorSpace(e,t){if("Mesh"===t.type);}checkForMeshSettings(e,t){t.hasOwnProperty("meshSettings")&&(t.meshSettings.hasOwnProperty("frontSided")&&(e.side=t.meshSettings.frontSided?o.FrontSide:o.BackSide),t.meshSettings.hasOwnProperty("doubleSided")&&(e.side=t.meshSettings.doubleSided?o.DoubleSide:o.FrontSide),t.meshSettings.hasOwnProperty("renderOrder")&&(e.renderOrder=t.meshSettings.renderOrder),t.meshSettings.hasOwnProperty("castShadow")&&(e.castShadow=t.meshSettings.castShadow),t.meshSettings.hasOwnProperty("receiveShadow")&&(e.receiveShadow=t.meshSettings.receiveShadow))}canAppendChildren(e,t){if("Group"!==t.type)return!1;var i=!0;return e.geoList.hasOwnProperty("Scripted")&&e.geoList.Scripted.hasOwnProperty(t.name)&&(i=!1),i}canAddToScene(e,t){var i=!0;return t.hasOwnProperty("userData")&&(t.userData.hasOwnProperty("Instance")||t.userData.hasOwnProperty("MobileInstance"))&&e.hasOwnProperty("baseInstancesNames")&&e.baseInstancesNames.hasOwnProperty(t.userData.Instance)&&(i=!1),i}checkIsGlassLiquid(e,t,i,s){var a=!1;if(i.userData.hasOwnProperty("isGlass")&&i.userData.isGlass&&(a=!0),i.userData.hasOwnProperty("isLiquid")&&i.userData.isLiquid&&(a=!0),!a)return!1;if(this.log("Glass Detected - ",i.name),!e.glassGroup){var r=new o.Group;e.glassGroup=r,t.add(r)}var n=i.material.clone();i.material=n,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=.5*i.material.specular.r+.1,i.material.specular.g=.5*i.material.specular.g+.1,i.material.specular.b=.5*i.material.specular.b+.1,i.material.side=o.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1+e.glassList.length,e.glassList.push(i),e.glassGroup.add(i);var l=i.geometry.clone(),h=i.material.clone();h.copy(i.material);var c=new o.Mesh(l,h);c.name=i.name+"_Front",c.material.shininess=40,c.material.side=o.FrontSide,c.matrixAutoUpdate=!1,c.renderOrder=1+e.glassList.length;var d=i.position,A=i.rotation,u=i.scale;return c.rotation.set(A.x,A.y,A.z),c.position.set(d.x,d.y,d.z),c.scale.set(u.x,u.y,u.z),c.updateMatrix(),i.parent.add(c),e.glassList.push(c),e.glassGroup.add(c),a}checkObjectInstancing(e,t,i){if(!e.hasOwnProperty("baseInstancesNames")||!e.hasOwnProperty("baseInstancesList"))return!1;if(!i.hasOwnProperty("userData")||!i.userData.hasOwnProperty("Instance")&&!i.userData.hasOwnProperty("MobileInstance"))return!1;if(!e.baseInstancesList.hasOwnProperty(i.userData.Instance))return this.warn("Instance '".concat(i.userData.Instance,"' not found for ").concat(i.name)),!1;var s=i.name;this.log("Generate Instance - ",s),e.geoList.hasOwnProperty("InstanceObjects")||(e.geoList.InstanceObjects={});var a=new RegExp(/(instlod)\d+/,"i"),r=new RegExp(/\d+/,"i"),n=new RegExp(/(instlod)\d+(dist)/,"i"),l=new RegExp(/(instlod)\d+(skip)/,"i"),h={lod0:{mesh:i,dist:1}},c={mesh:i,instMesh:null,dist:1,skip:0},d=!1,A={};try{Object.keys(i.userData).forEach((e=>{if(a.test(e)){var t=r.exec(e);if(!t||t.length<1)return;t=parseInt(t[0]);var s={};if(A.hasOwnProperty(t)||(A[t]=Object.assign({},c)),s=A[t],n.test(e)){var o=i.userData[e];s.dist=o}else if(l.test(e)){var h=i.userData[e];s.skip=h}else s.instMesh=i.userData[e]}}))}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}for(var u=i.children,p=0;p<u.length;++p)if(u[p].hasOwnProperty("userData"))for(var m=u[p].userData,g=0;g<m.length;++g){var v=m[g],f=a.test(v),b=Object.assign({},c);if(f){var x=r.exec(v);A.hasOwnProperty(x)&&(b=A[x])}if(n.test(v)){var C=m[v];b.dist=C}else if(l.test(v)){var E=m[v];b.skip=E}else b.instMesh=m[v]}var y=Object.keys(h);try{d;for(var I=0;I<y.length;++I){var B=h[y[I]].mesh,w=B.position,S=B.rotation,D=B.scale,P=this.pxlOptions.mobile&&B.userData.hasOwnProperty("MobileInstance")?B.userData.MobileInstance:B.userData.Instance,T=e.baseInstancesList[P];if("Mesh"===B.type){var R=new o.Matrix4,Q=new o.Vector3,k=new o.Vector3,L=new o.Quaternion,M=new o.Vector3(1,1,1),F=B.geometry.attributes.hasOwnProperty("color"),O=Object.keys(B.userData),G=O.map((e=>e.toLowerCase())),_=!1,U=0,N=1;G.includes("minscale")&&(_=!0,U=B.userData[O[G.indexOf("minscale")]]),G.includes("maxscale")&&(_=!0,N=B.userData[O[G.indexOf("maxscale")]]);for(var j={},H=[],V=0;V<B.geometry.attributes.position.count;++V){Q.fromBufferAttribute(B.geometry.attributes.position,V);var W=Q.toArray();if(W=this.pxlUtils.flattenArrayToStr(W),!j.hasOwnProperty(W)){if(B.geometry.attributes.normal){k.fromBufferAttribute(B.geometry.attributes.normal,V);var K=k.clone();K=K.cross(new o.Vector3(0,1,0)).cross(K).normalize(),L.setFromUnitVectors(k,K)}else{var z=new o.Vector3(Math.random(),.1*Math.random(),Math.random()).normalize();k.copy(z);var q=new o.Vector3(0,1,0).cross(z).normalize();L.setFromUnitVectors(z,q)}var Y=M;if(F){var J=B.geometry.attributes.color.getX(V);_&&(J=U+(N-U)*J),Y=new o.Vector3(J,J,J)}R.compose(Q,L,Y),H.push(R.clone()),j[W]=!0}}if(H.length>0){var X=new o.InstancedMesh(T.geometry,T.material,H.length);X.instanceMatrix.setUsage(o.DynamicDrawUsage),X.userData=Object.assign({},B.userData),X.userData.pxlInstanceToMesh=!0,this.checkForMeshSettings(X,T.material);for(var Z=0;Z<H.length;++Z)X.setMatrixAt(Z,H[Z]);X.visible=!0,X.position.set(w.x,w.y,w.z),X.rotation.set(S.x,S.y,S.z),X.scale.set(D.x,D.y,D.z),X.updateMatrix(),X.name=s+"Geo",e.geoList.InstanceObjects[s]=X,B.parent.add(X),B.visible=!1}}else{var $=new o.InstancedMesh(T.geometry,T.material,1);$.instanceMatrix.setUsage(o.DynamicDrawUsage),$.userData=Object.assign({},B.userData),$.userData.pxlInstanceToMesh=!1,this.checkForMeshSettings($,T.material);var ee=!1;if(B.userData.hasOwnProperty("fixInstMatrix")&&(ee=!!B.userData.fixInstMatrix),ee)$.rotation.set(S.x,S.y,S.z),$.position.set(w.x,w.y,w.z),$.scale.set(D.x,D.y,D.z);else{var te=new o.Matrix4;te.compose(w,(new o.Quaternion).setFromEuler(S),D),$.setMatrixAt(0,te)}$.visible=!0,$.updateMatrix(),$.name=s+"Geo",e.geoList.InstanceObjects[s]=$,B.parent.add($),B.visible=!1,B.parent.remove(B)}}}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}this.verbose,this.pxlEnums.VERBOSE_LEVEL.DEBUG}pSystemBuild(e,t){if(!e.hasOwnProperty("userData")||!e.userData.hasOwnProperty("pSystem")||!e.userData.pSystem)return null;this.log("Processing Particle System - ",e.name);try{var i=e;if("Mesh"===i.type){var s=new o.Vector3,a=i.geometry.attributes.hasOwnProperty("color"),r=Object.keys(i.userData),n=r.map((e=>e.toLowerCase())),l=!1,h=0,c=1;n.includes("minscale")&&(l=!0,h=i.userData[r[n.indexOf("minscale")]]),n.includes("maxscale")&&(l=!0,c=i.userData[r[n.indexOf("maxscale")]]);for(var d={},A=[],u=i.geometry.attributes.hasOwnProperty("color"),p=[],m=0;m<i.geometry.attributes.position.count;++m){s.fromBufferAttribute(i.geometry.attributes.position,m);var g=s.toArray();if(g=this.pxlUtils.flattenArrayToStr(g),!d.hasOwnProperty(g)){if(u&&(p.push(i.geometry.attributes.color.getX(m)),p.push(i.geometry.attributes.color.getY(m)),p.push(i.geometry.attributes.color.getZ(m))),a){var v=i.geometry.attributes.color.getX(m);l&&(v=h+(c-h)*v)}A.push(s.x),A.push(s.y),A.push(s.z),d[g]=!0}}if(A.length>0){var f=new o.Float32BufferAttribute(A,3),b=new o.BufferGeometry;b.setAttribute("position",f),b.userData=Object.assign({},i.userData),b.userData.pSystem=!0;var x=new o.Vector3(0,0,0);return x.equals(i.position)||(b.userData.pPosition=i.position),x.equals(i.rotation)||(b.userData.pRotation=i.rotation),x.equals(i.scale)||(b.userData.pScale=i.scale),b.computeBoundingBox(),b.computeBoundingSphere(),t.particleList[i.name]=b,void i.parent.remove(i)}}}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}}loadSceneFBX(e,t,i,s,a,r){""!==a&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[a]=0);var n=createFBXLoader();return n.load(e,(e=>{var t=e.children,i={},s=[];t.forEach(((e,t)=>{var a=e.name.toLowerCase();s.push(a),i[a]=t})),s.forEach((e=>{e.includes("camera")&&(t[i[e]].children.forEach(((e,t)=>{if(e.matrixAutoUpdate=!1,e.name.includes("position")){var i=e.position.clone();this.pxlCamera.cameraPrevPos=i.clone(),this.pxlCamera.camera.position.copy(i),this.pxlCamera.cameraPos.copy(i),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=i,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(i.clone())}else if(e.name.includes("lookat")){var s=e.position.clone();this.pxlCamera.cameraAimTarget.position.copy(s),this.pxlCamera.camera.lookAt(s),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new o.Vector3,this.pxlEnv.camInitLookAt=s,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(s.clone())}else if(e.name.includes("returnposition")){var a=e.position.clone();this.pxlEnv.camReturnPos=a}else if(e.name.includes("returnlookat")){var r=e.position.clone();this.pxlEnv.camReturnLookAt=r}})),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone());if(e.includes("Items"))for(var s=t[i[e]].children,a=null,n=null,l=null,h=null,processChildren=(e,t)=>{e.forEach((e=>{e.name.includes("Item")?(t.includes("LowGravity")?(null==n&&(n=new o.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:o.DoubleSide,depthTest:!0,depthWrite:!1})),e.material=n):t.includes("LizardKing")?(null==l&&((l=e.material.clone()).emissiveMap=l.map,l.emissive=new o.Color(8421504)),e.material=l):t.includes("StarField")||t.includes("InfinityZoom")&&(null==h&&(h=new o.ShaderMaterial({uniforms:{color:{value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:o.DoubleSide,depthTest:!0,depthWrite:!0})),e.material=h),this.pxlUser.itemList[t]=e):e.name.includes("ItemBase")&&(null==a&&(a=new o.ShaderMaterial({uniforms:{color:{value:e.material.emissive.clone()},alphaMap:{type:"t",value:e.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:o.DoubleSide,depthTest:!0,depthWrite:!1})),e.material=a,this.pxlUser.itemBaseList.push(e))}))};s.length>0;){var c=s.pop();if("Group"===c.type)processChildren(c.children,c.name),r[0].add(c),this.pxlUser.itemGroupList[c.name]=c,this.pxlUser.itemListNames.push(c.name)}})),""!==a&&(this.pxlEnv.geoList[a]=e,this.pxlEnv.geoLoadList[a]=1),this.pxlEnv.geoLoadList[a]=1}),void 0,(e=>{""!==a&&(this.pxlEnv.geoLoadList[a]=1)})),n}getSettings(){return{fileType:this.pxlEnums.FILE_TYPE.AUTO,filePath:"",meshKey:"",meshIsChild:!1,enableLogging:!1}}readSettings(e,t){var i=Object.assign(this.getSettings(),t);if(this.setLogging(i.enableLogging),null!==i.filePath&&""!==i.filePath||!e.hasOwnProperty("sceneFile")||(i.filePath=e.sceneFile),null===i.filePath||""===i.filePath)return this.warn("No Path Provided for Environment Load"),i.filePath=null,i;if(i.fileType===this.pxlEnums.FILE_TYPE.AUTO||"number"!=typeof i.fileType){var s=i.filePath.split(".").pop().toLowerCase();"fbx"===s?i.fileType=this.pxlEnums.FILE_TYPE.FBX:"glb"===s?i.fileType=this.pxlEnums.FILE_TYPE.GLB:"gltf"===s&&(i.fileType=this.pxlEnums.FILE_TYPE.GLTF)}return""===i.meshKey&&(i.meshKey=e.getName()),i.verified=!0,i}verifySettings(e,t){return t.hasOwnProperty("verified")&&t.verified?t:this.readSettings(e,t)}loadPath(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Object.assign(this.getSettings(),i);null!==t&&""!==t&&(s.filePath=t),null!==(s=this.readSettings(e,s)).filePath&&""!==s.filePath&&this.loadRoom(e,s)}loadRoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.readSettings(e,t);if(null!==i.filePath&&""!==i.filePath){var s=i.fileType;s===this.pxlEnums.FILE_TYPE.FBX?this.loadRoomFBX(e,i):s!==this.pxlEnums.FILE_TYPE.GLB&&s!==this.pxlEnums.FILE_TYPE.GLTF||this.loadRoomGLTF(e,i)}}loadRoomGLTF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((t=this.readSettings(e,t)).filePath){var i=new GLTFLoader,s=new DRACOLoader;s.setDecoderPath("https://threejs.org/examples/jsm/libs/draco/"),s.preload(),i.setDRACOLoader(s);var a=i;a.setMeshoptDecoder(ae);var r=new KTX2Loader;r.setTranscoderPath("https://threejs.org/examples/jsm/libs/basis/"),r.detectSupport(this.pxlEnv.engine),a.setKTX2Loader(r),this.loadRoomFile(a,e,t)}}loadRoomFBX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((t=this.readSettings(e,t)).filePath){var i=createFBXLoader();this.loadRoomFile(i,e,t)}}loadRoomFile(e,t){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((s=this.verifySettings(t,s)).filePath){var a=s.meshKey,r=s.filePath,n=t.materialList;this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[a]=0;var l=t.scene;return e.load(r,(e=>{e.hasOwnProperty("scenes")&&!e.hasOwnProperty("children")&&(e=e.scene);var s=e.children;if(1===s.length){var r=s[0];r.name.toLowerCase().includes("scene")||(s=r.children)}var h={},c=[];if(s.forEach(((e,t)=>{var i=e.name.split("_")[0].toLowerCase();c.push(i),h[i]=t})),c.indexOf("camera")>-1){var d=[];this.log("Camera - ",s[h.camera]);var A=t.defaultCamLocation;s[h.camera].userData.hasOwnProperty("DefaultCam")&&(A=s[h.camera].userData.DefaultCam,t.defaultCamLocation=A),s[h.camera].children.forEach(((e,t)=>{var i=e.name.toLowerCase();i.includes("position")||i.includes("lookat")||i.includes("returnposition")||i.includes("returnlookat")?d.push(e):e.children.length>0&&d.push(...e.children)})),d.forEach(((e,i)=>{e.matrixAutoUpdate=!1;var a=e.parent.name.toLowerCase();a===s[h.camera].name.toLowerCase()&&(a="default"),t.camLocation.hasOwnProperty(a)||(t.camLocation[a]={},t.camLocation[a].position=new o.Vector3(0,0,-10),t.camLocation[a].lookat=new o.Vector3(0,0,0));var r=e.name.toLowerCase();if(r.includes("positionmobile")){var n=e.position.clone();t.cameraBooted=!0,t.camInitPos=n,t.camLocation[a].positionmobile=n}else if(r.includes("lookatmobile")){var l=e.position.clone();t.camInitLookAt=l,t.camLocation[a].lookatmobile=l}else if(r.includes("position")){var c=e.position.clone();t.cameraBooted=!0,t.camInitPos=c,t.camLocation[a].position=c}else if(r.includes("lookat")){var d=e.position.clone();t.camInitLookAt=d,t.camLocation[a].lookat=d}else if(r.includes("returnposition")){var A=e.position.clone();t.camReturnPos=A,t.camLocation[a].returnposition=A}else if(r.includes("returnlookat")){var u=e.position.clone();t.camReturnLookAt=u,t.camLocation[a].returnlookat=u}})),Object.keys(t.camLocation).forEach((e=>{var i=t.camLocation[e];i.hasOwnProperty("positionmobile")||(i.positionmobile=i.position),i.hasOwnProperty("lookatmobile")||(i.lookatmobile=i.lookat)}))}if(c.indexOf("AutoCamPaths")>-1){var u=s[h.AutoCamPaths].children;this.log("AutoCamPaths - ",s[h.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[t.getName()]=[];for(var p=function _loop(){var e=u.pop();if("Group"===e.type){var s={};e.children.forEach((e=>{e.matrixAutoUpdate=!1,s[e.name]=e})),e.visible=!1,e.matrixAutoUpdate=!1,l.add(e),i.pxlAutoCam.autoCamPaths[t.getName()].push(s)}};u.length>0;)p()}if(c.indexOf("instances")>-1&&0===this.pxlQuality.detailLimit){var m=[...s[h.instances].children];this.log("Instances - ",s[h.instances]),m.length>0&&(t.hasOwnProperty("baseInstancesNames")||(t.baseInstancesNames=[]),t.hasOwnProperty("baseInstancesList")||(t.baseInstancesList={}),m.forEach(((e,i)=>{if(this.checkForColorSpace(t,e),this.checkForUserData(t,l,e),n.hasOwnProperty(e.name)){var s=null;e.material.map&&(s=e.material.map),e.material=n[e.name],this.checkForMeshSettings(e,e.material),s&&(e.material.uniforms.hasOwnProperty("diffuse")&&(e.material.uniforms.diffuse.value=s),e.material.hasOwnProperty("emissiveMap")&&(e.material.emissiveMap=s,e.material.emissive.r>0&&(e.material.emissiveIntensity=e.material.emissive.r))),e.matrixAutoUpdate=!1}t.baseInstancesNames.push(e),t.baseInstancesList[e.name]=e})))}if(c.indexOf("lights")>-1){var g=s[h.lights].children;for(this.log("Lights - ",s[h.lights]);g.length>0;){var v=g.pop();g.push(...v.children),v.type.includes("Light")&&(t.hasOwnProperty("lightList")||(t.lightList={}),t.geoList.hasOwnProperty("lights")||(t.geoList.lights=[]),"PointLight"===v.type&&(v.decay=Math.max(1.1,Math.min(3,v.intensity)),v.distance=0===v.distance?1e3*v.intensity:v.distance),t.lightList.hasOwnProperty(v.type)||(t.lightList[v.type]=[]),t.lightList[v.type].push(v),t.geoList.lights.push(v),v.matrixAutoUpdate=!1,l.add(v))}}if(c.includes("scene")||c.includes("mainscene")){var f=h.scene||h.mainscene,b=[...s[f].children];this.log("MainScene - ",s[f]);for(var x=function _loop2(){var e=b.pop();if(i.log("Cur Object - ".concat(e.name)),i.debug(e),i.checkForColorSpace(t,e),i.checkForUserData(t,l,e),e.isMesh){!e.userData.hasOwnProperty("Show")||e.userData.Show&&0!==e.userData.Show||(e.visible=!1),e.layers.set(i.pxlEnums.RENDER_LAYER.SCENE),t.geoList[e.name]=e;var s=o.FrontSide;if((e.userData.hasOwnProperty("doubleSided")||e.userData.hasOwnProperty("DoubleSided"))&&(s=o.DoubleSide),(e.userData.hasOwnProperty("scripted")||e.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[e.name]=e),n.hasOwnProperty(e.name)){var a=null;e.material.map&&(a=e.material.map),e.material=n[e.name],i.checkForMeshSettings(e,e.material),a&&(e.material.uniforms.hasOwnProperty("diffuse")&&(e.material.uniforms.diffuse.value=a),e.material.hasOwnProperty("emissiveMap")&&(e.material.emissiveMap=a,e.material.emissive.r>0&&(e.material.emissiveIntensity=e.material.emissive.r))),e.matrixAutoUpdate=!1}else{var r=e.material;Array.isArray(e.material)||(r=[e.material]),i.checkIsGlassLiquid(t,l,e,r)||r.forEach((e=>{e.map&&!e.emissiveMap&&e.emissive.r>0&&(e.emissiveMap=e.map,e.emissiveIntensity=e.emissive.r,e.emissive=new o.Color(16777215)),e.side=s})),e.matrixAutoUpdate=!1}}else if(e.type.includes("Light"))t.lightList.hasOwnProperty(e.type)||(t.lightList[e.type]=[]),t.lightList[e.type].push(e);else if("Group"===e.type){(e.userData.hasOwnProperty("scripted")||e.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[e.name]=e),b.push(...e.children)}};b.length>0;)x();l.add(...s[f].children)}if(c.indexOf("glass")>-1){var C=s[h.glass].children;if(this.log("Glass - ",s[h.glass]),C.length>0){if(!t.glassGroup){var E=new o.Group;t.glassGroup=E,l.add(E)}for(;C.length>0;){var y=C.pop();if(C.push(...y.children),y.isMesh){this.checkForColorSpace(t,y),this.checkForUserData(t,l,y);var I=y.material.clone();y.material=I,y.material.transparent=!0,y.material.opacity=.5,y.material.shininess=20,y.material.specular=y.material.color.clone(),y.material.specular.r=.5*y.material.specular.r+.1,y.material.specular.g=.5*y.material.specular.g+.1,y.material.specular.b=.5*y.material.specular.b+.1,y.material.side=o.BackSide,y.material.depthWrite=!1,y.matrixAutoUpdate=!1,y.renderOrder=1,t.glassList.push(y),t.glassGroup.add(y);var B=y.geometry.clone(),w=y.material.clone();w.copy(y.material);var S=new o.Mesh(B,w);S.material.shininess=40,S.material.side=o.FrontSide,S.matrixAutoUpdate=!1,S.renderOrder=2;var D=y.position,P=y.rotation,T=y.scale;S.rotation.set(P.x,P.y,P.z),S.position.set(D.x,D.y,D.z),S.scale.set(T.x,T.y,T.z),S.updateMatrix(),l.add(S),t.glassList.push(S),t.glassGroup.add(S)}}}}if(c.indexOf("colliders")>-1){var R=s[h.colliders];this.log("Colliders - ",s[h.colliders]);var Q=R.children;t.collidersExist=Q.length>0;for(var k=0;k<Q.length;++k)for(var L=Q[k].name.toLowerCase(),M=Q[k].children;M.length>0;){var F=M.pop();M.push(...F.children),F.isMesh&&(F.visible=!1,"colliderwalls"===L?(t.antiColliderActive=!0,t.antiColliderList.push(F)):"collidertops"===L?(t.antiColliderTopActive=!0,t.antiColliderTopList.push(F)):("roomwarpzone"===L&&(t.hasRoomWarp=!0,t.roomWarp.push(F)),t.colliderActive=!0,t.colliderList.push(F)),F.matrixAutoUpdate=!1,l.add(F),t.geoList[F.name]=F)}t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.FLOOR)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.FLOOR):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL_TOP)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL_TOP):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.ROOM)&&this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.ROOM)}if(c.indexOf("portalexit")>-1){var O=s[h.portalexit].children;for(this.log("PortalExit - ",s[h.portalexit]);O.length>0;){var G=O.pop();G.matrixAutoUpdate=!1,t.hasPortalExit=!0,t.portalList[G.name]=G}}if(c.indexOf("flatcolor")>-1){var _=s[h.flatcolor].children;for(this.log("FlatColor - ",s[h.flatcolor]);_.length>0;){var U=_.pop();if(_.push(...U.children),U.isMesh){this.checkForColorSpace(t,U),this.checkForUserData(t,l,U);var N=new o.MeshBasicMaterial({color:U.material.color.clone()});N.side=o.FrontSide,N.flatShading=!0,U.material=N,U.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),U.matrixAutoUpdate=!1,l.add(U)}}}if(c.indexOf("lambertcolor")>-1){var j=s[h.lambertcolor].children;for(this.log("LambertColor - ",s[h.lambertcolor]);j.length>0;){var H=j.pop();if(j.push(...H.children),H.isMesh){this.checkForColorSpace(t,H),this.checkForUserData(t,l,H);var V=new o.MeshLambertMaterial;if(H.material.map){var W=H.material.map.clone();V.map=W,H.material=V}else V.color=H.material.color.clone(),V.side=o.FrontSide,V.flatShading=!0,H.material=V;H.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),H.matrixAutoUpdate=!1,l.add(H)}}}if(c.indexOf("sky")>-1){var K=s[h.sky].children;for(this.log("Sky - ",s[h.sky]);K.length>0;){var z=K.pop();if(K.push(...z.children),z.isMesh){var q,Y,J,X=null;n.hasOwnProperty(z.name)?(X=n[z.name],this.checkForMeshSettings(z,X)):X=new o.ShaderMaterial({uniforms:{diffuse:{type:"t",value:z.material.map},noiseTexture:{type:"t",value:null},fogColor:{value:l.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:t.camera.near},camFar:{type:"f",value:.85*t.camera.far},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag(this.pxlOptions.skyHaze)}),z.material=X,z.matrixAutoUpdate=!1,z.frustumCulled=!1,z.layers.set(this.pxlEnums.RENDER_LAYER.SKY),z.material.depthTest=!0,z.material.depthWrite=!1,null!==(q=z.material)&&void 0!==q&&q.uniforms.hasOwnProperty("noiseTexture")&&null!=t&&t.cloud3dTexture&&(z.material.uniforms.noiseTexture.value=t.cloud3dTexture),null!==(Y=z.material)&&void 0!==Y&&Y.uniforms.hasOwnProperty("depthTexture")&&null!=l&&null!==(J=l.renderTarget)&&void 0!==J&&J.depthTexture&&(z.material.uniforms.envDiffuse.value=l.renderTarget.depthTexture),t.geoList[z.name]=z,t.materialList[z.name]=X,l.add(z)}}}if(c.indexOf("animatedtextures")>-1){var Z=s[h.animatedtextures].children;for(this.log("AnimatedTextures - ",s[h.animatedtextures]);Z.length>0;){var $=Z.pop();if(Z.push(...$.children),$.isMesh){this.checkForColorSpace(t,$),this.checkForUserData(t,l,$);var ee={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:$.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new o.Vector3(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},te=this.pxlShaders.animated.animTextureVert(),ie=this.pxlShaders.animated.animTextureFrag(),se=new o.ShaderMaterial({uniforms:ee,vertexShader:te,fragmentShader:ie,transparent:!0,side:o.FrontSide});$.material=se,$.matrixAutoUpdate=!1,l.add($)}}}if(c.indexOf("scrollingtextures")>-1){var ae=s[h.scrollingtextures].children;this.log("ScrollingTextures - ",s[h.scrollingtextures]);for(var re=1;ae.length>0;){re+=1;var ne=ae.pop();if(ae.push(...ne.children),ne.isMesh){this.checkForColorSpace(t,ne),this.checkForUserData(t,l,ne);var oe=ne.name,le=.05;oe.indexOf("_")>-1&&(le=oe.split("_")[1],le=.01*parseInt(le));var he=new o.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:ne.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:le},seed:{type:"f",value:1.1423*re},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:o.FrontSide});ne.material=he,ne.matrixAutoUpdate=!1,l.add(ne)}}}if(c.indexOf("userscreens")>-1){var ce=s[h.userscreens].children;this.log("UserScreens - ",s[h.userscreens]);for(var de=0,Ae=[new o.Vector3(1,0,0),new o.Vector3(0,1,0),new o.Vector3(0,0,1)],ue=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],pe=0,me=0,ge=Ae.length;ce.length>0;){var ve=ce.pop();if(ce.push(...ve.children),ve.isMesh){var fe=new o.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:1.1423*de},alpha:{type:"f",value:1},boostPerc:{value:t.userScreenIntensity},scale:{value:new o.Vector2(100,100)},ratio:{value:new o.Vector2(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:Ae[pe]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(ue[me])}},vertexShader:t.userScreenVert,fragmentShader:t.userScreenFrag,transparent:!0,side:o.FrontSide});ve.material=fe,ve.matrixAutoUpdate=!1,t.pxlEnv.camScreenData.screenGeoList.push(ve),l.add(ve),pe=(de+=1)%ge,me=Math.floor(de/3)%ge}}}if(c.indexOf("items")>-1){var be=s[h.items].children;this.log("Items - ",s[h.items]);for(var xe=function _loop3(){var e=be.pop();if("Group"===e.type){var t=e.children;t.length>0&&(t.forEach((t=>{if(t.name.includes("Item")){var s=new o.ShaderMaterial({uniforms:{color:{value:t.material.emissive.clone()},alphaMap:{type:"t",value:t.material.map},cloudNoise:{type:"t",value:i.cloud3dTexture},time:{value:i.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:i.pxlUser.itemRotateRate}},vertexShader:i.pxlShaders.objects.itemVert(),fragmentShader:i.pxlShaders.objects.itemFrag(),transparent:!0,side:o.DoubleSide,depthTest:!0,depthWrite:!1});t.material=s,i.pxlUser.itemList[e.name]=t}else if(t.name.toLowerCase().includes("base")){var a=new o.ShaderMaterial({uniforms:{color:{value:t.material.emissive.clone()},alphaMap:{type:"t",value:t.material.map},cloudNoise:{type:"t",value:i.cloud3dTexture},time:{value:i.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:i.pxlUser.itemBaseRotateRate}},vertexShader:i.pxlShaders.objects.itemBaseVert(),fragmentShader:i.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:o.DoubleSide,depthTest:!0,depthWrite:!1});t.material=a,i.pxlUser.itemBaseList.push(t)}})),l.add(e),i.pxlUser.itemGroupList[e.name]=e,i.pxlUser.itemListNames.push(e.name))}};be.length>0;)xe()}if(c.includes("scripted")){var Ce=s[h.scripted].children;for(this.log("Scripted - ",s[h.scripted]);Ce.length>0;){var Ee=Ce.pop();Ee.isMesh&&(t.geoList[Ee.name]=Ee,l.add(Ee))}}if(c.includes("clickable")){var ye=s[h.clickable];this.log("Clickable - ",s[h.clickable]);for(var Ie=ye.children,Be=0;Be<Ie.length;++Be)for(var we=Ie[Be].name,Se=Ie[Be].children;Se.length>0;){var De=Se.pop();if(Se.push(...De.children),De.isMesh)(new o.MeshBasicMaterial).color=new o.Color(16777215),De.material.emissive=new o.Color(4473924),De.material.emissiveMap=De.material.map,De.matrixAutoUpdate=!1,t.objectClickableObjectList[De.name]||(t.objectClickableObjectList[De.name]={}),t.objectClickableObjectList[De.name][we]=De,t.objectClickable.push(De),l.add(De),"Hover"===we&&(De.visible=!1)}}if(c.includes("markers")){var Pe=s[h.markers].children;for(this.log("Markers - ",s[h.markers]);Pe.length>0;){var Te=Pe.pop();t.marker[Te.name]=Te.position}}this.pxlEnv.geoList[a]=e,this.pxlEnv.geoLoadList[a]=1,t.fbxPostLoad(),this.runDebugger=!1}),null,(e=>{s.hasOwnProperty("onError")?s.onError(e):(""!==a&&(this.pxlEnv.geoLoadList[a]=1),this.log("Error Loading FBX"),this.log(e),this.runDebugger=!1)})),e}}loadAnimFBX(e,t,i,s,a){""===t&&(t=e.getName()),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[t]=0;var r=e.scene,n=e.materialList,l=createFBXLoader();return l.load(i,(i=>{var l=i.children,h={},c=[];l.forEach(((e,t)=>{var i=e.name.split("_")[0];c.push(i),h[i]=t})),i.traverse((t=>{if(this.checkForColorSpace(e,t),this.checkForUserData(e,r,t),t.isMesh&&(e.geoList[t.name]=t),n.hasOwnProperty(t.name)){var i=null;t.material.map&&(i=t.material.map),t.material=n[t.name],this.checkForMeshSettings(t,t.material),i&&(t.material.uniforms.hasOwnProperty("diffuse")&&(t.material.uniforms.diffuse.value=i),t.material.hasOwnProperty("emissiveMap")&&(t.material.emissiveMap=i,t.material.emissive.r>0&&(t.material.emissiveIntensity=t.material.emissive.r))),t.matrixAutoUpdate=!1}t.userData.hasOwnProperty("doubleSided")&&t.userData.doubleSided&&(t.material.side=o.DoubleSide)})),this.pxlAnim.initObject(t,i),this.log("Animation FBX - ",c[0]),r.add(i),i.frustumCulled=!1;var d=createFBXLoader(),A=[];Object.keys(s).forEach((e=>{var i=s[e],a=new Promise(((s,a)=>{d.load(i,(a=>{0===a.animations.length&&(this.log("No animations found in file",i),this.log(a),s()),this.pxlAnim.addClips(t,e,a),this.log("Animation Loaded",e),s()}),null,(e=>{this.log("Animation Load Error"),this.log(e),a(e)}))}));A.push(a)})),Promise.all(A).then((()=>{this.pxlAnim.setStateConnections(t,a),e.geoList[t]=i,this.pxlEnv.geoLoadList[t]=1,e.animPostLoad(t)})).catch((e=>{this.log("Error loading animations",e)}))}),null,(e=>{""!==t&&(this.pxlEnv.geoLoadList[t]=1)})),l}pxlShaderBuilder(e,t,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};null!==e&&(r=Object.assign({},r,e));var n={uniforms:r,vertexShader:t,fragmentShader:i};return a&&(n.defines=a),(s=new o.ShaderMaterial(n)).transparent=!0,s.depthTest=!0,s}removeChildren(e){for(var t=0,i=e.children,s=0;s<i.length;++s)"Group"===i[s].type&&(e.remove(i[s]),t++);return t}findMesh(e){for(var t=null,i=e.children,s=0;s<i.length;++s)if("Mesh"===i[s].type){t=i[s];break}return t}getBBoxCentroid(e){try{var t=(new o.Box3).setFromObject(e),i=t.min,s=t.max,a=(new o.Vector3).addVectors(s,i).multiplyScalar(.5);e.userData={bbox:t,centroid:a}}catch(e){this.verbose>=je.ERROR&&(console.log("- - - - - - - - ERROR - - - - - - - -"),console.log("     Object does not exist.\n           - Error Info -"),console.log(e),console.log("- - - - - - - - - - - - - - - - - - -"))}}loadScript(e){return new Promise(((t,i)=>{var s=document.createElement("script");s.type="text/javascript",s.src=e,s.async=!0,s.onreadystatechange=()=>{t(!0)},s.onload=()=>{t(!0)},document.head.appendChild(s)}))}xmlHttp(){if("undefined"!=typeof window&&window.XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof window&&void 0!==window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new Error("No supported XMLHttpRequest implementation found.")}static getURLContent(e){return new Promise(((t,i)=>{var s=null;"undefined"!=typeof window&&window.XMLHttpRequest?s=new XMLHttpRequest:"undefined"!=typeof window&&void 0!==window.ActiveXObject&&(s=new window.ActiveXObject("Microsoft.XMLHTTP")),s.open("GET",e),s.onload=e=>{4===s.readyState&&s.status>=200&&s.status<300?t(s.response):t(s.statusText)},s.onerror=()=>i(s.statusText),s.send()}))}getExternalHTML(e,t){if(window.XMLHttpRequest){var i=this.xmlHttp();i.onreadystatechange=function(){4===this.readyState&&200===this.status&&t&&"function"==typeof t&&t(i.responseText)},i.open("GET",e,!0),i.responceType="document",i.send()}else window.open(e,"_blank")}fetchURLStatus(e,t,i){fetch(e,{method:"HEAD"}).then((e=>{t(e.status,i)})).catch((e=>{t(404,i)}))}urlExistsFallback(e){return new Promise(((t,i)=>{var s=this.xmlHttp();s.open("HEAD",e,!0),s.send(),s.onreadystatechange=function(){this.readyState===this.DONE&&t(this.status<400)},s.onerror=e=>{t(!1)},s.ontimeout=e=>{t(!1)}}))}urlExists(e){return new Promise(((t,i)=>{this.urlExistsFallback(e).then((e=>{t(e)}))})).then((e=>e)).catch((e=>!1))}}function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}var Ze={height:{standing:1.75,stepSize:5},movement:{scalar:1,max:10,easing:.55},look:{pc:{invert:!1},mobile:{invert:!0}},headBounce:{height:.3,rate:.025,easeIn:.03,easeOut:.95},jump:{impulse:.75,holdMax:2.85,repeatDelay:.08},gravity:{ups:.3,max:15.5},deadZone:{controller:.1,touch:20,xr:.1}},pxlOptions={verbose:pxlEnums.VERBOSE_LEVEL.NONE,framework:pxlEnums.FRAMEWORK.NATIVE,fps:{pc:60,mobile:30},renderScale:{pc:1,mobile:1.5},fullLoadPreBoot:!0,staticCamera:!1,autoCamera:!1,allowStaticRotation:!1,userSettings:Object.assign({},Ze),subTickCalculations:!1,pxlRoomRoot:"./pxlRooms",pxlAssetRoot:"./pxlAssets",showOnboarding:!0,onboarding:{pc:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-welcome-message"],buttonText:"close",buttonStyle:["guiButton"]},mobile:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-mobile-body"],buttonText:"start",buttonStyle:["guiButton","pxlGui-mobile-welcomeButton"]}},loaderPhrases:["...loading the pixels..."],antiAliasing:pxlEnums.ANTI_ALIASING.LOW,collisionScale:{gridSize:50,gridReference:1e3},shadowMapBiasing:pxlEnums.SHADOW_MAP.BASIC,loadEnvAssetFile:!1,skyHaze:pxlEnums.SKY_HAZE.OFF,postProcessPasses:{roomGlowPass:!1,mapComposerWarpPass:!1,chromaticAberrationPass:!1,lizardKingPass:!1,starFieldPass:!1,crystallinePass:!1}};function Environment_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function Environment_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){Environment_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){Environment_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}class SVGUtils{static svgPromise(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={},r=document.getElementById(t);if(r){null!=i&&r.classList.add(i);var n=Promise.resolve(FileIO.getURLContent(e));return n.then((e=>{r.innerHTML=e,a.svg=r.getElementsByTagName("svg")[0],null!=s&&a.svg.classList.add(s)})),a.promise=n,a}}static svgRawPromise(e){var t={};return Promise.resolve(FileIO.getURLContent(e)).then((e=>{var i=document.createElement("div");i.innerHTML=e,t.svg=i.getElementsByTagName("svg")[0]})),t}static svgIconPromise(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=this,n={hover:null,mute:null,caret:null,indicator:null,waiting:[],state:null};n.eventType=i;var o=document.getElementById(t);if(o){a?o.classList.add(a):o.classList.add("iconStyle"),n.parent=o.parentNode,n.parent.classList.add("iconHover"),n.parent.addEventListener("click",(e=>{r.iconEvent("click",n,i)}));var l=Promise.resolve(FileIO.getURLContent(e));return l.then((e=>{if(o.innerHTML=e,n.svg=o.getElementsByTagName("svg")[0],n.svg){a?n.svg.classList.add(a):n.svg.classList.add("iconStyle");for(var i=n.svg.children,r=n.svg.getAttribute("xmlns"),l=n.svg.getAttribute("height"),h=n.svg.getAttribute("width"),c=0;c<i.length;++c){var d=i[c];if("speakerIcon"===t){var A=o.getAttribute("xmlns"),u=document.createElementNS(A,"rect");u.setAttribute("x",-1),u.setAttribute("y",-1),u.setAttribute("fill","white"),u.setAttribute("fill-opacity",0),u.setAttribute("height",l+2),u.setAttribute("width",h+2),u.setAttribute("z-index",-1),o.appendChild(u),n.hover=u,n.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}var p=d.getAttribute("id");if("mute"===p){n.mute=d,n.mute.style.transformOrigin="50% 50%",n.mute.style.filter="alpha(opacity=0)",n.mute.style.opacity="0",n.mute.style.transform="scale(0,0)",n.mute.style.transition="scale 1s, opacity .5s, filter .5s";var m=document.createElement("style");m.type="text/css",m.innerHTML="\n                                @keyframes loadingSpinner{\n                                    0%{\n                                        transform: rotate(0deg);\n                                    }\n                                    100%{\n                                        transform: rotate(360deg);\n                                    }\n                                }\n                            ",n.svg.appendChild(m);var g=Math.max(2,.25*Math.min(l,h)),v=.5*h,f=.5*l,b=document.createElementNS(r,"path");b.setAttribute("d"," M ".concat(v," ").concat(f-g," A ").concat(g," ").concat(g," 0 1 1 ").concat(v-g," ").concat(f," ")),b.setAttribute("stroke","white"),b.setAttribute("stroke-width","2"),b.style.display="none",b.style.transformOrigin="50% 50%",b.style.animation="loadingSpinner 1s linear infinite",b.style.animationDuration="2s",b.style.animationPlayState="paused",n.indicator=b,n.svg.appendChild(b),this.toggleIcon(n,s)}else"caret"===p?(n.caret=d,n.caret.style.transformOrigin="50% 50%",n.caret.style.transition="transform .5s",this.flipIcon(n,!1)):"state"===p?(d.style.display="none",n.state=d):n.waiting.push(d)}var x=document.createElementNS(r,"rect");x.classList.add("iconHover"),x.setAttribute("x",0),x.setAttribute("y",0),x.setAttribute("height",l),x.setAttribute("width",h),n.svg.appendChild(x)}})),n.promise=l,n}}static svgButtonPromise(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("string"!=typeof t||(t=document.getElementById(t))){var r=this;Promise.resolve(FileIO.getURLContent(e)).then((e=>{t.innerHTML=e;var n=t.getElementsByTagName("svg");if(n.length>0&&(n=n[0],i&&(i="string"==typeof i?[i]:i).forEach((e=>{n.classList.add(e)})),s)){var o=n.getAttribute("xmlns"),l=parseInt(n.getAttribute("height")),h=parseInt(n.getAttribute("width")),c=document.createElementNS(o,"rect");c.setAttribute("x",-1),c.setAttribute("y",-1),c.setAttribute("fill","white"),c.setAttribute("fill-opacity",0),c.setAttribute("height",l+2),c.setAttribute("width",h+2),c.setAttribute("z-index",-1),n.appendChild(c);var d=n.getElementById("state");d&&d.setAttribute("fill-opacity",this.toggleOpacity[0]),a&&(n.onclick=e=>{r.svgCheckClick(e,a)},r.pxlDevice.mobile?(n.ontouchstart=e=>{r.svgStylize(e,!0)},n.ontouchend=e=>{r.svgStylize(e,!1)}):(n.onmouseover=e=>{r.svgStylize(e,!0)},n.onmouseout=e=>{r.svgStylize(e,!1)}))}}))}}}function GUIBase_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function GUIBase_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){GUIBase_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){GUIBase_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}class GUIManager{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"./assets/",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"./assets/GUI/";this.projectTitle=t,this.verbose=e,this.mobile=!1,this.pxlOptions=null,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=i,this.guiRoot=s,this.introHelpActive=!0,this.branding={title:t,loader:s+".svg",logo:s+".svg",medalion:s+".svg",stack:s+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=8,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!1,loadingBranding:!1},this.settingsFields={changeUsername:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(pxlNav){this.pxlOptions=pxlNav.pxlOptions,this.pxlFile=pxlNav.pxlFile,this.pxlCookie=pxlNav.pxlCookie,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUtils=pxlNav.pxlUtils,this.pxlUser=pxlNav.pxlUser,this.pxlDevice=pxlNav.pxlDevice,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlCamera=pxlNav.pxlCamera,this.pxlNavCanvas=pxlNav.pxlNavCanvas,this.pxlQuality=pxlNav.pxlQuality,this.pxlEnv=pxlNav.pxlEnv,this.mobile=pxlNav.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),pxlNav.pxlDevice.subscribe("resize",this.resize.bind(this)),this.createContainer(),this.createFailState(),this.buildConsole()}init(){this.cssBuildClasses()}createContainer(){var e;this.pxlOptions.hasOwnProperty("container")&&this.pxlOptions.container instanceof HTMLElement?e=this.pxlOptions.container:((e=document.createElement("div")).id="pxlNav-container",e.classList.add("pxlNav-mainContainerStyle"),document.body.appendChild(e)),this.guiWindows.container={active:!0,gui:e}}addToContainer(e){this.guiWindows.container||this.createContainer(),this.guiWindows.container.gui.appendChild(e)}createFailState(){var e,t=document.createElement("div");t.id="pxlNav-failState",t.classList.add("pxlNav-failStateStyle"),null!==(e=this.guiWindows)&&void 0!==e&&null!==(e=e.container)&&void 0!==e&&e.gui?this.guiWindows.container.gui.appendChild(t):document.body.appendChild(t),this.guiWindows.failState={active:!0,gui:t}}addToFailState(e){this.guiWindows.failState||this.createFailState(),this.guiWindows.failState.gui.appendChild(e)}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),this.addToContainer(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML="\n            <div id=\"loaderLogoBranding\" class='pxlLoaderLogo'></div>\n            <div class='loadStyleParent'>\n              <div id='pxlLoader' class='loadStyle'></div>\n              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>\n            </div>\n            <div id=\"loaderBranding\" class='pxlLoaderTitle'>".concat(this.projectTitle,"</div>\n            <div id=\"loaderMessage\" class='pxlLoaderMessage'></div>\n          "),this.addToContainer(this.mapPrompt);var e=document.getElementById("loaderMessage");if(e){var t=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];e.innerHTML=t}this.buildGuiStatus.loadingBranding&&SVGUtils.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";var i=document.createElement("div");i.classList.add("pxlNav-crashPromptBackgroundStyle"),this.addToFailState(i);var s,a=document.createElement("div");a.classList.add("pxlNav-canvasCrashPromptStyle"),i.appendChild(a),this.pxlQuality&&(s=0===parseInt(this.pxlQuality.detailLimit)?'Looks like your computer is having a hard time, but we’ve got your fix.\n          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload '.concat(this.projectTitle,"."):'Looks like your computer is still having trouble, but we’ve got another fix for ya.\n          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload '.concat(this.projectTitle," again.")),a.innerHTML=s;var r=document.getElementById("pxlNav-crashLink");r&&(r.onclick=this.crashLinkTrigger.bind(this))}stepLoader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.pxlLoaderCount+=1;var t=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);100===t&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=t+"%",this.verbose>=je.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+e)}setLoaderPhrases(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e.length>0&&(t&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(e),this.setLoaderObjMessage())}setLoaderObjMessage(){var e=document.getElementById("loaderMessage");if(e){var t=Math.floor(17391.537193*Math.random()*this.loaderPhrases.length%this.loaderPhrases.length),i=this.loaderPhrases[t];e.innerHTML=i}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){var e;this.updateGuiPositions(),null!==(e=this.pxlUser)&&void 0!==e&&e.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.resetHelpTextPlacement();["videoinput","audioinput","audiooutput"].forEach((e=>{var t=null,i=null;"videoinput"===e?(t="camChoiceOptionsBlock",i=this.hudIcons.camChoiceIcon):"audioinput"===e?(t="micChoiceOptionsBlock",i=this.hudIcons.micChoiceIcon):"audiooutput"===e&&(t="speakerChoiceOptionsBlock",i=this.hudIcons.speakerChoiceIcon);var s=document.getElementById(t);if(s&&i){var a=s.getBoundingClientRect().width,r=i.parent.getBoundingClientRect();s.style.left=r.x-.5*a,s.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}})),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach((e=>{var t=this.textDescriptions[e];if(t){var i=document.getElementById("helpText_"+e);if(!i)return;var s=document.getElementById(e);if(s){var a=t.pos,r=t.offset?t.offset:[0,0],n=s.getBoundingClientRect(),o=i.getBoundingClientRect(),l=0,h=0,c=!1;a[1]<0?(h=n.y+o.height*a[1],c=!0):0===a[1]?h=n.y+.5*n.height-.5*o.height:a[1]>0&&(h=n.y+n.height+o.height*(a[1]-1),c=!0),c?a[0]<0?l=n.x+n.width+o.width*a[0]:0===a[0]?l=n.x+.5*n.width-.5*o.width:a[0]>0&&(l=n.x+n.width*(a[0]-1)):a[0]<0?l=n.x+o.width*a[0]:0===a[0]?l=n.x+.5*n.width-.5*o.width:a[0]>0&&(l=n.x+2*n.width*a[0]),(l+=r[0])+o.width>this.sW-2?l=this.sW-2-o.width:l<2&&(l=2),h+=r[1],i.style.left=l,i.style.top=h}else i.style.display="none"}}))}refreshPage(){window.location.reload()}crashLinkTrigger(e){var t=window.location.search.match(/[a-zA-Z0-9=]+/g);if(t){var i="?";t.forEach((e=>{var t=e.split("=");"dlimit"===t[0]?i+=t[0]+"="+(parseInt(t[1])+1)+"&":i+=e+"&"})),window.location.search=i}else window.location.search="?dlimit=1"}guiToggleVisibility(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e=null===e?!this.hudVisibility:e,this.hudVisibility=e,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),e){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){var t=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=t}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=e?"grid":"none")}cssBuildClasses(){var e=document.createElement("style");e.type="text/css",e.innerHTML="\n\t\t\t.fader{\n\t\t\t\ttransition: opacity .8s, filter .8s;\n\t\t\t}\n\t\t\t.visOn{\n\t\t\t\tfilter:alpha(opacity=100);\n\t\t\t\topacity:1.0;\n\t\t\t}\n\t\t\t.visOff{\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0.0;\n\t\t\t}\n\t\t",document.getElementsByTagName("head")[0].appendChild(e)}prepPromptFader(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;"string"==typeof i&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof e&&(e=document.getElementById(e)),e)if(e.hasOwnProperty("gui")&&(e=e.gui),(null===(i=e.classList)||void 0===i?void 0:i.value.indexOf("fader"))<0&&e.classList.add("fader"),t)e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!==s&&e.setAttribute("fadeOut",1e3*s))}),50);else if(e.classList.remove("visOn"),e.classList.add("visOff"),a){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{var t=e.parentNode;t&&t.removeChild(e)}))}))}else setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)}buildConsole(){var e=document.createElement("div");e.id="consoleBlock",e.classList.add("consoleBlockStyle"),this.addToContainer(e),this.guiWindows.consoleBlock={active:!1,gui:e}}buildMessageBlock(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Info",i=document.createElement("div");this.msgCount++,i.id="messageBlock-"+this.msgCount,i.classList.add("messageBlockStyle"),i.classList.add("message"+t);var s=this,a=document.createElement("div");a.classList.add("messageCloseBtn"),a.innerHTML="X",a.addEventListener("click",(function(){s.removeMessage(i)}));var r=document.createElement("div");r.classList.add("messageTopBarStyle");var n=document.createElement("div");n.classList.add("messageHeaderStyle"),n.innerHTML=t,r.appendChild(n),r.appendChild(a),i.appendChild(r);var o=document.createElement("div");return o.classList.add("messageContentStyle"),o.innerHTML=e,i.appendChild(o),i}print(e){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));var t=this.guiWindows.consoleBlock.gui,i=this.buildMessageBlock(e);t.appendChild(i)}buildHudBlock(){if(this.buildGuiStatus.hud){var e=document.createElement("div");e.id="hudBlock",e.classList.add("hudBlockStyle"),this.hudBlock.obj=e,this.addToContainer(this.hudBlock.obj),this.hudBlock.obj.style.display="none";var t=this;this.hudBlock.obj.addEventListener("click",(e=>{t.toggleHudBlock(!1,!0)}))}}toggleHudBlock(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hudBlock){e=null===e?!this.hudBlock.active:e,this.hudBlock.active=e;var i=!1;e?i="inline-block":this.checkOpenWindows(t)||(i="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&!1!==i&&(this.hudBlock.obj.style.display=i)}}checkOpenWindows(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object.keys(this.guiWindows),i=!1;return t.forEach((t=>{["container","failState","chatBoxGui"].includes(t)||(e&&(this.guiWindows[t].button&&this.flipIcon(this.guiWindows[t].button,!1),this.guiWindows[t].gui&&this.guiWindows[t].active&&(this.guiWindows[t].active=!1,this.promptFader(this.guiWindows[t].gui,!1),"settingsGui"===t&&this.togglePxlNavDataDisplay(!1))),i=i||this.guiWindows[t].active)})),i}checkFocus(){!0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(!this.mobile&&this.buildGuiStatus.userTopBar){var e=document.createElement("div");e.id="hud_topBar",e.classList.add("hud_topBarBlockStyle"),this.hudTopBar=e,this.addToContainer(this.hudTopBar);var t;t='\n\t\t\t<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>\n\t\t\t<div id="hud_topBarParent" class="hud_topBarParentStyle">\n\t\t<div id="statsIconParent">\n\t\t\t'.concat('<div id="statsIcon"></div></div>\n\t\t<div id="usersIconParent">\n\t\t\t<div id="usersIcon"></div>','\n\t\t</div>\n\t\t<div  class="hud_topBarVSpacerStyle"></div>\n\t\t\t</div>\n\t\t'),e.innerHTML=t,this.hudIcons.statsIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_stats.svg"),"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally((()=>{})),this.hudIcons.usersIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_user.svg"),"usersIcon","users");var i=document.createElement("div");i.id="hud_pxlNavData",i.classList.add("hud_pxlNavDataParentStyle"),e.appendChild(i),this.pxlNavData.gui=i;var s=document.createElement("div");s.id="hud_pxlNavData",s.classList.add("hud_pxlNavDataStyle"),i.appendChild(s),t='\n      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>\n      <div class="hud_pxlNavData_UL gui_boldText">↑</div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>\n      <div class="hud_pxlNavData_DL gui_boldText">↓</div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>\n    ',s.innerHTML=t,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];var e=document.createElement("div");e.classList.add("userControlBlockStyle"),this.addToContainer(e),this.userControlBlock.gui=e,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){var e=document.createElement("div");e.id="hud_medalionBar",e.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=e,this.addToContainer(this.hudMedalionBar);var t='\n        <div id="medalionIconParent" class="hud_speakerIconStyle">\n          <div id="medalionIcon"></div>\n        </div>\n        <div id="medalionTitle" class="medalionTitleStyle">'.concat(this.branding.title,"</div>\n      ");this.hudMedalionBar.innerHTML=t;var i=document.getElementById("medalionIcon"),s=document.getElementById("medalionTitle");i.addEventListener("mouseover",(()=>{s.classList.add("medalionTitleGrowStyle")})),i.addEventListener("mouseout",(()=>{s.classList.remove("medalionTitleGrowStyle")})),this.hudIcons.medalionIcon=SVGUtils.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(this.buildGuiStatus.bottomBar){var e=document.createElement("div");e.id="hud_bottomBar",e.classList.add("hud_bottomBarStyle"),this.hudBottomBar=e,this.addToContainer(this.hudBottomBar);var t="";if(t+='\n    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">\n        <div id="settingsIconParent" class="hud_settingsIconStyle">\n          <object id="settingsIcon"></object>\n        </div>\n  <div></div>\n        <div id="helpIconParent" class="hud_helpIconStyle">\n          <object id="helpIcon"></object>\n        </div>\n        ',!this.mobile&&this.buildGuiStatus.verseList&&(t+='<div class="hud_usersIconStyle">\n            <div id="multiverseIcon"></div>\n          </div>\n          <div></div>'),t+="</div>",this.mobile||(t+='\n        <div class="hud_micCamIconsBlockStyle">\n          <div id="speakerIconParent" class="hud_speakerIconStyle">\n            <div id="speakerIcon"></div>\n          </div>\n          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">\n            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="speakerChoiceIconParent">\n              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="micIconParent" class="hud_micIconStyle">\n            <div id="micIcon"></div>\n          </div>\n          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">\n            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="micChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="camIconParent" class="hud_camIconStyle">\n            <div id="camIcon"></div>\n          </div>\n          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">\n            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="camChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n        </div>\n        \n        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">\n          <div class="guiVerseHudTitle">\n            <span id="guiVerseTitle"></span>\n          </div>\n          <div></div>\n          <div id="chatIconParent" class="hud_chatIconStyle">\n            <div id="chatIcon"></div>\n          </div>\n          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>\n        </div>\n      '),this.hudBottomBar.innerHTML=t,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_chat.svg"),"chatIcon","chat"),this.mobile||this.pxlAutoCam.enabled){var i=document.getElementById("hud_chatIconBlock");i.style.gridAutoColumns="max-content max-content auto max-content",i.style.margin="0px 10px"}else this.hudIcons.multiverseIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_multiverse.svg"),"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_ProxAudio.svg"),"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_mic.svg"),"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_camera.svg"),"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_help.svg"),"helpIcon","help"),this.hudIcons.settingsIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_settings.svg"),"settingsIcon","settings")}}prepArtistInfo(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(e=this.pxlEnv)&&void 0!==e&&e.postIntro&&""!==t){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;var s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);var a=this;s.onclick=()=>{a.toggleArtistInfo()},this.hudElements.artistInfo.button=s;var r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(r),this.hudElements.artistInfo.buttonText=r;var n=document.createElement("div");n.classList.add("hud_aristInfoCarrotXStyle"),n.id="artistInfoCarrotX",s.appendChild(n);var o=document.createElement("div");o.classList.add("hud_aristInfoInner"),o.innerHTML=t,i.appendChild(o),this.hudElements.artistInfo.inner=o,this.addToContainer(i),this.hudElements.artistInfo.closeSvg=SVGUtils.svgPromise("".concat(this.guiRoot,"global/carrotClose_animated.svg"),"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally((()=>{this.artistInfoButtonPrep()}))}this.toggleArtistInfo(!1),null!==t&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=t,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.hudElements.artistInfo.closeSvg.svg;if(t){var i=t.getElementById("carrotToClone_on"),s=t.getElementById("carrotToClone_off");i&&s?(this.hudElements.artistInfo.onAnim=i,this.hudElements.artistInfo.offAnim=s):2===e||setTimeout((()=>{this.artistInfoButtonPrep(e+=1)}),100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){var e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";var a=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=a,this.hudElements.artistInfo.buttonText.style.maxWidth=a+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=null===e?!this.hudElements.artistInfo.active:e,this.hudElements.artistInfo.active=e;var t=this.hudElements.artistInfo.innerHeight,i=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,a=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":a+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";var r=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":r+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(e=this.pxlEnv)&&void 0!==e&&e.postIntro&&""!==t){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;var s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);var a=this;s.onclick=()=>{a.togglePageDisplay()},this.hudElements.artistInfo.button=s;var r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(r),this.hudElements.artistInfo.buttonText=r;var n=document.createElement("div");n.classList.add("hud_aristInfoCarrotXStyle"),n.id="artistInfoCarrotX",s.appendChild(n);var o=document.createElement("div");o.classList.add("hud_aristInfoInner"),o.innerHTML=t,i.appendChild(o),this.hudElements.artistInfo.inner=o,this.addToContainer(i)}this.togglePageDisplay(!1),null!==t&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=t,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){var e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";var a=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=a,this.hudElements.artistInfo.buttonText.style.maxWidth=a+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.hudElements.artistInfo){var t;e=null===e?!this.hudElements.artistInfo.active:e,null!==(t=this.hudElements)&&void 0!==t&&t.artistInfo&&(this.hudElements.artistInfo.active=e);var i=this.hudElements.artistInfo.innerHeight,s=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),a=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?i+"px":a+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?s+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";var n=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":n+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),"click"===e)switch(i){case"chat":this.toggleChatBox();break;case"musicToggle":this.pxlAudio.djPlayerMuteToggle(),this.toggleIcon(t,!this.pxlAudio.djMuted,!0);break;case"userSpeakerToggle":this.setUserControls(t);break;case"speakerToggle":this.toggleIcon(t,!1,!0);break;case"speakerChoice":var s="audiooutput";this.flipIcon(t,this.guiWindows[s]&&this.guiWindows[s].active);break;case"help":var a=!!this.guiWindows.helpGui&&this.guiWindows.helpGui.active;this.checkOpenWindows(!0),this.helpGuiToggle(!a);break;case"info":var r=!!this.guiWindows.infoGui&&this.guiWindows.infoGui.active;this.checkOpenWindows(!0),this.infoGuiToggle(!r);break;case"settings":var n=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active;this.checkOpenWindows(!0),this.settingsGuiToggle(!n);break;case"userProfile":this.toggleUserProfile()}}setMicVolumeLevel(e){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);var t=12-11*e;this.hudIcons.micIcon.volumeMask.setAttribute("y",t)}toggleIcon(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){if(e.mute.style.filter=t?"alpha(opacity=0)":"alpha(opacity=100)",e.mute.style.opacity=t?"0":"1",e.mute.style.transform=t?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(e.eventType))return;var s={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[e.eventType];s&&i&&this.loadingDeviceChange(s,t)}}flipIcon(e,t){e.caret.style.transform="rotate( ".concat(t?"180deg":"0deg"," )")}loadingDeviceChange(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null;"speaker"===e?i=this.hudIcons.speakerIcon:"audio"===e?i=this.hudIcons.micIcon:"video"===e&&(i=this.hudIcons.camIcon),i.indicator.style.display=t?"inline-block":"none",i.indicator.style.animationPlayState=t?"running":"paused",i.waiting.forEach((e=>{e.setAttribute("fill-opacity",t?".5":"1")})),t&&setTimeout((()=>{this.loadingDeviceChange(e,!1)}),1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";var e='\n          <audio id="djStream" playsinline muted>\n            <source src="'+this.pxlAudio.djUrlSource+'"></source>\n          </audio>\n          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>\n              <td align="left">\n                  <div id="djPlayerVol"></div>\n              </td><td valign="center" align="left" width=100%>\n                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>\n              </td></tr>\n          </tbody></table>';this.djPlayerObj.innerHTML=e,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_music.svg"),"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(e,t){this.activeItem.innerHTML=t,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout((()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"}),1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),this.addToContainer(this.activeItem)}updateGuiPositions(){if(this.loading){for(var e=this.radioControls.length,t=!1,i=0;i<e;++i){if(!this.radioControls[i][3]){t=!0;break}var s=this.radioControls[i][0],a=this.radioControls[i][2].getBoundingClientRect(),r=a.width+2*this.buttonPadding,n=a.height+2*this.buttonPadding,o=a.top-this.buttonPadding,l=a.left-this.buttonPadding;s.style.width=r,s.style.height=n,s.style.top=o,s.style.left=l,this.radioControls[i][1].style.width=r,this.radioControls[i][1].style.height=n,this.radioControls[i][1].style.top=o,this.radioControls[i][1].style.left=l}this.loading=t}}togglGuiWindow(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"helpGui"===e?this.helpGuiToggle(t,!1):"infoGui"===e?this.infoGuiToggle(t,!1):"settingsGui"===e&&this.settingsGuiToggle(t,!1)}svgCheckClick(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&("close"!==e?"ft1"!==e&&"ft2"!==e&&("ft3"!==e?"ft4"!==e&&("ft5"!==e||this.pxlAutoCam.toggleAutoCam()):this.toggleInviteUser()):this.toggleGuiWindowContainer(null,!1,!0))}svgStylize(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var i=e.path?e.path[1]:e.target.parentNode,s=i.getElementById("state");if(s){var a=t?"white":"none";s.setAttribute("fill",a)}var r=i.getElementById("hover");if(r){r.setAttribute("fill","white")}}}renderQualitySettings(e){this.pxlQuality.percent=e,this.pxlQuality.screenResPerc=.75*e+.25,this.pxlQuality.mapAutoQualityUpdate(e,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){var e;this.pxlNavData.active&&null!==(e=this.pxlNavData)&&void 0!==e&&e.fps&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){var e,t=document.createElement("div");t.classList.id="guiWindowBackground",t.classList.add("guiWindowBackground"),t.classList.add("fader"),t.classList.add("visOff"),t.style.display="none";var i=this;t.onclick=e=>{i.toggleGuiWindowContainer(e,!1,!0)},this.guiWindowBG=t,null!==(e=this.guiWindows)&&void 0!==e&&null!==(e=e.container)&&void 0!==e&&e.gui?this.guiWindows.container.gui.appendChild(t):document.body.appendChild(t)}toggleGuiWindowContainer(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var s=(e.path?e.path[0]:e.target).getAttribute("id");if("guiWindowBackground"!==s){if(!["pxlNav-container","pxlnav-react-container","pxlnav-next-container","gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(s))return null}}var a=this.checkOpenWindows(i);this.guiWindowBG&&a===t&&this.promptFader(this.guiWindowBG,t,null,!1),t?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){var e,t,i;this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;var s=document.createElement("div");s.id="gui_helpGuiWindow",s.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(s),this.guiWindowBG.appendChild(s);var a="",r="";if(""!==(null===(e=this.pxlOptions.onboarding.pc)||void 0===e?void 0:e.message)){a=this.pxlOptions.onboarding.pc.message,a=this.formatWelcomeMessage(a);var n="";this.pxlOptions.onboarding.pc.messageStyle.length>0&&(n=this.pxlOptions.onboarding.pc.messageStyle.join(" ")),r='<div class="'.concat(n,'" id="guiWelcomeMessage">').concat(a,"</div>")}var o="close",l="guiButton";""!==(null===(t=this.pxlOptions.onboarding.pc)||void 0===t?void 0:t.buttonText)&&(o=this.pxlOptions.onboarding.pc.buttonText),(null===(i=this.pxlOptions.onboarding.pc)||void 0===i?void 0:i.buttonStyle.length)>0&&(l=this.pxlOptions.onboarding.pc.buttonStyle.join(" "));var h="";h+='\n      <div id="gui_helpContent" class="gui_contentStyle">\n      '.concat(r,'\n    <div class="gui_body">\n      <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">\n      <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>\n      <div class="gui_helpGui_ASDWorUDLR">\n        <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>\n        <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>\n        <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>\n      </div>\n      <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">WASD</span> or<br><span class="gui_boldText">ARROWS</span> keys to move around</div>\n      </div>\n      <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">\n      <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>\n      <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>\n      <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>\n      </div>\n    </div>\n    <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">\n            You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings (G)</span> <span id="gui_helpGui_settingIcon"></span> menu\n            <br> To show this screen again, open the <span class="gui_boldText">Help (H)</span> screen\n            <br> For additional info, see the <span class="gui_boldText">Info (I)</span> screen\n          </div>\n    <div id="guiHelpFooter" class="gui_footer">\n      <div class="').concat(l,'" id="guiHelpBackButton">').concat(o,'</div>\n    </div>\n    <div class="gui_spacer"></div>\n      </div>\n    '),s.innerHTML=h,[[this.guiRoot+"keyboard_asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard_udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse_outline.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach((e=>{SVGUtils.svgButtonPromise(...e)}));var c=this,d=document.getElementById("guiHelpBackButton");d&&(d.onclick=e=>{c.introHelpActive&&(c.introHelpActive=!1,c.pxlEnv.postHelpIntro()),c.svgCheckClick(e,"close")});var A=document.getElementById("gui_helpGui_settingIcon");A&&this.hudIcons.settingsIcon&&(A.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,A.style.position="relative",A.style.top="7.3px",A.style.width="30px",A.style.padding="2px",A.style.cursor="pointer",A.children[0].style.height="26px",A.onclick=()=>{c.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=s,setTimeout((()=>{this.resize()}),50)}helpGuiToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.helpGui||this.helpGuiBuild(),e=null===e?!this.guiWindows.helpGui.active:e,this.guiWindows.helpGui.active=e,this.promptFader(this.guiWindows.helpGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.promptFader(this.guiWindows.container,!0),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout((()=>{this.resetHelpTextPlacement()}),20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;var e=document.createElement("div");e.id="gui_infoGuiWindow",e.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);var t="";t+='\n    <div id="gui_infoContent" class="gui_contentInfoStyle">\n  <div class="gui_infoBody">\n    <div id="gui_infoGuiParent" class="gui_infoGuiParent">\n    <br>'.concat(this.projectTitle,'\n    <br>&nbsp;&nbsp; Created by <a href="https://github.com/ProcStack" target="_blank">Kevin Edzenga / ProcStack</a> 2024; 2025\n    <br>\n    <br>If any bugs are found in pxlNav, you can share them on the GitHub issues page:\n    <br>&nbsp;&nbsp; <a href="https://github.com/ProcStack/pxlNav/issues" target="_blank">pxlNav / issues</a>\n    <br>\n    </div>\n  </div>\n  \n  <div id="guiInfoFooter" class="gui_footer">\n    <div class="guiButton" id="guiInfoBackButton">close</div>\n  </div>\n    </div>\n  '),e.innerHTML=t;var i=this;document.getElementById("guiInfoBackButton").onclick=e=>{i.svgCheckClick(e,"close")},this.guiWindows.infoGui.gui=e}infoGuiToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.infoGui||this.infoGuiBuild(),e=null===e?!this.guiWindows.infoGui.active:e,this.guiWindows.infoGui.active=e,this.promptFader(this.guiWindows.infoGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){}settingsGuiBuild(){var e=this;this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;var t=document.createElement("div");t.id="gui_settingsGuiWindow",t.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(t),this.guiWindowBG.appendChild(t);var i="Default";i=i||"";var s='\n    <div id="gui_settingsContent" class="gui_contentSettingsStyle">\n  <div class="gui_settingsBody">\n    <div class="gui_settingsParentGrid">\n    ';this.settingsFields.changeUsername&&(s+='\n        \x3c!-- -- Username -- -- --\x3e\n        <div class="cellMargin settings_icon" id="settings_user"></div>\n        <div class="settings_optionHeader">Username</div>\n        <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">\n            <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">\n              <input type="text" placeholder="Set your username" value="'.concat(i,'" id="settings_usernameInput" class="settings_usernameInput"></input>\n              <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">\n            </div>\n            <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>\n        </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      ')),s+='\n      \x3c!-- -- Left/Right -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_left_right"></div>\n    <div class="settings_optionHeader">Left/Right</div>\n    <div class="settings_radio" id="settingsRadioBlock_leftRight">\n      <span>\n      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>\n      <label for="settings_tankTurning">Turn</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>\n      <label for="settings_strafing">Strafe</label>\n      </span>\n    </div>\n      \x3c!-- -- Mouse -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_mouse"></div>\n    <div class="settings_optionHeader">Mouse Looking</div>\n    <div class="settings_radio" id="settingsRadioBlock_mouse">\n      <span>\n      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>\n      <label for="settings_dragLooking">Native</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>\n      <label for="settings_pointLooking">Inverted</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n    <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- Graphics Quality -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_graphics"></div>\n    <div class="settings_optionHeader">Graphics Quality</div>\n    <div class="settings_radio" id="settingsRadioBlock_graphics">\n      <span>\n      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>\n      <label for="settings_graphicsQuality_low">Low</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>\n      <label for="settings_graphicsQuality_med">Medium</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>\n      <label for="settings_graphicsQuality_high">High</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>\n      <label for="settings_graphicsQuality_custom">Custom</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- --\x3e\n      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_render"></div>\n      <div class="settings_optionHeader">Render Resolution</div>\n      <div class="settings_radio" id="settingsRadioBlock_resolution">\n      <span>\n        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>\n        <label for="settings_render_25">25%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>\n        <label for="settings_render_50">50%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>\n        <label for="settings_render_75">75%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>\n        <label for="settings_render_100">100%</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_fog"></div>\n      <div class="settings_optionHeader">Fog Quality</div>\n      <div class="settings_radio" id="settingsRadioBlock_fog">\n      <span>\n        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>\n        <label for="settings_noRedFog">Low</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>\n        <label for="settings_cheapResFog">Medium</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>\n        <label for="settings_highResFog">High</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_bloom"></div>\n      <div class="settings_optionHeader">Bloom Effects</div>\n      <div class="settings_radio" id="settingsRadioBlock_bloom">\n      <span>\n        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>\n        <label for="settings_noBloom">Off</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>\n        <label for="settings_bloomActive">On</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      </div>\n    </div>\n      <div class="settingsGridSpan settingsEmptySpacer"></div>\n    </div>\n    <div class="guiSettingsFooterButtons">\n    <div class="guiButton" id="guiSettingsBackButton">close</div>\n    </div>\n  </div>\n    </div>\n  ',t.innerHTML=s,this.guiWindows.settingsGui.gui=t;var a=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider"),document.getElementById("guiSettingsBackButton").onclick=e=>{a.svgCheckClick(e,"close")},[[this.guiRoot+"settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach((e=>{SVGUtils.svgButtonPromise(...e)}));var r,n,o=document.getElementById("settings_usernameInput");if(o){o.onkeyup=e=>{a.keyUsernameSet(e)},o.onkeydown=e=>{a.keyDownUsernameSet(e)},this.guiWindows.settingsGui.usernameInput=o,document.getElementById("settings_sendUsername").addEventListener("click",(()=>{a.sendUsernameUpdate(o)}));var l=document.getElementById("settings_usernameResponseMessage");l&&(this.guiWindows.settingsGui.usernameReturn=l)}this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),n=(r=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"]).length;for(var h=function _loop(){var t=r[c],i=document.getElementById(t);e.setRadioStyle(i,c,n);var s=parseInt(i.value);i.addEventListener("change",(e=>{a.pxlQuality.setQualityLevel(s),a.setRadioValues()}))},c=0;c<n;++c)h();n=(r=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"]).length;for(var d=function _loop2(){var t=r[A],i=document.getElementById(t);e.setRadioStyle(i,A,n);var s=parseFloat(i.value);i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({resolution:s}),a.pxlQuality.setQualityCookie(3)}))},A=0;A<n;++A)d();n=(r=["settings_noRedFog","settings_cheapResFog","settings_highResFog"]).length;for(var u=function _loop3(){var t=r[p],i=document.getElementById(t);e.setRadioStyle(i,p,n);var s=i.value;i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({fog:s}),a.pxlQuality.setQualityCookie(3)}))},p=0;p<n;++p)u();n=(r=["settings_noBloom","settings_bloomActive"]).length;for(var m=function _loop4(){var t=r[g],i=document.getElementById(t);e.setRadioStyle(i,g,n);var s=1===i.value;i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({bloom:s}),a.pxlQuality.setQualityCookie(3)}))},g=0;g<n;++g)m();n=(r=["settings_tankTurning","settings_strafing"]).length;for(var v=function _loop5(){var t=r[f],i=document.getElementById(t);e.setRadioStyle(i,f,n);var s=1===i.value;i.addEventListener("change",(e=>{a.pxlQuality.setGraphicsSettings({leftRight:s},null)}))},f=0;f<n;++f)v();n=(r=["settings_dragLooking","settings_pointLooking"]).length;for(var b=function _loop6(){var t=r[x],i=document.getElementById(t);e.setRadioStyle(i,x,n);var s=1===i.value;i.addEventListener("change",(e=>{a.pxlQuality.setGraphicsSettings({mouse:s},null)}))},x=0;x<n;++x)b();this.setRadioValues()}setRadioStyle(e,t,i){var s="settings_radio_label_mid";0===t?s="settings_radio_label_start":t===i-1&&(s="settings_radio_label_end"),e.parentNode.children[1].classList.add(s)}setRadioValues(){var e=this.pxlQuality.settings;Object.keys(e).forEach((t=>{var i=document.getElementById("settingsRadioBlock_"+t);if(i){var s="resolution"===t?4*e[t]-1:~~e[t];i.children[s].children[0].checked=!0}}))}settingsGuiAdvObjSizing(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.guiWindows.settingsGui.advObj,i=t.offsetHeight;t.style.maxHeight=(e?i:0)+"px",t.setAttribute("maxHeight",i)}settingsGuiToggle(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.settingsGui||this.settingsGuiBuild(),(t=null===t?!this.guiWindows.settingsGui.active:t)&&null!==(e=this.guiWindows)&&void 0!==e&&null!==(e=e.settingsGui)&&void 0!==e&&e.usernameReturn&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=t,this.promptFader(this.guiWindows.settingsGui.gui,t),this.toggleGuiWindowContainer(null,t),this.hudBlock.active&&this.toggleHudBlock(t),this.toggleHudBlock(t,!1),this.togglePxlNavDataDisplay(t),this.introHelpActive&&!t&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t&&(t=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active),this.pxlNavData.active=t;var i=this.pxlNavData.height||200;null!==(e=this.pxlNavData)&&void 0!==e&&e.gui&&(this.pxlNavData.gui.style.maxHeight=t?i+"px":"0px",t||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight))}renderRadius(e){this.pxlEnv.mapGlowPass.strength=Number(e),this.pxlEnv.roomBloomPass.strength=Number(e)}renderThreshold(e){this.pxlEnv.mapGlowPass.threshold=Number(e),this.pxlEnv.roomBloomPass.threshold=Number(e)}renderGlowRadius(e){this.pxlEnv.mapGlowPass.radius=Number(e),this.pxlEnv.roomBloomPass.radius=Number(e)}renderResolution(e){this.pxlQuality.screenResPerc=.75*e+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;var e=document.createElement("div");e.id="gui_inviteUserWindow",e.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(e),this.addToContainer(e);var t=window.location+"";t=t.replace(/^https?:\/\//,"");var i="";i+='\n        <div class="gui_inviteUserBody">\n          <div class="iu_urlStyle">'.concat(t,'</div>\n          <div id="iu_copy" class="iu_copyStyle">Copy</div>\n        </div>\n    '),e.innerHTML=i;var s=this.pxlUtils,a=document.getElementById("iu_copy");a.addEventListener("click",(()=>{var e=s.copyRoomUrl();a.innerText=e?"Copied":"Error",a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout((()=>{a.innerText="Copy",clearTimeout(a.timeout)}),2e3)})),this.guiWindows.inviteUserGui.gui=e}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){var e=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=e.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-e.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=e.height}}toggleInviteUser(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.inviteUserGui||this.inviteUserBuild(),e=null===e?!this.guiWindows.inviteUserGui.active:e,this.guiWindows.inviteUserGui.active=e,this.promptFader(this.guiWindows.inviteUserGui.gui,e),this.inviteUserPosition()}formatWelcomeMessage(e){var t=this.projectTitle;return e.replace(/%projectTitle%/g,t)}buildMobileWelcome(){var e,t,i;this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;var s=document.createElement("div");s.id="gui_mobileWelcomeGuiWindow",s.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(s),this.guiWindowBG.appendChild(s);var a="",r="";if(""!==(null===(e=this.pxlOptions.onboarding.mobile)||void 0===e?void 0:e.message)){var n;a=this.pxlOptions.onboarding.mobile.message,a=this.formatWelcomeMessage(a);var o="";(null===(n=this.pxlOptions.onboarding.mobile)||void 0===n?void 0:n.messageStyle.length)>0&&(o=this.pxlOptions.onboarding.mobile.messageStyle.join(" "),o='class="'.concat(o,'"')),r='<div id="gui_mobileWelcomeMessage" '.concat(o,">").concat(a,"</div>")}var l="guiButton";(null===(t=this.pxlOptions.onboarding.mobile)||void 0===t?void 0:t.buttonStyle.length)>0&&(l=this.pxlOptions.onboarding.mobile.buttonStyle.join(" "));var h="enter";""!==(null===(i=this.pxlOptions.onboarding.mobile)||void 0===i?void 0:i.buttonText)&&(h=this.pxlOptions.onboarding.mobile.buttonText);var c="";c+='\n    <div id="gui_helpContent" class="gui_contentStyle">\n  <div class="pxlGui-mobile-body">\n    '.concat(r,'\n  </div> \n  <div id="gui_helpGui_hotKeys" class="gui_helpGui_mobileHud">\n    Tap-&-Drag the <span class="gui_boldText">Left Circle</span> to move you,\n    <br>The <span class="gui_boldText">Right Circle</span> to look around;\n    <br>\n    <br> Tap the <span class="gui_boldText">upper</span> half of the screen to jump\n    <br>\n    <br> If the screen is black behind this message,\n    <br> Please <span id="refeshPxlPage">refresh</span> the page\n  </div>\n  <div id="guiHelpFooter" class="gui_footer">\n    <div class="').concat(l,'" id="guiMobileWelcomeButton">').concat(h,'</div>\n  </div>\n  <div class="gui_spacer"></div>\n    </div>\n  '),s.innerHTML=c;var d=document.getElementById("refeshPxlPage");d&&(d.onclick=e=>{e.preventDefault(),this.refreshPage()});var A=this;document.getElementById("guiMobileWelcomeButton").onclick=e=>{A.toggleMobileWelcome(!1),A.pxlEnv.postHelpIntro(),A.promptFader(this.guiWindowBG,!1,null,!1),this.pxlDevice.requestFullScreen()},this.guiWindows.mobileGui.gui=s}toggleMobileWelcome(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.mobileGui||this.buildMobileWelcome(),null===e||this.guiWindows.mobileGui.active!==e?(e=null===e?!this.guiWindows.mobileGui.active:e,this.guiWindows.mobileGui.active=e,e?this.promptFader(this.guiWindows.mobileGui.gui,e):this.promptFader(this.guiWindows.mobileGui.gui,e,null,!0),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e)):console.error("Mobile welcome already set to active: "+e)}ctaBuildPopup(){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.cta).then((e=>{this.ctaContentLoading=!1,this.googleDocHTML=e,this.ctaDisplayPopup()}))))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);var e=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");var t=document.createElement("div");t.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(t),this.addToContainer(this.actionPopUp);var i=null;""!==e&&e?(t.innerHTML=e,t.classList.add("iframeGoogleLinkDoc")):((i=document.createElement("iframe")).src="",i.classList.add("iframeGoogleLinkDoc"),t.appendChild(i),i.referrerpolicy="unsafe-url");var s=this;this.actionPopUp.onclick=function(e){"ctaPopup"===e.srcElement.getAttribute("id")&&(s.promptFader(this,!1,null,!0),s.actionPopUp=null)},i?i.onload=function(){setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}:setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}getUserControls(e){if(!e)return[null];var t=e,i=t.userStatusGui,s=t.audio,a=t.audioMuted,r=t.userSoundGui;return{curAvatar:t,curName:t.displayName,curAudio:s,curAudioMuted:a,curGui:i,curNameGui:t.userNameGui,curAudioGui:r,curVerse:t.verse}}setUserControlPosition(){var e=this;return GUIBase_asyncToGenerator((function*(){if(e.userControlBlock){var t=0;if(e.hudTopBar){var i=e.hudTopBar.getBoundingClientRect();t=i.y+i.height}e.userControlBlock.gui.style.top=t+"px"}}))()}buildUserSpeaker(){var e={},t=this.userControlBlock.speakerIcon.svg.cloneNode(!0);t.classList.add("userControlSpeakerStyle"),t.classList.add("userControlSpeakerButtonStyle"),e.gui=t,e.remoteMuted=!1,e.volPrev=0;for(var i=t.children,s=0;s<i.length;++s){var a=i[s],r=a.getAttribute("id");e[r]=a,"mute"===r?a.classList.add("userControlVisStyle"):"button"===r&&a.classList.add("userControlSpeakerButtonStyle")}for(var n=e.volLines.children,o=0;o<n.length;++o){var l=n[o];e[l.getAttribute("id")]=l}n=e.remoteMutedLines.children;for(var h=0;h<n.length;++h){var c=n[h];e[c.getAttribute("id")]=c}return e}addUserControls(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curAvatar:i,curName:s}=t.getUserControls(e),a=document.createElement("div");a.classList.add("userControlProximityOff"),a.classList.add("userControlParentStyle"),a.classList.add("userControlSpeakerButtonStyle"),t.mobile&&(a.style.display="none");var r=t;a.onclick=()=>{r.setUserControlMute(e)},i.userStatusGui=a,t.userControlBlock.gui.appendChild(a);var n=document.createElement("div");n.classList.add("userControlInnerParentStyle"),a.appendChild(n);var o=document.createElement("div");o.classList.add("userControlSpeakerParentStyle");var l=t.buildUserSpeaker();o.appendChild(l.gui),i.userSoundGui=l,n.appendChild(o);var h=document.createElement("div");h.classList.add("userControlNameStyle"),h.innerText=s,i.userNameGui=h,n.appendChild(h),t.setUserControlColor(e)}))()}setUserControlVolume(e,t){var i=arguments,s=this;return GUIBase_asyncToGenerator((function*(){var a=!(i.length>2&&void 0!==i[2])||i[2];if(s.userControlBlock.activeList.includes(e)){var{curAudioGui:r,curAudioMuted:n}=s.getUserControls(e);!r||n&&0!==t||(r.remoteMuted?t=0:a&&t>0&&(t*=2,t=Math.min(1,Math.max(t,.5*(t+r.volPrev)))),r.volPrev=t,r.volLines.style.opacity=t,r.volLines.style.filter="alpha(opacity="+100*t+")")}}))()}setUserControlMute(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curAvatar:i,curAudio:s,curAudioMuted:a,curAudioGui:r}=t.getUserControls(e);if(s){var n=!a;n?(t.setUserControlVolume(e,0,!1),r.mute.classList.add("userControlVisible"),s.volume=0,s.muted=!0):(r.mute.classList.remove("userControlVisible"),s.muted=!1,s.volume=1),i.audioMuted=n}}))()}setUserControlRemoteMute(e){var t=arguments,i=this;return GUIBase_asyncToGenerator((function*(){var s=t.length>1&&void 0!==t[1]?t[1]:null,a=!(t.length>2&&void 0!==t[2])||t[2],r=t.length>3&&void 0!==t[3]?t[3]:"#ffffff",{curAudio:n,curAudioGui:o}=i.getUserControls(e);if(o){null===s&&(s=!!n&&n.muted);var l="object"==typeof s?s.muted:s;o.remoteMuted=l,o.base.setAttribute("fill",l?"#ff0000":r),o.remoteMutedLines.style.display=l||!a?"inline-block":"none",o.remoteS1.setAttribute("stroke",a?"#ff0000":r),o.remoteS2.setAttribute("stroke",a?"#ff0000":r),i.setUserControlVolume(e,0,!1)}}))()}setUserControlVis(e){var t=arguments,i=this;return GUIBase_asyncToGenerator((function*(){var s=t.length>1&&void 0!==t[1]?t[1]:null,{curGui:a}=i.getUserControls(e);if(a){var r="userControlProximityOff";if(null===s&&(s=!a.classList.contains(r)),s)a.classList.remove(r),a.style.maxWidth=a.children[0].getBoundingClientRect().width+"px",i.setUserControlVolume(e,0),i.userControlBlock.activeList.includes(e)||i.userControlBlock.activeList.push(e);else{a.classList.add(r),a.style.maxWidth="30px";var n=i.userControlBlock.activeList.indexOf(e);n>-1&&i.userControlBlock.activeList.splice(n,1)}i.userControlBlock.gui.style.padding=0===i.userControlBlock.activeList.length?"0px":"5px"}}))()}deleteUserControlVis(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curGui:i}=t.getUserControls(e);if(i){i.classList.add("userControlProximityOff"),i.style.maxWidth="30px";var s=t.userControlBlock.activeList.indexOf(e);s>-1&&t.userControlBlock.activeList.splice(s,1),t.userControlBlock.gui.style.padding=0===t.userControlBlock.activeList.length?"0px":"5px",i&&i.parentNode.removeChild(i)}}))()}userControlsSwap(e,t){var i=this.userControlBlock.activeList.indexOf(e);i>-1&&(this.userControlBlock.activeList.splice(i,1),this.userControlBlock.activeList.includes(t)||this.userControlBlock.activeList.push(t))}setUserControlColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{curAvatar:i,curGui:s,curAudioGui:a,curVerse:r}=this.getUserControls(e),n=!0;null===t&&(t="#ffffff");s.style.color=t,a.base.setAttribute("fill",t),a.mute.setAttribute("stroke",t),a.mid.setAttribute("fill",t),a.max.setAttribute("fill",t),a.volPrev=0,a.volLines.style.opacity=0,a.volLines.style.filter="alpha(opacity=0)";var o=this;i.userStatusGui.onclick=()=>{o.setUserControlMute(e)},this.setUserControlRemoteMute(e,null,n,t)}toggleUserControls(e){if(!e)return null}}class ShaderEditor{constructor(e,t){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=e,this.pxlEnv=e.pxlEnv,this.guiManager=t,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.clickThroughListener=this.clickThroughCheck.bind(this),this.shaderSliderValues=new o.Vector3,this.editorWidthMinMax={min:30,max:70}}addSlider(e,t,i,s,a,r,n,o){"string"==typeof e&&(e=document.getElementById(e));var l=document.createElement("div");l.style.display="grid",l.style.gridAutoFlow="column",l.style.alignItems="center",l.style.gridAutoColumns="max-content auto max-content",l.innerHTML="<div class='input_sliderLabel'>"+t+" : </div>";var h=document.createElement("input");h.type="range",h.classList.add("input_sliderRange"),h.min=s,h.max=a,h.step=r,h.value=i,l.appendChild(h);var c=document.createElement("input");c.type="number",c.classList.add("gui_defaultInput"),c.classList.add("input_numberInput"),c.value=i,l.appendChild(c),c.onchange=e=>{h.value=e.target.value},h.onchange=e=>{c.value=e.target.value,n(e.target.value,...o)},h.oninput=e=>{c.value=e.target.value,n(e.target.value,...o)},e.appendChild(l)}updateShaderTextFields(){var e,t,i,s,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a||(a=this.pxlEnv.currentRoom===this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(a,this.shaderSliderValues)}catch(e){return}t=i=s="Unable To Load";try{for(var r in e.uniforms.sliders={type:"v",value:this.shaderSliderValues},t=JSON.stringify(e.uniforms),i=e.vertexShader,s=e.fragmentShader,t="",e.uniforms){var n="float",o={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if("object"===(n=typeof e.uniforms[r].value)){if(n="",!e.uniforms[r].value)continue;n="image"in e.uniforms[r].value?"sampler2D":n+"vec"+Object.keys(e.uniforms[r].value).length}else o.hasOwnProperty(e.uniforms[r].type)&&(n="i"===e.uniforms[r].type?"i":""),o.hasOwnProperty(e.uniforms[r].type)&&(n=o[e.uniforms[r].type]);t+="uniform ".concat(n," ").concat(r,";   ")}i=i.replace(/[\t]/g,"  "),s=s.replace(/[\t]/g,"  ")}catch(e){console.log("Error Reading Shader"),console.log(e)}e&&(e.needsUpdate=!0,this.children.uniformsObj.value=t,this.children.vertObj.value=i,this.children.fragObj.value=s)}buildShaderEditor(){var e="shaderGui",t=document.createElement("div");t.id="guiShaderEditorBlock",t.classList.add("gui_shaderEditorBlockStyle"),t.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(t),this.pxlEnv.pxlGuiDraws.guiWindows[e]={},this.pxlEnv.pxlGuiDraws.guiWindows[e].gui=t,this.pxlEnv.pxlGuiDraws.guiWindows[e].active=!1,this.gui=t;var i=document.createElement("div");i.id="guiShaderHelpBlock",i.classList.add("gui_shaderHelpBlockStyle"),i.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(i),this.pxlEnv.pxlGuiDraws.guiWindows[e].help=i,this.helpGui=i;var s=this.pxlEnv.currentRoom,a=this.pxlEnv.roomSceneList[s].geoList,r=Object.keys(a),n="";r.forEach((e=>{if(["Mesh","Points"].includes(a[e].type)&&"ShaderMaterial"===a[e].material.type){var t=e.substring(0,1).toUpperCase()+e.substring(1,e.length);n+="<option value='geo_"+e+"'>"+t+"</option>"}}));this.pxlEnv.pxlGuiDraws.guiWindows[e].currentShader="script_fog";var o='\n    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">\n      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">\n      <div class="gui_shaderEditorOptionBlock">\n        <div class="gui_shaderEditorTitleBlock">\n        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">\n            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>\n            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">\n              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>\n              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">\n                <option value="script_avatar" '.concat("",'>Avatar</option>\n                <option value="script_fog" ').concat("selected",'>Fog</option>\n                <option value="script_dArrows">Direction Arrows</option>\n                <option value="script_userScreens">User Screens</option>\n                <option value="script_warpZonePortals">Warp Zone Portals</option>\n                <option value="script_lizardking">Item; Lizard King</option>\n                <option value="script_majorTom">Item; Major Tom</option>\n                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>\n                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>\n                ').concat(n,'\n              </select>\n            </div>\n            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">\n              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>\n              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>\n              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>\n              <span class="gui_shaderEditorOptionBarSpacer"> </span>\n              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>\n            </div>\n          </div>\n        </div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n        <div id="guiShaderUserSliders"></div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n      </div>\n      </div>\n      \n      \n      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">\n        <span style=\'height:12px\'>Uniforms -</span>\n        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>\n        <span style=\'height:12px\'>Vertex Shader -</span>\n        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>\n        <span style=\'height:12px\'>Fragment Shader -</span>\n        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>\n      </div>\n      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>\n    </div>\n    '),l="<div class='gui_shaderHelpSpacerStyle'></div>";o+='\n    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">\n      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>\n      '.concat(l,'\n      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>\n      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>\n      ').concat(l,"\n      <span><span class=\"gui_boldText\">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>\n      ").concat(l,'\n      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>\n      ').concat(l,"\n    </div>\n    "),t.innerHTML=o,document.body.appendChild(t);var h=document.getElementById("guiShaderUserSliders");this.parentObj=h;var c=this.shaderSliderValues,d=function sliderSetShader(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];c[i[0]]=e};this.addSlider(h,"sliders.x",0,-1,1,1e-4,d,["x"]),this.addSlider(h,"sliders.y",0,-5,5,.001,d,["y"]),this.addSlider(h,"sliders.z",0,-10,10,.001,d,["z"]),this.children.shaderSliders=h,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");var A=document.getElementById("gui_shaderEditorFontSize");A.style.justifySelf="end",A.style.marginTop="2px",A.style.marginRight="3px",A.style.userSelect="none",A.style.display="flex",A.style.alignItems="center";var u=this;this.children.shaderSelect.onchange=e=>{u.updateShaderTextFields(this.children.shaderSelect.value)},document.getElementById("gui_shaderEditorFontSmaller").onclick=e=>{u.shiftFontSize(-.15)},document.getElementById("gui_shaderEditorFontLarger").onclick=e=>{u.shiftFontSize(.15)},document.getElementById("gui_shaderEditorCloseButton").onclick=e=>{u.toggleShaderEditor()},this.children.updateObj.addEventListener("click",(()=>{this.isEditing=!1;var e=document.getElementById("shaderEditor_uniformInput").value,t=document.getElementById("shaderEditor_vertInput"),i=t.value,s=document.getElementById("shaderEditor_fragInput"),a=s.value,r=document.createElement("div");r.innerHTML=e,e=r.innerText,r.innerHTML=i,i=r.innerText,r.innerHTML=a,a=r.innerText,u.pxlEnv.roomSceneList[u.pxlEnv.currentRoom].setShader(e,i,a),t.blur(),s.blur(),u.guiManager.pxlNavCanvas.focus()})),this.children.vertObj.onfocus=e=>{u.focusShaderMessage(e,"vertObj")},this.children.vertObj.onkeydown=e=>{u.keyShaderMessage(e)},this.children.vertObj.onmousedown=e=>{u.mDownShaderMessage(e)},this.children.vertObj.onclick=e=>{u.clickShaderMessage(e)},this.children.vertObj.ondblclick=e=>{u.dblclickShaderMessage(e)},this.children.fragObj.onfocus=e=>{u.focusShaderMessage(e,"fragObj")},this.children.fragObj.onkeydown=e=>{u.keyShaderMessage(e)},this.children.fragObj.onmousedown=e=>{u.mDownShaderMessage(e)},this.children.fragObj.onclick=e=>{u.clickShaderMessage(e)},this.children.fragObj.ondblclick=e=>{u.dblclickShaderMessage(e)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(e){var t=document.getElementById("gui_shaderEditorParent");if(t){t.hasAttribute("styleStore")||t.setAttribute("styleStore",1);var i=parseFloat(t.getAttribute("styleStore"))+e;t.setAttribute("styleStore",i),t.style.fontSize=i+"em";var s=document.getElementById("shaderEditor_uniformInput");s&&(s.style.fontSize=i+"em");var a=document.getElementById("shaderEditor_vertInput");a&&(a.style.fontSize=i+"em");var r=document.getElementById("shaderEditor_fragInput");r&&(r.style.fontSize=i+"em"),setTimeout((()=>{this.resizeShaderElements()}),130)}}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(e){this.mouseX=e.x,this.mouseY=e.y}clickShaderMessage(e){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){var t=Math.abs(this.mouseX-e.x),i=Math.abs(this.mouseY-e.y);if(Math.max(t,i)<5){var s=e.target,a=s.selectionStart,r=s.selectionEnd;a!==r&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=a,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=r)}}}dblclickShaderMessage(e){var t=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,i=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,s=e.target,a=s.value.substring(t,i+20),r=a.match(/[a-zA-Z0-9._[\]]+/);r&&!a[0].match(/\n/)&&(i=t+r[0].length),s.setSelectionRange(t,i),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout((()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1}),500)}keyShaderMessage(e){if(e.repeat)return!1;var t=e.key,i=e.code,s=e.shiftKey,a=e.ctrlKey,r=i.includes("Numpad");if(!("Enter"===t||"Tab"===t||"KeyD"===i&&a||"KeyK"===i&&a||r&&a||i.includes("Arrow")&&a))return!1;e.preventDefault();var n=e.target;if("NumpadAdd"===i){var o=window.getComputedStyle(n),l=parseFloat(o.fontSize)+2;return n.style.fontSize=l,!1}if("NumpadSubtract"===i){var h=window.getComputedStyle(n),c=parseFloat(h.fontSize)-2;return n.style.fontSize=c,!1}var d=n.selectionStart,A=n.selectionEnd,u=n.value;if(i.includes("Arrow")){if(d===A)return!1;var p,m,g,v=u.substring(d,A);if("ArrowUp"===i?(m=u.substring(0,d),d=m.search(/.*$/),i="ArrowLeft"):"ArrowDown"===i&&(m=u.substring(A,u.length),A=m.search(/\n/)+A,i="ArrowRight"),"ArrowLeft"===i){p=new RegExp(v+".*","gm");var f=[...(m=u.substring(0,d)).matchAll(v,"g")];if(0===f.length&&0===(f=[...u.matchAll(v,"g")]).length)return!1;g=f.pop().index}if("ArrowRight"===i){p=new RegExp(v,"m"),m=u.substring(A,u.length);var b=p.exec(m);if(b)g=b.index+A;else{if(!(b=p.exec(u)))return!1;g=b.index}}if(g>-1){var x=g+v.length;n.setSelectionRange(g,x);var C=n.getBoundingClientRect(),E=window.getComputedStyle(n).font,y=[u.slice(0,g),"<span id='tmpShaderPosition'>.</span>",u.slice(g)].join("");y=y.replace(/(?:\r\n|\r|\n)/g,"<br>");var I=document.createElement("div");I.style.position="fixed",I.style.width=C.width,I.style.height=C.height,I.style.overflowY="scroll",I.style.font=E,I.innerHTML=y,document.body.appendChild(I);var B=I.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(I),n.scrollTo(0,B)}return!1}if("Enter"===t&&a)return this.children.updateObj.click(),n.focus(),n.setSelectionRange(d,A),!1;if(r){var w=u.substring(d,A),S=w.length>0,D=u.substr(d-1,1);D=/[\w|\d]/.test(D)&&0===w.length?" ":"";var P=u.substr(A+1,1);P=/[\w|\d]/.test(P)&&0===w.length?" ":"";var T=d+D.length;if("Numpad1"===i){var R="float(";T+=6,w=R+(w=S?w:".0")+")"}else if("Numpad2"===i){var Q="vec2(";T+=5,w=Q+(w=S?w:".0, .0")+")"}else if("Numpad3"===i){var k="vec3(";T+=5,w=k+(w=S?w:".0, .0, .0")+")"}return w=D+w+P,document.execCommand("insertText",!1,w),S||n.setSelectionRange(T,T),!1}var L=Math.min(d,A),M=u.substr(0,L);if("KeyK"===i){var F,O,G,_=!1;if(d!==A&&(F=M.search(/.*$/),O=A,G=u.substring(F,A),_=/\n/.test(G)),!_){var U=M.search(/[\S\w].*$/);if(-1===U){if(-1===(U=u.substring(L,u.length).search(/(?:[^\s])/)))return!1;U+=L}var N=U,j=N,H="";if(s){if(j+=2,"//"!==u.substr(N,2))return!1;d-=2,A-=2}else{if("//"===u.substr(N,2))return!1;H="//",d+=2,A+=2}return n.setSelectionRange(N,j),document.execCommand("insertText",!1,H),n.setSelectionRange(d,A),!1}if(_){var V=O+u.substring(O,u.length).search(/\n./),W=u.substring(F,V),K=s?-2:2,z=[...W.matchAll(/[\S\w].*/g)],q=[],Y=d-F,J=O-F;return z.forEach((e=>{var t=e.index;q.push(t)})),(q=q.reverse()).forEach((e=>{var t=W.substr(e,2);if(s){if("//"!==t)return;W=W.substring(0,e)+W.substring(e+2,W.length)}else{if("//"===t)return;W=W.substring(0,e)+"//"+W.substring(e,W.length)}d+=e<Y?K:0,A+=e<J?K:0})),n.setSelectionRange(F,V),document.execCommand("insertText",!1,W),n.setSelectionRange(d,A),!1}return!1}var X=M.split("\n");if("Enter"===t||"Tab"===t){var Z=X.pop();0===Z.length&&(Z=X.pop());var $=Z.replace(/[\S\w].*$/g,""),ee=$="Tab"===t?" "===($=0===$.length?" ":$.substr(0,1))?"  ":"\t":"\n"+$,te=d,ie=A;if("Tab"===t&&d!==A){var se=u.substring(d,A);se=se.split("\n"),se=s?se.map((e=>""===e?e:e.replace($,""))):se.map((e=>""===e?e:$+e)),ie=te+(ee=se.join("\n")).length}else ie=te+=ee.length;return document.execCommand("insertText",!1,ee),n.setSelectionRange(te,ie),!1}if("KeyD"===i&&a)if(d===A){var ae=u.split("\n");X.pop();var re=ae[X.length],ne=[...X,re].join("\n").length;re="\n"+re,n.setSelectionRange(ne,ne),document.execCommand("insertText",!1,re),ne=L+re.length,n.setSelectionRange(ne,ne)}else{var oe=u.substring(d,A);n.setSelectionRange(A,A),document.execCommand("insertText",!1,oe),A+=oe.length,n.setSelectionRange(A,A)}return!1}updateShaderList(){var e=this.children.shaderSelect;if(!e)return console.log("No Object shader pulldown found."),void console.log(this.gui);var t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),i=Object.keys(t),s="",a=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();i.forEach((e=>{var i=e===a?" selected":"";s+='<option value="'.concat(e,'" ').concat(i,">").concat(t[e],"</option>")})),e.innerHTML=s}resize(e){this.resizeShaderElements()}resizeShaderElements(){var e=0;if(this.hudBottomBar&&(e=this.hudBottomBar.offsetHeight),this.children.headerBar&&(e+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=window.innerHeight-e;var t=this.children.vertObj.getBoundingClientRect().top,i=this.children.updateObj.getBoundingClientRect().height;i+=40;var s=window.innerHeight-i-t;this.children.vertObj.style.maxHeight=.4*s+"px",this.children.vertObj.displayHeight=.4*s,this.children.fragObj.style.maxHeight=.6*s+"px",this.children.fragObj.displayHeight=.6*s,this.children.fieldBodyHeight=s}}toggleShaderEditor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),e=null===e?!this.active:e,this.active=e,this.guiManager.promptFader(this.gui,e),this.guiManager.promptFader(this.helpGui,e),this.pxlEnv.emit("shaderEditorVis",e),e?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout((()=>{this.resizeShaderElements()}),130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur(),document.getElementById("guiShaderEditorBlock").style.maxWidth=this.editorWidthMinMax.min+"vw";var e=document.getElementById("gui_shaderHelpBlock");e&&(e.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");var t=document.getElementById("shaderEditor_loadShader");t&&(t.style.maxWidth="85px"),this.disconnectFocusListener(),this.updateHeaderBar(),setTimeout((()=>{this.resizeShaderElements()}),130)}focusShaderMessage(e,t){var i;this.isEditing=!0;var s=this.children,a=s.vertObj.displayHeight,r=s.fragObj.displayHeight,n=Math.max(150,.135*window.innerHeight),o=s.fieldBodyHeight-n;a="vertObj"===t?o:n,r="fragObj"===t?o:n,s.vertObj.style.maxHeight=a+"px",s.fragObj.style.maxHeight=r+"px",this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",null!==(i=this.children)&&void 0!==i&&i.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");var l=document.getElementById("gui_shaderHelpBlock");l&&(l.style.left=this.editorWidthMinMax.max+"vw"),this.connectFocusListener(),this.updateHeaderBar()}clickThroughCheck(e){for(var t=e.x,i=e.y,s=document.elementsFromPoint(t,i),a=0;a<s.length;++a){if("gui_shaderEditorParent"===s[a].id)return}this.blurShaderEditor()}connectFocusListener(){document.addEventListener("mousedown",this.clickThroughListener)}disconnectFocusListener(){document.removeEventListener("mousedown",this.clickThroughListener)}}class ElementBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hudRegion",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.name=e,this.object=null,this.type=Ye.REGION,this.pxlOptions=null,this.pxlEnums=null,this.pxlDevice=null,this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=0,this.dragThreshold=10,this.startPos=null,this.currentPos=null,this.previousPos=null,this.startDelta={x:0,y:0},this.stepDelta={x:0,y:0},this.defaultObject={pos:{x:0,y:0},bbox:{width:0,height:0},draw:Xe.DEFAULT,style:[],objectStyles:[],objectStyleKeys:[]},this.defaultObjectStyleEntry={object:"parent",base:["pxlNav-hudElement-thumbstick-default"],hover:["pxlNav-hudElement-thumbstick-hover"],active:["pxlNav-hudElement-thumbstick-active"]},"object"!=typeof t&&(t={}),(t=Object.assign(this.defaultObject,t)).objectStyles.length>0&&t.objectStyles.forEach((e=>{t.objectStyleKeys.push(e.object)})),this.data=t,this.callbacks=[]}setDependencies(pxlNav){this.pxlOptions=pxlNav.pxlOptions,this.pxlEnums=pxlNav.pxlEnums,this.pxlDevice=pxlNav.pxlDevice}build(){var e=this.createMainElement();return e.classList.add("pxlNav-hudElement-region"),this.object=e,this.object.ontouchstart=this.ontouchstart.bind(this),this.object.ontouchend=this.ontouchend.bind(this),e}createMainElement(){var e=document.createElement("div");return this.data.hasOwnProperty("id")&&(e.id=this.data.id),this.data.hasOwnProperty("style")&&this.data.style.forEach((t=>{e.classList.add(t)})),this.object=e,e}ontouchstart(e){this.emit(!0)}ontouchmove(e){}ontouchend(e){this.emit(!1)}updateStyle(){}subscribe(e){this.callbacks.push(e)}emit(e){this.callbacks.forEach((function(t){t(e)}))}}class DragRegion extends ElementBase{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hudDrawRegion",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=Ye.DRAG_REGION,this.dragThreshold=10}build(){var e=this.createMainElement();return e.classList.add("pxlNav-hudElement-dragRegion"),e}ontouchstart(e){}ontouchmove(e){}ontouchend(e){}}class Thumbstick extends ElementBase{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=Ye.THUMBSTICK,this.block=null,this.currentState=Je.NONE,this.innerObj=null,this.blockStyleOverrides=null,this.parentStyleOverrides=null,this.innerStyleOverrides=null}build(){var e=this.createMainElement();e.classList.add("pxlNav-hudElement-thumbstick-block");var t=document.createElement("div");t.classList.add("pxlNav-hudElement-thumbstick"),e.appendChild(t);var i=document.createElement("div");if(i.classList.add("pxlNav-hudElement-thumbstick-inner"),t.appendChild(i),e.ontouchstart=this.ontouchstart.bind(this),e.ontouchmove=this.ontouchmove.bind(this),e.ontouchend=this.ontouchend.bind(this),this.block=e,this.object=t,this.innerObj=i,this.data.hasOwnProperty("objectStyleKeys")&&this.data.objectStyleKeys.length>0){var s=this.data.objectStyleKeys.indexOf("block"),a=this.data.objectStyleKeys.indexOf("parent"),r=this.data.objectStyleKeys.indexOf("inner");s>=0&&(this.blockStyleOverrides=this.data.objectStyles[s],this.blockStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((t=>{e.classList.add(t)}))),a>=0&&(this.parentStyleOverrides=this.data.objectStyles[a],this.parentStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((e=>{t.classList.add(e)}))),r>=0&&(this.innerStyleOverrides=this.data.objectStyles[r],this.innerStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach((e=>{i.classList.add(e)})))}return e}getTouchId(e){if(!e.touches||e.touches.length<1)return-1;if(1===e.touches.length)return e.touches[0].identifier;for(var t=null,i=0;i<e.touches.length;++i){var s=e.touches[i];if(s.target===this.block){t=s.identifier;break}}return t}getTouchInfo(e){if(-1===this.touchId||!e.touches||e.touches.length<1)return null;for(var t=null,i=0;i<e.touches.length;++i)if(e.touches[i].identifier===this.touchId){t=e.touches[i];break}return t}ontouchstart(e){e.preventDefault(),e.stopPropagation(),this.isDown=!0,this.isDragging=!1,this.dragCount=-1,this.touchId=this.getTouchId(e);var t=this.getTouchInfo(e);t&&(this.startPos={x:t.clientX,y:t.clientY},this.updateStyle())}ontouchmove(e){if(e.preventDefault(),e.stopPropagation(),this.isDown){var t,i;this.dragCount++,this.isDragging||(Math.abs(this.startDelta.x)>this.pxlOptions.userSettings.deadZone.touch||Math.abs(this.startDelta.y)>this.pxlOptions.userSettings.deadZone.touch)&&(this.isDragging=!0);var s=this.getTouchInfo(e);if(!s)return;var a=(null===(t=this.currentPos)||void 0===t?void 0:t.x)||s.clientX,r=(null===(i=this.currentPos)||void 0===i?void 0:i.y)||s.clientY;this.previousPos={x:a,y:r},this.currentPos={x:s.clientX,y:s.clientY},this.startDelta={x:this.currentPos.x-this.startPos.x,y:this.currentPos.y-this.startPos.y},this.stepDelta={x:this.currentPos.x-this.previousPos.x,y:this.currentPos.y-this.previousPos.y},this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:this.currentPos,startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!0}),this.updateStyle()}}ontouchend(e){e.preventDefault(),e.stopPropagation(),this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:Object.assign({},this.currentPos),startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!1}),this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=-1,this.currentPos=null,this.startPos=null,this.prevPos=null,this.updateStyle()}updateStyle(){if(this.innerObj&&this.object)if(this.isDown&&!this.isDragging)this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.currentState=Je.HOVER;else if(this.isDragging){if(this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.innerStyleOverrides),this.currentState!==Je.ACTIVE){var e=this.object.getBoundingClientRect(),t=e.width/2+e.left,i=e.height/2+e.top,s=Math.max(.085*-this.pxlDevice.sW,Math.min(.085*this.pxlDevice.sW,this.startPos.x-t)),a=Math.max(.095*-this.pxlDevice.sH,this.startPos.y-i);this.object.style.left=s+"px",this.object.style.top=a+"px"}var r=this.startDelta.x,n=this.startDelta.y,o=Math.max((r**2+n**2)**.5,1);o>80&&(r=r/o*80,n=n/o*80),this.innerObj.style.left=r+"px",this.innerObj.style.top=n+"px",this.currentState=Je.ACTIVE}else this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.object.style.left="0px",this.object.style.top="0px",this.currentState=Je.NONE}toggleStyle(e,t){if(e!==t.currentAction){var i=[this.pxlEnums.HUD_ACTION.NONE,this.pxlEnums.HUD_ACTION.HOVER,this.pxlEnums.HUD_ACTION.ACTIVE],s=i.indexOf(e),a=null;"block"===t.object?a=this.block:"parent"===t.object?a=this.object:"inner"===t.object&&(a=this.innerObj),i.forEach(((e,i)=>{i!==s?t[e].forEach((e=>{a.classList.remove(e)})):t[e].forEach((e=>{a.classList.add(e)}))})),t.currentAction=e}}subscribe(e){this.callbacks.push(e)}}var $e=__webpack_require__(312);function Video_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function Video_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){Video_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){Video_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}var et={Utils:class Utils{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"images/assets/",t=arguments.length>1?arguments[1]:void 0;this.assetRoot=e,this.mobile=t,this.pxlTimer=null,this.pxlEnums=null,this.verboseLoading=!1,this.texLoader=new o.ImageLoader,this.textLoaderArray=[],this.channelFormats=[o.AlphaFormat,o.RedFormat,o.RGFormat,o.RGBFormat,o.RGBAFormat,o.DepthFormat]}get curMS(){return this.pxlTimer.curMS}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlEnums=pxlNav.pxlEnums}updateUrl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.history.replaceState?window.history.replaceState(t,i,e):window.history.pushState(t,i,e)}copyRoomUrl(){var e=window.location,t=document.activeElement,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();var s=!1;try{s=document.execCommand("copy")?"successful":"unsuccessful"}catch(e){}return document.body.removeChild(i),t.focus(),s}checkInt(e){return e%1==0}degToRad(e){return e*(Math.PI/180)}toHundreths(e){if(!e)return 0;if(Number.isInteger(e))return e;var t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,2))}toTenths(e){if(!e)return 0;if(Number.isInteger(e))return e;var t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,1))}getDateTime(){var e=new Date;return[(e.getFullYear()+"").padStart(2,"0")+"-"+(e.getMonth()+1+"").padStart(2,"0")+"-"+(e.getDate()+"").padStart(2,"0"),(e.getHours()+"").padStart(2,"0")+":"+(e.getMinutes()+"").padStart(2,"0")+":"+(e.getSeconds()+"").padStart(2,"0")]}cleanStrict(e){var t=document.createElement("div");t.innerHTML=e;var i=(t=t.innerText).match(/([a-zA-Z0-9])\w+/g);return i&&(t=i.join(" ")),t}cleanBasic(e){var t=document.createElement("div");t.innerHTML=e;var i=(t=t.innerText).match(/([a-zA-Z0-9\s\w-+()[\]])+/g);return i&&(t=i.join("")),t}cleanString(e){var t=document.createElement("div");return t.innerHTML=e,t=t.innerText}toNearestStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)}arrayToStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=[];return e.forEach((e=>{i.push(this.toNearestStr(e,t))})),i}flattenArrayToStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",";return this.arrayToStr(e,t).join(i)}randomFloat(e,t){return Math.random()*(t-e)+e}screenToNDC(e,t,i,s){var a=e/i*2-1,r=-t/s*2+1;return new o.Vector2(a,r)}componentToHex(e){return e.toString(16).padStart(2,"0")}rgbToHex(e,t,i){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(e))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(t))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(i))))}hexToRgb(e){var t,i,s;return 3===(e="#"===e[0]?e.substr(1,6):e.substr(0,6)).length?(t=e[0]+e[0],i=e[1]+e[1],s=e[2]+e[2]):(t=e[0]+e[1],i=e[2]+e[3],s=e[4]+e[5]),[t=parseInt(t,16),i=parseInt(i,16),s=parseInt(s,16)]}stringToRgb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=[255,0,0];if(e){for(var a=e.length,r="",n=0;n<a;++n)r+=e[a-1-n].charCodeAt(0).toString(16);var o=r.length;if(o>6){var l=1;"tussin"===e?l=0:"fexofenadine"===e&&(l=-1);var h=Math.max(0,parseInt((o-6)/2+l));r=r.substr(h,6)}s=this.hexToRgb(r)}if(null!=t){var c=Math.max(...s),d=Math.min(...s),A=c*t;s[0]=parseInt(Math.min(255,(s[0]-d)/(c-d)*255+A)),s[1]=parseInt(Math.min(255,(s[1]-d)/(c-d)*255+A)),s[2]=parseInt(Math.min(255,(s[2]-d)/(c-d)*255+A))}return!0===i&&(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255),s}colorTosRGB(e){return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.tosRGB(e.r),e.g=this.tosRGB(e.g),e.b=this.tosRGB(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.tosRGB(e.x),e.y=this.tosRGB(e.y),e.z=this.tosRGB(e.z)),e):e}tosRGB(e){return e<=.0031308?e*=12.92:e=1.055*Math.pow(e,this.oneTwoPFour)-.055,e}colorToLinear(e){return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.toLinear(e.r),e.g=this.toLinear(e.g),e.b=this.toLinear(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.toLinear(e.x),e.y=this.toLinear(e.y),e.z=this.toLinear(e.z)),e):e}toLinear(e){return e<=.04045?e*=this.twelvePNineTwoDiv:e=Math.pow((e+.055)*this.onePOFiveFiveDiv,2.4),e}gammaCorrectColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.2",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1.8";return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.gammaCorrect(e.r,t,i),e.g=this.gammaCorrect(e.g,t,i),e.b=this.gammaCorrect(e.b,t,i)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.gammaCorrect(e.x,t,i),e.y=this.gammaCorrect(e.y,t,i),e.z=this.gammaCorrect(e.z,t,i)),e):e}gammaCorrection(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.2",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1.8",s=Math.pow(e,t);return Math.pow(s,1/i)}convertColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pxlEnums.COLOR_SHIFT.KEEP;if(t===this.pxlEnums.COLOR_SHIFT.KEEP)return e;var i=e.clone();switch(t){case this.pxlEnums.COLOR_SHIFT.sRGB_TO_LINEAR:i=this.colorTosRGB(i);break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_sRGB:i=this.colorToLinear(i);break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_UNIX:i=this.gammaCorrectColor(i,"2.2","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.8","2.2");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.0","2.2");break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_LINEAR:i=this.gammaCorrectColor(i,"2.2","1.0");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_UNIX:i=this.gammaCorrectColor(i,"1.0","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_LINEAR:i=this.gammaCorrectColor(i,"1.8","1.0")}return i}randomizeArray(e){for(var t=[...e],i=[];t.length>0;){var s=1===t.length?0:parseInt(21*Math.random()*t.length)%t.length;i.push(t.splice(s,1)[0])}return i}getRandom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.14;return e[Math.floor(Math.random(t)*e.length)]}applyTransformList(e,t){var i=t.r;e.rotateX(i[0]),e.rotateY(i[1]),e.rotateZ(i[2]),void 0!==t.rOrder&&(e.rotation.order=t.rOrder);var s=t.t;e.position.set(s[0],s[1],s[2]);var a=t.s;e.scale.set(a[0],a[1],a[2]),e.matrixAutoUpdate=!1,e.updateMatrix()}vec2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new o.Vector2(e,t)}vec3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new o.Vector3(e,t,i)}loadTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.includes("/")||(e=this.assetRoot+e);var s=null;if(void 0!==this.textLoaderArray[e])s=this.textLoaderArray[e];else{s=new o.Texture;var a=Object.keys(i);this.texLoader.load(e,(e=>{null!=t&&(s.format=this.channelFormats[t]),s.image=e,s.needsUpdate=!0,a.length>0&&a.forEach((e=>{s[e]=i[e]}))}),void 0,(t=>{console.error(" TextureLoader :: Error loading texture :: "+e),console.error(t)})),this.textLoaderArray[e]=s}return s}getVideoTexture(e){var t=new o.VideoTexture(e);return t.minFilter=o.LinearFilter,t.magFilter=o.LinearFilter,t.format=o.RGBFormat,t}getCanvasTexture(e){var t=new o.CanvasTexture(e);return{texture:t,material:new o.MeshBasicMaterial({map:t})}}dupeArray(e,t){return Array.from({length:t}).fill(e)}},FileIO,QualityController:class QualityController{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlRendering=null,this.pxlEnv=null,this.msLog=0,this.prevMS=.001*(new Date).getTime(),this.autoQuality=!1,this.percent=1,this.verbose=e,this.screenResPerc=1,this.mBlurPercMult=t?.65:1,this.bloomPercMult=t?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new o.Vector3(30,0,.001*(new Date).getTime()),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(i).includes("dlimit")?i.dlimit:0,this.detailLimit=null!=this.detailLimitOverride?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlCookie=pxlNav.pxlCookie,this.pxlDevice=pxlNav.pxlDevice,this.pxlRendering=pxlNav.pxlRendering,this.pxlEnv=pxlNav.pxlEnv}init(){if(null!=this.detailLimitOverride?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=je.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse")),this.pxlCookie.hasCookie("qualitySetting")){var e=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=e,this.settingsQualityChoice=e}}step(){this.mapFpsQualitCheck()}attachModule(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this.moduleQualityList.push(e)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();var e=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=e,this.benchmarkRating=1-Math.min(1,Math.max(0,(e-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];var t=Math.min(1,Math.max(0,this.benchmarkRating));(t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t,this.setFromBenchmark)?this.setQualityLevel(this.qualityStep):(null===this.settingsQualityChoice&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach((e=>{this.settingsCustom[e]=this.settings[e]})));this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;var e=1;this.fpsCounter.x<15&&(e=-1);var t=Math.min(1,Math.max(0,this.percent+this.shiftRate*e));this.autoQuality&&this.mapAutoQualityUpdate(t,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Math.min(1,Math.max(0,e));t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t}setGraphicsSettings(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(null===e)if(0===this.qualityStep)e=this.settingsLow;else if(1===this.qualityStep)e=this.settingsMedium;else{if(2!==this.qualityStep)return;e=this.settingsHigh}3===t&&this.checkCustomDict(),Object.keys(e).forEach((i=>{this.setComponentQuality(i,e[i]),this.settings[i]=e[i],3===t&&(this.settingsCustom[i]=e[i])})),this.setDependentSettings(),this.colliderPrevObjHit=null,null!=t&&(this.settings.graphics=t)}reapplySettings(){Object.keys(this.settingsLow).forEach((e=>{this.setComponentQuality(e,this.settings[e],!1)})),this.setDependentSettings()}setQualityLevel(e){this.pxlDevice.mobile&&(e=1),this.setQualityCookie(e),0===e?this.setLowQuality():1===e?this.setMediumQuality():2===e?this.setHighQuality():3===e&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(null===this.settingsCustom){this.settingsCustom={};var e=this.settingsHigh;this.settingsQualityChoice&&(0===this.settingsQualityChoice?e=this.settingsLow:1===this.settingsQualityChoice?e=this.settingsMedium:2===this.settingsQualityChoice&&(e=this.settingsHigh)),Object.assign(this.settingsCustom,e)}}setQualityCookie(e){this.pxlCookie.setCookie("qualitySetting",e)}setComponentQuality(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(e){case"leftRight":case"mouse":this.settings[e]=t;break;case"resolution":this.screenResPerc=t,this.pxlDevice.resizeRenderResolution(),this.settings[e]=t,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*t);break;case"fog":this.pxlRendering.mapOverlayHeavyPass&&(this.pxlRendering.mapOverlayHeavyPass.enabled=2===t),this.pxlRendering.mapOverlayPass&&(this.pxlRendering.mapOverlayPass.enabled=1===t),this.pxlRendering.mapOverlaySlimPass&&(this.pxlRendering.mapOverlaySlimPass.enabled=0===t),this.pxlRendering.mapBoxAAPass.enabled&&(this.pxlRendering.mapBoxAAPass.enabled=2===t),this.pxlRendering.mapCrossAAPass.enabled&&(this.pxlRendering.mapCrossAAPass.enabled=1===t),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=1),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0===t?.7:.3),this.settings[e]=t;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=t?.4:1,this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=t),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=t),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=t),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=t?.65:.8,this.pxlEnv.userScreenIntensity.y=t?0:.8),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0===t?.7:.3),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t;break;case"motion":this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t}i&&this.pxlCookie.setCookie(e,t)}setDependentSettings(){var e,t,i=1,s=0,a=.6,r=!1,n=!1,o=!1,l=!1,h=!1,c=!1;(2===this.settings.fog?(r=!1,n=!0,o=!1,l=!1,h=!0,c=!1,i=.5):1===this.settings.fog?(r=!1,n=!1,o=!0,l=!1,h=!1,c=!0,i=.5):(r=!1,o=!1,l=!0,h=!1,c=!1,i=.4),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=r),n&&(this.pxlRendering.mapOverlayHeavyPass.enabled=n),o&&(this.pxlRendering.mapOverlayPass.enabled=o),l&&(this.pxlRendering.mapOverlaySlimPass.enabled=l),h&&(this.pxlRendering.mapBoxAAPass.enabled=h),c&&(this.pxlRendering.mapCrossAAPass.enabled=c),this.settings.bloom)?(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!0),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!0),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!0),this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,s=1,a=.25):(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!1),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!1),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!1),null!==(e=this.pxlRendering.mapComposerGlow)&&void 0!==e&&e.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.mapComposerGlow.renderTarget2),this.pxlRendering.engine.clear()),null!==(t=this.pxlRendering.roomGlowPass)&&void 0!==t&&t.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.roomGlowPass.renderTarget2),this.pxlRendering.engine.clear()),this.pxlRendering.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,i=1,s=0,a=.5);var d=this.pxlEnv.geoList.Circular_Gate;d&&(d.material.uniforms.bloomBoost.value=s),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);var A=this.pxlEnv.geoList.CirculateGateVideoSphere;A&&(A.material.color.r=a,A.material.color.g=a,A.material.color.b=a),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=i),this.pxlEnv.pxlCamera.colliderCurObjHit=null}},CookieManager:class CookieManager{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pxlNav-",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,a="-"===t.substring(-1)?t:t+"-";this.prepend=a,this.verbose=e,this.exp=s,this.path="path="+i,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}log(){if(this.verbose>=je.INFO){console.log("-- Cookie Manager --");for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.log(e)}))}}getExpiration(){var e=new Date;return e.setTime(e.getTime()+24*this.exp*60*60*1e3),"expires="+e.toGMTString()+";"}isEqual(e){return!!this.hasCookie(e)&&(this.log(e),this.readCookie(e)===this.variableToString(e))}getRegexp(e){return new RegExp("(?="+e+").*?((?=;)|(?=$))","g")}getClearCookieRegexp(e){return new RegExp("(?="+e+").*?(?==)","g")}pullData(){var e=document.cookie,t=this.getRegexp(this.prepend),i=e.match(t),s={};return i&&i.forEach((e=>{var t=e.split("=")[0].replace(this.prepend,""),i=e.split("=")[1].replace(this.sub,";");s[t]=i})),s}valueToString(e){var t=typeof e;return isNaN(Number(e))?"string"===t?"'"+e+"'":"boolean"===t?e?"true":"false":null==e?"null":isNaN(Number(e))?"NaN":e:e}variableToString(e){if(Array.isArray(e)){var t=e.map((e=>Array.isArray(e)?this.variableToString(e):this.valueToString(e)));return"["+t.join(",")+"]"}return this.valueToString(e)}hasCookie(e){return document.cookie.includes(this.prepend+e)}readCookie(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e);return document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e),i=document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return"true"===i?i=!0:"false"===i?i=!1:parseInt(i)===i?i=parseInt(i):parseFloat(i)===i&&(i=parseFloat(i)),i}return null}evalCookie(e){if(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e);return this.log("Eval Cookie has been limited, responce is: "),this.log(document.cookie.match(t)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}var i=this.getRegexp(this.prepend);return this.log("Eval Cookie has been limited, may error."),document.cookie.match(i).forEach((e=>{e.replace(this.prepend,"").replace(this.sub,";")})),!0}setCookie(e,t){(t=this.variableToString(t)).replace&&t.replace(";",this.sub),document.cookie=this.prepend+e+"="+t+";"+this.getExpiration()+this.path}addDictionary(e){for(var t=Object.keys(e),i=0;i<t.length;++i){var s=e[t[i]];(s=this.variableToString(s)).replace&&s.replace(";",this.sub),document.cookie=this.prepend+t[i]+"="+s+";"+this.getExpiration()+this.path}}parseDict(e){var t=Object.keys(e),i=!1;return t.forEach((t=>{this.hasCookie(t)&&(e[t]=this.parseCookie(t),i=!0)})),i}clearCookie(e){if(e)"string"==typeof e&&(e=[e]),e.forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}));else{var t=this.getClearCookieRegexp(this.prepend);document.cookie.match(t).forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}))}}},Timer:class Timer{constructor(){this.active=!1,this.msRunner=new o.Vector2(0,0),this.msLog=0,this.fpsStats=-1,this._msRate=.001,this.baseRate=.001;var e=(new Date).getTime()*this._msRate;this._bootMS=e,this._prevWorldMS=e,this._curMS=e,this._prevMS=e,this.deltaTime=0,this.avgDeltaTime=0,this.avgDeltaRate=.7,this.videoFeeds=[],this.booted=!1}init(){this.booted||(this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step(),this.booted=!0)}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=(new Date).getTime()*this._msRate}get prevMS(){return this._prevMS}set prevMS(e){this._prevMS=e}scaleTime(e){this._msRate=this.baseRate*e}start(){this.play()}pause(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.active=null===e?!this.active:!!e,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){var e=this._curMS;if(this.updateTime(),this._curMS!==e){this.prevMS=e,-1!==this.fpsStats&&this.fpsStats.update();var t=this.curMS-this.prevMS;this.avgDeltaTime=this.deltaTime*(1-this.avgDeltaRate)+t*this.avgDeltaRate,this.deltaTime=t,this.msRunner.x+=t>0?t:0,this.msRunner.y=this.avgDeltaTime}else this._curMS=e}getLerpRate(e){return 1-Math.pow(.5,this.deltaTime*e)}getLerpAvgRate(e){return 1-Math.pow(.5,this.avgDeltaTime*e)}},User:class User{constructor(){this.pxlEnums=null,this.pxlEnv=null,this.pxlTimer=null,this.id=null,this.Stats=null,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.moveSpeed=1,this.moveSpeedSlow=.5,this.moveSpeedBase=1,this.moveSpeedBoost=2,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lizardKingPass=null,this.sField=0,this.sFieldWarp=0,this.starFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.crystallinePass=null}setDependencies(pxlNav){this.pxlEnums=pxlNav.pxlEnums,this.pxlEnv=pxlNav.pxlEnv,this.pxlTimer=pxlNav.pxlTimer}setSlowSpeed(e){e=Math.max(.001,e),this.moveSpeedSlow=e}setBaseSpeed(e){e=Math.max(.001,e),this.moveSpeedBase=e}setBoostSpeed(e){e=Math.max(.001,e),this.moveSpeedBoost=e}setSpeed(e){switch(e){case this.pxlEnums.USER_SPEED.STOP:this.moveSpeed=0;break;case this.pxlEnums.USER_SPEED.SLOW:this.moveSpeed=this.moveSpeedBase*this.moveSpeedSlow;break;case this.pxlEnums.USER_SPEED.BASE:this.moveSpeed=this.moveSpeedBase;break;case this.pxlEnums.USER_SPEED.BOOST:this.moveSpeed=this.moveSpeedBase*this.moveSpeedBoost;break;default:this.moveSpeed=this.moveSpeedBase}}checkItemWearOff(e){if(this.itemActiveList.length>0&&this.itemActiveTimer[0]-e<=0)return this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0;return!1}checkItemPickUp(e){return"LowGravity"===e?0===this.lowGrav&&(this.lowGrav=1,!0):"LizardKing"===e?0===this.lKing&&(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lizardKingPass.enabled=!0,!0):"StarField"===e?0===this.sField&&(this.sField=1,this.starFieldPass.enabled=!0,!0):"InfinityZoom"===e?0===this.iZoom&&(this.iZoom=1,this.crystallinePass.enabled=!0,!0):void 0}toggleTankRotate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tankStrafe=null===e?!this.tankStrafe:e,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.invertMouse=null===e?!this.invertMouse:e,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){}},Device:class Device{constructor(e,t,i){this.projectTitle=e,this.pxlCore=t,this.pxlRendering=null,this.pxlEnv=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.allowCursorSwap=!1,this.longTouchLength=.75;var s=window.innerWidth,a=window.innerHeight;this.sW=s,this.sH=a,this.lookRange=.3,this.lookXScalar=1/(this.sW*this.lookRange),this.lookYScalar=1/(this.sH*this.lookRange),this.touchScreen=!1,this.x=.5*s,this.y=.5*a,this.screenRes=new o.Vector2(1/s,1/a),this.screenAspect=new o.Vector2(1,1),this.screenRatio=new o.Vector2(s/a,a/s),this.origRes=new o.Vector2(s,a),this.screenResDeltaPerc=new o.Vector2(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new o.Vector3(1,1,1),this.lightShift=new o.Vector2(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=i,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=s/2,this.mouseY=a/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new o.Vector2(1,1),velocityEase:new o.Vector2(0,0),velocityEasePrev:null,velocity:new o.Vector2(0,0),mBlurVelInf:new o.Vector2(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new o.Vector2(0,0),netDistYPerc:0,curDistance:new o.Vector2(0,0),curFadeOut:new o.Vector2(0,0),curStepDistance:new o.Vector2(0,0),initialQuat:new o.Quaternion,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={}}setDependencies(pxlNav){this.pxlRendering=pxlNav.pxlRendering,this.pxlEnv=pxlNav.pxlEnv,this.pxlEnums=pxlNav.pxlEnums,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUser=pxlNav.pxlUser,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality,this.pxlOptions=pxlNav.pxlOptions}init(){this.setGammaCorrection();var e=this;(!this.pxlOptions.staticCamera||this.pxlOptions.allowStaticRotation&&this.pxlOptions.staticCamera)&&(document.addEventListener("mousedown",(t=>{e.onmousedown(e,t)}),!1),document.addEventListener("mousemove",(t=>{e.onmousemove(e,t)}),!1),document.addEventListener("mouseup",(t=>{e.onmouseup(e,t)}),!1),document.addEventListener("touchstart",(function(t){e.touchstart(e,t)}),{passive:!0}),document.addEventListener("touchmove",(function(t){e.touchmove(e,t)}),{passive:!0}),document.addEventListener("touchend",(function(t){e.touchend(e,t)}),{passive:!0})),document.addEventListener("contextmenu",(t=>{e.oncontextmenu(t)}),!1),window.addEventListener("resize",(t=>{e.resizeRenderResolution()}),!1),document.onkeydown=t=>{e.onkeydown(e,t)},document.onkeyup=t=>{e.onkeyup(e,t)};var t=this;document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this),!1),"object"==typeof window.onblur&&(window.onblur=this.resetUserInput.bind(this)),window.addEventListener("beforeunload",(e=>{if(!0===t.controlKey)return e.preventDefault(),e.returnValue="Close tab?",t.controlKey=!1,t.mapLockCursor(!1,0),"Close tab?"})),window.addEventListener("unhandledrejection",(e=>(this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR?console.error("Unhandled promise rejection:",e.reason):e.preventDefault(),!1)))}step(){this.addMoveDelta()}setGammaCorrection(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!=e)return this.gammaCorrection.x=1/e,this.gammaCorrection.y=e,void(this.gammaCorrection.z=e);var t=1.5,i=1.1,s=1.2,a=.5;if(window&&window.navigator&&window.navigator.userAgent){var r=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(r&&r.length>0)t=2.2,i=.95,s=1,a=0;else{var n=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);n&&n.length>0?(t=1.8,i=.9,s=.97,a=.1):(t=1.8,i=.7,s=.96,a=.1)}}this.gammaCorrection.x=1/t,this.gammaCorrection.y=s,this.gammaCorrection.z=a,this.lightShift.x=i}getRenderScalar(){var e=1;return this.mobile&&0!==this.pxlOptions.renderScale.mobile?e=this.pxlOptions.renderScale.mobile:0!==this.pxlOptions.renderScale.pc&&(e=this.pxlOptions.renderScale.pc),e}setCanvasSize(e,t){this.pxlGuiDraws.pxlNavCanvas.width=e,this.pxlGuiDraws.pxlNavCanvas.height=t;var i=this.getRenderScalar();if(1!==i){var s=1/i;this.pxlGuiDraws.pxlNavCanvas.style.transform="scale("+s+")"}else this.pxlGuiDraws.pxlNavCanvas.style.transform=""}runHiddenCalcs(){this.windowHidden&&setTimeout((()=>{this.runHiddenCalcs()}),100)}onVisibilityChange(){this.windowHidden=document.hidden,this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.pxlCamera.workerFunc("focus",!document.hidden),this.runHiddenCalcs()}resetUserInput(e){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(e):this.mapOnUp(e))}requestFullScreen(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;t&&t.call(e)}onmousemove(e,t){e.mapOnMove(t)}onmousedown(e,t){e.mapOnDown(t)}onmouseup(e,t){e.mapOnUp(t)}oncontextmenu(e){return e.preventDefault(),!1}touchstart(e,t){e.startTouch(t)}touchmove(e,t){e.doTouch(t)}touchend(e,t){e.endTouch(t)}onkeydown(e,t){e.keyDownCall(t)}onkeyup(e,t){e.keyUpCall(t)}get active(){return this.inputActive}set active(e){this.inputActive=!!e}preventDefault(e){(e=e||window.event).preventDefault(e)&&e.preventDefault(e)(),e.returnValue=!1}setCursor(e){this.allowCursorSwap&&("activeLatch"===e&&(e=["grab","grabbing","all-scroll"][this.touchMouseData.button]),document.body.style.cursor=e)}hideAddressBar(){setTimeout((function(){window.scrollTo(0,1)}),0)}getMouseXY(e){if(this.mobile)try{var t=e.touches[0];this.mouseX=t.pageX,this.mouseY=t.pageY}catch(e){}else{var i=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(e.movementX||e.mozMovementX||e.webkitMovementX||0)*i,this.mouseY+=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*i):(this.mouseX=e.clientX,this.mouseY=e.clientY)}}mapLockCursor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.canCursorLock&&!this.mobile){if(2===t?(!e&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:e||this.cursorRightButtonLockActive||(this.cursorRightButtonLockActive=!0),e=e||this.cursorRightButtonLockActive):e||(this.cursorRightButtonLockActive=e),!0===e){this.pxlGuiDraws.pxlNavCanvas.focus();var i=this.pxlGuiDraws.pxlNavCanvas;i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock;try{i.requestPointerLock()}catch(e){}}else document.pointerLockElement&&document.exitPointerLock();this.cursorLockActive=e}}mapOnDown(e){var t=e.target;t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(e),this.touchMouseData.button=e.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new o.Vector2(0,0),this.touchMouseData.curStepDistance=new o.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,e.button))}mapOnMove(e){var t=e.target;if(t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(e),this.getMouseXY(e),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;var i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=8e-4*(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250),this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(e){var t=e.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),t.getAttribute&&t.getAttribute("id")===this.pxlCore){if(this.pxlGuiDraws.checkFocus(t.getAttribute("id"),!0),!this.mobile)return this.preventDefault(e),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,e.button),e.preventDefault(),!1;this.pxlAutoCam.getNextPath(!1,1)}}startTouch(e){var t=e.target;if(t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active){this.touchScreen=!0;var i=e.touches[0];this.mouseX=i.pageX,this.mouseY=i.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new o.Vector2(0,0),this.touchMouseData.curStepDistance=new o.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;var s=t.getAttribute("id");if(this.objectPercList.includes(s)){"djPlayerVolume"===s&&(s=(t=this.pxlAudio.djVolumeParentObj).getAttribute("id"));var a=t.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=t,this.objectPerc.left=a.left,this.objectPerc.top=a.top,this.objectPerc.width=a.width,this.objectPerc.height=a.height,this.objectPerc.startX=this.mouseX-a.left,this.objectPerc.startY=this.mouseY-a.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[s]&&this.objectPercFuncList[s](e)}}}doTouch(e){if(this.touchMouseData.active){var t=e.touches[0];if(this.mouseX=t.pageX,this.mouseY=t.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,void 0!==e.touches[1])return void(e.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,t=e.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[t.pageX,t.pageY])));var i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}}endTouch(e){this.touchMouseData.active&&(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock?this.touchMouseData.lock=!1:(this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger()))}keyDownCall(e){var t=this;return _asyncToGenerator((function*(){if(t.emit("keydown",e),e.ctrlKey&&(t.controlKey=!0),void 0===document.activeElement.type&&t.pxlTimer.active){if(e.repeat)return;var i=e.keyCode||e.which;37!==i&&65!==i||(t.directionKeyDown=!0,t.keyDownCount[0]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[0]=1,t.pxlCamera.deviceKey(0,!0)),e.ctrlKey&&87===i&&1===t.directionKeysPressed[1]&&e.this.preventDefault(e)(),38!==i&&87!==i||(t.directionKeyDown=!0,t.keyDownCount[1]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[1]=1,t.pxlCamera.deviceKey(1,!0)),39!==i&&68!==i||(t.directionKeyDown=!0,t.keyDownCount[0]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[2]=1,t.pxlCamera.deviceKey(2,!0)),40!==i&&83!==i||(t.directionKeyDown=!0,t.keyDownCount[1]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[3]=1,t.pxlCamera.deviceKey(3,!0)),16!==i&&224!==i||t.deviceAction(t.pxlEnums.DEVICE_ACTION.RUN,{},!0),32===i&&t.deviceAction(t.pxlEnums.DEVICE_ACTION.JUMP,{},!0)}}))()}keyUpCall(e){var t=this;return _asyncToGenerator((function*(){if(t.emit("keyup",e),e.ctrlKey)return t.controlKey=!1,e.preventDefault(),!1;if(void 0===document.activeElement.type){var i=e.keyCode||e.which,s=e.code||e.which;if(!e.isTrusted)return!1;if(e.ctrlKey||e.altKey||e.code.includes("F"))return e.preventDefault(),!1;if("Backquote"===s)return void t.pxlGuiDraws.guiToggleVisibility();if(89===i&&t.pxlGuiDraws.toggleShaderEditor(),220===i){var a=t.pxlQuality.screenResPerc;t.pxlQuality.screenResPerc=1,t.pxlEnv.mapRender(!1);for(var r=t.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),n=atob(r.split(",")[1]),o=n.length,l=new Uint8Array(o),h=0;h<o;++h)l[h]=n.charCodeAt(h);var c=URL.createObjectURL(new Blob([l])),d=new Date,A=d.getDate(),u=d.getMonth()+1,p=d.getFullYear()+"-"+u+"-"+A+"_"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds(),m=document.createElement("a");return m.download=t.projectTitle+"_"+p+".png",m.href=c,document.body.appendChild(m),m.click(),m.parentNode.removeChild(m),t.pxlQuality.screenResPerc=a,void t.pxlEnv.mapRender(!1)}if(t.pxlTimer.active){if(37!==i&&65!==i||(t.directionKeysPressed[0]=0,t.pxlCamera.deviceKey(0,!1)),38!==i&&87!==i||(t.directionKeysPressed[1]=0,t.pxlAutoCam.active&&t.pxlAutoCam.step(!0),t.pxlCamera.deviceKey(1,!1)),39!==i&&68!==i||(t.directionKeysPressed[2]=0,t.pxlCamera.deviceKey(2,!1)),40!==i&&83!==i||(t.directionKeysPressed[3]=0,t.pxlAutoCam.active&&t.pxlAutoCam.setRoom(!0),t.pxlCamera.deviceKey(3,!1)),t.directionKeysPressed.includes(1)||(t.directionKeyDown=!1),16===i||224===i)return void t.deviceAction(t.pxlEnums.DEVICE_ACTION.RUN,{},!1);if(32===i)return void t.deviceAction(t.pxlEnums.DEVICE_ACTION.JUMP,{},!1);if(!t.directionKeyDown&&(53===i||101===i))return void t.pxlAutoCam.preAutoCamToggle();var g;if(221===i)return void((null===(g=t.pxlUser)||void 0===g||null===(g=g.itemInactiveCmd)||void 0===g?void 0:g.length)>0&&t.pxlUser.itemInactiveCmd.pop())}if(27===i||13===i&&!e.ctrlKey)return t.pxlGuiDraws.toggleHudBlock(!1,!0),void t.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);if(e.altKey||e.ctrlKey||e.shiftKey)return;if(73===i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.infoIcon,"info");if(71===i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.settingsIcon,"settings");if(191===i||72===i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.helpIcon,"help");if(66===i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");if(78===i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");if(80===i)return void t.deviceAction(t.pxlEnums.DEVICE_ACTION.PAUSE)}}))()}deviceAction(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(e){case this.pxlEnums.DEVICE_ACTION.MOVE:this.addMoveDelta(t);break;case this.pxlEnums.DEVICE_ACTION.LOOK:this.addLookDelta(t);break;case this.pxlEnums.DEVICE_ACTION.JUMP:this.pxlCamera.camJumpKey(i);break;case this.pxlEnums.DEVICE_ACTION.RUN:var s=i?this.pxlEnums.USER_SPEED.BOOST:this.pxlEnums.USER_SPEED.BASE;this.pxlUser.setSpeed(s);break;case this.pxlEnums.DEVICE_ACTION.ACTION:case this.pxlEnums.DEVICE_ACTION.ACTION_ALT:case this.pxlEnums.DEVICE_ACTION.ITEM:case this.pxlEnums.DEVICE_ACTION.MENU:break;case this.pxlEnums.DEVICE_ACTION.PAUSE:this.togglePause(i);case this.pxlEnums.DEVICE_ACTION.MAP:}}addMoveDelta(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!1;if(this.pxlOptions.mobile&&!this.pxlOptions.staticCamera&&(null!==e||this.directionKeyDown)){if(null!==e){if(e.hasOwnProperty("status")&&(t=e.status),t){var i=Math.abs(e.startDelta.x),s=Math.abs(e.startDelta.y),a=this.pxlOptions.userSettings.deadZone.touch,r=i>a?e.startDelta.x-a*Math.sign(e.startDelta.x):0,n=s>a?e.startDelta.y-a*Math.sign(e.startDelta.y):0,o=this.sW/this.sH,l=this.sH/this.sW;r=Math.min(r*this.lookXScalar,1)*this.pxlOptions.userSettings.movement.max*o,n=Math.min(n*this.lookYScalar,1)*this.pxlOptions.userSettings.movement.max*l,this.pxlCamera.cameraMovement[0]=.7*(this.pxlCamera.cameraMovement[0]+r),this.pxlCamera.cameraMovement[1]=.7*(this.pxlCamera.cameraMovement[1]+n),this.userInputMoveScalar=Math.max(this.pxlCamera.cameraMovement[0]**2,this.pxlCamera.cameraMovement[1]**2)**.5,this.userInputMoveScalar=this.userInputMoveScalar*this.userInputMoveScalar*this.userInputMoveScalar*1.5,this.userInputMoveScalar+=this.userInputMoveScalar>1?30*(this.userInputMoveScalar-1):0,this.userInputMoveScalar>1?this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!0):this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!1)}}else t=this.directionKeyDown;this.directionKeyDown=t,t?(this.directionKeysPressed[0]=this.pxlCamera.cameraMovement[0]<0?1:0,this.directionKeysPressed[1]=this.pxlCamera.cameraMovement[1]<0?1:0,this.directionKeysPressed[2]=this.pxlCamera.cameraMovement[0]>0?1:0,this.directionKeysPressed[3]=this.pxlCamera.cameraMovement[1]>0?1:0,this.pxlCamera.userInputMoveScalar.x=this.pxlCamera.cameraMovement[0],this.pxlCamera.userInputMoveScalar.y=this.pxlCamera.cameraMovement[1],this.pxlCamera.cameraMovementEase=1,this.pxlUser.setSpeed(this.userInputMoveScalar*this.pxlEnums.USER_SPEED.BASE)):(this.directionKeysPressed[0]=0,this.directionKeysPressed[1]=0,this.directionKeysPressed[2]=0,this.directionKeysPressed[3]=0,this.pxlCamera.cameraMovementEase=.85)}}addLookDelta(e){var t=!1;if(e.hasOwnProperty("status")&&(t=e.status),this.mouseX=e.currentPos.x,this.mouseY=e.currentPos.y,t)0===e.dragCount?(this.touchScreen=!0,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new o.Vector2(0,0),this.touchMouseData.curStepDistance=new o.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS):(this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new o.Vector2(e.startDelta.x,e.startDelta.y),this.touchMouseData.curStepDistance=new o.Vector2(e.stepDelta.x,e.stepDelta.y),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(new o.Vector2(e.previousPos.x,e.previousPos.y).sub(this.touchMouseData.endPos)),this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height));else{if(this.touchScreen=!1,this.touchMouseData.dragTotal+=e.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new o.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock)return void(this.touchMouseData.lock=!1);this.pxlAutoCam.touchBlender=!0}}togglePause(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=!this.pxlTimer.active),this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlTimer.pause(e),this.pxlTimer.active&&this.pxlEnv.mapRender(),this.pxlCamera.workerFunc("activeToggle",this.pxlTimer.active)}resizeRenderResolution(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=window.innerWidth,s=window.innerHeight;i=e||i,s=t||s;var a=this.getRenderScalar();if(i*=a,s*=a,this.mapW=(this.sW=i)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=s)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW*this.screenRes.x,this.screenRatio.y=this.sH*this.screenRes.y,this.pxlEnv.geoList.HDRView){var r=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=r}if(this.touchMouseData.mBlurVelInf=new o.Vector2(2*this.screenRes.x,2*this.screenRes.y),this.pxlEnv.mapGlowPass){this.pxlEnv.scene.renderTarget.setSize(this.mapW,this.mapH),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW,this.mapH),this.setCanvasSize(this.sW,this.sH),this.pxlRendering.resize(this.mapW,this.mapH),this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);var n=window.innerWidth/window.innerHeight;this.pxlCamera.setAspect(n);var l=[this.sW/this.sH,this.sH/this.sW],h=[1,1];h[0]=n>l[0]?1:this.sW/(this.sH*l[0]),h[1]=n>l[1]?this.sH/(this.sW*l[1]):1,h[0]>1?(h[1]*=1/h[0],h[0]=1):h[1]>1&&(h[0]*=1/h[1],h[1]=1),this.screenAspect.x=h[0]*(1/.5**.5),this.screenAspect.y=h[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlRendering.updateCompUniforms(),this.pxlEnv.roomNameList.forEach((e=>{var t;this.pxlEnv.roomSceneList[e].pxlCamAspect=n,null!==(t=this.pxlEnv.roomSceneList[e])&&void 0!==t&&t.resize&&this.pxlEnv.roomSceneList[e].resize(this.mapW,this.mapH)})),this.emit("resize",{rawWidth:window.innerWidth,rawHeight:window.innerHeight,width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:n}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}}subscribe(e,t){this.subscriptableEvents.includes(e)?(this.callbackList[e]||(this.callbackList[e]=[]),this.callbackList[e].push(t)):console.error("Event type not subscribable: ",e)}unsubscribe(e,t){var i=-1;return this.callbackList[e]&&(i=this.callbackList[e].indexOf(t))>=0&&this.callbackList[e].splice(i,1),i>=0}emit(e,t){this.callbackList.hasOwnProperty(e)&&this.callbackList[e].forEach((e=>{e(t)}))}},Colliders:class Colliders{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;this.pxlEnv=null,this.pxlUtils=null,this.verbose=e,this.delimiter=",",this.roomColliderData={},this.baseGridSize=t,this.degToRad=Math.PI/180,this.epsilon=1e-5,this.colliderBoundsReference=i,this.prevGridKey=""}setDependencies(e){this.pxlEnv=e,this.pxlUtils=e.pxlUtils}log(e){this.verbose>=je.INFO&&console.log(e)}debug(e){this.verbose>=je.DEBUG&&console.log(e)}warn(e){this.verbose>=je.WARN&&console.warn(e)}error(e){this.verbose>=je.ERROR&&console.error(e)}init(){}start(){}stop(){}step(){}prepColliders(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke.FLOOR,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.hasColliders()){i||(i=this.baseGridSize);var s=1/i;if(t===Ke.HOVERABLE||t===Ke.CLICKABLE)return void this.prepInteractables(e,t);var a=e.getName(),r=e.getColliders(t);this.roomColliderData.hasOwnProperty(a)||(this.roomColliderData[a]={}),this.roomColliderData[a].hasOwnProperty(t)||(this.roomColliderData[a][t]={},this.roomColliderData[a][t].helper=null,this.roomColliderData[a][t].count=0,this.roomColliderData[a][t].gridSize=i,this.roomColliderData[a][t].gridSizeInv=s,this.roomColliderData[a][t].faceVerts={},this.roomColliderData[a][t].faceGridGroup={});var n=[],l={min:new o.Vector2(1/0,1/0),max:new o.Vector2(-1/0,-1/0)};r.forEach((e=>{for(var t=e.geometry.attributes.position.array,i=t.length/3,s=0;s<i;++s){var a=new o.Vector2(t[3*s],t[3*s+2]);n.push(a),l.min.min(a),l.max.max(a)}}));var h=l.max.clone().sub(l.min),c=Math.abs(Math.max(h.x,h.z)),d=Math.min(1,c/this.colliderBoundsReference);if(d<1){var A=i;s=1/(i*=d),this.roomColliderData[a][t].gridSize=i,this.roomColliderData[a][t].gridSizeInv=s,this.debug("Grid size adjusted for pxlRoom: "+a+"; from "+A+" to "+i+" units; "+d+"%"),this.debug("Reference bound set to: "+this.colliderBoundsReference+" units"),this.debug("Total pxlRoom bounds found: "+c+" units")}else this.debug("-- Grid size unchanged for pxlRoom '"+a+"', collider bounds within reference bounds --");this.debug("Collider bounds: {x:"+l.min.x+", y:"+l.min.y+"} -to- {x:"+l.max.x+", y:"+l.max.y+" }");var u=-1,p=0;r.forEach((e=>{u++;for(var i=e.geometry.attributes.position.array,r=i.length/3,n=e.matrixWorld,l=0;l<r;++l){var h=9*l,c=new o.Vector3(i[h],i[h+1],i[h+2]),d=new o.Vector3(i[h+3],i[h+4],i[h+5]),A=new o.Vector3(i[h+6],i[h+7],i[h+8]);if(c.applyMatrix4(n),d.applyMatrix4(n),A.applyMatrix4(n),0!==c.length()||0!==d.length()||0!==A.length()){var m=Math.min(c.x,d.x,A.x),g=Math.max(c.x,d.x,A.x),v=Math.min(c.z,d.z,A.z),f=Math.max(c.z,d.z,A.z),b=Math.floor(m*s),x=Math.floor(g*s),C=Math.floor(v*s),E=Math.floor(f*s);p++;var y=d.clone().sub(c),I=A.clone().sub(c),B=y.clone().cross(I),w=y.dot(y),S=y.dot(I),D=I.dot(I),P=1/(w*D-S*S),T=""!==e.name?e.name:"collider_"+u,R=this.getGridKey(T,"_face_",this.flattenVector3(c),this.flattenVector3(d),this.flattenVector3(A)),Q={object:e,name:e.name,key:R,verts:[c,d,A],edge0:y,edge1:I,normal:B,dotE0E0:w,dotE0E1:S,dotE1E1:D,areaInv:P};if(this.roomColliderData[a][t].faceVerts[R]=Q,b!==x||C!==E)for(var k=b;k<=x;++k)for(var L=C;L<=E;++L)this.addFaceToGridLocation(a,t,k,L,R);else this.addFaceToGridLocation(a,t,b,C,R)}}}));for(var m=Object.keys(this.roomColliderData[a][t].faceGridGroup),g=0;g<m.length;++g){var v=this.roomColliderData[a][t].faceGridGroup[m[g]];this.roomColliderData[a][t].faceGridGroup[m[g]]=[...new Set(v)]}this.roomColliderData[a][t].count=p,this.debug(" -- Collider Count for "+a+" : "+p)}else this.debug(" -- No colliders found for room: "+e.getName()),this.debug("      If you didn't intend on including collider objects in your FBX, something went wrong. Please check your FBX for unintentional collider user-detail attributes on mainScene objects.")}prepInteractables(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke.HOVERABLE;if(e.hasColliderType(t)){var i=e.getName(),s=e.getColliders(t);0!==s.length&&(this.roomColliderData.hasOwnProperty(i)||(this.roomColliderData[i]={}),s.forEach((e=>{var s=e.geometry.attributes.position.array,a=s.length/3,r=e.name;if(!this.roomColliderData[i].hasOwnProperty(r)){this.roomColliderData[i][r]={},this.roomColliderData[i][r].hoverable=t===Ke.HOVERABLE,this.roomColliderData[i][r].clickable=t===Ke.CLICKABLE,this.roomColliderData[i][r].gridSize=this.baseGridSize,this.roomColliderData[i][r].faceVerts={};for(var n=0;n<a;++n){var l=9*n,h=new o.Vector3(s[l],s[l+1],s[l+2]),c=new o.Vector3(s[l+3],s[l+4],s[l+5]),d=new o.Vector3(s[l+6],s[l+7],s[l+8]),A=c.clone().sub(h),u=d.clone().sub(h),p=A.clone().cross(u),m=this.getGridKey(r,"_",this.flattenVector3(h),this.flattenVector3(c),this.flattenVector3(d)),g={object:e,key:m,verts:[h,c,d],edge0:A,edge1:u,normal:p};this.roomColliderData[i][r].faceVerts[m]=g}}})))}}isGridEdgeIntersecting(e,t,i,s,a,r){var n=t.x,o=t.z,l=0!==n?(i-e.x)/n:1/0,h=0!==n?(s-e.x)/n:-1/0,c=0!==o?(a-e.z)/o:1/0,d=0!==o?(r-e.z)/o:-1/0,A=Math.max(Math.min(l,h),Math.min(c,d)),u=Math.min(Math.max(l,h),Math.max(c,d));return u>=A&&u>=0&&A<=1}getGridKey(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.join(this.delimiter)}flattenVector3(e){return this.getGridKey(this.pxlUtils.toNearestStr(e.x),this.pxlUtils.toNearestStr(e.y),this.pxlUtils.toNearestStr(e.z))}addFaceToGridLocation(e,t,i,s,a){var r=this.getGridKey(i,s);this.roomColliderData[e][t].faceGridGroup[r]||(this.roomColliderData[e][t].faceGridGroup[r]=[]),this.roomColliderData[e][t].faceGridGroup[r].push(a)}castRay(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ke.FLOOR,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ze.DOUBLE;if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(s))return this.error("Room '"+e+"' does not have collider data for type: "+s),this.error(" -- Please register any collider objects with `pxlColliders.prepColliders()` or `pxlColliders.prepInteractables` first -- "),[];var r=this.roomColliderData[e][s],n=1/r.gridSize,o=Math.floor(t.x*n),l=Math.floor(t.z*n),h=this.getGridKey(o,l),c=1,d=1;if(a===ze.FRONT?c=0:a===ze.BACK&&(d=0),!r.faceGridGroup.hasOwnProperty(h))return[];var A=r.faceGridGroup[h],u={};A.forEach((e=>{var s=r.faceVerts[e],a=s.verts[0],n=s.edge0,o=s.edge1,l=i.clone().cross(o),h=n.dot(l);if(!(h*c>-this.epsilon&&h*d<this.epsilon)){var A=t.clone().sub(a),p=A.dot(l);if(!(p<0||p>h)){var m=A.clone().cross(n),g=i.dot(m);if(!(g<0||p+g>h)){var v=1/h;p*=v,g*=v;var f=v*o.dot(m);if(f>this.epsilon){var b=t.clone().add(i.clone().multiplyScalar(f));u[f]={object:s.object,pos:b,dist:f}}}}}}));var p=Object.keys(u);p.sort();for(var m=[],g=0;g<p.length;++g)m.push(u[p[g]]);if(r.helper){var v=m.length>0?m[0]:-1;this.setHelperActiveFace(e,s,v)}return m}castGravityRay(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ke.FLOOR,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(i))return[];for(var a=this.roomColliderData[e][i],r=a.gridSize,n=a.faceGridGroup,o=1/r,l=Math.floor(t.x*o),h=Math.floor(t.z*o),c=[this.getGridKey(l-1,h-1),this.getGridKey(l-1,h),this.getGridKey(l,h-1),this.getGridKey(l,h),this.getGridKey(l+1,h),this.getGridKey(l,h+1),this.getGridKey(l+1,h+1)],d=[],A=0;A<c.length;++A)null!=n&&n.hasOwnProperty(c[A])&&d.push(...n[c[A]]);if(0===(d=Object.keys(a.faceVerts)).length)return[];d=[...new Set(d)];for(var u={},p=0;p<d.length;++p){var m=a.faceVerts[d[p]],g=m.verts[0],v=m.verts[1],f=m.verts[2],b=t.clone().sub(g),x=m.normal,C=b.dot(x)/x.dot(x),E=t.clone().sub(x.clone().multiplyScalar(C)),y=f.sub(g),I=v.sub(g),B=E.clone().sub(g),w=y.dot(y),S=y.dot(I),D=y.dot(B),P=I.dot(I),T=I.dot(B),R=w*P-S*S;if(0!==R){var Q=(P*D-S*T)*(R=1/(w*P-S*S)),k=(w*T-S*D)*R;if(Q>=0&&k>=0&&Q+k<1){var L=g.clone().add(y.multiplyScalar(Q)).add(I.multiplyScalar(k)),M=t.distanceTo(L),F={object:m.object,pos:L,dist:M};if(u[M]=F,!s)return[F]}}}var O=Object.keys(u);O.sort();for(var G=[],_=0;_<O.length;++_)G.push(u[O[_]]);if(a.helper){var U=G.length>0?G[0]:-1;this.setHelperActiveFace(e,i,U)}return G}castInteractRay(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.Vector2)(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null===i)return this.error("No camera provided for castInteractRay()"),[];var r=new o.Vector3(0,0,0);i.getWorldDirection(r);var n=i.position.clone(),l=i.fov*this.degToRad,h=Math.tan(.5*l),c=i.aspect,d=s.x*c*h,A=s.y*h,u=new o.Vector3(d,A,-1).applyMatrix4(i.matrixWorld).sub(i.position).normalize(),p={};t.forEach((t=>{var i=t.name,s=this.roomColliderData[e][i].faceVerts;Object.keys(s).forEach((e=>{var i=s[e],r=i.verts[0],o=i.verts[1],l=i.verts[2],h=i.edge0,c=i.edge1,d=i.normal,A=d.dot(u);if(!(Math.abs(A)<1e-6)){var m=(d.dot(r)-d.dot(n))/A;if(!(m<0)){var g=n.clone().add(u.clone().multiplyScalar(m)),v=r.clone().sub(g),f=o.clone().sub(g),b=l.clone().sub(g),x=f.clone().cross(b).length(),C=b.clone().cross(v).length(),E=v.clone().cross(f).length(),y=x+C+E,I=x/y,B=C/y,w=E/y;if(I>=0&&I<=1&&B>=0&&B<=1&&w>=0&&w<=1){var S=r.clone().add(h.multiplyScalar(I)).add(c.multiplyScalar(B)),D=n.distanceTo(S);if(p[D]={obj:t,pos:g},!a)return{obj:t,pos:g}}}}}))}));var m=Object.keys(p);m.sort();for(var g={order:[],hits:{},hitCount:0},v=0;v<m.length;++v){var f=p[m[v]].obj,b=p[m[v]].pos,x=f.name;g.order.push(f),g.hits.hasOwnProperty(x)||(g.hits[x]=[]),g.hits[x].push(b),g.hitCount++}return g}toColorId(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,i=1/t,s=1/(t*t);return[Math.floor(e*s)%t*i,Math.floor(e*i)%t*i,e%t*i]}getRandomColorIdList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=Array.from({length:e},((e,t)=>t)),i=parseInt(Math.floor(t.length/3));i+=1&i?0:1;for(var s=[],a=0;a<e&&0!==t.length;++a){if(1===t.length){s.push(t.pop());break}var r=i*a%t.length,n=t.splice(r,1);s.push(n[0])}return s}buildHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke.FLOOR,i=e.getName(),s=this.roomColliderData[i][t],a=s.count;this.log("Building helper for "+i+" with "+a+" triangles");var r=new o.BufferGeometry,n=[],l=[],h=[],c=this.getRandomColorIdList(a),d=parseInt(a**.5);Object.keys(s.faceVerts).forEach(((e,t)=>{var i=s.faceVerts[e].verts;n.push(i[0].x,i[0].y+.1,i[0].z),n.push(i[1].x,i[1].y+.1,i[1].z),n.push(i[2].x,i[2].y+.1,i[2].z),h.push(0,0,0);var a=this.toColorId(c[t],d);l.push(...a,...a,...a)}));var A=new Float32Array(n),u=new Float32Array(l),p=new Float32Array(h);r.setAttribute("position",new o.BufferAttribute(A,3)),r.setAttribute("colorId",new o.BufferAttribute(u,3)),r.setAttribute("visibility",new o.BufferAttribute(p,1));var m=new o.ShaderMaterial({uniforms:{visibleFaceId:{value:-1}},vertexShader:"\n        uniform float visibleFaceId;\n\n        attribute vec3 colorId;\n        attribute float visibility;\n\n        varying vec4 vCd;\n        varying float vVisibility;\n\n        void main() {\n          vVisibility = visibility*.5+.5;\n          \n          vCd = vec4( normalize(colorId), 0.50 ); // Pre-calculated Blue for visible face\n          if (visibleFaceId === 1.0) {\n            vCd = vec4( 0.0, 1.0, 0.0, 1.0 ); // Green for visible face\n          }\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec4 vCd;\n        varying float vVisibility;\n\n        void main() {\n\n          vec4 Cd = vCd;\n          //Cd.a *= vVisibility;\n          //Cd.rgb = vec3( vVisibility );\n\n          gl_FragColor = Cd;\n        }\n      "});m.side=o.DoubleSide,m.transparent=!0,m.depthTest=!0,m.depthWrite=!1,m.blending=o.AdditiveBlending;var g=new o.Mesh(r,m);return g.renderOrder=2,this.roomColliderData[i][t].helper=g,g}stepHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke.FLOOR,i=e.getName(),s=1/this.roomColliderData[i][t].gridSize,a=Math.floor(e.position.x*s),r=Math.floor(e.position.z*s);this.getGridKey(a,r);this.prevGridKey}setHelperActiveFace(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke.FLOOR,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.roomColliderData[e][t].helper.material.uniforms.visibleFaceId.value=i}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];var t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Animation:class Animation{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pxlEnv=null,this.assetPath=e,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=t,this.clock=new o.Clock}setDependencies(e){this.pxlEnv=e}log(e){this.verbose&&console.log(e)}initObject(e,t){for(var i=null,s=null,a=t.children.length,r=0,n=[...t.children],l=0,h=0,c=0,d=0;r<a;){var A=n[r];switch(A.type){case"Bone":++h,i=A;break;case"Mesh":++l,A.visible=!1;break;case"SkinnedMesh":++c,s=A;break;case"Group":++d,a=(n=n.concat(A.children)).length}++r}var u=!1;if(i||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),u=!0),s||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),u=!0),u)return console.log("Unable to prepare '"+e+"' for animation"),console.log("Group Count: "+d),console.log("Bone Root Found : "+(h>0)),console.log("Bone Count : "+h),console.log("Mesh Count: "+l),void console.log("SkinnedMesh Count: "+c);if(!this.objNames.includes(e)){this.objNames.push(e);var p=Object.assign({},this.animInitEntry);p.rig=i,p.mesh=s,this.animMixer[e]=new o.AnimationMixer(i),p.mixer=this.animMixer[e],this.objects[e]=p;var m=new o.MeshStandardMaterial;m.map=s.material.map,s.material=m}}addClips(e,t,i){if(this.objNames.includes(e)){Object.keys(this.objects[e].clips).includes(t)&&this.log("Warning, '"+t+"' already exists in '"+e+"'");var s=this.animMixer[e].clipAction(i.animations[0]);this.objects[e].clips[t]=s}else this.log("Error, '"+e+"' not found in Animation Manager")}hasClip(e,t){return!!this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)}getMixer(e){return this.objNames.includes(e)?this.animMixer[e]:null}getRig(e){return this.objNames.includes(e)?this.objects[e].rig:null}getMesh(e){return this.objNames.includes(e)?this.objects[e].mesh:null}getFallbackCycle(e){if(this.objNames.includes(e)){var t=Object.keys(this.objects[e].clips);if(t.length>0)return t[0]}return null}playClip(e,t){if(this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)){var i=this.objects[e].clips[t];this.objects[e].state=t,this.objects[e].prevTime=-1,this.objects[e].hasConnection=this.objects[e].connected.includes(t),this.setWeight(e,t,1,!0),i.reset(),i.play()}}setWeight(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.objNames.includes(e)){var a=Object.keys(this.objects[e].clips);if(a.includes(t)){var r=this.objects[e].clips[t];r.enabled=!0,r.setEffectiveTimeScale(1),r.setEffectiveWeight(i),s&&a.forEach((i=>{if(i!==t){var s=this.objects[e].clips[i];s.enabled=!1,s.setEffectiveTimeScale(1),s.setEffectiveWeight(0)}}))}}}setStateConnections(e,t){if(this.objNames.includes(e)){var i=Object.keys(t);this.objects[e].connected=i,this.objects[e].connections=t}}step(e){if(this.objNames.includes(e)){if(!this.objects[e].hasConnection)return void this.animMixer[e].update(this.clock.getDelta());var t=this.objects[e].state;if(t){var i=this.objects[e].clips[t].time;if(this.objects[e].prevTime>i){var s=this.objects[e].connections[t],a=s[Math.floor(Math.random()*s.length)];this.playClip(e,a)}else this.animMixer[e].update(this.clock.getDelta()),this.objects[e].prevTime=i}else this.animMixer[e].update(this.clock.getDelta())}}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];var t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Rendering:class Rendering{constructor(pxlOptions){this.pxlOptions=pxlOptions,this.pxlEnv=null,this.pxlUser=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlQuality=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlShaders=null,this.engine=null,this.scene=null,this.shaderPasses={},this.stepShaderFuncArr=[],this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.mapMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerGlow=null,this.chromaticAberrationPass=null,this.lizardKingPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null}init(){}setDependencies(pxlNav){this.scene=pxlNav.scene,this.pxlEnv=pxlNav.pxlEnv,this.pxlUser=pxlNav.pxlUser,this.pxlUtils=pxlNav.pxlUtils,this.pxlTimer=pxlNav.pxlTimer,this.pxlQuality=pxlNav.pxlQuality,this.pxlDevice=pxlNav.pxlDevice,this.pxlCamera=pxlNav.pxlCamera,this.pxlShaders=pxlNav.pxlShaders}buildComposers(){var e,t,i=(null===(e=this.pxlCamera.camera)||void 0===e?void 0:e.near)||.1,s=(null===(t=this.pxlCamera.camera)||void 0===t?void 0:t.far)||1e3;this.mapWorldPosMaterial=new o.ShaderMaterial({uniforms:{camNear:{type:"f",value:i},camFar:{type:"f",value:s}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=o.FrontSide,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.blurComposer=new EffectComposer(this.engine),this.shaderPasses.blurXShaderPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new ShaderPass(l),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.pxlOptions.antiAliasing===He.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.pxlOptions.antiAliasing===He.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.pxlOptions.antiAliasing===He.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0),this.mapComposerMotionBlur=new EffectComposer(this.engine),this.mapMotionBlurPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new EffectComposer(this.engine);var a=new RenderPass(this.pxlEnv.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(a),this.blurScreenMerge=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},mtDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.material.uniforms.mtDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);var r=new ShaderPass(l);r.name="glowCopyPassBlur",this.mapComposerGlow.addPass(r),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new ShaderPass(new o.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayHeavyPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayHeavyPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayHeavyPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new ShaderPass(new o.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new ShaderPass(new o.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlaySlimPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlaySlimPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.mapGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new EffectComposer(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new o.Vector2(...this.pxlUser.lKingInactive),this.lizardKingPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lizardKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lizardKingPass.name="lizardKingPass",this.pxlUser.starFieldPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg",null,{encoding:o.LinearSRGBColorSpace})}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.starFieldPass.enabled=!1,this.pxlUser.starFieldPass.name="starFieldPass",this.pxlUser.crystallinePass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.crystallinePass.enabled=!1,this.pxlUser.crystallinePass.name="crystallinePass",this.pxlOptions.postProcessPasses.chromaticAberrationPass&&(this.chromaticAberrationPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},chroAberUVAlpha:{value:this.chroAberUVAlpha},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chromaticAberrationPass.enabled=!1,this.chromaticAberrationPass.name="chromaticAberrationPass",this.mapComposer.addPass(this.chromaticAberrationPass)),this.pxlOptions.postProcessPasses.lizardKingPass&&this.mapComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.mapComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.mapComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&(this.mapComposerWarpPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.pxlEnv.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},animTexture:{value:this.pxlEnv.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass)),this.mapBoxAAPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;var n=this.pxlEnv.roomSceneList[this.pxlEnv.bootRoom].scene;this.roomComposer=new EffectComposer(this.engine),this.roomRenderPass=new RenderPass(n,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.pxlEnv.roomNameList.forEach((e=>{if(e!==this.mainRoom){var t=this.pxlEnv.roomSceneList[e].applyRoomPass(this.roomComposer);t&&(t.enabled=!1,this.roomComposer.addPass(t))}})),this.roomBloomPass=new UnrealBloomPass(new o.Vector2(.5*this.pxlDevice.mapW,.5*this.pxlDevice.mapH),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.pxlOptions.postProcessPasses.roomGlowPass&&(this.roomGlowPass=new ShaderPass(new o.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.material.uniforms.gDiffuse=this.blurComposer.writeBuffer.texture,this.roomGlowPass.material.uniforms.rDiffuse=this.blurComposer.renderTarget2.texture,this.roomGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass)),this.pxlOptions.postProcessPasses.chromaticAberrationPass&&this.roomComposer.addPass(this.chromaticAberrationPass),this.pxlOptions.postProcessPasses.lizardKingPass&&this.roomComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.roomComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.roomComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new EffectComposer(this.engine),this.delayPass=new ShaderPass(new o.ShaderMaterial({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:null},tDiffusePrevRoom:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.material.uniforms.tDiffusePrev=this.mapComposer.renderTarget1.texture,this.delayPass.material.uniforms.tDiffusePrevRoom=this.roomComposer.renderTarget1.texture,this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.crystallinePass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}resize(e,t){this.pxlEnv.mapComposer&&this.pxlEnv.mapComposer.setSize(e,t),this.pxlEnv.mapComposerGlow&&this.pxlEnv.mapComposerGlow.setSize(e,t),this.pxlEnv.roomComposer&&this.pxlEnv.roomComposer.setSize(e,t),this.pxlEnv.roomGlowPass&&this.pxlEnv.roomGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer&&this.pxlEnv.delayComposer.setSize(e,t),this.pxlEnv.mapGlowPass&&this.pxlEnv.mapGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass&&this.pxlEnv.mapMotionBlurPass.setSize(e*this.pxlQuality.mBlurPercMult,t*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass&&(this.pxlEnv.mapOverlayHeavyPass.setSize(e,t),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlayPass&&(this.pxlEnv.mapOverlayPass.setSize(e,t),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlaySlimPass&&(this.pxlEnv.mapOverlaySlimPass.setSize(e,t),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,e/t))}updateCompUniforms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.pxlRenderSettings.exposure=e*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}stepShaderValues(){this.stepShaderFuncArr.forEach((e=>{"object"==typeof e&&e.step()}))}},Environment:class Environment{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Default",i=arguments.length>2?arguments[2]:void 0;this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[t]=[],this.parentNameList=[],this.pxlOptions=e,this.pxlRendering=null,this.prevRenderMS=0,this.prevRuntimeMS=0,this.nextRenderMS=0,this.fps=30,this.pxlOptions.fps.hasOwnProperty("mobile")?this.fps=i?this.pxlOptions.fps.mobile:this.pxlOptions.fps.pc:this.pxlOptions.fps.hasOwnProperty("Mobile")&&(this.fps=i?this.pxlOptions.fps.Mobile:this.pxlOptions.fps.PC),this.renderInterval=1/this.fps;var s="Default";s=this.pxlOptions.hasOwnProperty("pxlRoomName")?this.pxlOptions.pxlRoomName:t||"Default",this.pxlRoomAbsRoot=s;var a=s.split("/");a.splice(0,1),a=a.join("/"),s=s.startsWith("./")?s.slice(1):s,this.pxlOptions.hasOwnProperty("pxlRoomRoot")?this.pxlRoomLclRoot=this.pxlOptions.pxlRoomRoot:this.pxlRoomLclRoot="./"+s.split("/").pop().join("/"),this.mainRoom=t,this.bootRoom=t,this.bootLocation=null,this.currentRoom=t,this.roomNameList=[t],this.roomSubList={},this.roomSceneList={},this.roomSceneList[t]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.chroAberUVAlpha=null,this.blockAnimTexture=null,this.userScreenIntensity=new o.Vector2(0,.8),this.portaluserScreenIntensity=new o.Vector2(1,0),this.portalMtlRate=.7,this.mobile=i,this.camNear=.1,this.camFar=5e3,this.fogMult=new o.Vector2(0,0),this.fogColor=new o.Color(.07,.07,.1),this.fogColorSky=new o.Color(.1,.1,.12),this.fogExp=3e-4,this.fog=new o.FogExp2(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new o.Vector3(0,15,0),this.camInitLookAt=new o.Vector3(0,15,0),this.camThumbPos=new o.Vector3(0,0,0),this.camThumbLookAt=new o.Vector3(0,20,0),this.camReturnPos=new o.Vector3(0,0,0),this.camReturnLookAt=new o.Vector3(0,0,0),this.camLobbyPos=new o.Vector3(0,15,0),this.camLobbyLookAt=new o.Vector3(0,15,-100),this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new o.Group,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new o.Vector2(0,1),this.warpVisualCmd=null,this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new o.Vector2(1,0),this.blurDirCur=new o.Vector2(0,0),this.blurDirPrev=new o.Vector2(0,0),this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new o.Vector2(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(e,t)=>{}}setDependencies(pxlNav){this.scene=pxlNav.scene,this.pxlUtils=pxlNav.pxlUtils,this.pxlEnums=pxlNav.pxlEnums,this.pxlTimer=pxlNav.pxlTimer,this.pxlAnim=pxlNav.pxlAnim,this.pxlRendering=pxlNav.pxlRendering,this.pxlColliders=pxlNav.pxlColliders,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlAudio=pxlNav.pxlAudio,this.pxlFile=pxlNav.pxlFile,this.pxlVideo=pxlNav.pxlVideo,this.pxlQuality=pxlNav.pxlQuality,this.pxlUser=pxlNav.pxlUser,this.pxlShaders=pxlNav.pxlShaders,this.pxlDevice=pxlNav.pxlDevice,this.pxlCamera=pxlNav.pxlCamera,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.emit=pxlNav.emit.bind(pxlNav)}log(){if(this.pxlOptions.verbose>je.INFO){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.log(t)}}debug(){if(this.pxlOptions.verbose>je.DEBUG){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.log(t)}}warn(){if(this.pxlOptions.verbose>je.WARN){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.warn(t)}}error(){if(this.pxlOptions.verbose>je.ERROR){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.error(t)}}init(){var e=Object.keys(this.pxlOptions);Object.keys(pxlOptions).forEach((t=>{e.includes(t)||(this.pxlOptions[t]=pxlOptions[t])})),Object.keys(this.roomSubList).forEach((e=>{this.roomSubList[e].init()}))}boot(){}setBootRoom(e,t){this.bootRoom=e,this.bootLocation=t}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0,this.pxlOptions.showOnboarding&&(this.pxlDevice.mobile||this.pxlAutoCam.enabled?this.pxlGuiDraws.toggleMobileWelcome(!0):this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help"))}postHelpIntro(){this.pxlDevice.mobile||this.pxlAutoCam.enabled?(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout((()=>{this.pxlAudio.initPlay()}),100))):this.pxlCamera.jogServerMemory(),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlDevice.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;var e=document.createElement("canvas"),t=!1;try{t=!!e.getContext("webgl")}catch(e){this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}t||console.warn("WebGL Context lost, reloading pxlNav")}this.emit("step",{time:this.pxlTimer.curMS,delta:this.pxlTimer.msRunner.y})}stop(){var e=this;return Environment_asyncToGenerator((function*(){e.setExposure(0),Object.keys(e.roomSubList).forEach((t=>{e.roomSubList[t].stop()}))}))()}loadRoomByName(e){if(Object.keys(this.roomSceneList).includes(e)){var t=this.roomSceneList[e];this.loadRoom(t)}else this.warn("Room '"+e+"' not found, cannot load.")}loadRoom(e){var t=this;return new Promise(function(){var i=Environment_asyncToGenerator((function*(i,s){var a=e.roomName;t.log("Loading Room - ",a);try{e.setDependencies(t),e.camera=t.pxlCamera.camera,e.scene=new o.Scene,e.userAvatarGroup||(e.userAvatarGroup=new o.Group),e.scene.add(e.userAvatarGroup);var r={format:o.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?o.HalfFloatType:o.FloatType};e.scene.renderTarget=new o.WebGLRenderTarget(t.pxlDevice.sW*t.pxlQuality.screenResPerc,t.pxlDevice.sH*t.pxlQuality.screenResPerc,r),e.scene.renderTarget.texture.format=o.RGBAFormat,e.scene.renderTarget.texture.minFilter=o.LinearFilter,e.scene.renderTarget.texture.magFilter=o.LinearFilter,e.scene.renderTarget.texture.generateMipmaps=!1,e.scene.renderTarget.depthBuffer=!0,e.scene.renderTarget.depthTexture=new o.DepthTexture(t.pxlDevice.sW*t.pxlQuality.screenResPerc,t.pxlDevice.sH*t.pxlQuality.screenResPerc),e.scene.renderTarget.depthTexture.format=o.DepthFormat,e.scene.renderTarget.depthTexture.type=o.UnsignedShortType,t.roomNameList.includes(a)||t.roomNameList.push(a),t.roomSceneList[a]=e,t.debug(t.roomSceneList[a]),i(!0)}catch(e){console.error("Error Loading Room - ",a),console.error("Error details:",e.message),t.pxlOptions.verbose>=je.ERROR&&console.error("Full error:",e),s(e)}}));return function(e,t){return i.apply(this,arguments)}}())}startAllRooms(){this.roomNameList.forEach((e=>{this.startRoom(this.roomSceneList[e])}))}startRoom(e){e.active=!1,e.startTime=this.pxlTimer.msRunner.x}newSubRoom(e){this.roomSubList[e.getName()]=e}addToRooms(e){var t={};return this.roomNameList.forEach((i=>{var s=e.clone();this.roomSceneList[i].scene.add(s),t[i]=s})),t}addToRoomLayers(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={};return this.roomNameList.forEach((s=>{var a=e.clone();this.roomSceneList[s].scene.add(a),i[s]=a,a.layers.set(t)})),i}addToRoomParents(e,t){var i={};return this.parentNameList.includes(t)||this.parentNameList.push(t),this.roomNameList.forEach((s=>{var a=e.clone();if(this.parentGroupList[s]||(this.parentGroupList[s]={}),!this.parentGroupList[s][t]){var r=new o.Group;this.parentGroupList[s][t]=r,this.roomSceneList[s].scene.add(r)}this.parentGroupList[s][t].add(a),i[s]=a})),i}buildRoomEnvironments(){this.debug("Building Room Environments - "),this.debug(this.roomNameList),this.roomNameList.forEach((e=>{this.roomSceneList[e].init&&this.roomSceneList[e].init(),this.roomSceneList[e].build&&this.roomSceneList[e].build()}))}getArtistInfo(){return null}setFogHue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1],i=[t[0]-e[0],t[1]-e[1]],s=Math.abs(.3183098861837907*Math.atan2(i[0],i[1])),a=(i[0]**2+i[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(s,.5*a+.3,.5*a),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("script_fog"===e){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,!0===this.pxlRendering.mapOverlayHeavyPass.enabled)return this.pxlRendering.mapOverlayHeavyPass.material;if(!0===this.pxlRendering.mapOverlayPass.enabled)return this.pxlRendering.mapOverlayPass.material;if(!0===this.pxlRendering.mapOverlaySlimPass.enabled)return this.pxlRendering.mapOverlaySlimPass.material}else{if("script_dArrows"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList.dArrows[0].material;if("script_userScreens"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.camScreenData.screenGeoList[0].material;if("script_warpZonePortals"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.returnPortalGlowList[0].material;if("script_lizardking"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.lizardKingPass.material;if("script_majorTom"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.starFieldPass.material;if("script_fractalSubstrate"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.crystallinePass.material;if("script_fractalEcho"===e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.delayPass.material;var t=e.split("_");if(t.shift(),t=t.join("_"),this.geoList[t])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList[t].material}}setShader(e,t,i){var s,a=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if("script_fog"===a)!0===this.pxlRendering.mapOverlayHeavyPass.enabled?s=this.pxlRendering.mapOverlayHeavyPass.material:!0===this.pxlRendering.mapOverlayPass.enabled?s=this.pxlRendering.mapOverlayPass.material:!0===this.pxlRendering.mapOverlaySlimPass.enabled&&(s=this.pxlRendering.mapOverlaySlimPass.material);else{if("script_dArrows"===a)return void this.geoList.dArrows.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_userScreens"===a)return void this.camScreenData.screenGeoList.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_warpZonePortals"===a)return void this.returnPortalGlowList.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_lizardking"===a)s=this.pxlRendering.lizardKingPass.material;else if("script_majorTom"===a)s=this.pxlUser.starFieldPass.material;else if("script_fractalSubstrate"===a)s=this.pxlUser.crystallinePass.material;else if("script_fractalEcho"===a)s=this.pxlRendering.delayPass.material;else{var r=a.split("_");r.shift(),r=r.join("_"),this.geoList[r]&&(s=this.geoList[r].material)}}s&&(s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0)}getAssetTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.log("Get Internal Texture - ",e);var s=this.pxlUtils.assetRoot+e;if(!t){var a=e.split(".").pop().toLowerCase();"jpg"===a||"jpeg"===a?t=3:"png"===a&&(t=4)}return i||(i={encoding:o.LinearSRGBColorSpace,magFilter:o.LinearFilter,minFilter:o.LinearFilter}),this.pxlUtils.loadTexture(s,t,i)}buildBackgroundObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new o.PlaneGeometry,a={};Object.assign(a,e),null!==t&&"string"==typeof t||(t=this.pxlShaders.scene.bgScreenVert()),null!==i&&"string"==typeof i||(i=this.pxlShaders.scene.bgScreenFrag());var r=this.pxlFile.pxlShaderBuilder(a,t,i);r.side=o.DoubleSide,r.depthTest=!0,r.depthWrite=!1;var n=new o.Mesh(s,r);return n.frustumCulled=!1,n}clickUserDetect(){var e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(null!=e&&e.hasColliderType&&e.hasColliderType(Ke.CLICKABLE)){var s=e.getColliders(Ke.CLICKABLE);i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){var a=i.order[0];this.clickableActions(a.name)}else if(i={},(i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t)).hasOwnProperty("order")&&i.order.length>0){var r=i.order[0];this.promoActions(r)}}clickableActions(){"CallToAction"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null).userData.video;this.promoClickableLinks.hasOwnProperty(e)&&window.open(this.promoClickableLinks[e],"_blank").focus()}hoverUserDetect(){var e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(null!=e&&e.hasColliderType&&(e.hasColliderType(Ke.CLICKABLE)||e.hasColliderType(Ke.HOVERABLE))){var s=[...e.getColliders(Ke.CLICKABLE),...e.getColliders(Ke.HOVERABLE)];i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){var a=i.order[0];return this.pxlDevice.setCursor("help"),void(this.objectClickableObjectList[a.name]&&(null===this.clickablePrevActiveObject&&(this.clickablePrevActiveObject=a.name),this.objectClickableObjectList[a.name].Inactive.visible=!1,this.objectClickableObjectList[a.name].Hover.visible=!0))}if(this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab"),i={},(i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t)).hasOwnProperty("order")&&i.order.length>0){var r=i.order[0];this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[r.name]&&(null===this.promoPrevActiveObject&&(this.promoPrevActiveObject=r.name),this.promoClickableObjectList[r.name].x=1)}else this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab")}sendRoomMessage(e,t,i){this.roomSceneList[e]&&this.roomSceneList[e].onMessage(t,i)}buildComposers(){this.pxlRendering.buildComposers(),this.mapOverlayHeavyPass=this.pxlRendering.mapOverlayHeavyPass,this.mapOverlayPass=this.pxlRendering.mapOverlayPass,this.mapOverlaySlimPass=this.pxlRendering.mapOverlaySlimPass,this.mapBoxAAPass=this.pxlRendering.mapBoxAAPass,this.mapCrossAAPass=this.pxlRendering.mapCrossAAPass,this.mapWorldPosMaterial=this.pxlRendering.mapWorldPosMaterial,this.mapGlowPass=this.pxlRendering.mapGlowPass,this.mapComposer=this.pxlRendering.mapComposer,this.mapComposerMotionBlur=this.pxlRendering.mapComposerMotionBlur,this.mapComposerGlow=this.pxlRendering.mapComposerGlow,this.chromaticAberrationPass=this.pxlRendering.chromaticAberrationPass,this.lizardKingPass=this.pxlRendering.lizardKingPass,this.mapComposerWarpPass=this.pxlRendering.mapComposerWarpPass,this.blurScreenMerge=this.pxlRendering.blurScreenMerge}setExposure(e){e*=1,this.pxlCamera.uniformScalars.exposureUniformBase=e,this.pxlRendering.updateCompUniforms(e)}stepWarpPass(){if(this.warpVisualActive){var e=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],t=Math.min(1,3*e),i=Math.min(1,3-3*e);1===t&&1===i&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=t,this.warpVisualFader.y=i,i<=0&&this.stopWarpVisual()}}checkUserVideoStatus(e){}remoteUserUpdateMedia(e){}userRemoveRemoteData(e){}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach((e=>{this.pxlUser.itemList[e].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate}))}initWarpVisual(e){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!0)}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom)}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(e,t){this.roomWarpVisuals[t].material.map=e}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(e){var t=this.roomSceneList[e];this.pxlRendering.engine.setRenderTarget(t.warpZoneRenderTarget),t.prepPortalRender(),this.pxlRendering.engine.render(t.scene||t.scene,this.pxlCamera.camera),t.cleanupPortalRender(),this.pxlRendering.engine.setRenderTarget(null)}mapRender(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.pxlTimer.active&&this.step(),this.pxlTimer.runtime>this.nextRenderMS||!1===e){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.runtime+this.renderInterval,this.pxlRendering.stepShaderValues(),this.stepAnimatedObjects(),this.emit("render-prep",{time:this.pxlTimer.runtime});var t=this.roomSceneList[this.currentRoom];t&&t.booted&&(t.step(),t.camera.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(t.scene.renderTarget),this.pxlRendering.engine.clear(),this.pxlRendering.engine.render(t.scene,t.camera),this.pxlRendering.engine.setRenderTarget(null),t.camera.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(t,t.camera,t.scene,this.scene.renderGlowTarget),this.pxlRendering.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}else if(this.pxlOptions.subTickCalculations){var i=this.roomSceneList[this.currentRoom];i&&i.booted&&i.step()}this.emit("render-post",{time:this.pxlTimer.runtime}),this.pxlTimer.active&&e&&requestAnimationFrame((()=>{this.mapRender()}))}mapRenderBlurStack(e,t,i,s){if(this.blurComposer){e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{if(e.userData.hasOwnProperty("GlowPerc")){var t=e.userData.GlowPerc;e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=t)}})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=0)}))),t.layers.disable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.disable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(s);var a=i.background.clone();i.background.set(0),this.pxlRendering.engine.setClearColor(0,0),this.pxlRendering.engine.render(i,t),i.background.r=a.r,i.background.g=a.g,i.background.b=a.b,t.layers.enable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.enable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(null),e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{e.userData.hasOwnProperty("GlowPerc")&&e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=1)})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=1)}))),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}},GUI:class GUI extends GUIManager{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",arguments.length>2&&void 0!==arguments[2]?arguments[2]:"images/assets/",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"images/GUI/"),this.verbose=e,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(pxlNav){super.setDependencies(pxlNav),this.ShaderEditor=new ShaderEditor(pxlNav,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(e){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(e)}},HUD:class HUD{constructor(){this.pxlOptions=null,this.pxlEnums=null,this.pxlGuiDraws=null,this.pxlDevice=null,this.hudParent=null,this.huds={},this.mobileHUD={}}setDependencies(pxlNav){this.pxlOptions=pxlNav.pxlOptions,this.pxlEnums=pxlNav.pxlEnums,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlDevice=pxlNav.pxlDevice}init(){var e=document.createElement("div");e.classList.add("pxlNav-hud-parent"),this.pxlGuiDraws.addToContainer(e),this.hudParent=e,this.pxlOptions.mobile&&!this.pxlOptions.staticCamera&&(e.classList.add("pxlNav-hud-parent-mobile"),this.createMobileHUD())}addToHUD(e){e.hasOwnProperty("block")&&null!==e.block?this.hudParent.appendChild(e.block):null!==(null==e?void 0:e.object)?this.hudParent.appendChild(e.object):this.hudParent.appendChild(e)}addItem(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.huds.hasOwnProperty(e)||(this.huds[e]=[]);var r=null;switch(t){case Ye.REGION:r=this.createRegion(e,i,s,a),this.huds[e].push(r);break;case Ye.DRAG_REGION:r=this.createDragRegion(e,i,s,a),this.huds[e].push(r);break;case Ye.BUTTON:r=this.createButton(e,i,s,a),this.huds[e].push(r);break;case Ye.THUMBSTICK:r=this.createThumbstick(e,i,s,a),this.huds[e].push(r);break;case Ye.SLIDER:r=this.createSlider(e,i,s,a),this.huds[e].push(r);break;case Ye.IMAGE:r=this.createImage(e,i,s,a),this.huds[e].push(r);break;case Ye.TEXT:r=this.createText(e,i,s,a),this.huds[e].push(r)}return null!==r&&(null!==a?a.appendChild(r.object):this.addToHUD(r),null!==s&&r.subscribe(s)),r}createRegion(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new ElementBase(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createDragRegion(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new DragRegion(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createButton(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new ElementBase(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createThumbstick(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new Thumbstick(e,t);return s.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),s.build(),null!==i&&s.subscribe(i),s}createSlider(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new ElementBase(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createImage(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new ElementBase(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createText(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new ElementBase(e,t);return a.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),a.build(),null!==i&&a.subscribe(i),null!==s&&s.appendChild(a.object),a}createMobileHUD(){var e="",t="",i={},s=document.createElement("div");s.classList.add("pxlNav-hudMobile-parent"),s.classList.add(),this.hudParent.appendChild(s);var a=this.pxlEnums.HUD_ACTION.NONE,r=this.pxlEnums.HUD_ACTION.HOVER,n=this.pxlEnums.HUD_ACTION.ACTIVE;e="thumbstick_left",(i={style:["pxlNav-hudMobile-joystick-left"],objectStyles:[{object:"block"},{object:"parent"},{object:"inner"}]}).objectStyles[0][a]=["pxlNav-hudElement-thumbstick-block-default"],i.objectStyles[0][r]=["pxlNav-hudElement-thumbstick-block-hover"],i.objectStyles[0][n]=["pxlNav-hudElement-thumbstick-block-active"],i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][n]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-left"],i.objectStyles[2][a]=["pxlNav-hudElement-thumbstick-inner-default"],i.objectStyles[2][r]=["pxlNav-hudElement-thumbstick-inner-hover"],i.objectStyles[2][n]=["pxlNav-hudElement-thumbstick-inner-active"],(t=this.addItem(e,Ye.THUMBSTICK,Object.assign({},i))).subscribe((e=>{this.mobileDeligate(qe.MOVE,e)})),this.mobileHUD[e]=t,e="thumbstick_right",(i=Object.assign({},i)).style=["pxlNav-hudMobile-joystick-right"],i.objectStyles[1]={object:"parent"},i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][n]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-right"],(t=this.addItem(e,Ye.THUMBSTICK,i)).subscribe((e=>{this.mobileDeligate(qe.LOOK,e)})),this.mobileHUD[e]=t,e="mobile_jump",i={style:["pxlNav-hudMobile-region-jump"]},t=this.addItem(e,Ye.REGION,i,(e=>{this.mobileDeligate(qe.JUMP,{},e)})),this.mobileHUD.jump=t,e="mobile_ACTION",i={style:["pxlNav-hudMobile-region-action"]},(t=this.addItem(e,Ye.REGION,i)).subscribe((e=>{this.mobileDeligate(qe.ACTION,e)})),this.mobileHUD.item=t}mobileDeligate(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.pxlDevice.deviceAction(e,t,i)}subscribe(e,t){this.huds.hasOwnProperty(e)&&(this.huds[e].hasOwnProperty("callbacks")||(this.huds[e].callbacks=[]),this.huds[e].callbacks.push(t))}emit(e,t){this.huds.hasOwnProperty(e)&&this.huds[e].hasOwnProperty("callbacks")&&this.huds[e].callbacks.forEach((e=>{e(t)}))}},Camera:class Camera{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.hasMovementLimit=!0,this.movementMax=100,this.jumpScalar=1,this.userScale=1,this.maxStepHeight=5,this.cameraEasing=[.55,.45],this.touchMaxSensitivity=800,this.cameraJumpImpulse=[.75,1.5],this.cameraMaxJumpHold=[2.85,2],this.gravityCount=0,this.gravityRate=0,this.gravityMax=15.5,this.gravityUPS=[.3,.15],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlRendering=null,this.pxlEnv=null,this.pxlColliders=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.camUpdated=!0,this.cameraBooted=!1,this.hasMoved=!1,this.hasRotated=!1,this.hasJumped=!1,this.hasJumpLock=!1,this.hasGravity=!1,this.userInputMoveScalar={x:1,y:1},this.userInputLookScalar=1,this.roomStandingHeight={default:this.standingHeight},this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.walkBounceSeed=230,this.walkBounceHeight=.3,this.walkBounce=0,this.walkBouncePerc=0,this.walkBounceRate=.025,this.walkBounceEaseIn=.03,this.walkBounceEaseOut=.95,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new o.Vector3(0,0,0),this.camRotPitch=new o.Vector2(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.9,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new o.Vector3(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new o.Vector3(0,0,0),this.nearestFloorObjNamePrev=null,this.gravitySourceActive=!1,this.gravityDirection=new o.Vector3(0,-1,0),this.gravityEaseOutRate=.5,this.jump=0,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.08,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:.1,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"position",lookAt:"lookat"},mobile:{pos:"positionmobile",lookAt:"lookatmobile"},vr:{pos:"positionvr",lookAt:"lookatvr"}},this.cameraPos=new o.Vector3(0,0,0),this.cameraPrevPos=new o.Vector3(0,0,0),this.cameraPrevLookAt=new o.Vector3(0,0,0),this.cameraAim=new o.Vector3(0,0,1),this.cameraAimTarget=new o.Vector3(0,0,0),this.cameraCross=new o.Vector3(1,0,0),this.lookAtTargetActive=new o.Vector3(0,0,0),this.lookAtPerc=new o.Vector2(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new o.Quaternion,this.pi=3.141592653589793,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi,this.callbacks={},this.init()}setDependencies(pxlNav){this.pxlAudio=pxlNav.pxlAudio,this.pxlTimer=pxlNav.pxlTimer,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlRendering=pxlNav.pxlRendering,this.pxlEnv=pxlNav.pxlEnv,this.pxlColliders=pxlNav.pxlColliders,this.pxlUser=pxlNav.pxlUser,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality,this.pxlOptions=pxlNav.pxlOptions,this.socket=pxlNav.socket}log(e){this.verbose>=je.INFO&&console.log(e)}warn(e){this.verbose>=je.WARN&&console.warn(e)}error(e){this.verbose>=je.ERROR&&console.error(e)}init(){}updateMainValues(e){var{gravityRate:t,standingHeightGravInfluence:i,cameraJumpImpulse:s}=e;null!=t&&(this.gravityRate=t),null!=i&&(this.standingHeightGravInfluence=i),null!=s&&(this.cameraJumpVelocity+=s),this.camUpdated=!0}setUserHeight(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";e=Math.max(e,.01),this.roomStandingHeight.hasOwnProperty(t)||(this.roomStandingHeight[t]=this.standingHeight),"default"===t&&(this.standingHeight=e),this.roomStandingHeight[t]=e}setMaxStepHeight(e){e=Math.max(e,.01),this.maxStepHeight=e}setUserScale(e){e=Math.max(e,.01),this.userScale=e}setMovementScalar(e){e=Math.max(e,.01),this.movementScalar=e}setMovementMax(e){e=Math.max(e,.01),this.movementMax=e}setMovementEase(e){e=Math.min(1,Math.max(e,.01)),this.cameraMovementEase=e}setPositionBlend(e){e=Math.min(1,Math.max(e,.01)),this.camPosBlend=e}setInputMovementMult(e){e=Math.max(e,.01),this.cameraMoveLengthMult=e}setJumpScalar(e){e=Math.max(e,.01),this.jumpScalar=e}setJumpImpulse(e){e=Math.max(e,.01),this.cameraJumpImpulse[0]=e}setJumpHoldMax(e){e=Math.max(e,.01),this.cameraMaxJumpHold[0]=e}setJumpRepeatDelay(e){e=Math.max(e,.01),this.releaseJumpLockDelay=e}setCameraRotateEasing(e){Array.isArray(e)||("number"==typeof e?(e=[e,e],this.warn("Warning : Camera.setCameraEasing() expects an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")):this.error("Error : Camera.setCameraEasing() unexpected values type; expecting an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")),this.cameraEasing=e}setTouchSensitivity(e){e<=0&&(e=1),this.touchMaxSensitivity=e,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi}setGravityRate(e){e<=0&&(e=1),this.gravityRate=e}setGravityMax(e){e<=0&&(e=1),this.gravityMax=e}setWalkBounceHeight(e){e<=0&&(e=0),this.walkBounceHeight=e}setWalkBounceRate(e){e<=0&&(e=1e-4),this.walkBounceRate=e}setWalkBounceEaseIn(e){e=Math.min(1,Math.max(e,1e-4)),this.walkBounceEaseIn=e}setWalkBounceEaseOut(e){e=Math.min(1,Math.max(e,.01)),this.walkBounceEaseOut=e}setUserSettings(e){e.hasOwnProperty("height")&&(e.height.hasOwnProperty("standing")&&this.setUserHeight(e.height.standing),e.height.hasOwnProperty("stepSize")&&this.setMaxStepHeight(e.height.stepSize)),e.hasOwnProperty("movement")&&(e.movement.hasOwnProperty("scalar")&&this.setMovementScalar(e.movement.scalar),e.movement.hasOwnProperty("max")&&this.setMovementMax(e.movement.max),e.movement.hasOwnProperty("easing")&&this.setMovementEase(e.movement.easing)),e.hasOwnProperty("headBounce")&&(e.headBounce.hasOwnProperty("height")&&this.setWalkBounceHeight(e.headBounce.height),e.headBounce.hasOwnProperty("rate")&&this.setWalkBounceRate(e.headBounce.rate),e.headBounce.hasOwnProperty("easeIn")&&this.setWalkBounceEaseIn(e.headBounce.easeIn),e.headBounce.hasOwnProperty("easeOut")&&this.setWalkBounceEaseOut(e.headBounce.easeOut)),e.hasOwnProperty("jump")&&(e.jump.hasOwnProperty("impulse")&&this.setJumpScalar(e.jump.impulse),e.jump.hasOwnProperty("holdMax")&&this.setJumpHoldMax(e.jump.holdMax),e.jump.hasOwnProperty("repeatDelay")&&this.setJumpRepeatDelay(e.jump.repeatDelay)),e.hasOwnProperty("gravity")&&(e.gravity.hasOwnProperty("ups")&&this.setGravityRate(e.gravity.ups),e.gravity.hasOwnProperty("max")&&this.setGravityMax(e.gravity.max))}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.hasGravity=!1,this.cameraAllowJump=!0,this.camInitJump()),this.hasGravity&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse()),this.camUpdated=this.camUpdated||this.hasMoved||this.hasRotated||this.hasGravity||0!==this.cameraMovement[0]||0!==this.cameraMovement[1],this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(e){if(!this.pxlQuality.settings.leftRight){var t=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=t),this.pxlDevice.touchMouseData.netDistance.x+=4*t}if(null!=this.pxlDevice.touchMouseData.velocity&&!this.pxlDevice.mobile){if(e<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{var i=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(i)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(e){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),null===e&&(e=this.camera.position.clone()),this.camera.position.copy(e),this.updateCameraMatrices(),this.cameraPos.copy(e),this.cameraPrevPos.copy(e),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0,this.hasMoved=!0}setFOV(e){this.camera.fov=e,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(e,t,i,s){this.camera.near=i,this.camera.far=s,this.setFOV(e)}setAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setTransform(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetCameraCalculations(e),t&&(this.cameraAimTarget.position.copy(t),this.camera.lookAt(t),this.cameraPrevLookAt.copy(t),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.resetCameraCalculations(e.position),t){var i=t.position.clone();this.cameraAimTarget.position.copy(i),this.camera.lookAt(i),this.cameraPrevLookAt.copy(i),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=e.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.hasMoved=!0,this.hasRotated=!0,this.colliderCheck(e.position),this.nearestFloorObjName=null}warpToRoom(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=Object.keys(this.pxlEnv.roomSceneList),a=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];i=(i=i||a.defaultCamLocation||"").toLowerCase();var r=(e||"").toLowerCase(),n=this.pxlEnv.roomSceneList.hasOwnProperty(this.pxlEnv.currentRoom);a&&!s.includes(e)&&a.camLocation.hasOwnProperty(r)?(i=r,e=this.pxlEnv.currentRoom):(n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop(),a=this.pxlEnv.roomSceneList[e]);var o=this.pxlEnv.currentRoom,l=!1;n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasOwnProperty("camHoldWarpPos")&&(l=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos),this.pxlEnv.currentRoom=e,this.pxlAutoCam.curRoom=e;var h=e===this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){var c=h?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,d=h?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=c.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=d.renderTarget1.texture,setTimeout((()=>{o!==e&&(h?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1}),500)}),100)}if(t){if(!a)return void this.warn("pxlCamera.warpToRoom(); pxlRoom not found - "+this.pxlEnv.currentRoom);e!==o&&a.start(),this.pxlRendering.roomRenderPass.scene=a.scene;var A=i.toLowerCase();if(a.camLocation.hasOwnProperty(A)){var u=this.cameraPosLookAtNames.default.pos,p=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(a.camLocation[A].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(u=this.cameraPosLookAtNames.mobile.pos),a.camLocation[A].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(p=this.cameraPosLookAtNames.mobile.lookAt));var m=a.camLocation[A][u],g=a.camLocation[A][p];this.setTransform(m,g)}else!a.camInitPos||!a.camInitLookAt||l&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(this.setTransform(a.camInitPos,a.camInitLookAt),this.hotKeyTriggered=!1)}else l&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(null!=i?this.setToObj(i):this.setTransform(a.camReturnPos,a.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(a.getArtistInfo()),this.camUpdated=!0;var v=a.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=v,this.camera.zoom=a.pxlCamZoom,this.camera.aspect=a.pxlCamAspect,this.camera.near=a.pxlCamNearClipping,this.camera.far=a.pxlCamFarClipping,this.camera.updateProjectionMatrix();var f=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),f,!0),this.canMove&&(this.colliderValid=!1,this.hasGravity=!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(e){this.pxlEnv.currentRoom=e;var t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],i=t.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=i,this.camera.zoom=t.pxlCamZoom,this.camera.aspect=t.pxlCamAspect,this.camera.near=t.pxlCamNearClipping,this.camera.far=t.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(t.camThumbPos,t.camThumbLookAt);var s=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),s,!0)}fastTravel(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,0===e&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.hasGravity&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.hasGravity=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.hasJumpLock&&(this.hasJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(e){var t=e-this.pxlDevice.keyDownCount[2],i=Math.min(1,t/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){var s=i;1===s?this.cameraJumpActive=!1:(s=(1-s)*(1-s),s*=.5*s+.5),this.cameraJumpVelocity+=Math.max(0,s)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar*this.pxlTimer.deltaTime}this.cameraJumpVelocity*=1-i,1===i&&(this.cameraJumpActive=!1)}killJumpImpulse(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.cameraJumpVelocity*e*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=t>.1?t:0,this.workerFunc("killJumpImpulse")}updateGravity(e){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-this.cameraJumpVelocity);var t=this.gravityUPS[this.pxlUser.lowGrav];this.hasGravity&&(this.gravityCount+=2.5*t*e,this.gravityRate=Math.min(1,this.gravityRate+this.gravityMax)*this.gravityCount),0!==this.gravityRate&&(this.hasGravity||(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*t*e:0),this.standingHeightGravInfluence=Math.min(1,this.gravityRate/this.gravityMax)*this.standingMaxGravityOffset)}}resetGravity(){this.gravityCount=0,this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityCount=0,this.hasGravity=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,e&&this.workerFunc("jumpLanding")}colliderCheck(e){if(!this.canMove)return e;var t=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||null===this.colliderPrevObjHit||null===this.nearestFloorObjName)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;var i=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],s=new o.Vector3(0,-1,0),a=e.clone(),r=150*this.maxStepHeight;a.y+=r+this.maxStepHeight;var n=[];if(i.hasColliderType(Ke.WALL)&&(n=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,Ke.WALL)),n.length>0)if(i.hitColliders(n,Ke.WALL),i.hasColliderType(Ke.WALL_TOP)){var l=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,Ke.WALL_TOP);l.length>0&&i.hitColliders(l,Ke.WALL_TOP);for(var h,c,d=-99999,A=this.nearestFloorHit,u=!1,p=0;p<l.length;++p){var m=l[p];h=m.object.name;var g=m.pos,v=m.dist,f=g.y<this.maxStepHeight;u=u||f,(v<d&&f||null===t)&&(t=h,d=v,A=g)}(!u||e.y<A.y&&this.nearestFloorHitPrev.y-A.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity&&e.y+this.maxStepHeight+this.getStandingHeight()<A.y&&this.hasGravity)&&(0===this.cameraMovement[0]&&0===this.cameraMovement[1]||(u=!0,this.hasGravity=!1,this.hasJumpLock=!0),(c=this.cameraPos.clone()).y=Math.min(e.y,c.y),A=e=c,this.hasGravity?A.y=this.nearestFloorHitPrev.y:A.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),u&&(null===t?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(e.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.hasGravity=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=A,this.nearestFloorObjName=t))}else this.colliderFail=!0,this.movementBlocked=!0;else{var b=this.maxStepHeight;if((a=e.clone()).y+=r+this.maxStepHeight,!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasColliders())return e;if((n=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,Ke.FLOOR)).length>0){if(n.length>1){var x=Math.abs(n[0].pos.y-e.y);if(x<b)n=[n[0]];else if(x>b&&n[0].pos.y>n[1].pos.y&&n[1].pos.y>e.y-this.maxStepHeight)return e}this.floorColliderInitialHit=!0;for(var C,E=-99999,y=this.nearestFloorHit,I=0;I<n.length;++I){var B,w=n[I],S=w.pos;C=w.object.name;var D=S.distanceTo(e);if(B=D<this.maxStepHeight,(this.portalList[C]||this.roomWarpZone.includes(C))&&B){t=C,y=S;break}this.itemCheck(C,B)||(D<E||null===t)&&(t=C,E=D,y=S)}null===this.nearestFloorObjName&&null!=t&&(this.nearestFloorHitPrev=y,this.nearestFloorObjNamePrev=t,this.nearestFloorHit=y,this.nearestFloorObjName=t),this.nearestFloorHitPrev.y-y.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,e=t?this.cameraPos.clone():this.cameraPrevPos.clone(),t=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=y,this.nearestFloorObjName=t,null===t&&(this.colliderValid=!1,this.hasGravity=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,e=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,e}checkColliderValid(e){this.colliderValidityChecked=!0;var t=this.maxStepHeight+this.gravityRate,i=e.distanceTo(this.nearestFloorHit),s=i<t;return this.colliderValid=s,i}eventTrigger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.canMove)return!1;if(!e)return!1;if(this.portalList[e])return this.warpEventTriggered(0,this.portalList[e]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(e))return this.warpEventTriggered(1,e),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!==e||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=e,this.colliderShiftActive=this.colliderShiftActive||!(1===this.colliderAdjustPerc||0===this.colliderAdjustPerc),this.colliderShiftActive&&this.colliderCurObjHit){var t=1;this.colliderCurObjHit.includes("AudioTrigger")&&(t=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*t));var i=1-this.colliderAdjustPerc,s=1;if("AudioTrigger_1"===this.colliderCurObjHit)this.pxlEnv.currentAudioZone=1,s-=i*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=s;else if("AudioTrigger_2"===this.colliderCurObjHit){this.pxlEnv.currentAudioZone=2;s=this.uniformScalars.curExp+i*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=s,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)}else this.pxlEnv.currentAudioZone=0,s=s*(1-i)+this.uniformScalars.exposureUniformBase*i;if(this.colliderShiftActive=!(1===this.colliderAdjustPerc||0===this.colliderAdjustPerc),"AudioTrigger_2"===this.colliderPrevObjHit&&this.colliderCurObjHit!==this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(s=this.colliderAdjustPerc),this.pxlRendering.updateCompUniforms(s),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){var a=this.colliderAdjustPerc;a=1-(1-a)*(1-a),this.pxlEnv.fogMult.x=a,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(e,t){if(!t)return!1;var i=e.split("_").shift();if(this.pxlUser.itemListNames.includes(e)&&this.pxlUser.checkItemPickUp(i))return this.itemActive(i,e);return!1}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{0===this.pxlUser.mPick.length&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));var e=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(e),this.itemActive(e)}}itemActive(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return!1;var i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,s="",a="";if("LowGravity"===e)a="Low Gravity",s="this.lowGrav=0;this.itemGroupList['"+t+"'].visible=true;",i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("LizardKing"===e)a="I am the Lizard King",s="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lizardKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("StarField"===e)a="Major Tom",s="this.sField=0;this.starFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else{if("InfinityZoom"!==e)return!1;a="Fractal Substrate",s="this.iZoom=0;this.crystallinePass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout((()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0}),500)}),500)}return this.pxlGuiDraws.buildItemHud(e,a),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[t].visible=!1),this.pxlUser.itemInactiveCmd.push(s),this.pxlUser.itemActiveTimer.push(i),this.pxlUser.itemActiveList.push(a),!0}toggleMovement(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=!this.canMove),this.canMove=e,this.hasGravity=e}updateMovement(e){if(this.canMove&&!this.pxlDevice.mobile){var t=[0,0],i=[...this.pxlDevice.directionKeysPressed],s=0,a=0,r=[e-this.pxlDevice.keyDownCount[0],e-this.pxlDevice.keyDownCount[1]],n=this.mobile?1:0;if(i[0]+i[2]===1){s=i[2]-i[0];var o=this.pxlQuality.settings.leftRight?this.cameraEasing[n]:.5*(1-Math.min(1,Math.abs(.3*this.cameraMovement[1])));t[0]=((this.pxlQuality.settings.leftRight?1:6)+r[0]*r[0]*.1)*o,t[0]=Math.min(this.pxlUser.moveSpeed,t[0])*this.movementScalar*this.userInputMoveScalar.x}else this.pxlDevice.keyDownCount[0]=e;if(i[1]+i[3]===1){a=i[3]-i[1];var l=(1-Math.min(1,Math.abs(.07*this.cameraMovement[0])))*this.cameraEasing[n];t[1]=r[1]*(3*r[1]+2+this.pxlUser.moveSpeed)*.5*l,t[1]=Math.min(this.pxlUser.moveSpeed,t[1])*this.movementScalar*this.userInputMoveScalar.y}else this.pxlDevice.keyDownCount[1]=e;this.hasMovementLimit=!0,this.movementMax=10,this.cameraMovement[0]+=s*t[0],this.cameraMovement[1]+=a*t[1]}}initFrameCamPosition(){var e=this.cameraPos.clone();if(this.cameraBooted){var t;t=new o.Vector3(this.pxlQuality.settings.leftRight?.5*this.cameraMovement[0]:0,0,this.cameraMovement[1]),this.cameraMoveLength=t.length(),t.applyQuaternion(this.camera.quaternion);var i=this.cameraMoveLength*this.cameraMoveLengthMult;if(0!==i){i=i>0?Math.max(.1,i):Math.min(-.1,i),t.normalize().multiply(new o.Vector3(1,0,1)).multiplyScalar(i),e.add(t),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,0===this.cameraMovement[0]&&(this.userInputMoveScalar.x=1),0===this.cameraMovement[1]&&(this.userInputMoveScalar.y=1),this.hasMoved=!0}e.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}else this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new o.Vector3(e.clone()),this.cameraPrevLookAt=new o.Vector3(0,0,1),this.hasMoved=!0,this.hasRotated=!0;return this.cameraCross=new o.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),e}applyGravity(e){if(this.canMove&&this.hasGravity)if(e.y<this.nearestFloorHit.y){var t=this.nearestFloorHitPrev;e.y=Math.max(t.y,e.y),e.y<0&&(e.x=t.x,e.z=t.z)}else e.y=Math.max(this.nearestFloorHit.y,e.y-this.gravityRate),e.y===this.nearestFloorHit.y&&e.y<this.cameraPrevPos.y&&this.jumpLanding();else if(e.distanceTo(this.nearestFloorHit)<this.maxStepHeight)e.y=this.nearestFloorHit.y;else{var i=(e=this.cameraPos.clone()).y>this.nearestFloorHit.y;this.hasGravity=i,this.hasMoved=this.hasMoved||i,this.colliderFail=!i,this.workerFunc("jumpLanding")}return e}getStandingHeight(){var e=this.standingHeight;return this.roomStandingHeight.hasOwnProperty(this.pxlEnv.currentRoom)&&(e=this.roomStandingHeight[this.pxlEnv.currentRoom]),e*this.userScale}getUserHeight(){var e=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+this.walkBounceEaseIn*e,this.walkBounce+=e*this.walkBounceRate,this.walkBouncePerc=this.walkBouncePerc*this.walkBounceEaseOut+e,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=2351.3256*Math.random());var t=Math.sin(this.walkBounce+this.walkBounceSeed)*this.walkBouncePerc*this.walkBounceHeight;return this.getStandingHeight()-this.standingHeightGravInfluence+t}camApplyMobileRotation(){if(null!=this.cameraPose.alpha){var e=.017453292519943278,t=2.23606797749979,i=new o.Quaternion,s=this.cameraPose.alpha*e+this.cameraPose.alphaOffset+2.1,a=this.cameraPose.beta*e,r=this.cameraPose.gamma*e,n=new o.Vector3(0,0,1),l=new o.Quaternion,h=new o.Quaternion(-t,0,0,t),c=new o.Euler;c.set(a,s,-r,"YXZ"),i.setFromEuler(c),i.multiply(h),i.multiply(l.setFromAxisAngle(n,-this.cameraPose.orientation)),i.normalize();var d=new o.Quaternion;o.Quaternion.slerp(this.camera.quaternion,i,d,.35);var A=(new o.Euler).setFromQuaternion(d);A.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,A.x)),d.setFromEuler(A),this.camera.setRotationFromQuaternion(d),this.hasRotated=!0}}updateRoamRotation(){if(null===this.cameraPose.alpha){var e=this.pxlDevice.gyroGravity[2];this.pxlDevice.touchMouseData.velocity.y=Math.min(this.touchSensitivityLimits,Math.max(-this.touchSensitivityLimits,this.pxlDevice.touchMouseData.velocity.y));var t,i=new o.Euler;if(this.pxlDevice.mobile){var s=this.pxlOptions.userSettings.look.mobile.invert||!1?-1:1;i.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*4*s,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*7*s+e,0,"YXZ"),(t=new o.Quaternion).setFromEuler(i),t=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(t)}else{var a=this.pxlOptions.userSettings.look.pc.invert||!1?-1:1;i.set(.005*this.pxlDevice.touchMouseData.velocity.y*a,.008*this.pxlDevice.touchMouseData.velocity.x*a+e,0,"YXZ"),(t=new o.Quaternion).setFromEuler(i),t=this.camera.quaternion.clone().multiply(t)}t.normalize();var r=new o.Vector3(0,0,-10).applyQuaternion(t).add(this.camera.position);this.camera.setRotationFromQuaternion(t),this.camera.lookAt(r),this.camera.up.set(0,1,0),this.hasRotated=!0}}updateStaticRotation(){var e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var t=new o.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var i=(new o.Quaternion).clone(this.camera.quaternion);i.setFromEuler(t),(i=this.camera.quaternion.clone().multiply(i)).normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();var s=new o.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0),this.hasRotated=!0}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(0!==this.lookAtLockFader&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,.001*this.pxlDevice.touchMouseData.velocity.length()))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){var e=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);var t=this.camera.quaternion.clone();1===this.lookAtLockPerc?this.camera.setRotationFromQuaternion(t):this.camera.setRotationFromQuaternion(t.slerp(e,.5*Math.cos(this.lookAtLockPerc*this.pi)+.5)),this.hasRotated=!0}}warpEventTriggered(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"init";this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=e,this.warpObj=t,this.warpTarget=i,this.warpActive=!0,this.pxlEnv.initWarpVisual(e))}warpCamRun(){if(0===this.warpType)this.setToObj(this.warpObj);else if(1===this.warpType){var e="init"===this.warpTarget;this.warpToRoom(this.warpObj,e,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){var e=new o.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),t=e.clone().multiply(new o.Vector3(1,0,1)).normalize();this.camRotPitch.set(.1591549430918955*-Math.atan2(t.x,t.z),.5*e.y)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){var e,t=new o.Vector3(0,0,0);if(t.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(t.multiplyScalar(.2)),this.pxlDevice.mobile){var i=.5*this.pxlDevice.sW,s=.5*this.pxlDevice.sH,a=new o.Vector3(0,0,10),r=new o.Vector3(0,0,10);a.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),r.applyQuaternion(this.prevQuaternion).project(this.camera),a.x=(a.x+1)*i,a.y=-(a.y-1)*s,r.x=(r.x+1)*i,r.y=-(r.y-1)*s;(e=r.clone().sub(a.clone()).multiplyScalar(.6).multiply(new o.Vector3(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0))).length>.1&&e.normalize().multiplyScalar(.1)}else e=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));var n=new o.Vector2(e.x,-e.y),l=new o.Vector2(0,0).lerpVectors(this.pxlEnv.blurDirPrev,n,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(l)}}emitCameraTransforms(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.emit("cameraTransforms",{cameraPos:e,standingHeight:t,force:i})}jogServerMemory(){var e=this.cameraPos.clone(),t=this.getUserHeight();this.emitCameraTransforms(e,t,!0)}updateCamera(){var e=this.pxlDevice.touchMouseData.velocity.length();if(this.hasRotated=this.hasRotated||e>0,this.camUpdated=this.camUpdated||this.hasRotated,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated){this.camUpdated=!1;var t=!1;this.updateDeviceValues(e),this.prevQuaternion.copy(this.camera.quaternion);var i=this.initFrameCamPosition(),s=this.getUserHeight();if(this.pxlOptions.staticCamera)return this.hasGravity=!1,this.hasMoved=!1,this.pxlOptions.allowStaticRotation&&this.hasRotated&&(this.updateStaticRotation(),this.camera.updateMatrixWorld()),void(this.hasRotated=!1);(this.hasMoved||this.hasGravity)&&(i=this.colliderCheck(i),this.updateGravity(this.pxlTimer.deltaTime),this.colliderValid||this.colliderValidityChecked?this.jump=0:this.jump=this.checkColliderValid(i),this.eventCheckStatus=!0,i=this.applyGravity(i),this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=i.clone(),t=this.cameraPos.distanceTo(this.cameraPrevPos)>0,i.y+=s+this.cameraJumpHeight,this.camera.position.copy(i)),this.hasRotated&&this.canMove?(this.updateRoamRotation(),t=t||this.hasRotated):this.hasRotated&&(this.updateStaticRotation(),t=t||this.hasRotated),t&&(this.camera.updateMatrixWorld(),this.emitCameraTransforms(i,s)),this.hasMoved=!1,this.hasRotated=!1,this.cameraBooted=!0}}subscribe(e,t){this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){var i=!1;return this.callbacks.hasOwnProperty(e)&&(i=this.callbacks[e].includes(t))&&(this.callbacks[e]=this.callbacks[e].filter((e=>e!==t))),i}emit(e,t){this.callbacks.hasOwnProperty(e)&&this.callbacks[e].forEach((e=>{e(t)}))}},AutoCamera:class AutoCamera{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.enabled=e,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new o.Vector2,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlAudio=pxlNav.pxlAudio,this.pxlCamera=pxlNav.pxlCamera,this.pxlEnv=pxlNav.pxlEnv,this.camera=pxlNav.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;var{roomList:e,pathCounts:t}=this.getAutoCamData();this.roomList=e,this.curRoom=this.roomList[0],this.pathCounts=t,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===this.autoCamActive||null===this.active)return this.autoCamActive=!1,this.active=!1,!0;if(!1===this.active){if(!this.autoCamActive)return!0;this.updateAutoCamera()}if((this.pxlTimer.curMS>=this.nextCamChange||e)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!e||!this.enabled){var t=this.checkCamMode();this.setNextTrigger(t)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),1===this.camMode||2===this.camMode?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){var e=this.camMode;return this.camMode=0,this.enabled&&this.active?(this.camMode!==e&&0===this.camMode&&(this.forceNewRoom=!0),1):1}setCamMode(e){var t=1;return 1===e.type||2===e.type?t=1:(this.camMode=0,this.forceNewRoom=!0),this.step(!0),t}stepDroneCam(){var e=!0,t=Math.random(this.nextCamChange),i=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=2*i&&(this.forceNewRoom=!0),(t<.3||this.forceNewRoom)&&(this.setRoom(),e=!1),this.curRoomCount+=1,this.getNextPath(e)}setRoom(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.active||this.autoCamActive){var i=this.curRoomIndex,s=this.roomList.length;this.pxlEnv.postIntro?t||(e||(i=Math.floor(Math.random()*s))===this.curRoomIndex)&&(i=(i+1)%s):i=0,this.curRoomIndex=i,this.curRoom!==this.roomList[i]&&(this.curRoom=this.roomList[i],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Math.random(this.nextCamChange);t=(this.delayRange[1]-this.delayRange[0])*t+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+t*e}getNextPath(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.enabled&&this.active&&this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){var i=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+t)%i,e&&0===t){var s=Math.random(this.nextCamChange);s=Math.floor(s*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath===s&&(s=(s+1)%i),this.curPath=s}else this.curPath=this.curPath<0?i-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||"AudioTrigger_2"===this.pxlCamera.colliderCurObjHit&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamMode=e,1===e&&(this.resetAutoCam=!0)}setPosQuat(e,t){this.camera.quaternion.copy(t),this.camera.position.copy(e),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;var i=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=i-1);var s=this.autoCamActive;if(this.autoCamActive=null===e&&i>0?!this.autoCamActive:e,this.autoCamActive=this.mobile||this.autoCamActive,!s&&this.autoCamActive&&(this.netDistance=(new o.Vector2).copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+t)%i,this.autoCamId=this.autoCamId<0?i-1:this.autoCamId;var a=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=a.position.userData.duration;try{this.autoCamPositions=a.position.geometry.attributes.position,this.autoCamLookAt=a.lookAt.geometry.attributes.position,a.up?this.autoCamUp=a.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch(e){}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.autoCamActive&&(this.enabled&&this.active&&!t?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,e))}setAutoCamPath(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamActive&&(this.autoCamId=e,this.toggleAutoCam(!0,0))}getAutoCamData(){var e=Object.keys(this.autoCamPaths),t={};return e.forEach((e=>{t[e]=this.autoCamPaths[e].length})),{roomList:e,pathCounts:t}}getAutoCamValueFromCurve(e,t,i){var s=e[3*t],a=e[3*t+1],r=e[3*t+2],n=(t+1)%this.numControlPoints,l=e[3*n],h=e[3*n+1],c=e[3*n+2],d=new o.Vector3(s,a,r),A=new o.Vector3(l,h,c);return d.lerp(A,i),d}updateAutoCamera(){if(this.autoCamPositions&&this.autoCamPositions.array){var e=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;e*=this.numControlPoints-1;var t=Math.floor(e),i=e-t,s=this.getAutoCamValueFromCurve(this.autoCamPositions.array,t,i,!1);this.camera.position.copy(s);var a=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,t,i);if(this.camera.lookAt(a),this.autoCamUp){var r=this.getAutoCamValueFromCurve(this.autoCamUp.array,t,i);r=r.sub(s).normalize(),this.camera.up.copy(r)}}}applyTouchRotate(){var e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var t=new o.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var i=(new o.Quaternion).clone(this.camera.quaternion);i.setFromEuler(t),(i=this.camera.quaternion.clone().multiply(i)).normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();var s=new o.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0)}},Extensions:$e.Extensions,MusicUtils:class MusicUtils{constructor(){this.audioObject=null}},Audio:class Audio{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new o.Vector3(0,0,0),this.audioEq=new o.Vector4(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.audioCtx=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlVideo=pxlNav.pxlVideo,this.pxlDevice=pxlNav.pxlDevice,this.pxlEnv=pxlNav.pxlEnv,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlSocket=pxlNav.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){var e=this,t=this.djAudioVolumeMax,i=document.getElementById("guiMobileWelcomeButton");function audioClickMonitor(a){setTimeout((()=>{e.djAudioVolume=0,e.djAudioVolumeMax=t,e.djAudioVolumeMin=0,e.djAudioObj.byScript=!0,e.djAudioObj.volume=0,s.play().then((()=>{e.djPlayerMuteToggle(!1),e.setFadeActive(.5)})),i.removeEventListener("click",audioClickMonitor),i.removeEventListener("touchstart",audioClickMonitor)}),500)}i.addEventListener("click",audioClickMonitor),i.addEventListener("touchstart",audioClickMonitor)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();var s=this.djAudioObj;s.setAttribute("autoplay",!0);var a=this;this.djAudioObj.addEventListener("volumechange",(e=>{a.djPlayerSetSliderGui()}),!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch((e=>{})),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){var e=!0;return this.djAudioObj&&(e=this.djAudioObj.paused),e}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;var e=this.djAudioObj;e.children[0].setAttribute("src",this.djUrlSource),setTimeout((()=>{e.load(),setTimeout((()=>{e.volume=this.djAudioVolume,e.muted=this.djMuted||!this.roomAudioStopped,e.paused&&e.play()}),20)}),20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{var e=this.djAudioObj;e.children[0].setAttribute("src",""),e.pause(),setTimeout((()=>{e.load()}),20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";var e=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=t=>{e.djPlayerAdjustVolume(t)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",(t=>{e.djVolumeParentObj.down=!0,e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mousemove",(t=>{e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mouseup",(t=>{e.djVolumeParentObj.down=!1})),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",(t=>{e.djVolumeParentObj.down=!0}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",(t=>{e.djPlayerAdjustVolume(t)}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",(t=>{e.djVolumeParentObj.down=!1}),{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(e){}buildRemoteAudioMixer(e,t){return!1}loadStreamPromise(){var e=this.djAudioObj;return new Promise(((t,i)=>{this.djAudioObj.byScript=!0,e.children[0].setAttribute("src",this.djUrlSource),e.load(),e.muted=this.djMuted||!this.roomAudioStopped})).then((()=>{})).catch((e=>{console.log("error source")}))}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=100*this.djAudioVolume*~~!this.djMuted+"%"}djPlayerAdjustVolume(e){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&e.touches){var t=this.djVolumeParentObj.offsetWidth,i=0;i=e.touches?this.pxlDevice.objectPerc.percX:e.offsetX/t;var s=Math.max(0,Math.min(1,i));this.djAudioVolume=s,this.djAudioVolumeMax=s,this.djAudioVolumeMin=.1*s,s*=s,this.djAudioObj&&(this.djAudioObj.volume=s),e.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.djMuted=null===e?!this.djMuted:e,null!=e&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!e,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.fadeDir!==e&&(this.fadeDir=e,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1)return this.fadePerc=1===this.fadeDir?1:0,void(this.fadeActive=!1);var e=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=e,e*=e,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=e),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}},Video:class Video{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.pxlUtils=t,this.pxlAudio=i,this.pxlFile=s,this.pxlGuiDraws=a,this.pxlEnv=null,this.videojs=null,this.Hls=null,this.IVSPlayer=null,this.posted=!1,this.djStreamUrl="",this.performerStreamUrl="",this.screenVideoBlock=null,this.screenVideos={},this.videoStreams={},this.videoStreamFailCount=0,this.videoStreamFailMax=5,this.videoAudioEvent={dj:!1,performer:!1},this.checkForDjStream=!1,this.checkForPerformerStream=!1,this.videoStills={dj:{texture:null,url:e+"SoftNoise_512.jpg"},performer:{texture:null,url:e+"SoftNoise_512.jpg"}}}init(){this.buildVideoBlock(),this.buildPromoVideos()}buildVideoBlock(){if(null===this.screenVideoBlock){var e=document.createElement("div");e.classList.add("videoScreenBlockStyle"),document.body.appendChild(e),this.screenVideoBlock=e}}buildPromoVideos(){[].forEach((e=>{var t=e.name,i=e.type,s=e.intensity,a=e.boost,r=e.file,n=e.landscape,o=this.pxlFile.vidRoot+r,l=document.createElement("video");l.id="screenVideo_"+t+"_"+(n?"port":"land"),l.src=o,l.classList.add("bgMediaAssets"),l.controls=!1,l.muted=!0,l.preload="true",l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.setAttribute("playsinline",""),l.setAttribute("loop",""),this.screenVideoBlock.appendChild(l),this.screenVideos[t]||(this.screenVideos[t]={}),this.screenVideos[t].name=t,this.screenVideos[t].type=i,s&&(this.screenVideos[t].intensity=s),a&&(this.screenVideos[t].boost=a);var h=this.screenVideos[t].file||[];this.screenVideos[t].file?h[~~n]=o:h=[o,o],this.screenVideos[t].file=h;var c=this.pxlUtils.getVideoTexture(l),d=this.screenVideos[t].texture||[];this.screenVideos[t].texture?d[~~n]=c:d=[c,c],this.screenVideos[t].texture=d;var A=[];this.screenVideos[t].videoObjs?A[~~n]=l:A=[l,l],this.screenVideos[t].videoObjs=A}))}boot(){var e=this;return Video_asyncToGenerator((function*(){e.videoAudioEvent.dj?e.buildVideoPlayer("dj"):e.videoStills.dj.texture=e.pxlUtils.loadTexture(e.videoStills.dj.url)}))()}buildVideoPlayer(e){var t=this,i=document.createElement("video");i.id="antibodyDjStream",i.classList.add("bgMediaAssets"),i.controls=!1,i.volume=0,i.muted=!0,i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.addEventListener("volumechange",(e=>{i.volume=Math.min(i.volume,t.pxlAudio.djAudioVolume)}),!0),this.screenVideoBlock.appendChild(i),this.videoStreams[e]={},this.videoStreams[e].mode=0,this.videoStreams[e].active=!1,this.videoStreams[e].loading=!1,this.videoStreams[e].checkResolve=!1,this.videoStreams[e].prevCheck=this.pxlUtils.curMS+5,this.videoStreams[e].delayCheck=5,this.videoStreams[e].obj=i,this.videoStreams[e].url=this.djStreamUrl,this.videoStreams[e].urlStatus=!1,this.videoStreams[e].player=null,this.videoStreams[e].checkScreens=!1,this.videoStreams[e].activeLevel=-1,this.videoStreams[e].prevFrame=0,this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].canvasObj=null,this.videoStreams[e].videoTexture=this.getTexture(e),this.pxlFile.urlExists(this.djStreamUrl).then((t=>{this.videoStreams[e].urlStatus=t})),this.buildVideoStream(e,!1)}postBoot(e){this.videoStreams[e]&&this.videoStreams[e].urlStatus&&this.load(e,this.videoStreams[e].url),this.posted=!0,this.checkForDjStream=this.videoAudioEvent.dj}step(){var e=!1,t="dj";if(this.videoAudioEvent[t]){var i=this.videoStreams[t];i&&(i.active||this.checkVideoStreamStatus(t),this.pxlUtils.mobile?i.active&&i.videoTexture&&i.checkScreens&&(i.checkScreens=!1,this.setScreensToStreams(1,i.videoTexture)):(e=i.checkScreens,i.checkScreens=!1))}else this.videoStills[t].texture&&this.pxlUtils.mobile&&this.setScreensToStreams(1,this.videoStills[t].texture);return e}setScreensToStreams(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dj",i=t;"string"==typeof i&&((i=this.getTexture(t))||(e=0,this.videoStreams[t].active=!1,this.videoStreams[t].checkScreens=!0)),this.pxlEnv.camScreenData.screenGeoList.forEach(((t,s)=>{t.material.uniforms.camExists.value=e,t.material.uniforms.videoFeed.value=i}))}isActive(e){var t=!1;return this.videoStreams.hasOwnProperty(e)?this.videoStreams[e].active&&this.videoStreams[e].videoTexture&&(t=!0):t=null!=this.videoStills[e].texture,t}getTexture(e){var t=null;return this.videoAudioEvent[e]?(this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.buildVideoTexture(e)),t=this.videoStreams[e].videoTexture):this.videoStills[e].texture&&(t=this.videoStills[e].texture),t}buildVideoTexture(e){return this.disposeVideoTexture(e),this.videoStreams[e].obj&&this.videoStreams[e].player?this.pxlUtils.getVideoTexture(this.videoStreams[e].obj):null}disposeVideoTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.videoStreams[e].videoTexture&&(this.videoStreams[e].videoTexture.dispose(),this.videoStreams[e].videoTexture=null,this.videoStreams[e].checkScreens=null===t||t)}resetvideoTexture(e){this.setScreensToStreams(0,e),this.disposeVideoTexture(e,!1);var t=this.getTexture(e);this.videoStreams[e].videoTexture=t,this.videoStreams[e].checkScreens=!0}resetEnvSettings(e){this.resetvideoTexture(e),this.videoStreams[e].checkScreens=!1}hlsPreflight(){var e=window.MediaSource||window.WebKitMediaSource;e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var t=window.SourceBuffer||window.WebKitSourceBuffer;return t=(!t||t.prototype)&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,e&&t}buildVideoStream(e){var t=this;this.videoStreams[e].obj;if(void 0!==this.IVSPlayer)this.buildIvsPlayer(e);else{this.pxlFile.loadScript("https://player.live-video.net/1.1.2/amazon-ivs-player.min.js").then((()=>{t.buildIvsPlayer(e)}))}}buildVhsPlayer(e){if(this.videojs){this.videoStreams[e].mode=1;var t=this.videoStreams[e].obj,i=this.videojs(t,{controls:!1,autoplay:!0,preload:"auto"});this.videojs.log.level("off"),this.videojs.log.level("error"),this.videoStreams[e].player=i;var s=this;i.ready((function(){var e=i.play();e&&e.catch((function(e){document.addEventListener("click",(function vhsClickMonitor(e){var t=i.networkState();1!==t&&2!==t||(i.play(),document.removeEventListener("click",vhsClickMonitor))}))}))})),i.on("play",(t=>{s.ready(e)})),i.on("loadedmetadata",(t=>{s.start(e)})),i.on("waiting",(t=>{var a=i.currentTime(),r=i.duration();r>0&&setTimeout((()=>{var t=i.currentTime(),n=i.duration();a===t&&r===n&&this.pxlFile.urlExists(i.src()).then((t=>{t||s.ended(e)})).catch((()=>{s.ended(e)}))}),500)})),i.on("ended",(t=>{s.ended(e)})),i.on("error",(t=>{s.ended(e)}))}else this.buildFallbackPlayer(e)}buildHlsPlayer(e){if(this.Hls&&this.Hls.isSupported()){this.videoStreams[e].mode=4;var t=this.videoStreams[e].obj,i=new this.Hls({enableWorker:!0,liveBackBufferLength:900,startLevel:2,stretchShortVideoTrack:!0,nudgeOffset:.5,fragLoadingTimeOut:2e3});i.attachMedia(t),this.videoStreams[e].player=i;var s=this;i.on(this.Hls.Events.MEDIA_ATTACHED,(function(t){s.ready(e)})),i.on(this.Hls.Events.BUFFER_CREATED,(function(e){})),i.on(this.Hls.Events.MANIFEST_PARSED,(function(t){s.start(e)})),i.streamController.onMediaEnded=function(t){s.ended(e)},i.on(this.Hls.Events.ERROR,(function(t,a){a.fatal?s.ended(e):"bufferFullError"!==a.details&&"bufferAppendingError"!==a.details||i.recoverMediaError()})),i.on(this.Hls.Events.STREAM_STATE_TRANSITION,(function(t,a){"PARSED"===a.previousState&&"IDLE"===a.nextState&&(s.videoStreams[e].activeLevel=i.currentLevel,-1===i.currentLevel&&setTimeout((()=>{-1===i.currentLevel&&i.recoverMediaError()}),1e3))}))}else this.buildFallbackPlayer(e)}sendModMessage(e,t,i){var s={msg:e,init:t,data:i};this.pxlEnv.pxlSocket.sendErrorMsg(s)}buildFallbackPlayer(e){var t=this.videoStreams[e].obj;this.videoStreams[e].mode=2,t.setAttribute("src",this.videoStreams[e].urlStatus?this.videoStreams[e].url:"");var i=this;t.addEventListener("error",(function(e,t){})),t.addEventListener("loadedmetadata",(function(t){i.ready(e)})),t.addEventListener("canplay",(function(s){t.play(),i.start(e)})),t.addEventListener("suspend",(function(t){i.ended(e)})),t.addEventListener("ended",(function(t){i.ended(e)}))}buildIvsPlayer(e){if(this.IVSPlayer.isPlayerSupported){this.videoStreams[e].mode=3;var t=this.videoStreams[e].obj,i=this.IVSPlayer.create();i.attachHTMLVideoElement(t),i.setAutoplay(!0),i.setLogLevel("Error"),this.videoStreams[e].loading=!0,this.videoStreams[e].player=i,this.videoStreams[e].checkScreens=!1;var s=this,a=this.IVSPlayer.PlayerState;i.addEventListener(a.READY,(t=>{s.ready(e)})),i.addEventListener(a.PLAYING,(t=>{s.start(e)})),i.addEventListener(a.ENDED,(t=>{s.ended(e)}));var r=this.IVSPlayer.PlayerEventType;i.addEventListener(r.ERROR,((t,i,a,r)=>{s.ended(e,t)}))}else this.buildFallbackPlayer(e)}unload(e){}load(e,t){var i=this.videoStreams[e];if(i)switch(i.mode){case 1:this.videoStreams[e].url=t,i.player.src({type:"application/x-mpegURL",src:t}),i.player.load();break;case 2:i.obj.setAttribute("src",t),i.obj.load();break;case 3:i.player.load(t);break;case 4:i.player&&this.destroyPlayer(e,!0),i.player.attachMedia(this.videoStreams[e].obj);var s=decodeURIComponent(t);i.player.loadSource(s)}}newStream(e){}canUnmute(e){var t=!0;return this.videoStreams[e]&&(t=this.videoStreams[e].active),t}setMuted(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.videoStreams[e];i&&(i.obj.muted=t)}setVolume(e,t){var i=this.videoStreams[e];i&&(i.obj.volume=t)}getStreamState(e){var t=!1,i=this.videoStreams[e];switch(i.mode){case 1:case 2:t=!i.obj.paused;break;case 3:var s=i.player;t=s.core.isLoaded&&!s.core.paused;break;case 4:t=null!=i.player.streamController.lastCurrentTime}return t}checkVideoError(e){var t=this.videoStreams[e];t.active&&4===t.mode&&(0===t.obj.videoWidth?!t.obj.paused&&t.player.streamController.lastCurrentTime>10&&(this.destroyPlayer(e),this.videoStreams[e].active=!1,this.checkForDjStream=!0,this.buildHlsPlayer(e),this.videoStreams[e].player.recoverMediaError()):t.obj.webkitDecodedFrameCount===t.prevFrame?(this.videoStreams[e].prevFrameCount+=1,this.videoStreams[e].prevFrameCount>50&&(this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].player.recoverMediaError(),this.videoStreams[e].player.nextLoadLevel=Math.max(0,this.videoStreams[e].player.currentLevel-1),this.videoStreams[e].player.recoverMediaError())):(this.videoStreams[e].prevFrame=t.obj.webkitDecodedFrameCount,-1!==this.videoStreams[e].player.nextLevel&&(this.videoStreams[e].player.nextLevel=-1),this.videoStreams[e].prevFrameCount=0))}ready(e){this.videoStreams[e].loading=!1,this.videoStreams[e].obj.volume=0,this.videoStreams[e].activeLevel=1}start(e){var t=this.videoStreams[e];if(!t.active){var i=this.getStreamState(e);this.videoStreams[e].active=i,this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.getTexture(e)),this.pxlAudio.isVideoObject=!0,this.videoStreamFailCount=0,this.checkForDjStream=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.djAudioObj.byScript=!0;var s=this.pxlAudio.djAudioObj;s.children[0].setAttribute("src",""),s.pause(),s.muted=!0,setTimeout((()=>{s.load(),setTimeout((()=>{this.pxlAudio.roomAudioStopped&&(t.obj.volume=this.pxlAudio.djAudioVolume),t.obj.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,t.obj.click()}),20)}),20)}}restart(e){var t=!1,i=this.videoStreams[e].player,s=this.videoStreams[e].obj;switch(this.videoStreams[e].mode){case 1:case 2:t=!s.paused;break;case 3:t=i.core.isLoaded&&!i.core.paused;break;case 4:t=i.currentLevel>-1}this.videoStreams[e].active=t,this.videoStreams[e].checkScreens=t}ended(e){var t=this.videoStreams[e];if(t.active){this.destroyPlayer(e);var i=4===t.mode?!t.player.liveTracker.atLiveEdge():!t.obj.paused;this.videoStreams[e].active=i,this.checkForDjStream=this.videoAudioEvent.dj,this.pxlAudio.isVideoObject=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.roomAudioStopped&&(t.obj.volume=0),t.obj.pause(),t.obj.muted=!0,this.pxlAudio.djAudioObj.byScript=!0;var s=this.pxlAudio.djAudioObj,a=s.children[0];""===a.getAttribute("src")&&(a.setAttribute("src",this.pxlAudio.djUrlSource),s.load(),s.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,s.play()),this.videoStreams[e].prevCheck=this.pxlUtils.curMS+15,this.videoStreams[e].activeLevel=-1}}error(e,t){var i;i="object"==typeof t?t.type:t;["ErrorNetworkIO","networkError","mediaError","internalException"].includes(i)&&(this.videoStreams[e].active=!1)}destroyPlayer(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];4===this.videoStreams[e].mode&&(this.videoStreams[e].active||t)&&this.videoStreams[e].player&&this.videoStreams[e].player.detachMedia()}streamState(e){var t=this;return Video_asyncToGenerator((function*(){var i=!0,s=!0;t.videoStreams.dj&&(i=!t.videoStreams.dj.active),t.videoStreams.performer&&(s=!t.videoStreams.performer.active),!0===e.hasOwnProperty("dj")&&i&&(t.checkForDjStream=e.dj&&t.videoAudioEvent.dj),!0===e.hasOwnProperty("performer")&&s&&(t.checkForPerformerStream=e.performer&&t.videoAudioEvent.performer)}))()}checkVideoStreamStatus(e){var t=this;return Video_asyncToGenerator((function*(){var i=t.videoStreams[e];i&&t.checkForDjStream&&t.posted&&!i.active&&i.prevCheck+i.delayCheck<t.pxlUtils.curMS&&(t.checkForDjStream=!1,t.pxlFile.urlExists(t.videoStreams[e].url).then((i=>{t.videoStreams[e].urlStatus=i,t.checkForDjStream=!i,t.videoStreams[e].prevCheck=t.pxlUtils.curMS,t.videoStreams[e].checkResolve=t.pxlUtils.curMS,i?t.load(e,t.videoStreams[e].url):t.videoStreamFailCount+=1})).catch((i=>{console.log(i),t.videoStreamFailCount+=1,t.checkForDjStream=!0,t.videoStreams[e].prevCheck=t.pxlUtils.curMS})))}))()}}};function ShaderHeader_shaderHeader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        "}function defaultVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function defaultShiftVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  varying vec2 vUvShift;\n  void main(){\n    vUv=uv;\n        vUvShift=uv-.5;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function camPosVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 camPos;\n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n    camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;\n  }"}function discardFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  void main(){\n    discard;\n    gl_FragColor=vec4(.0,.0,.0,0.0);\n  }"}function animTextureVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function animTextureFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  uniform vec2 time;\n  uniform float rate;\n  uniform float freq;\n  uniform float intensity;\n  uniform vec3 glowColor;\n  uniform sampler2D glowTexture;\n  varying vec2 vUv;\n  float pi=3.14159265358979;\n  \n  void main(){\n    vec4 glowCd=texture2D(glowTexture, vUv);\n    vec4 Cd=vec4(glowColor,1.0);\n    Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;\n    Cd.rgb*=glowCd.r*glowCd.a;\n    gl_FragColor=Cd;\n  }"}function clickableBevelVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function clickableBevelFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform vec2 intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( 1.0 );\n      Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);\n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function portalBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec2 time;\n        uniform float rate;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        void main(){\n            shiftUv=(uv-.5);\n            \n            float t=time.x*rate;\n            vec2 rot=vec2( sin(t), cos(t) );\n            vec2 rotUV=vec2(0.0);\n            rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);\n            rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);\n            wUv=rotUV+.5;\n            \n            vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix*modelViewPosition;\n            \n        }"}function portalBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec3 color;\n        uniform sampler2D alphaMap;\n        uniform sampler2D cloudNoise;\n        uniform vec2 intensity;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        #define TAU 6.28318530717958\n        void main() {\n            float suvLength=length(shiftUv)+.1;\n            vec2 suvSign=sign(shiftUv);\n            \n            vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );\n            rUv *= suvLength ;\n            \n            vec4 noiseCd=texture2D(cloudNoise,rUv);\n            vec2 aUv=wUv*(noiseCd.xy*.5+wUv);\n            \n            float alpha=texture2D(alphaMap,aUv).r;\n            \n            vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);\n            alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );\n            Cd.a=min(1.0, alpha);\n            \n            gl_FragColor = Cd;\n        }"}function rgbaMapFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D rgbMap;\n    uniform sampler2D alphaMap;\n\n    varying vec2 vUv;\n\n    main(){\n      vec3 rgb=texture2D( rgbMap, vUv ).rgb;\n      float alpha=texture2D( alphaMap, vUv ).r;\n\n      vec4 outCd = vec4( rgb, alpha );\n      gl_FragColor=outCd;\n    }\n  "}function itemBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function itemBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      \n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function itemVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main(){\n      vUv=uv;\n      nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);\n      nUv.x=sin(nUv.x)*.5+.5;\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec3 pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function itemFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    uniform sampler2D cloudNoise;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      float alpha=texture2D(alphaMap,vUv).r;\n      float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*blender;\n      Cd.rgb*=intensity*alpha;\n      Cd.a=blender*alpha+noise*alpha;\n      gl_FragColor = Cd;\n    }"}function itemZoomFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D color;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform sampler2D cloudNoise;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=texture2D(color,vUv);\n      Cd.a=Cd.b;\n      Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );\n      Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);\n      gl_FragColor = Cd;\n    }"}function pxlPrincipledVert(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="\n    attribute vec3 color;\n    attribute vec3 shading;\n\n    varying float vFlicker;\n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    ";return e&&(t+="\n        ".concat(o.ShaderChunk.common,"\n        ").concat(o.ShaderChunk.shadowmap_pars_vertex,"\n      ")),t+="\n    \n    void main(){\n        vUv=uv;\n        \n        vShading=shading;\n        \n        vCd=color;\n        \n        vec3 transformed = vec3( position );\n        vec3 objectNormal = vec3( normal );\n        vec3 transformedNormal = objectNormal;\n        \n        \n        vLocalPos = position;\n        vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;\n        vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;\n        vec4 mvPos=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n        vPos = mvPos.xyz;\n        \n        ",e&&(t+="\n            ".concat(o.ShaderChunk.worldpos_vertex,"\n            ").concat(o.ShaderChunk.shadowmap_vertex,"\n          ")),t+="\n    }"}function pxlPrincipledFrag(e,t,i,s,a,r){var n=!1,l=1;e.hasOwnProperty("Specular")&&e.Specular>0&&(n=!0,l=e.Specular);var h=!1;e.PointColor&&(h=!0);var c=!0,d="1.0";e.hasOwnProperty("SurfaceNoise")&&(e.SurfaceNoise%1==0&&(d=e.SurfaceNoise+".0"),"0.0"===d&&(c=!1));var A="\n        ";if(t||(A+="uniform sampler2D dTexture;"),A+="\n    \n    uniform sampler2D noiseTexture;\n    uniform sampler2D detailTexture;\n        \n    uniform vec2 time;\n    uniform float cdMult;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    \n    varying float vFlicker;\n    \n    #define PI 3.14159265358979\n    \n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    struct DirLight {\n      vec3 color;\n      vec3 direction;\n    };\n    ",s&&(A+="\n    #if NUM_POINT_LIGHTS > 0\n      uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    #endif\n    #if NUM_DIR_LIGHTS > 0\n      uniform DirLight directionalLights[NUM_DIR_LIGHTS];\n    #endif\n      "),a&&(A+="\n      \n      ".concat(o.ShaderChunk.packing,"\n      \n      #if NUM_POINT_LIGHT_SHADOWS > 0\n          uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n          varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n          struct PointLightShadow {\n              float shadowBias;\n              float shadowNormalBias;\n              float shadowRadius;\n              vec2 shadowMapSize;\n              float shadowCameraNear;\n              float shadowCameraFar;\n          };\n          uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n      #endif\n      float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n          return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n      }\n      vec2 cubeToUV( vec3 v, float texelSizeY ) {\n          vec3 absV = abs( v );\n          float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n          absV *= scaleToCube;\n          v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n          vec2 planar = v.xy;\n          float almostATexel = 1.5 * texelSizeY;\n          float almostOne = 1.0 - almostATexel;\n          if ( absV.z >= almostOne ) {\n              if ( v.z > 0.0 )\n                  planar.x = 4.0 - v.x;\n          } else if ( absV.x >= almostOne ) {\n              float signX = sign( v.x );\n              planar.x = v.z * signX + 2.0 * signX;\n          } else if ( absV.y >= almostOne ) {\n              float signY = sign( v.y );\n              planar.x = v.x + 2.0 * signY + 2.0;\n              planar.y = v.z * signY - 2.0;\n          }\n          return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n      }\n      float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n           dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n              vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n              return (\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n              ) * ( .11111111111 ) * (1.0-dp);\n          #else\n              return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);\n          #endif\n      }\n    \n      vec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n          dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n          return texture2D( pointShadowMap[0], cubeToUV( bd3D, texelSize.y )).rgb;\n      }\n      ")),A+="\n    void main(){\n      ",h)A+="vec3 vertCd = vCd;";else if(t){var toFloatStr=e=>e%1==0?e+".0":e+"",u=toFloatStr(t.r),p=toFloatStr(t.g),m=toFloatStr(t.b);A+="vec3 vertCd = vec3( ".concat(u,", ").concat(p,", ").concat(m," ) ;")}else A+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";A+="\n        \n        vec4 Cd=vec4( vertCd, 1.0 );\n        float specular = 0.0;\n        ",i&&(A+="\n          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;\n          Cd.rgb=  mix( Cd.rgb, fogColor, depth );\n          ");var g="",v="",f="";if(c&&("1.0"!==d&&(g="*"+d),A+="\n            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;\n            ",v="+detailMult * (shadowInf*.5+.5) ".concat(g),f="(detailMult+.5) ".concat(g)),s&&(A+="\n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);\n          #endif\n          \n          #if NUM_POINT_LIGHTS > 0\n            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\n                vec3 lightVector = normalize(vPos - pointLights[i].position);\n                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;\n                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);\n                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );\n                lightInf *=  distFalloff;\n                lights.rgb += lightInf;\n                ",n&&(A+="\n                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;\n                  specular += distFalloff;\n                  "),A+="\n            }\n          #endif\n            \n          #if NUM_DIR_LIGHTS > 0\n            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {\n                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;\n                lights.rgb += lightInf;\n            }\n          #endif\n            \n            \n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            Cd.rgb *= lights.rgb;\n          #endif\n          ",n&&(A+="\n            Cd.rgb += vertCd * specular * ".concat(l,";\n            "))),a){A+="\n          #if NUM_POINT_LIGHT_SHADOWS > 0\n            \n            float shadowInf = 0.0;\n            float detailInf = 0.0;\n            float lShadow = 0.0;\n            int i = 0;\n            ";for(var b=0;b<r;++b)A+="\n                i=".concat(b,";\n                lShadow = getPointShadow( pointShadowMap[").concat(b,"], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.75, pointLightShadows[i].shadowRadius*1.65, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );\n                shadowInf = max( lShadow, shadowInf);\n                ");A+="\n            shadowInf = shadowInf;\n            Cd.rgb*=shadowInf ".concat(v," ;\n            "),c&&(A+="\n              #else\n                Cd.rgb*=".concat(f,";\n              ")),A+="\n          #endif\n          "}else c&&(A+="\n            Cd.rgb*=".concat(f,";\n            "));return A+="\n        Cd*=cdMult;\n        \n        // Convert to sRGB\n        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );\n\n        gl_FragColor=Cd;\n    }"}var tt={BaseSpeed:.77,EmberSpread:10,EmberFadeDistance:.04,ShiftFromZero:.6,MultPosXZ:1.313};function emberWispsVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},tt,e);var toFloatStr=e=>(e+"").includes(".")?e:e+".0",t="\n// Ember Settings\n  const vec3 EmberEarlyCd = vec3( 0.8, 0.5, .1 );\n  const vec3 EmberOldCd = vec3( 0.634, 0.20, 0.20 );\n  const float BaseSpeed = ".concat(toFloatStr(e.BaseSpeed),";\n  const float EmberSpread = ").concat(toFloatStr(e.EmberSpread),";\n  const float EmberFadeDistance = ").concat(toFloatStr(e.EmberFadeDistance),";\n  const float ShiftFromZero = ").concat(toFloatStr(e.ShiftFromZero),";\n  const float MultPosXZ = ").concat(toFloatStr(e.MultPosXZ),";\n\n// -- -- --\n  ");return t+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",t+="\n// -- -- --\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec3 windDir;\nuniform vec3 offsetPos;\nuniform float rate;\nuniform float pointScale;\n\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n    \n    return ret;\n}\n\nvoid main(){\n    vAtlas=atlas;\n    \n    float rot=seeds.z+time.x*seeds.z*3.;\n    vRot=vec2( sin(rot), cos(rot) );\n    \n    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n    \n    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n    \n    float rateShift = (BaseSpeed*(seeds.x*.4+.6));\n    float t=time.x*rate*rateShift;\n    \n    // Random shift to a cycle y movement\n    //float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);\n    \n    float shiftY = (t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0) * 0.1;\n    float lifePerc = fract( shiftY );\n    float loopSeed = floor( shiftY ) * seeds.w * 20.0;\n    shiftY = lifePerc * 10.0;\n    \n    // Change up ages of embers\n    float fadeDrop = min(1.0, lifePerc*lifePerc*4. ); \n    //\n    float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );\n    life = 1.0-((shiftY*.001-seeds.x*.2) );\n    \n    pOff.y=shiftY*seeds.y;\n    \n    pOff.y=(pOff.y)+shiftY; \n    vec3 pos= pOff ;\n    \n\n    float spreadPerc = min(1.0, life*2.) * EmberSpread;\n    pos.xz=fract(noiseCd.rg*noiseCd.r + loopSeed)*(seeds.x)*(life*seeds.zy*fract(seeds.w*30.0 )) * spreadPerc ;\n    \n    // Add gap from (0,0) and scale to spread after shift\n    pos.x = ( pos.x + (step( 0.0, pos.x )-.5) * ShiftFromZero ) * MultPosXZ;\n    pos.z = ( pos.z + (step( 0.0, pos.z )-.5) * ShiftFromZero ) * MultPosXZ;\n    \n    // Directional push\n    float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.03) * 4.2;\n    pos.xz += windDir.xz * yPush * max(0.0,pos.y-.5)*(.5+life*.5);\n    pos.y += yPush;\n    \n    float pToCamLen = length(pos-cameraPosition);\n    float pScalar = max( 0., (1.-pToCamLen *  0.0806 )); // 0.0385\n    pScalar += max(0.0,pToCamLen - 0.4) * 0.005;\n    \n    vAlpha = min(1.0, (seeds.x*.15+.7) * pScalar*3.0 );\n\n    \n    vAlpha=max(0.0, life*life-seeds.z-seeds.z);\n    float distMult = ( length( pos )*EmberFadeDistance );\n    distMult = 1.0 - ( distMult * distMult );\n    vAlpha *= distMult;\n    \n    \n    float pScale = pointScale * seeds.w * pScalar + 2.0;\n    \n    gl_PointSize =  pScale*fadeDrop ;\n    \n    \n    float tightenBase = min( 1.0, pos.y* 0.12 + .32 );\n    pos.xz *= tightenBase*tightenBase;\n    \n    // Apply Offset Position and move to camera space\n    vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n    \n    float cdAge = clamp( 1.0 - life, 0.0, 1.0);\n    \n    vCd = mix( EmberEarlyCd, EmberOldCd, cdAge )  ;\n    \n    vBrightness = 1.045 + fadeDrop*2.;\n}"}function emberWispsFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    \n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n    \n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n        \n        dustCd.rgb *= vBrightness;\n        \n        float dirtLuma = luma( dustCd.rgb );\n        vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n        \n        gl_FragColor=Cd;\n    }"}var it={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85};function dustVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},it,e);var toFloatStr=e=>(e+"").includes(".")?e:e+".0",t="\n    // Fade-Out Influence multiplier\n        const float ParticleOpacity = ".concat(toFloatStr(e.pOpacity),";\n        const float FadeOutScalar = ").concat(toFloatStr(e.fadeOutScalar),";\n        const float WanderInf = ").concat(toFloatStr(e.wanderInf),";\n        const float WanderRate = ").concat(toFloatStr(e.wanderRate),";\n        const float WanderFrequency = ").concat(toFloatStr(e.wanderFrequency),";\n\n        #define PROX ").concat(e.proxDist.toFixed(3),"\n        #define PROX_INV 1.0/").concat((.8*e.proxDist).toFixed(3),"\n\n    // -- -- --\n  ");return t+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",t+="\n    // -- -- --\n\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    uniform vec3 positionOffset;\n    uniform vec3 windDir;\n  ",e.hasLights&&(t+="\n  #if NUM_POINT_LIGHTS > 0\n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    uniform PointLight pointLights[NUM_POINT_LIGHTS];\n  #endif\n    "),t+="\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    \n    // -- -- --\n\n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    vec3 randomVec( vec3 seed ) {\n      return vec3(\n        fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),\n        fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),\n        fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )\n      );\n    }\n\n    // -- -- --\n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate*0.;\n        \n        vec3 pOff=seeds.xyz * vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.x);\n        pOff.xyz += time.x * windDir.xyz; \n        vec3 pos= pOff ;\n        \n        vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*2.1) ).rgb-.5;\n        vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;\n        \n        // -- -- --\n        \n        // Meandering points\n        \n        \n        vec3 randDirA = randomVec( seeds.xyz );\n        vec3 randDirB = randomVec( seeds.wyz );\n        vec3 randDirC = randomVec( seeds.zxy );\n        vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * time.x * WanderFrequency ) ) * WanderInf;\n        \n        // -- -- --\n        \n        pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );\n\n        pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);\n\n        pos = mod( pos-cameraPosition, PROX) + cameraPosition - PROX*.5;\n        pos+=positionOffset;\n        \n        \n        float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );\n        float aMult = min(1.0, pScalar*3.0);\n        vAlpha = (seeds.x*.5+.7) * aMult;\n\n  ",e.hasLights&&(t+="\n      #if NUM_POINT_LIGHTS > 0\n        float lightInf = 1.0;\n        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){\n            vec3 lightVector = normalize(pos - pointLights[x].position);\n            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );\n        }\n        vAlpha*=(1.0-lightInf)*.8+.2;\n      #endif\n    "),t+="\n        vScalar = pScalar * ParticleOpacity ;\n        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;\n        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );\n        pScale *= step( .5, atlas.x )*.5+1.;\n\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function dustFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    uniform sampler2D atlasTexture;\n    uniform sampler2D atlasAlphaTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    void main(){\n\n        if( vAlpha < .01 ){\n          discard;\n        }\n\n\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n\n      ",e+=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      ); \n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",e+="\n        float alpha = clamp( dustCd.a * vAlpha * vScalar, 0.0, 1.0 );\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }"}var st={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85,jumpHeightMult:15};function heightMapVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},st,e);var toFloatStr=e=>(e+"").includes(".")?e:e+".0",t="\n    // Fade-Out Influence multiplier\n        const float ParticleOpacity = ".concat(toFloatStr(e.pOpacity),";\n        const float FadeOutScalar = ").concat(toFloatStr(e.fadeOutScalar),";\n        const float WanderInf = ").concat(toFloatStr(e.wanderInf),";\n        const float WanderRate = ").concat(toFloatStr(e.wanderRate),";\n        const float WanderFrequency = ").concat(toFloatStr(e.wanderFrequency),";\n        const float JumpHeightMult = ").concat(toFloatStr(e.jumpHeightMult),";\n\n        #define PROX ").concat(e.proxDist.toFixed(3),"\n        #define PROX_INV 1.0/").concat((.98*e.proxDist).toFixed(3),"\n\n    // -- -- --\n  ");return t+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",t+="\n    // -- -- --\n\n    uniform sampler2D heightMap;\n    uniform sampler2D spawnMap;\n    uniform vec3 tankSize;\n    \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    uniform vec3 positionOffset;\n    uniform vec3 windDir;\n  ",e.hasLights&&(t+="\n  #if NUM_POINT_LIGHTS > 0\n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    uniform PointLight pointLights[NUM_POINT_LIGHTS];\n  #endif\n    "),t+="\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    \n    \n    // -- -- --\n\n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    vec3 randomVec( vec3 seed ) {\n      return vec3(\n        fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),\n        fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),\n        fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )\n      );\n    }\n\n    // -- -- --\n    \n    #define oneThird 0.3333333333333333\n    #define srgbLow 1.0 / 12.92\n    #define srgbHigh 1.0 / 1.055\n\n    vec3 sRGBToLinear(vec3 srgb) {\n      return vec3(\n        mix( srgb.r * srgbLow,  pow((srgb.r + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.r) ),\n        mix( srgb.g * srgbLow,  pow((srgb.g + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.g) ),\n        mix( srgb.b * srgbLow,  pow((srgb.b + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.b) )\n      );\n    }\n\n    void main(){\n      vAtlas=atlas;\n      \n      float rot=seeds.z+time.x*(seeds.z*2.);\n      vRot=vec2( sin(rot), cos(rot) );\n      \n      float t=time.x*rate;\n      vec2 sizeXZ = tankSize.xz;\n      vec2 scaleXZ = 1.0 / (sizeXZ);\n      \n      vec3 pOff= (seeds.xyz - vec3(0.5,0.0,0.5)) * vec3(PROX);\n      \n      \n      // Loop point positions based on camera location\n      float yFract=fract(t+seeds.x);\n      pOff.xyz += time.x * windDir.xyz; \n      vec3 pos= pOff ;\n      \n      vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+(time.x + seeds.y)*2.1) ).rgb-.5;\n      vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;\n      \n      // -- -- --\n      \n      // Meandering points\n      \n      \n      vec3 randDirA = randomVec( seeds.xyz );\n      vec3 randDirB = randomVec( seeds.wyz );\n      vec3 randDirC = randomVec( seeds.zxy );\n      vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * (time.x + seeds.w) * WanderFrequency ) ) * WanderInf;\n      \n      float jumpHeight = randDirBlend.y * abs(max(noiseCd.x,noiseCd.y));\n      \n      // -- -- --\n      \n\n      pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );\n      pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);\n\n      vec3 mPos = modelMatrix[3].xyz;\n      pos.xz = mod( pos.xz - cameraPosition.xz , PROX) + cameraPosition.xz - PROX*.5 + positionOffset.xz;\n      \n      \n      vec2 fitPos = clamp( ( pos.xz - mPos.xz  ) * scaleXZ + .5, vec2(0.0), vec2(1.0));\n\n      \n      vec3 heightCd=texture2D(heightMap, fitPos ).rgb;\n      vec2 spawnOffset = vec2( 0.0161 );\n      float spawnInf= min(1.0, texture2D(spawnMap, fitPos ).r +\n                      texture2D(spawnMap, fitPos + spawnOffset ).r +\n                      texture2D(spawnMap, fitPos - spawnOffset ).r );\n      heightCd = sRGBToLinear( heightCd );\n      float heightVal = heightCd[0] * oneThird + heightCd[1] * oneThird + heightCd[2] * oneThird;\n\n      pos.y = tankSize.y * heightVal + mPos.y;\n      \n      \n      float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );\n      float aMult = min(1.0, pScalar*pScalar*4.0);\n      vAlpha = min( 1.0, (seeds.x*.5+.75) * aMult * spawnInf * 2.5 * ParticleOpacity );\n\n      pos.y += max(1.0, (jumpHeight*pScalar + positionOffset.y) * JumpHeightMult * WanderInf);\n\n  ",e.hasLights&&(t+="\n      #if NUM_POINT_LIGHTS > 0\n        float lightInf = 1.0;\n        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){\n            vec3 lightVector = normalize(pos - pointLights[x].position);\n            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );\n        }\n        vAlpha*=(1.0-lightInf)*.8+.2;\n      #endif\n\n    "),t+="\n        float pScale = pointScale.x * (seeds.w*.25+1.0) * pScalar * 2.;\n        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );\n\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function heightMapFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    uniform sampler2D atlasTexture;\n    uniform sampler2D atlasAlphaTexture;\n    uniform vec3 tint;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    \n    void main(){\n\n        if( vAlpha < .01 ){\n          discard;\n        }\n\n\n        vec2 uv=gl_PointCoord;\n\n        /*vec2 pos = uv*.25-.125;\n        float vis = max(0.0, 1.0-max(0.0,length(pos)-.09)*20.);\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.125) + vAtlas;*/\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n\n      ",e+=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      ); \n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",e+="\n        float alpha = min(1.0, dustCd.a*1.75) * vAlpha ;\n        vec4 Cd=vec4( dustCd.rgb * tint, alpha );\n\n        gl_FragColor=Cd;\n    }"}var at={BaseSpread:200,SmokeBrightness:.65,InnerBulster:-.05,SmokeDensity:.12,WindInfluenceBoost:.45,TightenBaseSpread:1,TightenMidSpread:.08,TightenTipSpread:.2};function smokeVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},at,e);var toFloatStr=e=>(e+"").includes(".")?e:e+".0",t="\n// Billowy goodness!\n  const float BaseSpread = ".concat(toFloatStr(e.BaseSpread),";\n  const float SmokeBrightness = ").concat(toFloatStr(e.SmokeBrightness),";\n  const float InnerBulster = ").concat(toFloatStr(e.InnerBulster),";\n  const float SmokeDensity = ").concat(toFloatStr(e.SmokeDensity),";\n  const float WindInfluenceBoost = ").concat(toFloatStr(e.WindInfluenceBoost),";\n\n  const float TightenBaseSpread = ").concat(toFloatStr(e.TightenBaseSpread),";\n  const float TightenMidSpread = ").concat(toFloatStr(e.TightenMidSpread),";\n  const float TightenTipSpread = ").concat(toFloatStr(e.TightenTipSpread),";\n\n  // -- -- --\n  ");return t+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",t+=" \n\n  // -- -- --\n         \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec3 windDir;\n    uniform vec3 offsetPos;\n    uniform vec2 pointScale;\n    uniform vec3 sliders;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    #define PROX 6.0\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n      vec2 ref=pos-pt;\n      float ret = step( dot( ref, n1 ), 0.0 );\n      ret *= step( dot( ref, n2 ), 0.0 );\n      \n      return ret;\n    }\n     \n        \n    void main(){\n      vAtlas=atlas;\n      \n      float rot=seeds.z+time.x*(seeds.z*2.);\n      vRot=vec2( sin(rot), cos(rot) );\n      \n      vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n      \n      vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n      vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n      \n      float t=time.x*rate;\n      float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);\n      float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;\n      float alphaMult = (1.0-(1.0-life)*(1.0-life))*SmokeDensity;\n      \n      pOff.y=shiftY*seeds.y*life - (1.0-life);\n      \n      pOff.y=(pOff.y)+shiftY; \n      vec3 pos= pOff ;\n      \n      \n      // Magic numbers!  Boo!!\n      float tightenTip = max(0.0,life-.73);\n      tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);\n      //tightenTip *= tightenTip;\n      float tightenBase = max(0.0, (1.0-life)*InnerBulster);\n      float tightenMid = max(0.0, TightenBaseSpread - tightenTip - tightenBase - seeds.x*.2);\n      \n      float curBaseSpread = BaseSpread * tightenBase +\n                            BaseSpread * tightenMid * TightenMidSpread +\n                            BaseSpread * tightenTip * TightenTipSpread ;\n      \n      //pos.xz=clamp((noiseCd.rg*noiseCd.b)*seeds.w, vec2(0.0), vec2(1.0))*curBaseSpread*(life*(seeds.zy*.6));\n      pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*curBaseSpread*life;\n      \n      // Wind -- Forces\n      //   Magic numbers, yarb!\n      float windInf = life * life * (life*.5+.5);\n      vec2 curWindDir = windInf * windDir.xz ;\n      \n      float yPush = ( life * (life*.5+.5))* min(1.0,pos.y*.12) * .08;\n      pos.xz += curWindDir*life + curWindDir * WindInfluenceBoost ;\n      \n      \n      // Alpha with cam distance inf\n      float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );\n      pScalar=1.0-(pScalar*pScalar);\n      float aMult = min(1.0, pScalar*2.0);\n      vAlpha = (seeds.x*.5+.7) * aMult;\n\n      \n      // Alpha from gettin' old\n      vAlpha=(1.0-life)*min(1.0,alphaMult);\n      vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;\n      pos.xz=(pos.xz*(0.9+seeds.xy*.2)+doubleCd.rb*10.0)*min(1.0,life+seeds.y);\n      \n      \n      // Draw size, particle scale\n      pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);\n      float pScale = pointScale.x * seeds.w * 0.6 * pScalar + (175.0+125.0*life*pScalar)*(1.0-pScalar);\n      pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));\n\n      gl_PointSize = pScale;\n      \n      // Brightness multiplier\n      vBrightness = 1.0-tightenMid*.1 - tightenTip + tightenBase;\n      float originDelta = length(pos)*(-InnerBulster);\n      vBrightness *= max(0.0, 1.0-originDelta * life * 0.807) * SmokeBrightness;\n      \n      // Apply Offset Position and move to camera space\n      vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);\n      gl_Position = projectionMatrix*mvPos;\n    }"}function smokeFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    // -- -- --\n    \n    uniform sampler2D atlasTexture;\n    uniform sampler2D atlasAlphaTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n\n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n      \n\n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n      ",e+=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      ); \n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",e+="\n        float alpha=dustCd.a*vAlpha;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        float lumaCd = luma( Cd.rgb );\n\n        Cd.rgb = mix( vec3( lumaCd ), Cd.rgb, vBrightness*.2 );\n\n        Cd.rgb *= vec3(vBrightness);\n        //Cd.rgb *= Cd.rgb*.5+.5;\n        \n        gl_FragColor=Cd;\n    }"}var rt={ProxDist:1e3,CalculateCollisions:!0,LandHeight:50};function snowFallVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},rt,e);var toFloatStr=e=>(e+"").includes(".")?e:e+".0",t="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return t+="\n    uniform vec2 time;\n    uniform float rate;\n    uniform float pointScale;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    #define PROX ".concat(toFloatStr(e.ProxDist),"\n    #define LAND ").concat(toFloatStr(e.LandHeight),"\n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate;\n        \n        vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.z);\n        pOff.y=PROX-yFract*(PROX+LAND); \n        vec3 pos= pOff ;\n        vec2 camXZ=cameraPosition.xz;\n        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;\n        \n        \n        // Get some roof tops working\n        //   Using opposing points and 2 normals in xz space to determin y floor position\n        // Find rooves from xz pos + dot products\n        float floor=0.0;\n    "),e.CalculateCollisions&&(t+="\n        // -- --\n        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1\n        vec2 l1n1=vec2(-.1,1.); // Normal 1\n        vec2 l1n2=vec2(1.,-.1); // Normal 2\n        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2\n        vec2 l2n1=vec2(.1,-1.1);\n        vec2 l2n2=vec2(-1.,.1);\n        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof\n\n        lp1=vec2( -217.0, 786.0 ); // Point 1\n        l1n1=vec2(.2,-1.); // Normal 1\n        l1n2=vec2(1.,.1); // Normal 2\n        lp2=vec2( -940.0, 1293.0 ); // Point 2\n        l2n1=vec2(-.2,1.);\n        l2n2=vec2(-1.,-.1);\n        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n\n        lp1=vec2( 204.028, 56.7629 ); // Point 1\n        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1\n        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2\n        lp2=vec2( 755.264, 754.843 ); // Point 2\n        l2n1=vec2( -0.160366, 0.987058 );\n        l2n2=vec2( 0.999849, 0.0173488 );\n        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n        "),t+="  \n        // Prevent snow drifting after hitting the ground\n        float yLimit=max( floor, pos.y ) * .08 * seeds.z;\n        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky\n        \n        // Shift Y position per camera height\n        pos.y+=cameraPosition.y-yFract*(cameraPosition.y); \n        pos.y=max( floor+1.5, pos.y );\n        \n        float melt=min(1.0, (pOff.y+LAND-floor)*.02);\n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );\n        \n        vScalar = pScalar;\n        float pScale = pointScale * seeds.w * pScalar ;\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function snowFallFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D snowTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = uv-.5;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        float alpha=texture2D(snowTexture,rotUV).r * vScalar;\n        vec4 Cd=vec4( vec3(1.), alpha );\n\n        gl_FragColor=Cd;\n    }"}function worldPositionVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 pos;\n  \n  void main(){\n    vec3 transformed = vec3( position );\n      vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );\n    pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;\n    \n    gl_Position = projectionMatrix * mvPosition;\n  }"}function worldPositionFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e="#include <packing>\n  "+e,e+="\n    uniform sampler2D diffuse;\n    uniform sampler2D depth;\n    uniform float camNear;\n    uniform float camFar;\n    varying vec3 pos;\n    \n    void main() {\n      \n      vec4 Cd=vec4( pos, 1.0 );\n      gl_FragColor = Cd;\n    }"}function glowPassPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D gDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 gCd=texture2D( gDiffuse, vUv );\n      vec4 rCd=texture2D( rDiffuse, vUv );\n      \n      Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;\n\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function textureStorePass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D tDiffusePrevRoom;\n    uniform float roomComposer;\n    varying vec2 vUv;\n        \n    void main() {\n      vec4 Cd = texture2D( tDiffusePrev, vUv );\n      vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;\n      Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);\n      //Cd.rgb=Cd.rgb + prevRoomCd;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function compLayersPostProcess(){return"\n    uniform sampler2D tDiffuse;\n    uniform sampler2D mtDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform sampler2D noiseTexture;\n    uniform float exposure;\n    uniform vec2 camRotPitch;\n    uniform vec2 time;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*exposure;\n      vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;\n      vec4 depth=texture2D(sceneDepth,vUv);\n      \n  ////////////////////////\n  /*\n      vec2 uv=vUv;\n      float pi=3.14159265358979;\n      float t=-time.x*.007;\n      float pitch=camRotPitch.y;//depth.w*2.0-1.0;\n      float yaw=camRotPitch.x;\n      \n      float distMult=depth.x*2.0;\n      vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));\n      vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;\n      noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));\n      noiseCd.g=texture2D(noiseTexture,noiseUV).g;\n      noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));\n      noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n      float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n      mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);\n      \n      float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;\n      float bval=length(bloomCd.rgb);\n      mult= mult*(bg+bval) ;//*(1.0-depth.z);\n      Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );\n      */\n      \n      Cd.rgb+=mBlurCd.rgb;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function crossAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n    // 1/4 ==  0.25\n    //  + 2 center samples, 1/6 ==  0.166...\n    #define AADIV 0.1666666666666666\n    const int runCount = 4;\n    const vec2 runDir[4] = vec2[4](\n                              vec2( -1.0, -1.0 ),\n                              vec2( -1.0, 1.0 ),\n                              vec2( 1.0, -1.0 ),\n                              vec2( 1.0, 1.0 )\n                            );\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n      float dist = 1.0;\n      vec2 baseUV=vUv;\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n        Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function boxAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n    // 1/8 ==  0.125\n    //  + 2 center samples, 1/10 ==  0.1\n    #define AADIV 0.1\n    const int runCount = 8;\n    const vec2 runDir[8] = vec2[8](\n                              vec2( -1.0, -1.0 ),\n                              vec2( -1.0, 1.0 ),\n                              vec2( 1.0, -1.0 ),\n                              vec2( 1.0, 1.0 ),\n\n                              vec2( -1.0, 0.0 ),\n                              vec2( 0.0, -1.0 ),\n                              vec2( 0.0, 1.0 ),\n                              vec2( 1.0, 0.0 )\n                            );\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n      float dist = 1.0;\n      vec2 baseUV=vUv;\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n                Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function directionalBlurPass(e,t,i,s){var a="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return a+="\n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n  \n        #define PI 3.14159265358979\n        \n        void main() {\n          \n          float dist = 2.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n            \n          const int blurCount=".concat(i,";\n          const int runCount=2;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(").concat(t[0],".0, ").concat(t[1],".0);\n          runDir[1]=vec2(-").concat(t[0],".0, -").concat(t[1],".0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 blurCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.0 + float(b)*").concat(s,";\n            fade = (1.0-float(b+1)/float(blurCount+2));\n            //fade = 1.- (1.-fade)*(1.-fade);\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curUV = min( vec2(1.), max( vec2(0.), curUV ));\n              curCd = texture2D(").concat(e,",curUV);\n              curCd.a *= fade*(length(curCd.rgb)*.6);\n              blurCd.r = max( blurCd.r, curCd.r );\n              blurCd.g = max( blurCd.g, curCd.g );\n              blurCd.b = max( blurCd.b, curCd.b );\n              //blurCd.rgb += curCd.rgb;\n              blurCd.a = max( blurCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=blurCd;\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }")}function mixBlurShaderPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n        \n        #define PI 3.14159265358979\n        \n        void main() {\n\n          float dist = 3.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n          const int blurCount=3;\n          const int runCount=8;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(1.0, 0.0);\n          runDir[1]=vec2(1.0, 1.0);\n          runDir[2]=vec2(0.0, 1.0);\n          runDir[3]=vec2(-1.0, 1.0);\n          runDir[4]=vec2(-1.0, 0.0);\n          runDir[5]=vec2(-1.0, -1.0);\n          runDir[6]=vec2(0.0, -1.0);\n          runDir[7]=vec2(1.0, -1.0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 scatterCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.5*(1.0+float(b));\n            fade = .1*(1.0-float(b)/float(blurCount));\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curCd = texture2D(pDiffuse,curUV);\n              curCd.a *= fade;\n              scatterCd.rgb += curCd.rgb;\n              scatterCd.a = max( scatterCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=scatterCd;\n          \n          vec4 blurCd=texture2D(tDiffuse,vUv);\n          blurCd.rgb = normalize( blurCd.rgb );\n          \n          Cd = mix( blurCd, Cd, Cd.a);\n          Cd = texture2D(tDiffuse,vUv);\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }"}function motionBlurPostProcess(e,t){var i="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return i+="\n    uniform sampler2D tDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D noiseTexture;\n    \n    uniform float exposure;\n    uniform vec2 time;\n    uniform vec3 camRotXYZ;\n    uniform vec2 blurDirCur;\n    uniform vec2 blurDirPrev;\n    varying vec2 vUv;\n\n    vec4 getTexture( sampler2D texelToLinearTexture ) {\n      return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n    }\n    \n    vec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){\n      float perc;\n      float curPerc=1.0;\n      vec2 curUV;\n      float origLength=length(origCd.rgb);\n      vec3 curCd;\n      vec3 retCd=origCd;\n      float delta;\n      float threshTrigger=1.0;\n      float dropoff;\n      float percCurve;\n      float d=dot(dir,deltaDir)*.5+.5;\n      for(int r=0; r<10; ++r){\n        perc=(float(r)/10.0);\n        percCurve=perc*.5;\n        dropoff=(dist*float(r))*perc*d;\n        curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;\n        //curUV=uv+dir*dropoff;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n        percCurve*=percCurve;\n        curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;\n        //curUV=uv-dir*dropoff*.4;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n      }\n      return retCd /curPerc;\n    }\n\n    void main() {\n      \n      \n      vec4 bloomCd=getTexture( rDiffuse );\n      float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;\n      noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));\n      vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      float blurDist=length(blurDirCur);\n      blurDist=min(1.0,blurDist*15.0);\n      //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));\n      vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);",t||(i+="\n        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );\n      "),i+="\n      vec2 deltaDir=normalize(blurDirPrev);\n      deltaDir.x+=sin((blurDir.x-deltaDir.x));\n      deltaDir.y+=sin((blurDir.y-deltaDir.y));\n      \n      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, "+e.y+"*"+(t?"3.0":"5.0")+"*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);\n      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;\n      //Cd.a=bloomAdd.a-bloomCd.a;\n      \n      Cd.a=1.0;\n      gl_FragColor = Cd;\n      \n    }"}function chroAberPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D chroAberUVTexture;\n    uniform sampler2D chroAberUVAlpha;\n    uniform vec2 ratio;\n\n    uniform vec2 warpMult;\n    uniform vec2 lKing;\n    \n    varying vec2 vUv;\n\n    void main() {\n      // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame\n      vec4 caCd= vec4( \n        texture2D( chroAberUVTexture, vUv ).rgb - 0.7294118,\n        texture2D( chroAberUVAlpha, vUv ).r - 0.5019608\n      );\n      //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );\n      caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;\n      \n      vec2 bUv=vUv+caCd.rg;\n      vec2 rUv=vUv+caCd.ba;\n      vec2 gUv=vUv+(caCd.rg+caCd.ba);\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 Cd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function lKingPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv )*.2;\n      vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;\n      \n      vec2 bUv=vUv+noiseCd.rg;\n      vec2 rUv=vUv+noiseCd.gb;\n      vec2 gUv=vUv+noiseCd.br;\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 gCd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function iZoomPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n            vec4 pCd=texture2D( tDiffusePrev, vUv );\n            vec3 dCd=Cd.rgb-pCd.rgb;\n            vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;\n            vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;\n            b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );\n            \n            vec4 outCd=vec4(1.0);\n            outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );\n            \n      vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;\n\n            outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );\n            outCd.rgb+= dCd.gbr;\n            \n            \n            \n      outCd.a=1.0;\n      gl_FragColor = outCd;\n    }"}function sFieldPostProcessVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    varying vec2 vUv;\n    varying vec2 vUvShift;\n    varying vec2 starUv;\n    varying float vTimer;\n\n    void main(){\n        vUv=uv;\n        vUvShift=uv-.5;\n        \n        vec2 rUv=vUvShift*0.7071067811865476;\n        vec2 tmpUv=rUv;\n        float rot=time.x*.1;\n        vec2 sinCos=vec2( sin(rot), cos(rot) );\n        rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;\n        rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;\n        rUv=(rUv+.5);\n        \n        float starTimer=sin(time.x*.2)*.1+.1;\n        starUv=mix( vUv, rUv, starTimer);\n        \n        vTimer=time.x*.5;\n        \n        vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*modelViewPosition;\n    }"}function sFieldPostProcessFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D starTexture;\n        varying vec2 vUv;\n        varying vec2 vUvShift;\n        varying vec2 starUv;\n        varying float vTimer;\n\n        #define PI 3.14159265358979\n        \n        void main() {\n            float uvDist=length(vUvShift);\n            \n            vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;\n            \n            float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;\n            vec2 starBlendUV=starCd.rg*blender;\n            \n            vec2 cdUv = vUv+starBlendUV;\n            vec4 Cd=texture2D( tDiffuse, cdUv );\n            \n            vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );\n            float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;\n            Cd.rgb= mix( Cd.rgb, negCd, cdBlender );\n            \n            gl_FragColor = Cd;\n        }"}function warpPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform sampler2D animTexture;\n    uniform vec2 time;\n    uniform vec2 fader;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 animCd=texture2D( animTexture, vUv );\n      float timer=time.x*.2;\n      vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );\n      animCd=texture2D( animTexture, animUV );\n      \n      vec2 noiseUV=animUV+animCd.rg;\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );\n      \n      float blend=fader.x*fader.y;\n      Cd=mix( Cd, noiseCd, blend);\n      \n      Cd.a=1.0;\n      Cd.r=1.0;\n      gl_FragColor = Cd;\n    }"}function finalOverlayHeavyShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec3 camPos;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        vec3 fogValue( vec3 worldPos, float time ){\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;\n            noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            return noiseCd;\n        }\n\n        #define PROX_WARP 3.14159265358979*.45\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float t = -time.x*.003;\n            vec3 baseNoiseCd=fogValue( worldPos, t );\n            \n            float mult=0.0;\n            vec3 noiseCd;\n            vec3 curNoiseCd;\n            vec3 samplePos;\n            float samples=4.3;//+sin(time.x*.001);\n            float blender;\n            float blenderMax=0.0;\n            for( int x=0; x<=3; ++x){\n                blender=( float(x+1) / samples );\n                samplePos=worldPos*blender;\n                curNoiseCd=fogValue( samplePos, t );\n                noiseCd=max(noiseCd, curNoiseCd * blender );\n                blenderMax+=blender;\n            }\n            noiseCd += baseNoiseCd*.2;\n            mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;\n            //mult*=mult;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n    }"}function finalOverlayShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.45\n\n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            float t = -time.x*.003;\n            \n            vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;\n            noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function finalOverlaySlimShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform vec2 time;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.4\n        #define PI 3.14159265358979\n        \n        vec3 boostHighs( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=(1.0-sat);\n            sat=1.0-sat*sat;\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        vec3 boostMids( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=sin( sat*PI );\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            vec2 uv=vUv;\n            \n            vec3 bloomCd=texture2D(bloomTexture,uv).rgb;\n            bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );\n            \n            Cd.rgb+= bloomCd;\n\n            // Proximity Draw Over\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            dProx*= dProx * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd;\n            Cd.r=1.0;\n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function bgScreenVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    \n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vUv=uv;\n        \n        mat4 pvMat=projectionMatrix * viewMatrix;\n        pvMat[3] = vec4(.0, .0, .0, 1.0);\n        mat3 pvRot = inverse( mat3( pvMat ) );\n        vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));\n        vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));\n        vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));\n        \n        float timeRate = time.x * .1;\n        vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );\n        vec3 sunRef = sunPos;\n        sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;\n        sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;\n        sunPos.x = sin( timeRate ) * .1;\n        \n        vSunPos = normalize( sunPos );\n        \n        vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);\n        gl_Position = modelViewPosition;\n    }"}function bgScreenFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D noiseTexture;\n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);\n        \n        float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;\n        sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );\n        \n        vec2 xOffset = vec2( .0, .0);\n        vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;\n        nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;\n        sunDot *= nCd.x*nCd.y*nCd.z;\n        nCd= vec3( length( nCd ) );\n        \n        float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));\n        Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);\n        Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );\n        Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));\n        Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));\n        gl_FragColor=Cd;\n    }"}function skyObjectVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform float camFar;\n    uniform vec2 resUV;\n    \n    varying vec2 vUv;\n    varying vec3 vN;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    void main(){\n        vUv=uv;\n        vLocalPos=position;\n        vN = normal;\n        \n        vec3 pos = position;\n        vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);\n        gl_Position = modelViewPosition;\n        \n        vWorldPos = modelViewPosition;\n        \n    }"}function skyObjectFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="     \n    uniform sampler2D diffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float camNear;\n    uniform float camFar;\n    uniform vec2 resUV;\n\n    uniform float rate;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vN;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    #define PI 3.14159265358979323\n    \n    void main(){\n        vec2 uv=vUv;\n        vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;\n        vec4 Cd=texture2D(diffuse,uv);\n\n  ",(arguments.length>0&&void 0!==arguments[0]?arguments[0]:We.OFF)===We.VAPOR&&(e+="\n\n        // -- -- -- -- -- -- -- -- --\n        // -- Horizon Vapor Code - -- --\n        // -- -- -- -- -- -- -- -- -- -- --\n\n        vec3 lPos = vLocalPos;\n        lPos.y = abs(lPos.y)*0.05;\n\n        float t = time.x*.6;\n\n        // Duel noise texture sampling\n        //   Creates a flowing vapor effect flowing through the noise texture\n        vec2 nUv =  vec2(vUv.x*0.40, vUv.y*.5 - t*.0065  - vN.y );\n        vec3 noiseBaseCd = texture2D( noiseTexture, nUv ).rgb;\n        nUv = ( nUv*vec2(1.0,.5)+noiseBaseCd.rg*(noiseBaseCd.b) + t*.02);\n        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;\n        noiseCd.rg = noiseCd.rg*2.0-1.0;\n        \n        \n        float reachDepth = 0.0 ;\n        \n        // Calculate mask based on the local position\n        //   Assuming for a sky-box / sky-sphere object\n        vec3 normPos = normalize(vLocalPos);\n        normPos.y = 1.0-min(1.0,(normPos.y)*3.0);\n        normPos.y = normPos.y*normPos.y*normPos.y;\n        \n        // Noise-influence of the normal vector to drive the vapoe mask\n        reachDepth =  min(1.0, (vN.y * 1. * noiseCd.x  * max(noiseCd.y, noiseCd.z))) ;\n\n        float vaporMask = clamp(reachDepth+normPos.y * max(.95, noiseBaseCd.x*noiseBaseCd.z+vN.y*.5), 0.0, 1.0)*.1;\n        \n        float fogMixer = (Cd.r+Cd.g+Cd.b) - (fogColor.r+fogColor.g+fogColor.b) ;\n        vec3 toFogColor = mix(  Cd.rgb, fogColor,  fogMixer );\n        float blender = (sin(noiseCd.r*PI+t+uv.x))*max(0.0,1.0-(vaporMask+fogMixer))*.1 ;\n        vec3 baseColor = (toFogColor-min(1.0,blender+ vaporMask*10.0)) ;\n\n        Cd.rgb = mix(Cd.rgb, baseColor, vaporMask * step( -0.10, vN.y ));\n\n        // -- -- -- -- -- -- -- -- -- -- --\n        // -- End of Horizon Vapor -- --\n        // -- -- -- -- -- -- -- -- --\n\n    "),e+="\n\n        gl_FragColor=Cd;\n    }"}var nt={animated:t,core:e,objects:i,particles:s,rendering:a,scene:n};class ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"particles";this.type="particleSystem",this.name=t,this.room=e,this.geometry=null,this.material=null,this.points=null,this.count=-1,this.pscale=new o.Vector2(0,0),this.position=new o.Vector3(0,0,0),this.atlasPath="sprite_dustAtlas_rgb.jpg",this.atlasAlphaPath="sprite_dustAtlas_alpha.jpg",this.hasAlphaMap=!0,this.shaderSettings={vertCount:1e3,pScale:7,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,hasLights:!1},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i&&s){if(e&&typeof e===Object){var a=Object.keys(e);this.knownKeys.forEach((t=>{a.includes(t)?this.shaderSettings[t]=e[t]:e[t]=this.shaderSettings[t]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=this.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));var r=this.room.pxlFile.pxlShaderBuilder(t,i,s);this.material=r,this.material.transparent=!0,this.material.depthTest=!0,this.material.depthWrite=!1,this.shaderSettings.hasOwnProperty("additiveBlend")&&this.shaderSettings.additiveBlend&&(this.material.blending=o.AdditiveBlending),this.addToScene()}else console.error("No Shader Found; Cannot Build Particle System")}setPosition(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];1===t.length?this.position=t[0]:this.position=new o.Vector3(...t),this.points&&this.points.position.copy(this.position)}setMaterial(e){e||e.isMaterial?(this.material=e,this.points&&(this.points.material=e)):console.error("No Material Found; Cannot Set Particle System Material")}setGeometry(e){e||e.isBufferGeometry?(this.shaderSettings.vertCount=e.attributes.position.count,this.geometry=e,this.points&&(this.points.geometry=e)):console.error("No Geometry Found; Cannot Set Particle System Geometry")}getSettings(){return this.shaderSettings}setSettings(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&"object"==typeof e){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]})),this.points&&(this.points.material.uniforms.pointScale.value=new o.Vector2(this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc,this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc))}else console.error("No Settings Found; Cannot Set Particle System Settings")}addToScene(){if(this.shaderSettings){var e=this.shaderSettings.vertCount,t=this.shaderSettings.pScale,i=this.material,s=this.shaderSettings.atlasRes,a=this.shaderSettings.atlasPicks,r=this.shaderSettings.randomAtlas,n=this.shaderSettings.additiveBlend;this.geometry&&this.geometry.attributes.position.count>0&&(e=this.geometry.attributes.position.count,this.shaderSettings.vertCount=e),this.room.materialList[this.name]=i,this.count=e,this.pscale.x=t*this.room.pxlEnv.pxlQuality.screenResPerc;var l=null;r?(l=this.atlasRandomGen,a=s):l=this.atlasArrayPicker,i||(i=this.newMaterial());var h=[],c=[],d=[],A=null;if(this.geometry){var u=!1,p=!1;if(e=(A=this.geometry).attributes.position.count,this.count=e,A.attributes.hasOwnProperty("atlas")||(p=!0),A.attributes.hasOwnProperty("seeds")||(u=!0),p||u)for(var m=0;m<e;++m)u&&c.push(Math.random(),2*Math.random()-1,Math.random(),2*Math.random()-1),p&&d.push(...l(a));if(u){var g=new o.Float32BufferAttribute(c,4);A.setAttribute("seeds",g)}if(p){var v=new o.Float32BufferAttribute(d,2);A.setAttribute("atlas",v)}}else{for(var f=0;f<e;++f)h.push(0,0,0),c.push(Math.random(),2*Math.random()-1,Math.random(),2*Math.random()-1),d.push(...l(a));var b=new o.Float32BufferAttribute(h,3),x=new o.Float32BufferAttribute(c,4),C=new o.Float32BufferAttribute(d,2);(A=new o.BufferGeometry).setAttribute("position",b),A.setAttribute("seeds",x),A.setAttribute("atlas",C)}i.depthTest=!0,i.depthWrite=!1;var E=new o.Points(A,i);return E.sortParticles=!1,E.frustumCulled=!1,this.room.scene.add(E),E.layers.set(1),E.renderOrder=Ve.PARTICLES,E.pBaseScale=t,this.room.geoList[this.name]=E,this.geometry=A,this.material=i,this.points=E,n&&(E.material.blending=o.AdditiveBlending),E}console.error("No Shader Settings Found; Somehow deleted?")}atlasRandomGen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=1/e;return Array.from({length:t}).map((()=>Math.floor(648405.71*Math.random()%e)*i))}atlasRandomList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Array.from({length:e}).map((e=>this.atlasRandomGen(t,i)))}atlasArrayPicker(e){return e[Math.floor(92314.75*Math.random()%e.length)]}dupeArray(e,t){return Array.from({length:t}).fill(e)}elementDuplicator(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return e.map((e=>this.dupeArray(e,t))).flat(1)}findLightPositions(){var e=[];return this.room.lightList.hasOwnProperty("PointLight")&&this.room.lightList.PointLight.forEach((t=>{e.push(t.position.clone())})),e}hasPointLights(){return this.room.lightList.hasOwnProperty("PointLight")}setAtlasPath(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.atlasPath=e,t?(this.atlasAlphaPath=t,this.hasAlphaMap=!0):this.hasAlphaMap=!1}newMaterial(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.hasPointLights(),i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},lightPos:{value:t}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,dustVert(this.shaderSettings),dustFrag(this.hasAlphaMap));return s.transparent=!0,this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.smoothNoiseTexture,s.depthTest=!0,s.depthWrite=!1,e&&(this.room.materialList[this.name]=s),s}}var ot={pxlParticles:{ParticleBase,BillowSmoke:class BillowSmoke extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"billowSmoke";super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:56,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new o.Vector3(0,0,1),offsetPos:new o.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}this.shaderSettings.atlasPicks&&0!==this.shaderSettings.atlasPicks.length||(this.shaderSettings.atlasPicks=[...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);var i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"f",value:e.windDir},offsetPos:{type:"f",value:e.offsetPos},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:.8},rate:{type:"f",value:2.85}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,smokeVert(),smokeFrag(this.hasAlphaMap));s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=o.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},EmberWisps:class EmberWisps extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emberWisps";super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new o.Vector3(0,0,1),offsetPos:new o.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}this.shaderSettings.atlasPicks&&0!==this.shaderSettings.atlasPicks.length||(this.shaderSettings.atlasPicks=super.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));var i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"v",value:this.shaderSettings.windDir},offsetPos:{type:"v",value:this.shaderSettings.offsetPos},pointScale:{type:"f",value:this.shaderSettings.pScale},intensity:{type:"f",value:1},rate:{type:"f",value:5.5}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,emberWispsVert(),(this.hasAlphaMap,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    \n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n    \n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n        \n        dustCd.rgb *= vBrightness;\n        \n        float dirtLuma = luma( dustCd.rgb );\n        vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n        \n        gl_FragColor=Cd;\n    }"));s.side=o.DoubleSide,s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=o.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},FloatingDust:class FloatingDust extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"floatingDust";super(e,t),this.name=t,this.room=e,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,windDir:new o.Vector3(0,0,1),offsetPos:new o.Vector3(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();var i=e.windDir;i&&typeof i===Object&&typeof i!==o.Vector3&&3===i.length&&this.shaderSettings.windDir.set(i[0],i[1],i[2]);var s=e.offsetPos;s&&typeof s===Object&&typeof s!==o.Vector3&&3===s.length&&this.shaderSettings.offsetPos.set(s[0],s[1],s[2]);var a={atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},r=this.room.pxlFile.pxlShaderBuilder(a,dustVert(this.shaderSettings),dustFrag(this.hasAlphaMap));r.transparent=!0,this.hasAlphaMap?(r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(r.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}))):r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.shaderSettings.additiveBlend&&(r.blending=o.AdditiveBlending),r.uniforms.noiseTexture.value=this.room.softNoiseTexture,r.depthTest=!0,r.depthWrite=!1,this.room.materialList[this.name]=r,this.material=r,super.addToScene()}},HeightMap:class HeightMap extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"heightMap";super(e,t),this.name=t,this.room=e,this.heightMapPath=null,this.spawnMapPath=null,this.spawnMapMode=1,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,tint:new o.Vector3(1,1,1),jumpHeightMult:0,offsetPos:new o.Vector3(0,0,0),windDir:new o.Vector3(0,0,0),size:new o.Vector3(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}setHeightMapPath(e){this.heightMapPath=e}setSpawnMapPath(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.spawnMapPath=e,3===t&&(t=4),this.spawnMapMode=t}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&typeof e===Object){var i=Object.keys(e);this.knownKeys.forEach((t=>{i.includes(t)?this.shaderSettings[t]=e[t]:e[t]=this.shaderSettings[t]}))}e.hasOwnProperty("atlasPicks")?this.shaderSettings.atlasPicks=e.atlasPicks:(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();var s=e.offsetPos;s&&typeof s===Object&&typeof s!==o.Vector3&&3===s.length&&this.shaderSettings.offsetPos.set(s[0],s[1],s[2]);var a=100,r=100,n=100;e.hasOwnProperty("size")&&(e.size.x>0&&(a=e.size.x),e.size.y>0&&(r=e.size.y),e.size.z>0&&(n=e.size.z)),this.shaderSettings.pScale>=0&&(this.pscale.x=this.shaderSettings.pScale),t&&(a=t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeX")?t.userData.SizeX:t.scale.x,r=t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeY")?t.userData.SizeY:t.scale.y,n=t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeZ")?t.userData.SizeZ:t.scale.z,this.pscale.x=t.pScale);var l=new o.Vector3(a,r,n),h={heightMap:{type:"t",value:null},spawnMap:{type:"t",value:null},tankSize:{type:"v",value:l},atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},tint:{type:"v",value:this.shaderSettings.tint},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},c=this.room.pxlFile.pxlShaderBuilder(h,heightMapVert(this.shaderSettings),heightMapFrag(this.hasAlphaMap));c.transparent=!0,this.hasAlphaMap?(c.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(c.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}))):c.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter}),this.heightMapPath&&(c.uniforms.heightMap.value=this.room.pxlUtils.loadTexture(this.heightMapPath,4,{magFilter:o.LinearFilter,minFilter:o.LinearMipmapLinearFilter})),this.spawnMapPath&&(c.uniforms.spawnMap.value=this.room.pxlUtils.loadTexture(this.spawnMapPath,this.spawnMapMode,{magFilter:o.NearestFilter,minFilter:o.NearestMipmapNearestFilter})),this.shaderSettings.additiveBlend&&(c.blending=o.AdditiveBlending),c.uniforms.noiseTexture.value=this.room.softNoiseTexture,c.depthTest=!0,c.depthWrite=!1,this.room.materialList[this.name]=c,this.material=c;var d=super.addToScene();return t&&d.position.set(t.position.x,t.position.y,t.position.z),d.userData.tankRes=l,d}}}};var lt="pxlNav-coreCanvas",ht=window.innerWidth,ct=window.innerHeight;var dt={pxlNav:class pxlNav{constructor(e,t,i,s){this._active=!1,this.loaderStepTotalCount=9,this.pxlEnums=pxlEnums,this.assetsToLoadDict={Cloud3d:!0,SoftNoise:!0,SmoothNoise:!0,ChromaticAberration:!1,WarpAnimTexture:!1,MathFuncs:!1},this.knownPostProcessPasses={mapComposerWarpPass:["cloud3dTexture"],chromaticAberrationPass:["ChromaticAberration"],lizardKingPass:["cloud3dTexture"],starFieldPass:["cloud3dTexture"],crystallinePass:["cloud3dTexture"]},this.pxlOptions=Object.assign({},e);var a=Object.keys(this.pxlOptions);Object.keys(pxlOptions).forEach((e=>{a.includes(e)||(this.pxlOptions[e]=pxlOptions[e])})),this.pxlOptions.hasOwnProperty("userSettings")||(this.pxlOptions.userSettings=Object.assign({},Ze)),this.verbose=this.pxlOptions.verbose,this.projectTitle=t,this.startingRoom=i,this.startingRoomName=i.roomName;var r=[];s.forEach((e=>{r.push(e.roomName)})),this.roomBootList=s,s.includes(i)||s.push(i),this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.pxlOptions.mobile=this.mobile,this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:this.pxlOptions.pxlAssetRoot+"/",guiRoot:this.pxlOptions.pxlAssetRoot+"/GUI/",roomRoot:this.pxlOptions.pxlAssetRoot+"/rooms/",vidRoot:this.pxlOptions.pxlAssetRoot+"/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",step:"Emitted when frame update occurs, pre render.","render-prep":"Emitted when the pxlNav engine starting to prepare for scene rendering.","render-post":"Emitted when the pxlNav engine has finished rendering the scene.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.","camera-move":"Returns a {'pos':vec3(),'dist':float}; Emitted when the camera moves.","camera-rotate":"Returns a [quaternion]; Emitted when the camera rotates.","camera-jump":"Returns a [bool]; Emitted when the camera jumps to a new position.","camera-fall":"Returns a [bool]; Emitted when the camera starts to free-fall / gravity.","camera-landed":"Returns a [bool]; Emitted when the camera lands from a jump / fall.","camera-collision":"Returns a [bool]; Emitted when the camera collides with an object.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.",".":"** NOTE : callbacks get an event object shaped - **","..":"**  callbackFn( eventType, eventValue ) **","...":"**  eventValue = { 'type' : *eventName*, 'value' : *data* } **","....":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=this.pxlOptions.loadEnvAssetFile||!1,this.loadEnvAssetFile=!0,this.pxlTimer=new et.Timer,this.pxlShaders=nt,this.pxlCookie=new et.CookieManager(this.verbose,t,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=this.pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new et.QualityController(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new et.Utils(this.folderDict.assetRoot,this.mobile),this.pxlFile=new et.FileIO(this.folderDict),this.pxlExtensions=null,this.pxlAudio=new et.Audio(this.pxlTimer),this.pxlAutoCam=new et.AutoCamera(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new et.User,this.pxlRendering=new et.Rendering(this.pxlOptions),this.pxlEnv=new et.Environment(this.pxlOptions,this.startingRoomName,this.mobile),this.pxlDevice=new et.Device(t,lt,this.mobile,this.autoCam),this.pxlColliders=new et.Colliders(this.verbose,this.pxlOptions.collisionScale.gridSize,this.pxlOptions.collisionScale.gridReference),this.pxlCamera=new et.Camera,this.pxlOptions.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlCamera.setUserSettings(this.pxlOptions.userSettings),this.pxlAnim=new et.Animation(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new et.GUI(this.verbose,t,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlGuiDraws.pxlLoaderTotal=this.loaderStepTotalCount,this.pxlHUD=new et.HUD,this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlUser.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlColliders.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlHUD.setDependencies(this),this.pxlRendering.setDependencies(this),this.pxlDevice.init(),this.pxlGuiDraws.prepLoader(),this.pxlOptions.hasOwnProperty("loaderPhrases")||(this.pxlOptions.loaderPhrases=["...loading the pixels..."]),this.pxlGuiDraws.setLoaderPhrases(this.pxlOptions.loaderPhrases),this.verbose>=pxlEnums.VERBOSE_LEVEL.INFO&&(console.log("pxlNav v1.0.0-dev set to Verbose Info Mode"),console.log("  With Three.js v171"),console.log("Booting pxlNav...")),this.pxlQuality.init()}set active(e){void 0===e&&(e=null),null==e&&(e=!this.pxlTimer.active),!0===e?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}log(){this.verbose>=pxlEnums.VERBOSE_LEVEL.INFO&&console.log(...arguments)}warn(){this.verbose>=pxlEnums.VERBOSE_LEVEL.WARN&&console.warn(...arguments)}error(){this.verbose>=pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(...arguments)}debug(){this.verbose>=pxlEnums.VERBOSE_LEVEL.DEBUG&&console.debug(...arguments)}init(){this.pxlTimer.active||this.bootTimer(),this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.detectJSFramework(),this.checkPxlOptions(),this.buildGui().then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Engine"),this.bootEnvironment()})).then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Boot Engine"),this.bootEngine()})).then((()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Composers"),this.pxlEnv.buildComposers(),this.pxlHUD.init()})).then((()=>{this.tickLoader(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(!1),this.pxlDevice.setCursor("grab")})).catch((e=>{this.verbose>pxlEnums.VERBOSE_LEVEL.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",e),console.error(e))})).finally((()=>{this.verbose>=pxlEnums.VERBOSE_LEVEL.DEBUG&&(console.log("'pxlNavCore' Room Build Promise-Chain Completed; ",this.loadPercent),console.log("-- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()}))}checkPxlOptions(){if(this.pxlOptions.hasOwnProperty("postProcessPasses")){var e=Object.keys(this.pxlOptions.postProcessPasses),t=Object.keys(this.knownPostProcessPasses);e.forEach((e=>{t.includes(e)&&this.pxlOptions.postProcessPasses[e]&&this.knownPostProcessPasses[e].forEach((e=>{this.assetsToLoadDict[e]=!0}))}))}}detectJSFramework(){if("undefined"!=typeof window){if(window.__NEXT_DATA__||window.__NEXT_ROUTER__||window.next)return void(this.pxlOptions.framework=this.pxlEnums.FRAMEWORK.NEXT);if(window.__REACT_DEVTOOLS_GLOBAL_HOOK__||document.querySelector("[data-reactroot]")||document.querySelector("[data-react-helmet]"))return void(this.pxlOptions.framework=this.pxlEnums.FRAMEWORK.REACT)}if("undefined"!=typeof process&&process.env){if(process.env.NEXT_RUNTIME||process.env.__NEXT_ROUTER_BASEPATH)return void(this.pxlOptions.framework="next");if(process.env.REACT_APP_)return void(this.pxlOptions.framework=this.pxlEnums.FRAMEWORK.REACT)}this.pxlOptions.framework=this.pxlEnums.FRAMEWORK.REACT}buildGui(){return new Promise(((e,t)=>{if(this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(lt),this.pxlGuiDraws.guiWindows.container.gui.appendChild(this.pxlGuiDraws.pxlNavCanvas),!this.pxlGuiDraws.pxlNavCanvas)return console.error("pxlNav: Canvas element with ID '"+lt+"' not found in DOM"),void t(new Error("Canvas element not found: "+lt));this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),e(!0)}))}isMobile(){var e=!1;return e=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),e=this.getHashParm("m",e)}findHashParms(){var e={},t=window.location.hash;if(t.length>1)for(var i=(t=t.substring(1)).split("&"),s=0;s<i.length;s++){var a=i[s].split("=");e[a[0]]=a[1]}return e}getHashParm(e,t){return Object.keys(this.uriHashParms).includes(e)?this.uriHashParms[e]:t}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise(((e,t)=>{for(var i=[],s=0;s<this.roomBootList.length;++s)i.push(this.pxlEnv.loadRoom(this.roomBootList[s]));Promise.all(i).then((()=>{e(!0)})).catch((e=>{this.verbose>=pxlEnums.VERBOSE_LEVEL.ERROR&&console.error("Error loading rooms:",e),t(e)}))}))}bootEnvironment(){return new Promise(((e,t)=>{if(!this.pxlGuiDraws.pxlNavCanvas)return console.error("pxlNav: Canvas not available for WebGLRenderer"),void t(new Error("Canvas not available for WebGLRenderer"));try{this.pxlRendering.engine=new o.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,powerPreference:"low-power",alpha:!0,antialias:!1,sortObjects:!0,depth:!0})}catch(e){return console.error("pxlNav: Failed to create WebGLRenderer:",e),void t(new Error("Failed to create WebGLRenderer: "+e.message))}var i={format:o.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?o.HalfFloatType:o.FloatType};this.pxlEnv.engine=this.pxlRendering.engine,this.pxlRendering.engine.autoClear=!0,o.ColorManagement.enabled=!0,this.pxlRendering.engine.outputColorSpace=o.LinearSRGBColorSpace,this.pxlRendering.engine.debug.checkShaderErrors=!1,this.pxlRendering.engine.debug.checkShaderErrors=!0;this.pxlRendering.engine.setClearColor(this.pxlRendering.fogColor,0),this.pxlRendering.engine.setSize(undefined/this.pxlQuality.screenResPerc,undefined/this.pxlQuality.screenResPerc),this.pxlRendering.engine.setSize(window.innerWidth,window.innerHeight),this.pxlRendering.engine.setPixelRatio(1),this.pxlOptions.shadowMapBiasing===pxlEnums.SHADOW_MAP.OFF?this.pxlRendering.engine.shadowMap.enabled=!1:(this.pxlRendering.engine.shadowMap.enabled=!0,this.pxlRendering.engine.shadowMap.type=o.BasicShadowMap),this.pxlEnv.scene=new o.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new o.Color("#000000"),this.pxlEnv.scene.renderTarget=new o.WebGLRenderTarget(ht*this.pxlQuality.screenResPerc,ct*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderTarget.texture.format=o.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=o.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=o.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new o.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=o.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=o.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new o.WebGLRenderTarget(ht*this.pxlQuality.screenResPerc,ct*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderWorldPos.texture.format=o.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=o.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=o.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,i.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new o.WebGLRenderTarget(parseInt(ht*this.pxlQuality.screenResPerc),parseInt(ct*this.pxlQuality.screenResPerc),i),this.pxlEnv.scene.renderGlowTarget.texture.format=o.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;var s,a=this.pxlEnv.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];if(this.pxlCamera.camera=new o.PerspectiveCamera(a,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new o.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.assetsToLoadDict.Cloud3d&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg",null,{encoding:o.LinearSRGBColorSpace}),this.pxlEnv.cloud3dTexture&&(this.pxlEnv.cloud3dTexture.wrapS=o.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=o.RepeatWrapping)),this.assetsToLoadDict.SoftNoise&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture&&(this.pxlEnv.softNoiseTexture.wrapS=o.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=o.RepeatWrapping)),this.assetsToLoadDict.SmoothNoise&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture&&(this.pxlEnv.detailNoiseTexture.wrapS=o.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=o.RepeatWrapping)),this.assetsToLoadDict.ChromaticAberration){var r=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_rgb.jpg");r.minFilter=o.LinearFilter,r.magFilter=o.LinearFilter,this.pxlEnv.chroAberUVTexture=r;var n=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_alpha.jpg");n.minFilter=o.LinearFilter,n.magFilter=o.LinearFilter,this.pxlEnv.chroAberUVAlpha=n}this.assetsToLoadDict.WarpAnimTexture&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=o.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=o.LinearFilter);if(s=function tListIdent(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return null!=e&&(t[e[0]]=e[1]),t}(),this.loadEnvAssetFile){var l=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(l,undefined,s,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.pxlOptions.shadowMapBiasing===pxlEnums.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlOptions.shadowMapBiasing===pxlEnums.SHADOW_MAP.BASIC||this.mobile?this.pxlEnv.engine.shadowMap.type=o.BasicShadowMap:this.pxlOptions.shadowMapBiasing===pxlEnums.SHADOW_MAP.SOFT&&(this.pxlEnv.engine.shadowMap.type=o.PCFSoftShadowMap));var h=new o.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(h),this.pxlEnv.scene.add(h);var c=new o.DirectionalLight(16777215,.1);c.position.set(1e3,550,1200),this.pxlEnv.lightList.push(c),this.pxlEnv.scene.add(c),e(!0)}))}cameraRunAnimatorMobile(e){for(var t=!1,i=Object.keys(e.pxlEnv.geoLoadList),s=0;s<i.length;++s){var a;if(t=(t=0===e.pxlEnv.geoLoadList[i[s]])&&!(null!==(a=e.pxlEnv.roomSceneList[s])&&void 0!==a&&a.booted))break}t?setTimeout((()=>{e.cameraRunAnimatorMobile(e)}),300):e.initRoomList(e)}initRoomList(e){e.pxlGuiDraws.stepLoader("camAnim"),e.pxlCamera.setTransform(e.pxlEnv.camInitPos,e.pxlEnv.camInitLookAt),e.pxlCamera.updateCamera(),e.pxlEnv.buildRoomEnvironments(),e.monitorRoomLoad(e)}monitorRoomLoad(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,s=!1,a=Object.keys(e.pxlEnv.geoLoadList),r=!pxlOptions.fullLoadPreBoot,n=0;n<a.length;++n){var o;if(s=(s=0===e.pxlEnv.geoLoadList[a[n]])&&!(null!==(o=e.pxlEnv.roomSceneList[n])&&void 0!==o&&o.booted),r&&a[n]===this.startingRoomName&&s)break}t>i&&(this.warn("pxlNav: Room Load Monitor timed out, continuing with boot"),s=!1),s?setTimeout((()=>{e.monitorRoomLoad(e,t+1,i)}),300):(e.pxlQuality.mapAutoQualityUpdate(1,!0),e.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(0===e&&this.pxlGuiDraws.stepLoader("Room Prep"),e++,i.length>0){if(t){t=!1;var s=i[i.length-1];this.pxlCamera.warpToRoom(s)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),e%10==0){var a=i.pop();t=!0,this.pxlGuiDraws.stepLoader(a)}requestAnimationFrame((()=>{this.runPrepDrawScenes(e,t,i)}))}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();var e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];e.active=!0,e.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach((e=>{e.postGuiEvent()})),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");var t=this;setTimeout((()=>{t.pxlEnv.postBoot(),t.pxlGuiDraws.mapPrompt&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPrompt,!1,null,!0),t.pxlGuiDraws.mapPromptBG&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPromptBG,!1,null,!1),this.pxlDevice.hideAddressBar(),t.emit("booted",!0)}),200)}step(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pxlTimer.active&&(this.pxlTimer.step(),e&&requestAnimationFrame((()=>{this.step()})))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;"string"==typeof i&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof e&&(e=document.getElementById(e)),e)if((null===(i=e.classList)||void 0===i?void 0:i.value.indexOf("fader"))<0&&e.classList.add("fader"),t)e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!=s&&e.setAttribute("fadeOut",1e3*s))}),50);else if(e.classList.remove("visOn"),e.classList.add("visOff"),a){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{var t=e.parentNode;t&&t.removeChild(e)}))}))}else setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)}addRooms(e){for(var t=0;t<e.length;++t)this.pxlEnv.roomNameList.includes(e[t])||(this.booted?this.warn("pxlNav: Cannot add rooms after boot, room '"+e[t]+"' not added."):this.roomBootList.push(e[t]))}setBootRoom(e,t){this.pxlEnv.bootRoom=e,this.pxlEnv.bootLocation=t}setLoaderPhrases(e){this.pxlGuiDraws.setLoaderPhrases(e)}initExtension(e,t,i){this.pxlExtensions.init(e,t,i)}startExtension(e,t,i){this.pxlExtensions.start(e,t,i)}stopExtension(e,t,i){this.pxlExtensions.stop(e,t,i)}extensionStatus(e){return this.pxlExtensions.status(e)}trigger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(e=e.toLowerCase()){case"warptoroom":this.pxlCamera.warpToRoom(t,!0,i);break;case"camera":var s=t.toLowerCase();"roam"===s?this.pxlCamera.toggleMovement(!0):"static"===s&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":var a=i.type,r=i.value;null===t&&(t=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(t,a,r)}}subscribe(e,t){if(this.validEventsKeys.includes(e))if("test"===e)console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if("pxlNavEventNameHere"===e||"help"===e)"pxlNavEventNameHere"===e?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):"help"===e&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach((e=>{console.log("  - ",e," : ",this.validEvents[e])}));else{var i=e.split("-");if("device"===i[0])this.pxlDevice.subscribe(i[1],t);else if("camera"===i[0]){var s=pxlEnums.CAMERA_EVENT.MOVE;switch(i[1]){case"move":s=pxlEnums.CAMERA_EVENT.MOVE;break;case"rotate":s=pxlEnums.CAMERA_EVENT.ROTATE;break;case"jump":s=pxlEnums.CAMERA_EVENT.JUMP;break;case"fall":s=pxlEnums.CAMERA_EVENT.FALL;break;case"landed":s=pxlEnums.CAMERA_EVENT.LANDED;break;case"collision":s=pxlEnums.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+i[1]+"', ... )` was used; use 'help' for a list of valid events.")}this.pxlCamera.subscribe(s,t)}else this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}else console.warn("Warning : `pxlNav.subscribe( '"+e+"', ... )` was used; use 'help' for a list of valid events.")}unsubscribe(e,t){var i=!1,s=e.split("-");if("device"===s[0])i=this.pxlDevice.unsubscribe(s[1],t);else if("camera"===s[0]){var a=pxlEnums.CAMERA_EVENT.MOVE;switch(s[1]){case"move":a=pxlEnums.CAMERA_EVENT.MOVE;break;case"rotate":a=pxlEnums.CAMERA_EVENT.ROTATE;break;case"jump":a=pxlEnums.CAMERA_EVENT.JUMP;break;case"fall":a=pxlEnums.CAMERA_EVENT.FALL;break;case"landed":a=pxlEnums.CAMERA_EVENT.LANDED;break;case"collision":a=pxlEnums.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+s[1]+"', ... )` was used; use 'help' for a list of valid events.")}i=this.pxlCamera.unsubscribe(a,t)}else this.callbacks.hasOwnProperty(e)&&(this.callbacks.hasOwnProperty(e)&&this.callbacks[e]instanceof Array?(i=this.callbacks[e].includes(t),this.callbacks[e]=this.callbacks[e].filter((e=>e!==t))):console.warn("Warning : `pxlNav.unsubscribe( '"+e+"', ... )` was used; but the callback function does not match the one used in `pxlNav.subscribe()`."));return i}emit(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.callbacks.hasOwnProperty(e)){var s={type:e,value:t};for(var a of(null!==i&&(s.status=i),this.callbacks[e]))a(s)}}},pxlNavVersion:"1.0.0",pxlEnums,pxlUserSettings:Ze,pxlOptions,RoomEnvironment:class RoomEnvironment{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pxlRoomEnvironment",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.roomName=e,this.pxlOptions=null,this.pxlEnums=null,this.pxlFile=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlDevice=null,this.pxlHUD=null,this.pxlRendering=null,this.pxlEnv=null,this.booted=!1,this.initScene=!0,this.active=!0,""===t&&(t="./pxlRooms/"+e+"/"),this.assetPath=t+"Assets/",this.mobile=!1,this.sceneFile=null,this.animFile=null,this.animClips={},this.animMixer=null,this.spiralizerUniforms={},this.materialList={},this.revertColorSpaceList=[],this.particleList={},this.camInitPos=null,this.camInitLookAt=null,this.camThumbPos=new o.Vector3(0,0,-30),this.camThumbLookAt=new o.Vector3(0,35,-1e3),this.cameraBooted=!1,this.cameraPrevPos=new o.Vector3(0,0,0),this.cameraAimTarget=new o.Object3D(0,0,0),this.camHoldWarpPos=!0,this.defaultCamLocation="default",this.camLocation={},this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=5,this.pxlCamFarClipping=1e4,this.fogColor=new o.Color(.01,.02,.05),this.fogExp=7e-4,this.fog=new o.FogExp2(this.fogColor,this.fogExp),this.userAvatarGroup=new o.Group,this.packedTextureMaterial=null,this.coreTextureMaterial=null,this.projectedMaterial=null,this.voidMaterial=null,this.holoMaterial=null,this.aspectRatio=null,this.flag=null,this.initPos=[],this.finalPos=[],this.midPos=new o.Vector3(0,30,-50),this.perspectiveInstances=160,this.startTime=0,this.runTime=new o.Vector2(0,0),this.msRunner=null,this.camera=null,this.autoCamPaths={},this.scene=null,this.lightList={},this.geoList={},this.glassGroup=null,this.glassList=[],this.particleList={},this.lodList=[],this.enableRaycast=!1,this.hasHoverables=!1,this.hoverableList=[],this.hoverableObj=null,this.hasClickables=!1,this.clickableList=[],this.clickableObj=null,this.collidersExist=!1,this.colliderActive=!1,this.colliderHashMap={},this.colliderList=[],this.antiColliderActive=!1,this.antiColliderList=[],this.antiColliderTopActive=!1,this.antiColliderTopList=[],this.hasPortalExit=!1,this.portalList={},this.hasRoomWarp=!1,this.roomWarp=[],this.warpPortalTexture=null,this.warpZoneRenderTarget=null,this.worldPosMaterial=null,this.worldPosRenderTarget=null,this.spiralizerPass=null,this.bloomPreState=!1,this.cloud3dTexture=null,this.smoothNoiseTexture=null,this.hasHelpers=!1,this.helperObjects={},this.currentShader=null}setDependencies(pxlNav){this.pxlOptions=pxlNav.pxlOptions,this.pxlEnums=pxlNav.pxlEnums,this.pxlRendering=pxlNav.pxlRendering,this.pxlEnv=pxlNav,this.pxlFile=pxlNav.pxlFile,this.pxlAnim=pxlNav.pxlAnim,this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlHUD=pxlNav.pxlHUD,this.pxlColliders=pxlNav.pxlColliders,this.mobile=pxlNav.mobile,this.msRunner=this.pxlTimer.msRunner,this.cloud3dTexture=this.pxlEnv.cloud3dTexture,this.cloud3dTexture&&(this.cloud3dTexture.wrapS=o.RepeatWrapping,this.cloud3dTexture.wrapT=o.RepeatWrapping),this.smoothNoiseTexture=this.pxlEnv.softNoiseTexture,this.smoothNoiseTexture&&(this.smoothNoiseTexture.wrapS=o.RepeatWrapping,this.smoothNoiseTexture.wrapT=o.RepeatWrapping)}get deltaTime(){return this.pxlTimer.deltaTime}get avgDeltaTime(){return this.pxlTimer.avgDeltaTime}getLerpRate(e){return this.pxlTimer.getLerpRate(e)}getLerpAvgRate(e){return this.pxlTimer.getLerpAvgRate(e)}init(){this.scene.fog=this.fog,this.scene.background=this.fogColor}start(){this.booted,this.pxlRendering.engine.setClearColor(this.fogColor,0)}step(){this.runTime.x=this.msRunner.x}stop(){}resize(e,t){}setUserHeight(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.pxlEnv.pxlCamera.setUserHeight(e,this.roomName)}resetCamera(){(null===this.camInitPos||null===this.camInitLookAt)&&this.pxlOptions.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN&&console.warn("pxlRoomEnvironment: Room Initial Camera Positions not initialized, \n Ensure `this.booted=true` is ran in `build()` or `fbxPostLoad()` \n -&-\n That there is a `Camera` group with `position` & `lookAt` child nulls in your scene file."),this.pxlEnv.pxlCamera.setTransform(this.camInitPos,this.camInitLookAt)}prepPortalRender(){this.geoList.intro.visible=!1,this.geoList.MainRoomWarp.visible=!1}cleanupPortalRender(){this.geoList.intro.visible=!0,this.geoList.MainRoomWarp.visible=!0}setPortalTexture(e){this.geoList.MainRoomWarp.material.map=e}applyRoomPass(){}getName(){return this.roomName}getArtistInfo(){return null}setFog(e){}getShaderList(){var e={};return Object.keys(this.materialList).forEach((t=>{e[t]=t})),e}getCurrentShader(){return this.currentShader||Object.keys(this.materialList)[0]}readShader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=this.currentShader&&this.materialList[this.currentShader].hasOwnProperty("uniforms")&&(t||(t=new o.Vector3),this.materialList[this.currentShader].uniforms.sliders.value=t,this.materialList[this.currentShader].needsUpdate=!0),this.currentShader=e,this.materialList[this.currentShader]}setShader(e,t,i){this.emitterList&&this.emitterList[this.currentShader]&&this.emitterList[this.currentShader].Particles.length>0&&this.emitterList[this.currentShader].Particles.forEach((e=>{var s=e.material;s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0})),this.materialList[this.currentShader].vertexShader=t,this.materialList[this.currentShader].fragmentShader=i,this.materialList[this.currentShader].needsUpdate=!0}castRay(e,t){if(this.enableRaycast)if(!e&&!this.hasHoverables||e&&!this.hasClickables)this.mouseRayHits=[];else{var i=[];!e&&this.hasHoverables?i=this.hoverableList:e&&this.hasClickables&&(i=this.clickableList);var s=[];if(i.length>0){var a=new o.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlEnv.pxlCamera.objRaycast.setFromCamera(a,this.pxlEnv.pxlCamera.camera),s=this.pxlEnv.pxlCamera.objRaycast.intersectObjects(i)}this.mouseRayHits=s}}hitColliders(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).length}hasColliders(){return this.collidersExist}hasColliderType(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke.FLOOR,t=!1;if(!this.hasColliders())return t;switch(e){case Ke.FLOOR:t=this.colliderActive;break;case Ke.WALL:t=this.antiColliderActive;break;case Ke.WALL_TOP:t=this.antiColliderTopActive;break;case Ke.CEILING:break;case Ke.PORTAL_WARP:t=this.hasPortalExit;break;case Ke.ROOM_WARP:t=this.hasRoomWarp;break;case Ke.ITEM:case Ke.SCRIPTED:break;case Ke.HOVERABLE:t=this.hasHoverables;break;case Ke.CLICKABLE:t=this.hasClickables;break;default:t=!1}return t}getColliders(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke.FLOOR,t=[];if(!this.hasColliders())return t;if(e===Ke.WALL&&!this.antiColliderActive)return t=this.antiColliderList;if(e===Ke.WALL_TOP&&!this.antiColliderTopActive)return t=this.antiColliderTopList;if(e===Ke.PORTAL_WARP&&!this.hasPortalExit)return t=this.portalList;if(e===Ke.ROOM_WARP&&!this.hasRoomWarp)return t=this.roomWarp;if(e===Ke.HOVERABLE&&!this.hasHoverables)return t=this.hoverableList;if(e===Ke.CLICKABLE&&!this.hasClickables)return t=this.clickableList;switch(e){case Ke.FLOOR:case Ke.WALL:t=[...this.colliderList];break;case Ke.WALL_TOP:t=[...this.antiColliderTopList];break;case Ke.CEILING:break;case Ke.PORTAL_WARP:t=this.portalList;break;case Ke.ROOM_WARP:t=this.roomWarp}return t}addColliderHelper(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke.FLOOR;this.hasColliders()&&(this.helperObjects.hasOwnProperty("colliders")?this.helperObjects.colliders.hasOwnProperty(e)||(this.helperObjects.colliders[e]=null):(this.helperObjects.colliders={},this.helperObjects.colliders[e]=null),this.helperObjects.colliders[e]=this.pxlColliders.buildHelper(this,e),this.helperObjects.colliders[e]&&(this.scene.add(this.helperObjects.colliders[e]),this.hasHelpers=!0))}stepColliderHelper(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke.FLOOR;this.hasHelpers&&this.hasColliders()&&this.helperObjects.hasOwnProperty("colliders")&&this.helperObjects.colliders.hasOwnProperty(e)&&this.helperObjects.colliders[e].stepHelper(this,e)}toCameraPos(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e&&(e=this.defaultCamLocation),e=e.toLowerCase(),this.cameraBooted&&this.camLocation.hasOwnProperty(e)){var t=this.mobile?"positionmobile":"position",i=this.mobile?"lookatmobile":"lookat",s=this.camLocation[e][t],a=this.camLocation[e][i];a||(a=new o.Vector3(0,0,1)).addVectors(s,a),this.pxlEnv.pxlCamera.setTransform(this.camLocation[e][t],this.camLocation[e][i]),this.setUserHeight(this.camInitPos.y)}}fbxPostLoad(){this.booted=!0,this.toCameraPos(this.defaultCamLocation);var e=0;this.lightList.hasOwnProperty("PointLight")&&(e=this.lightList.PointLight.length);var t=Object.keys(this.lightList);if(t.length>0&&t.forEach((e=>{this.lightList[e].forEach((t=>{"DirectionalLight"===e?t.castShadow=!1:"PointLight"===e&&t.castShadow&&(t.shadow.radius=5,t.shadow.receiveShadow=!0,t.shadow.mapSize.width=512,t.shadow.mapSize.height=512,t.shadow.camera.near=.5,t.shadow.camera.far=35,t.shadow.bias=.025,t.shadow.radius=5)}))})),this.shaderGeoList)for(var i in this.shaderGeoList){var s=this.shaderGeoList[i];if(s.userData&&"pxlPrincipled"===s.userData.Shader){var a=o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.lights,o.UniformsLib.shadowmap,{dTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},detailTexture:{type:"t",value:null},cdMult:{type:"f",value:1},fogColor:{type:"c",value:this.scene.fog.color}}]),r={USE_MAP:""},n={},l=!0===s.userData.castShadow||!0===s.userData.receiveShadow,h=!1;s.material.map||(h=s.material.color.clone()),s.userData.ShaderParms&&""!==s.userData.ShaderParms&&(n=JSON.parse(s.userData.ShaderParms));var c=this.pxlFile.pxlShaderBuilder(a,pxlPrincipledVert(l),pxlPrincipledFrag(n,h,!0,!0,l,e),r);c.transparent=!1,c.lights=!0,h||(c.uniforms.dTexture.value=s.material.map),c.uniforms.noiseTexture.value=this.cloud3dTexture,c.uniforms.detailTexture.value=this.pxlEnv.detailNoiseTexture,s.material=c,this.materialList[s.name]=c}}}animPostLoad(e,t){if(this.pxlAnim.hasClip(e,this.animInitCycle)){var i=this.pxlAnim.getMixer(e);this.animMixer=i,this.pxlAnim.playClip(e,this.animInitCycle)}else{var s=this.pxlAnim.getFallbackCycle(e);this.animInitCycle=s,this.log("No animation cycle '"+this.animInitCycle+"' found; Using '"+s+"' instead")}}build(){this.sceneFile}onMessage(e,t){if(console.log("Room : "+this.roomName+" - Message Received: "+e),console.log("Message : "+t),"roomwarp"===(e=e.toLowerCase()))this.roomWarp=t;else console.log("-- Message Type Not Recognized -- "),console.log("Room : "+this.roomName),console.log("Message Received: "+e),console.log("Message : "+t)}},pxlEffects:ot,pxlShaders:nt,pxlBase:et};const At=dt})(),r=r.default})()));